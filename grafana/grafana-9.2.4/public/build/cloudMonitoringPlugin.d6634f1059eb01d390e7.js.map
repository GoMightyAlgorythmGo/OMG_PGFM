{"version":3,"file":"cloudMonitoringPlugin.d6634f1059eb01d390e7.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/CloudMonitoringCheatSheet.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/ConfigEditor/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/VariableQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/components/AnnotationQueryEditor.tsx","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/CloudMonitoringMetricFindQuery.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/variables.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/datasource.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/annotationSupport.ts","webpack://grafana/./public/app/plugins/datasource/cloud-monitoring/module.ts"],"sourcesContent":["import { css } from '@emotion/css';\nimport React, { PureComponent } from 'react';\n\nimport { QueryEditorHelpProps } from '@grafana/data';\n\nimport { CloudMonitoringQuery } from '../types';\n\nexport default class CloudMonitoringCheatSheet extends PureComponent<\n  QueryEditorHelpProps<CloudMonitoringQuery>,\n  { userExamples: string[] }\n> {\n  render() {\n    return (\n      <div>\n        <h2>Cloud Monitoring alias patterns</h2>\n        <div>\n          <p>\n            Format the legend keys any way you want by using alias patterns. Format the legend keys any way you want by\n            using alias patterns.\n          </p>\n          Example:\n          <code>{`${'{{metric.name}} - {{metric.label.instance_name}}'}`}</code>\n          <br />\n          Result: &nbsp;&nbsp;<code>cpu/usage_time - server1-europe-west-1</code>\n          <br />\n          <br />\n          <label>Patterns</label>\n          <br />\n          <ul\n            className={css`\n              list-style: none;\n            `}\n          >\n            <li>\n              <code>{`${'{{metric.type}}'}`}</code> = metric type e.g. compute.googleapis.com/instance/cpu/usage_time\n            </li>\n            <li>\n              <code>{`${'{{metric.name}}'}`}</code> = name part of metric e.g. instance/cpu/usage_time\n            </li>\n            <li>\n              <code>{`${'{{metric.service}}'}`}</code> = service part of metric e.g. compute\n            </li>\n            <li>\n              <code>{`${'{{metric.label.label_name}}'}`}</code> = Metric label metadata e.g. metric.label.instance_name\n            </li>\n            <li>\n              <code>{`${'{{resource.label.label_name}}'}`}</code> = Resource label metadata e.g. resource.label.zone\n            </li>\n            <li>\n              <code>{`${'{{metadata.system_labels.name}}'}`}</code> = Meta data system labels e.g.\n              metadata.system_labels.name. For this to work, the needs to be included in the group by\n            </li>\n            <li>\n              <code>{`${'{{metadata.user_labels.name}}'}`}</code> = Meta data user labels e.g.\n              metadata.user_labels.name. For this to work, the needs to be included in the group by\n            </li>\n            <li>\n              <code>{`${'{{bucket}}'}`}</code> = bucket boundary for distribution metrics when using a heatmap in\n              Grafana\n            </li>\n            <li>\n              <code>{`${'{{project}}'}`}</code> = The project name that was specified in the query editor\n            </li>\n            <li>\n              <code>{`${'{{service}}'}`}</code> = The service id that was specified in the SLO query editor\n            </li>\n            <li>\n              <code>{`${'{{slo}}'}`}</code> = The SLO id that was specified in the SLO query editor\n            </li>\n            <li>\n              <code>{`${'{{selector}}'}`}</code> = The Selector function that was specified in the SLO query editor\n            </li>\n          </ul>\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { ConnectionConfig } from '@grafana/google-sdk';\n\nimport { CloudMonitoringOptions, CloudMonitoringSecureJsonData } from '../../types';\n\nexport type Props = DataSourcePluginOptionsEditorProps<CloudMonitoringOptions, CloudMonitoringSecureJsonData>;\n\nexport class ConfigEditor extends PureComponent<Props> {\n  render() {\n    return (\n      <>\n        <ConnectionConfig {...this.props}></ConnectionConfig>\n      </>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\n\nimport CloudMonitoringDatasource from '../datasource';\nimport { extractServicesFromMetricDescriptors, getLabelKeys, getMetricTypes } from '../functions';\nimport {\n  CloudMonitoringOptions,\n  CloudMonitoringQuery,\n  CloudMonitoringVariableQuery,\n  MetricDescriptor,\n  MetricFindQueryTypes,\n  VariableQueryData,\n} from '../types';\n\nimport { VariableQueryField } from './';\n\nexport type Props = QueryEditorProps<\n  CloudMonitoringDatasource,\n  CloudMonitoringQuery,\n  CloudMonitoringOptions,\n  CloudMonitoringVariableQuery\n>;\n\nexport class CloudMonitoringVariableQueryEditor extends PureComponent<Props, VariableQueryData> {\n  queryTypes: Array<{ value: string; label: string }> = [\n    { value: MetricFindQueryTypes.Projects, label: 'Projects' },\n    { value: MetricFindQueryTypes.Services, label: 'Services' },\n    { value: MetricFindQueryTypes.MetricTypes, label: 'Metric Types' },\n    { value: MetricFindQueryTypes.LabelKeys, label: 'Label Keys' },\n    { value: MetricFindQueryTypes.LabelValues, label: 'Label Values' },\n    { value: MetricFindQueryTypes.ResourceTypes, label: 'Resource Types' },\n    { value: MetricFindQueryTypes.Aggregations, label: 'Aggregations' },\n    { value: MetricFindQueryTypes.Aligners, label: 'Aligners' },\n    { value: MetricFindQueryTypes.AlignmentPeriods, label: 'Alignment Periods' },\n    { value: MetricFindQueryTypes.Selectors, label: 'Selectors' },\n    { value: MetricFindQueryTypes.SLOServices, label: 'SLO Services' },\n    { value: MetricFindQueryTypes.SLO, label: 'Service Level Objectives (SLO)' },\n  ];\n\n  defaults: VariableQueryData = {\n    selectedQueryType: this.queryTypes[0].value,\n    metricDescriptors: [],\n    selectedService: '',\n    selectedMetricType: '',\n    labels: [],\n    labelKey: '',\n    metricTypes: [],\n    services: [],\n    sloServices: [],\n    selectedSLOService: '',\n    projects: [],\n    projectName: '',\n    loading: true,\n  };\n\n  constructor(props: Props) {\n    super(props);\n    this.state = Object.assign(this.defaults, this.props.query);\n  }\n\n  async componentDidMount() {\n    await this.props.datasource.ensureGCEDefaultProject();\n    const projectName = this.props.datasource.getDefaultProject();\n    const projects = (await this.props.datasource.getProjects()) as MetricDescriptor[];\n    const metricDescriptors = await this.props.datasource.getMetricTypes(\n      this.props.query.projectName || this.props.datasource.getDefaultProject()\n    );\n    const services = extractServicesFromMetricDescriptors(metricDescriptors).map((m: any) => ({\n      value: m.service,\n      label: m.serviceShortName,\n    }));\n\n    let selectedService = '';\n    if (services.some((s) => s.value === getTemplateSrv().replace(this.state.selectedService))) {\n      selectedService = this.state.selectedService;\n    } else if (services && services.length > 0) {\n      selectedService = services[0].value;\n    }\n\n    const { metricTypes, selectedMetricType } = getMetricTypes(\n      metricDescriptors,\n      this.state.selectedMetricType,\n      getTemplateSrv().replace(this.state.selectedMetricType),\n      getTemplateSrv().replace(selectedService)\n    );\n\n    const sloServices = await this.props.datasource.getSLOServices(projectName);\n\n    const state: any = {\n      services,\n      selectedService,\n      metricTypes,\n      selectedMetricType,\n      metricDescriptors,\n      projects,\n      ...(await this.getLabels(selectedMetricType, projectName)),\n      sloServices,\n      loading: false,\n      projectName,\n    };\n    this.setState(state, () => this.onPropsChange());\n  }\n\n  onPropsChange = () => {\n    const { metricDescriptors, labels, metricTypes, services, ...queryModel } = this.state;\n    this.props.onChange({ ...queryModel, refId: 'CloudMonitoringVariableQueryEditor-VariableQuery' });\n  };\n\n  async onQueryTypeChange(queryType: string) {\n    const state: any = {\n      selectedQueryType: queryType,\n      ...(await this.getLabels(this.state.selectedMetricType, this.state.projectName, queryType)),\n    };\n\n    this.setState(state);\n  }\n\n  async onProjectChange(projectName: string) {\n    const metricDescriptors = await this.props.datasource.getMetricTypes(projectName);\n    const labels = await this.getLabels(this.state.selectedMetricType, projectName);\n    const { metricTypes, selectedMetricType } = getMetricTypes(\n      metricDescriptors,\n      this.state.selectedMetricType,\n      getTemplateSrv().replace(this.state.selectedMetricType),\n      getTemplateSrv().replace(this.state.selectedService)\n    );\n\n    const sloServices = await this.props.datasource.getSLOServices(projectName);\n\n    this.setState(\n      {\n        ...labels,\n        metricTypes,\n        selectedMetricType,\n        metricDescriptors,\n        projectName,\n        sloServices,\n      },\n      () => this.onPropsChange()\n    );\n  }\n\n  async onServiceChange(service: string) {\n    const { metricTypes, selectedMetricType } = getMetricTypes(\n      this.state.metricDescriptors,\n      this.state.selectedMetricType,\n      getTemplateSrv().replace(this.state.selectedMetricType),\n      getTemplateSrv().replace(service)\n    );\n    const state: any = {\n      selectedService: service,\n      metricTypes,\n      selectedMetricType,\n      ...(await this.getLabels(selectedMetricType, this.state.projectName)),\n    };\n    this.setState(state, () => this.onPropsChange());\n  }\n\n  async onMetricTypeChange(metricType: string) {\n    const state: any = {\n      selectedMetricType: metricType,\n      ...(await this.getLabels(metricType, this.state.projectName)),\n    };\n    this.setState(state, () => this.onPropsChange());\n  }\n\n  onLabelKeyChange(labelKey: string) {\n    this.setState({ labelKey }, () => this.onPropsChange());\n  }\n\n  componentDidUpdate(prevProps: Readonly<Props>, prevState: Readonly<VariableQueryData>) {\n    const selecQueryTypeChanged = prevState.selectedQueryType !== this.state.selectedQueryType;\n    const selectSLOServiceChanged = this.state.selectedSLOService !== prevState.selectedSLOService;\n    if (selecQueryTypeChanged || selectSLOServiceChanged) {\n      this.onPropsChange();\n    }\n  }\n\n  async getLabels(selectedMetricType: string, projectName: string, selectedQueryType = this.state.selectedQueryType) {\n    let result = { labels: this.state.labels, labelKey: this.state.labelKey };\n    if (selectedMetricType && selectedQueryType === MetricFindQueryTypes.LabelValues) {\n      const labels = await getLabelKeys(this.props.datasource, selectedMetricType, projectName);\n      const labelKey = labels.some((l) => l === getTemplateSrv().replace(this.state.labelKey))\n        ? this.state.labelKey\n        : labels[0];\n      result = { labels, labelKey };\n    }\n    return result;\n  }\n\n  renderQueryTypeSwitch(queryType: string) {\n    const variableOptionGroup = {\n      label: 'Template Variables',\n      expanded: false,\n      options: getTemplateSrv()\n        .getVariables()\n        .map((v: any) => ({\n          value: `$${v.name}`,\n          label: `$${v.name}`,\n        })),\n    };\n\n    switch (queryType) {\n      case MetricFindQueryTypes.MetricTypes:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n            <VariableQueryField\n              value={this.state.selectedService}\n              options={[variableOptionGroup, ...this.state.services]}\n              onChange={(value) => this.onServiceChange(value)}\n              label=\"Service\"\n            />\n          </>\n        );\n      case MetricFindQueryTypes.LabelKeys:\n      case MetricFindQueryTypes.LabelValues:\n      case MetricFindQueryTypes.ResourceTypes:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n            <VariableQueryField\n              value={this.state.selectedService}\n              options={[variableOptionGroup, ...this.state.services]}\n              onChange={(value) => this.onServiceChange(value)}\n              label=\"Service\"\n            />\n            <VariableQueryField\n              value={this.state.selectedMetricType}\n              options={[\n                variableOptionGroup,\n                ...this.state.metricTypes.map(({ value, name }) => ({ value, label: name })),\n              ]}\n              onChange={(value) => this.onMetricTypeChange(value)}\n              label=\"Metric Type\"\n            />\n            {queryType === MetricFindQueryTypes.LabelValues && (\n              <VariableQueryField\n                value={this.state.labelKey}\n                options={[variableOptionGroup, ...this.state.labels.map((l) => ({ value: l, label: l }))]}\n                onChange={(value) => this.onLabelKeyChange(value)}\n                label=\"Label Key\"\n              />\n            )}\n          </>\n        );\n      case MetricFindQueryTypes.Aligners:\n      case MetricFindQueryTypes.Aggregations:\n        return (\n          <>\n            <VariableQueryField\n              value={this.state.selectedService}\n              options={[variableOptionGroup, ...this.state.services]}\n              onChange={(value) => this.onServiceChange(value)}\n              label=\"Service\"\n            />\n            <VariableQueryField\n              value={this.state.selectedMetricType}\n              options={[\n                variableOptionGroup,\n                ...this.state.metricTypes.map(({ value, name }) => ({ value, label: name })),\n              ]}\n              onChange={(value) => this.onMetricTypeChange(value)}\n              label=\"Metric Type\"\n            />\n          </>\n        );\n      case MetricFindQueryTypes.SLOServices:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n          </>\n        );\n\n      case MetricFindQueryTypes.SLO:\n        return (\n          <>\n            <VariableQueryField\n              allowCustomValue={true}\n              value={this.state.projectName}\n              options={[variableOptionGroup, ...this.state.projects]}\n              onChange={(value) => this.onProjectChange(value)}\n              label=\"Project\"\n            />\n            <VariableQueryField\n              value={this.state.selectedSLOService}\n              options={[variableOptionGroup, ...this.state.sloServices]}\n              onChange={(value) => {\n                this.setState({\n                  ...this.state,\n                  selectedSLOService: value,\n                });\n              }}\n              label=\"SLO Service\"\n            />\n          </>\n        );\n      default:\n        return '';\n    }\n  }\n\n  render() {\n    if (this.state.loading) {\n      return (\n        <div className=\"gf-form max-width-21\">\n          <span className=\"gf-form-label width-10 query-keyword\">Query Type</span>\n          <div className=\"gf-form-select-wrapper max-width-12\">\n            <select className=\"gf-form-input\">\n              <option>Loading...</option>\n            </select>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <>\n        <VariableQueryField\n          value={this.state.selectedQueryType}\n          options={this.queryTypes}\n          onChange={(value) => this.onQueryTypeChange(value)}\n          label=\"Query Type\"\n        />\n        {this.renderQueryTypeSwitch(this.state.selectedQueryType)}\n      </>\n    );\n  }\n}\n","import React, { useState } from 'react';\nimport { useDebounce } from 'react-use';\n\nimport { QueryEditorProps, toOption } from '@grafana/data';\nimport { EditorField, EditorRows } from '@grafana/experimental';\nimport { Input } from '@grafana/ui';\n\nimport CloudMonitoringDatasource from '../datasource';\nimport {\n  EditorMode,\n  MetricKind,\n  AnnotationMetricQuery,\n  CloudMonitoringOptions,\n  CloudMonitoringQuery,\n  AlignmentTypes,\n} from '../types';\n\nimport { MetricQueryEditor } from './MetricQueryEditor';\n\nimport { AnnotationsHelp } from './';\n\nexport type Props = QueryEditorProps<CloudMonitoringDatasource, CloudMonitoringQuery, CloudMonitoringOptions>;\n\nexport const defaultQuery: (datasource: CloudMonitoringDatasource) => AnnotationMetricQuery = (datasource) => ({\n  editorMode: EditorMode.Visual,\n  projectName: datasource.getDefaultProject(),\n  projects: [],\n  metricType: '',\n  filters: [],\n  metricKind: MetricKind.GAUGE,\n  valueType: '',\n  refId: 'annotationQuery',\n  title: '',\n  text: '',\n  labels: {},\n  variableOptionGroup: {},\n  variableOptions: [],\n  query: '',\n  crossSeriesReducer: 'REDUCE_NONE',\n  perSeriesAligner: AlignmentTypes.ALIGN_NONE,\n  alignmentPeriod: 'grafana-auto',\n});\n\nexport const AnnotationQueryEditor = (props: Props) => {\n  const { datasource, query, onRunQuery, data, onChange } = props;\n  const meta = data?.series.length ? data?.series[0].meta : {};\n  const customMetaData = meta?.custom ?? {};\n  const metricQuery = { ...defaultQuery(datasource), ...query.metricQuery };\n  const [title, setTitle] = useState(metricQuery.title || '');\n  const [text, setText] = useState(metricQuery.text || '');\n  const variableOptionGroup = {\n    label: 'Template Variables',\n    options: datasource.getVariables().map(toOption),\n  };\n\n  const handleQueryChange = (metricQuery: AnnotationMetricQuery) => onChange({ ...query, metricQuery });\n  const handleTitleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setTitle(e.target.value);\n  };\n  const handleTextChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setText(e.target.value);\n  };\n\n  useDebounce(\n    () => {\n      onChange({ ...query, metricQuery: { ...metricQuery, title } });\n    },\n    1000,\n    [title, onChange]\n  );\n  useDebounce(\n    () => {\n      onChange({ ...query, metricQuery: { ...metricQuery, text } });\n    },\n    1000,\n    [text, onChange]\n  );\n\n  return (\n    <EditorRows>\n      <>\n        <MetricQueryEditor\n          refId={query.refId}\n          variableOptionGroup={variableOptionGroup}\n          customMetaData={customMetaData}\n          onChange={handleQueryChange}\n          onRunQuery={onRunQuery}\n          datasource={datasource}\n          query={metricQuery}\n        />\n        <EditorField label=\"Title\" htmlFor=\"annotation-query-title\">\n          <Input id=\"annotation-query-title\" value={title} onChange={handleTitleChange} />\n        </EditorField>\n        <EditorField label=\"Text\" htmlFor=\"annotation-query-text\">\n          <Input id=\"annotation-query-text\" value={text} onChange={handleTextChange} />\n        </EditorField>\n      </>\n      <AnnotationsHelp />\n    </EditorRows>\n  );\n};\n","import { isString } from 'lodash';\n\nimport { SelectableValue } from '@grafana/data';\n\nimport { ALIGNMENT_PERIODS, SELECTORS } from './constants';\nimport CloudMonitoringDatasource from './datasource';\nimport {\n  extractServicesFromMetricDescriptors,\n  getAggregationOptionsByMetric,\n  getAlignmentOptionsByMetric,\n  getLabelKeys,\n  getMetricTypesByService,\n} from './functions';\nimport { CloudMonitoringVariableQuery, MetricDescriptor, MetricFindQueryTypes, MetricKind, ValueTypes } from './types';\n\nexport default class CloudMonitoringMetricFindQuery {\n  constructor(private datasource: CloudMonitoringDatasource) {}\n\n  async execute(query: CloudMonitoringVariableQuery) {\n    try {\n      if (!query.projectName) {\n        query.projectName = this.datasource.getDefaultProject();\n      }\n\n      switch (query.selectedQueryType) {\n        case MetricFindQueryTypes.Projects:\n          return this.handleProjectsQuery();\n        case MetricFindQueryTypes.Services:\n          return this.handleServiceQuery(query);\n        case MetricFindQueryTypes.MetricTypes:\n          return this.handleMetricTypesQuery(query);\n        case MetricFindQueryTypes.LabelKeys:\n          return this.handleLabelKeysQuery(query);\n        case MetricFindQueryTypes.LabelValues:\n          return this.handleLabelValuesQuery(query);\n        case MetricFindQueryTypes.ResourceTypes:\n          return this.handleResourceTypeQuery(query);\n        case MetricFindQueryTypes.Aligners:\n          return this.handleAlignersQuery(query);\n        case MetricFindQueryTypes.AlignmentPeriods:\n          return this.handleAlignmentPeriodQuery();\n        case MetricFindQueryTypes.Aggregations:\n          return this.handleAggregationQuery(query);\n        case MetricFindQueryTypes.SLOServices:\n          return this.handleSLOServicesQuery(query);\n        case MetricFindQueryTypes.SLO:\n          return this.handleSLOQuery(query);\n        case MetricFindQueryTypes.Selectors:\n          return this.handleSelectorQuery();\n        default:\n          return [];\n      }\n    } catch (error) {\n      console.error(`Could not run CloudMonitoringMetricFindQuery ${query}`, error);\n      return [];\n    }\n  }\n\n  async handleProjectsQuery() {\n    const projects = await this.datasource.getProjects();\n    return (projects as SelectableValue<string>).map((s: { label: string; value: string }) => ({\n      text: s.label,\n      value: s.value,\n      expandable: true,\n    }));\n  }\n\n  async handleServiceQuery({ projectName }: CloudMonitoringVariableQuery) {\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    const services: MetricDescriptor[] = extractServicesFromMetricDescriptors(metricDescriptors);\n    return services.map((s) => ({\n      text: s.serviceShortName,\n      value: s.service,\n      expandable: true,\n    }));\n  }\n\n  async handleMetricTypesQuery({ selectedService, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedService) {\n      return [];\n    }\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    return getMetricTypesByService(metricDescriptors, this.datasource.templateSrv.replace(selectedService)).map(\n      (s) => ({\n        text: s.displayName,\n        value: s.type,\n        expandable: true,\n      })\n    );\n  }\n\n  async handleLabelKeysQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const labelKeys = await getLabelKeys(this.datasource, selectedMetricType, projectName);\n    return labelKeys.map(this.toFindQueryResult);\n  }\n\n  async handleLabelValuesQuery({ selectedMetricType, labelKey, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const refId = 'handleLabelValuesQuery';\n    // REDUCE_MEAN is needed so the groupBy is not ignored\n    const labels = await this.datasource.getLabels(selectedMetricType, refId, projectName, {\n      groupBys: [labelKey],\n      crossSeriesReducer: 'REDUCE_MEAN',\n    });\n    const interpolatedKey = this.datasource.templateSrv.replace(labelKey);\n    const values = labels.hasOwnProperty(interpolatedKey) ? labels[interpolatedKey] : [];\n    return values.map(this.toFindQueryResult);\n  }\n\n  async handleResourceTypeQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const refId = 'handleResourceTypeQueryQueryType';\n    const labels = await this.datasource.getLabels(selectedMetricType, refId, projectName);\n    return labels['resource.type']?.map(this.toFindQueryResult) ?? [];\n  }\n\n  async handleAlignersQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    const descriptor = metricDescriptors.find(\n      (m) => m.type === this.datasource.templateSrv.replace(selectedMetricType)\n    );\n\n    if (!descriptor) {\n      return [];\n    }\n\n    return getAlignmentOptionsByMetric(descriptor.valueType, descriptor.metricKind).map(this.toFindQueryResult);\n  }\n\n  async handleAggregationQuery({ selectedMetricType, projectName }: CloudMonitoringVariableQuery) {\n    if (!selectedMetricType) {\n      return [];\n    }\n\n    const metricDescriptors = await this.datasource.getMetricTypes(projectName);\n    const descriptor = metricDescriptors.find(\n      (m) => m.type === this.datasource.templateSrv.replace(selectedMetricType)\n    );\n\n    if (!descriptor) {\n      return [];\n    }\n\n    return getAggregationOptionsByMetric(descriptor.valueType as ValueTypes, descriptor.metricKind as MetricKind).map(\n      this.toFindQueryResult\n    );\n  }\n\n  async handleSLOServicesQuery({ projectName }: CloudMonitoringVariableQuery) {\n    const services = await this.datasource.getSLOServices(projectName);\n    return services.map(this.toFindQueryResult);\n  }\n\n  async handleSLOQuery({ selectedSLOService, projectName }: CloudMonitoringVariableQuery) {\n    const slos = await this.datasource.getServiceLevelObjectives(projectName, selectedSLOService);\n    return slos.map(this.toFindQueryResult);\n  }\n\n  async handleSelectorQuery() {\n    return SELECTORS.map(this.toFindQueryResult);\n  }\n\n  handleAlignmentPeriodQuery() {\n    return ALIGNMENT_PERIODS.map(this.toFindQueryResult);\n  }\n\n  toFindQueryResult(x: any) {\n    return isString(x) ? { text: x, expandable: true } : { ...x, expandable: true };\n  }\n}\n","import { from, Observable } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport { CustomVariableSupport, DataQueryRequest, DataQueryResponse } from '@grafana/data';\n\nimport CloudMonitoringMetricFindQuery from './CloudMonitoringMetricFindQuery';\nimport { CloudMonitoringVariableQueryEditor } from './components/VariableQueryEditor';\nimport CloudMonitoringDatasource from './datasource';\nimport { CloudMonitoringVariableQuery } from './types';\n\nexport class CloudMonitoringVariableSupport extends CustomVariableSupport<\n  CloudMonitoringDatasource,\n  CloudMonitoringVariableQuery\n> {\n  private readonly metricFindQuery: CloudMonitoringMetricFindQuery;\n\n  constructor(private readonly datasource: CloudMonitoringDatasource) {\n    super();\n    this.metricFindQuery = new CloudMonitoringMetricFindQuery(datasource);\n    this.query = this.query.bind(this);\n  }\n\n  editor = CloudMonitoringVariableQueryEditor;\n\n  query(request: DataQueryRequest<CloudMonitoringVariableQuery>): Observable<DataQueryResponse> {\n    const executeObservable = from(this.metricFindQuery.execute(request.targets[0]));\n    return from(this.datasource.ensureGCEDefaultProject()).pipe(\n      mergeMap(() => executeObservable),\n      map((data) => ({ data }))\n    );\n  }\n}\n","import { chunk, flatten, isString, isArray } from 'lodash';\nimport { from, lastValueFrom, Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport {\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceInstanceSettings,\n  ScopedVars,\n  SelectableValue,\n} from '@grafana/data';\nimport { DataSourceWithBackend, getBackendSrv, toDataQueryResponse } from '@grafana/runtime';\nimport { getTimeSrv, TimeSrv } from 'app/features/dashboard/services/TimeSrv';\nimport { getTemplateSrv, TemplateSrv } from 'app/features/templating/template_srv';\n\nimport { CloudMonitoringAnnotationSupport } from './annotationSupport';\nimport { SLO_BURN_RATE_SELECTOR_NAME } from './constants';\nimport {\n  CloudMonitoringOptions,\n  CloudMonitoringQuery,\n  EditorMode,\n  Filter,\n  MetricDescriptor,\n  QueryType,\n  PostResponse,\n  Aggregation,\n} from './types';\nimport { CloudMonitoringVariableSupport } from './variables';\n\nexport default class CloudMonitoringDatasource extends DataSourceWithBackend<\n  CloudMonitoringQuery,\n  CloudMonitoringOptions\n> {\n  authenticationType: string;\n  intervalMs: number;\n\n  constructor(\n    private instanceSettings: DataSourceInstanceSettings<CloudMonitoringOptions>,\n    public templateSrv: TemplateSrv = getTemplateSrv(),\n    private readonly timeSrv: TimeSrv = getTimeSrv()\n  ) {\n    super(instanceSettings);\n    this.authenticationType = instanceSettings.jsonData.authenticationType || 'jwt';\n    this.variables = new CloudMonitoringVariableSupport(this);\n    this.intervalMs = 0;\n    this.annotations = CloudMonitoringAnnotationSupport(this);\n  }\n\n  getVariables() {\n    return this.templateSrv.getVariables().map((v) => `$${v.name}`);\n  }\n\n  query(request: DataQueryRequest<CloudMonitoringQuery>): Observable<DataQueryResponse> {\n    request.targets = request.targets.map((t) => ({\n      ...this.migrateQuery(t),\n      intervalMs: request.intervalMs,\n    }));\n    return super.query(request);\n  }\n\n  applyTemplateVariables(target: CloudMonitoringQuery, scopedVars: ScopedVars): Record<string, any> {\n    const { metricQuery, sloQuery } = target;\n    return {\n      ...target,\n      datasource: this.getRef(),\n      intervalMs: this.intervalMs,\n      metricQuery: {\n        ...this.interpolateProps(metricQuery, scopedVars),\n        projectName: this.templateSrv.replace(\n          metricQuery.projectName ? metricQuery.projectName : this.getDefaultProject(),\n          scopedVars\n        ),\n        filters: this.interpolateFilters(metricQuery.filters || [], scopedVars),\n        groupBys: this.interpolateGroupBys(metricQuery.groupBys || [], scopedVars),\n        view: metricQuery.view || 'FULL',\n        editorMode: metricQuery.editorMode,\n      },\n      sloQuery: sloQuery && this.interpolateProps(sloQuery, scopedVars),\n    };\n  }\n\n  async getLabels(metricType: string, refId: string, projectName: string, aggregation?: Aggregation) {\n    const options = {\n      targets: [\n        {\n          refId,\n          datasource: this.getRef(),\n          queryType: QueryType.METRICS,\n          metricQuery: {\n            projectName: this.templateSrv.replace(projectName),\n            metricType: this.templateSrv.replace(metricType),\n            groupBys: this.interpolateGroupBys(aggregation?.groupBys || [], {}),\n            crossSeriesReducer: aggregation?.crossSeriesReducer ?? 'REDUCE_NONE',\n            view: 'HEADERS',\n          },\n        },\n      ],\n      range: this.timeSrv.timeRange(),\n    } as DataQueryRequest<CloudMonitoringQuery>;\n\n    const queries = options.targets;\n\n    if (!queries.length) {\n      return lastValueFrom(of({ results: [] }));\n    }\n\n    return lastValueFrom(\n      from(this.ensureGCEDefaultProject()).pipe(\n        mergeMap(() => {\n          return getBackendSrv().fetch<PostResponse>({\n            url: '/api/ds/query',\n            method: 'POST',\n            data: {\n              from: options.range.from.valueOf().toString(),\n              to: options.range.to.valueOf().toString(),\n              queries,\n            },\n          });\n        }),\n        map(({ data }) => {\n          const dataQueryResponse = toDataQueryResponse({\n            data: data,\n          });\n          const labels = dataQueryResponse?.data\n            .map((f) => f.meta?.custom?.labels)\n            .filter((p) => !!p)\n            .reduce((acc, labels) => {\n              for (let key in labels) {\n                if (!acc[key]) {\n                  acc[key] = new Set<string>();\n                }\n                if (labels[key]) {\n                  acc[key].add(labels[key]);\n                }\n              }\n              return acc;\n            }, {});\n          return Object.fromEntries(\n            Object.entries(labels).map((l: any) => {\n              l[1] = Array.from(l[1]);\n              return l;\n            })\n          );\n        })\n      )\n    );\n  }\n\n  async getGCEDefaultProject() {\n    return this.getResource(`gceDefaultProject`);\n  }\n\n  getDefaultProject(): string {\n    const { defaultProject, authenticationType, gceDefaultProject } = this.instanceSettings.jsonData;\n    if (authenticationType === 'gce') {\n      return gceDefaultProject || '';\n    }\n\n    return defaultProject || '';\n  }\n\n  async ensureGCEDefaultProject() {\n    const { authenticationType, gceDefaultProject } = this.instanceSettings.jsonData;\n    if (authenticationType === 'gce' && !gceDefaultProject) {\n      this.instanceSettings.jsonData.gceDefaultProject = await this.getGCEDefaultProject();\n    }\n  }\n\n  async getMetricTypes(projectName: string): Promise<MetricDescriptor[]> {\n    if (!projectName) {\n      return [];\n    }\n\n    return this.getResource(\n      `metricDescriptors/v3/projects/${this.templateSrv.replace(projectName)}/metricDescriptors`\n    ) as Promise<MetricDescriptor[]>;\n  }\n\n  async getSLOServices(projectName: string): Promise<Array<SelectableValue<string>>> {\n    return this.getResource(`services/v3/projects/${this.templateSrv.replace(projectName)}/services?pageSize=1000`);\n  }\n\n  async getServiceLevelObjectives(projectName: string, serviceId: string): Promise<Array<SelectableValue<string>>> {\n    if (!serviceId) {\n      return Promise.resolve([]);\n    }\n    let { projectName: p, serviceId: s } = this.interpolateProps({ projectName, serviceId });\n    return this.getResource(`slo-services/v3/projects/${p}/services/${s}/serviceLevelObjectives`);\n  }\n\n  getProjects(): Promise<Array<SelectableValue<string>>> {\n    return this.getResource(`projects`);\n  }\n\n  migrateQuery(query: CloudMonitoringQuery): CloudMonitoringQuery {\n    if (!query.hasOwnProperty('metricQuery')) {\n      const { hide, refId, datasource, key, queryType, maxLines, metric, intervalMs, type, ...rest } = query as any;\n      return {\n        refId,\n        intervalMs,\n        type,\n        hide,\n        queryType: QueryType.METRICS,\n        metricQuery: {\n          ...rest,\n          view: rest.view || 'FULL',\n        },\n      };\n    }\n    return query;\n  }\n\n  interpolateProps<T extends Record<string, any>>(object: T, scopedVars: ScopedVars = {}): T {\n    return Object.entries(object).reduce((acc, [key, value]) => {\n      return {\n        ...acc,\n        [key]: value && isString(value) ? this.templateSrv.replace(value, scopedVars) : value,\n      };\n    }, {} as T);\n  }\n\n  filterQuery(query: CloudMonitoringQuery): boolean {\n    if (query.hide) {\n      return false;\n    }\n\n    if (query.queryType && query.queryType === QueryType.SLO && query.sloQuery) {\n      const { selectorName, serviceId, sloId, projectName, lookbackPeriod } = query.sloQuery;\n      return (\n        !!selectorName &&\n        !!serviceId &&\n        !!sloId &&\n        !!projectName &&\n        (selectorName !== SLO_BURN_RATE_SELECTOR_NAME || !!lookbackPeriod)\n      );\n    }\n\n    if (query.queryType && query.queryType === QueryType.METRICS && query.metricQuery.editorMode === EditorMode.MQL) {\n      return !!query.metricQuery.projectName && !!query.metricQuery.query;\n    }\n\n    const { metricType } = query.metricQuery;\n\n    return !!metricType;\n  }\n\n  interpolateVariablesInQueries(queries: CloudMonitoringQuery[], scopedVars: ScopedVars): CloudMonitoringQuery[] {\n    return queries.map(\n      (query) => this.applyTemplateVariables(this.migrateQuery(query), scopedVars) as CloudMonitoringQuery\n    );\n  }\n\n  interpolateFilters(filters: string[], scopedVars: ScopedVars) {\n    const completeFilter: Filter[] = chunk(filters, 4)\n      .map(([key, operator, value, condition]) => ({\n        key,\n        operator,\n        value,\n        ...(condition && { condition }),\n      }))\n      .filter((item) => item.value);\n\n    const filterArray = flatten(\n      completeFilter.map(({ key, operator, value, condition }: Filter) => [\n        this.templateSrv.replace(key, scopedVars || {}),\n        operator,\n        this.templateSrv.replace(value, scopedVars || {}, (value: string | string[]) => {\n          return isArray(value) && value.length ? `(${value.join('|')})` : value;\n        }),\n        ...(condition ? [condition] : []),\n      ])\n    );\n\n    return filterArray || [];\n  }\n\n  interpolateGroupBys(groupBys: string[], scopedVars: {}): string[] {\n    let interpolatedGroupBys: string[] = [];\n    (groupBys || []).forEach((gb) => {\n      const interpolated = this.templateSrv.replace(gb, scopedVars || {}, 'csv').split(',');\n      if (Array.isArray(interpolated)) {\n        interpolatedGroupBys = interpolatedGroupBys.concat(interpolated);\n      } else {\n        interpolatedGroupBys.push(interpolated);\n      }\n    });\n    return interpolatedGroupBys;\n  }\n}\n","import { AnnotationSupport, AnnotationQuery } from '@grafana/data';\n\nimport { AnnotationQueryEditor } from './components/AnnotationQueryEditor';\nimport CloudMonitoringDatasource from './datasource';\nimport {\n  AlignmentTypes,\n  CloudMonitoringQuery,\n  EditorMode,\n  LegacyCloudMonitoringAnnotationQuery,\n  MetricKind,\n  QueryType,\n} from './types';\n\n// The legacy query format sets the title and text values to empty strings by default.\n// If the title or text is not undefined at the top-level of the annotation target,\n// then it is a legacy query.\nconst isLegacyCloudMonitoringAnnotation = (\n  query: unknown\n): query is AnnotationQuery<LegacyCloudMonitoringAnnotationQuery> =>\n  (query as AnnotationQuery<LegacyCloudMonitoringAnnotationQuery>).target?.title !== undefined ||\n  (query as AnnotationQuery<LegacyCloudMonitoringAnnotationQuery>).target?.text !== undefined;\n\nexport const CloudMonitoringAnnotationSupport: (\n  ds: CloudMonitoringDatasource\n) => AnnotationSupport<CloudMonitoringQuery> = (ds: CloudMonitoringDatasource) => {\n  return {\n    prepareAnnotation: (\n      query: AnnotationQuery<LegacyCloudMonitoringAnnotationQuery> | AnnotationQuery<CloudMonitoringQuery>\n    ): AnnotationQuery<CloudMonitoringQuery> => {\n      if (!isLegacyCloudMonitoringAnnotation(query)) {\n        return query;\n      }\n\n      const { enable, name, iconColor } = query;\n      const { target } = query;\n      const result: AnnotationQuery<CloudMonitoringQuery> = {\n        datasource: query.datasource,\n        enable,\n        name,\n        iconColor,\n        target: {\n          intervalMs: ds.intervalMs,\n          refId: target?.refId || 'annotationQuery',\n          type: 'annotationQuery',\n          queryType: QueryType.METRICS,\n          metricQuery: {\n            projectName: target?.projectName || ds.getDefaultProject(),\n            editorMode: EditorMode.Visual,\n            metricType: target?.metricType || '',\n            filters: target?.filters || [],\n            metricKind: target?.metricKind || MetricKind.GAUGE,\n            query: '',\n            crossSeriesReducer: 'REDUCE_NONE',\n            perSeriesAligner: AlignmentTypes.ALIGN_NONE,\n            title: target?.title || '',\n            text: target?.text || '',\n          },\n        },\n      };\n      return result;\n    },\n    prepareQuery: (anno: AnnotationQuery<CloudMonitoringQuery>) => {\n      if (!anno.target) {\n        return undefined;\n      }\n\n      return {\n        ...anno.target,\n        queryType: QueryType.METRICS,\n        type: 'annotationQuery',\n        metricQuery: {\n          ...anno.target.metricQuery,\n        },\n      };\n    },\n    QueryEditor: AnnotationQueryEditor,\n  };\n};\n","import { DataSourcePlugin } from '@grafana/data';\n\nimport CloudMonitoringCheatSheet from './components/CloudMonitoringCheatSheet';\nimport { ConfigEditor } from './components/ConfigEditor/ConfigEditor';\nimport { QueryEditor } from './components/QueryEditor';\nimport { CloudMonitoringVariableQueryEditor } from './components/VariableQueryEditor';\nimport CloudMonitoringDatasource from './datasource';\nimport { CloudMonitoringQuery } from './types';\n\nexport const plugin = new DataSourcePlugin<CloudMonitoringDatasource, CloudMonitoringQuery>(CloudMonitoringDatasource)\n  .setQueryEditorHelp(CloudMonitoringCheatSheet)\n  .setQueryEditor(QueryEditor)\n  .setConfigEditor(ConfigEditor)\n  .setVariableQueryEditor(CloudMonitoringVariableQueryEditor);\n"],"names":["CloudMonitoringCheatSheet","PureComponent","render","className","css","ConfigEditor","ConnectionConfig","this","props","CloudMonitoringVariableQueryEditor","constructor","super","value","MetricFindQueryTypes","label","selectedQueryType","queryTypes","metricDescriptors","selectedService","selectedMetricType","labels","labelKey","metricTypes","services","sloServices","selectedSLOService","projects","projectName","loading","queryModel","state","onChange","refId","Object","assign","defaults","query","datasource","ensureGCEDefaultProject","getDefaultProject","getProjects","getMetricTypes","extractServicesFromMetricDescriptors","map","m","service","serviceShortName","some","s","getTemplateSrv","replace","length","getSLOServices","getLabels","setState","onPropsChange","queryType","metricType","onLabelKeyChange","componentDidUpdate","prevProps","prevState","selecQueryTypeChanged","selectSLOServiceChanged","result","getLabelKeys","l","renderQueryTypeSwitch","variableOptionGroup","expanded","options","getVariables","v","name","allowCustomValue","onProjectChange","onServiceChange","onMetricTypeChange","onQueryTypeChange","AnnotationQueryEditor","onRunQuery","data","meta","series","customMetaData","custom","metricQuery","editorMode","EditorMode","filters","metricKind","MetricKind","valueType","title","text","variableOptions","crossSeriesReducer","perSeriesAligner","AlignmentTypes","alignmentPeriod","defaultQuery","setTitle","useState","setText","toOption","useDebounce","EditorRows","MetricQueryEditor","EditorField","htmlFor","Input","I","id","e","target","CloudMonitoringMetricFindQuery","handleProjectsQuery","handleServiceQuery","handleMetricTypesQuery","handleLabelKeysQuery","handleLabelValuesQuery","handleResourceTypeQuery","handleAlignersQuery","handleAlignmentPeriodQuery","handleAggregationQuery","handleSLOServicesQuery","handleSLOQuery","handleSelectorQuery","error","console","expandable","getMetricTypesByService","templateSrv","displayName","type","toFindQueryResult","groupBys","interpolatedKey","hasOwnProperty","descriptor","find","getAlignmentOptionsByMetric","getAggregationOptionsByMetric","getServiceLevelObjectives","SELECTORS","ALIGNMENT_PERIODS","x","isString","CloudMonitoringVariableSupport","CustomVariableSupport","metricFindQuery","bind","request","executeObservable","from","execute","targets","pipe","mergeMap","CloudMonitoringDatasource","DataSourceWithBackend","instanceSettings","timeSrv","getTimeSrv","ds","authenticationType","jsonData","variables","intervalMs","annotations","prepareAnnotation","undefined","isLegacyCloudMonitoringAnnotation","enable","iconColor","QueryType","prepareQuery","anno","QueryEditor","t","migrateQuery","applyTemplateVariables","scopedVars","sloQuery","getRef","interpolateProps","interpolateFilters","interpolateGroupBys","view","aggregation","range","timeRange","queries","lastValueFrom","getBackendSrv","fetch","url","method","valueOf","toString","to","dataQueryResponse","toDataQueryResponse","f","filter","p","reduce","acc","key","Set","add","fromEntries","entries","Array","of","results","getResource","defaultProject","gceDefaultProject","getGCEDefaultProject","serviceId","Promise","resolve","hide","rest","object","filterQuery","selectorName","sloId","lookbackPeriod","SLO_BURN_RATE_SELECTOR_NAME","interpolateVariablesInQueries","completeFilter","chunk","operator","condition","item","flatten","isArray","join","interpolatedGroupBys","forEach","gb","interpolated","split","concat","push","plugin","DataSourcePlugin","setQueryEditorHelp","setQueryEditor","setConfigEditor","setVariableQueryEditor"],"sourceRoot":""}