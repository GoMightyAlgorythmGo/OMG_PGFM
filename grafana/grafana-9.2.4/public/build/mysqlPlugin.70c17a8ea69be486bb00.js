(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4251],{63843:(e,t,n)=>{"use strict";n.d(t,{d:()=>u});n(68404);var r,i,a,s=n(81391),o=n(24643),l=n(67174),c=n(45916);const u=e=>{const{labelWidth:t,editorProps:n,showCACert:u,showKeyPair:d=!0}=e,{secureJsonFields:h}=n.options;return(0,c.jsxs)(c.Fragment,{children:[d?(0,c.jsx)(o._,{tooltip:r||(r=(0,c.jsx)("span",{children:"To authenticate with an TLS/SSL client certificate, provide the client certificate here."})),labelWidth:t,label:"TLS/SSL Client Certificate",children:(0,c.jsx)(l.Zk,{placeholder:"Begins with -----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:h&&h.tlsClientCert,onChange:(0,s.fi)(n,"tlsClientCert"),onReset:()=>{(0,s.Mf)(n,"tlsClientCert")}})}):null,u?(0,c.jsx)(o._,{tooltip:i||(i=(0,c.jsx)("span",{children:"If the selected TLS/SSL mode requires a server root certificate, provide it here."})),labelWidth:t,label:"TLS/SSL Root Certificate",children:(0,c.jsx)(l.Zk,{placeholder:"Begins with -----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:h&&h.tlsCACert,onChange:(0,s.fi)(n,"tlsCACert"),onReset:()=>{(0,s.Mf)(n,"tlsCACert")}})}):null,d?(0,c.jsx)(o._,{tooltip:a||(a=(0,c.jsx)("span",{children:"To authenticate with a client TLS/SSL certificate, provide the key here."})),labelWidth:t,label:"TLS/SSL Client Key",children:(0,c.jsx)(l.Zk,{placeholder:"Begins with -----BEGIN RSA PRIVATE KEY-----",cols:45,rows:7,isConfigured:h&&h.tlsClientKey,onChange:(0,s.fi)(n,"tlsClientKey"),onReset:()=>{(0,s.Mf)(n,"tlsClientKey")}})}):null]})}},54105:(e,t,n)=>{"use strict";n.r(t),n.d(t,{plugin:()=>$});var r=n(12822),i=n(24620),a=n(40773),s=n(355);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l{constructor(e,t,n){o(this,"target",void 0),o(this,"templateSrv",void 0),o(this,"scopedVars",void 0),this.target=e,this.templateSrv=t,this.scopedVars=n}unquoteIdentifier(e){return'"'===e[0]&&'"'===e[e.length-1]?e.substring(1,e.length-1).replace(/""/g,'"'):e}quoteIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}quoteLiteral(e){return"'"+e.replace(/'/g,"''")+"'"}getDatabase(){return this.target.dataset}}var c=n(82897);class u{transformMetricFindResponse(e){const t=[],n=e.fields.find((e=>"__text"===e.name)),r=e.fields.find((e=>"__value"===e.name));if(n&&r)for(let e=0;e<n.values.length;e++)t.push({text:""+n.values.get(e),value:""+r.values.get(e)});else t.push(...e.fields.flatMap((e=>e.values.toArray())).map((e=>({text:e}))));return(0,c.uniqBy)(t,"text")}}function d(e){switch(e){case"TIME":case"DATETIME":case"TIMESTAMP":return"clock-nine";case"BOOLEAN":return"toggle-off";case"INTEGER":case"FLOAT":case"FLOAT64":case"INT":case"SMALLINT":case"BIGINT":case"TINYINT":case"BYTEINT":case"INT64":case"NUMERIC":case"DECIMAL":return"calculator-alt";case"CHAR":case"VARCHAR":case"STRING":case"BYTES":case"TEXT":case"TINYTEXT":case"MEDIUMTEXT":case"LONGTEXT":return"text";case"GEOGRAPHY":return"map";default:return}}function h(e,t,n,r){let i="SELECT column_name, data_type FROM information_schema.columns WHERE ";switch(i+=function(e,t){let n="";if(t.includes(".")){const r=t.split(".");return n="table_schema = "+m(e,r[0]),n+=" AND table_name = "+m(e,r[1]),n}return n=`table_schema = ${void 0!==e.getDatabase()?`'${e.getDatabase()}'`:"database()"} AND table_name = `+m(e,t),n}(e,t),n){case"time":i+=" AND data_type IN ('timestamp','datetime','bigint','int','double','float')";break;case"metric":case"group":i+=" AND data_type IN ('text','tinytext','mediumtext','longtext','varchar','char')";break;case"value":i+=" AND data_type IN ('bigint','int','smallint','mediumint','tinyint','double','decimal','float')",i+=" AND column_name <> "+m(e,r)}return i+=" ORDER BY column_name",i}function m(e,t){return e.quoteLiteral(e.unquoteIdentifier(t))}var f=n(58123);const p=[{id:"STDDEV",name:"STDDEV",description:"STDDEV(\n    expression\n  )\n\n  Returns the standard deviation of non-NULL input values, or NaN if the input contains a NaN."},{id:"VARIANCE",name:"VARIANCE",description:"VARIANCE(\n    expression\n  )\n\n  Returns the variance of non-NULL input values, or NaN if the input contains a NaN."}];let v,g,C;!function(e){e.AfterDataset="afterDataset",e.AfterFrom="afterFrom",e.AfterSelect="afterSelect"}(v||(v={})),function(e){e.TablesWithinDataset="tablesWithinDataset"}(g||(g={})),function(e){e.Next="next",e.Previous="previous"}(C||(C={}));var b;!function(e){e.Select="SELECT",e.Where="WHERE",e.From="FROM"}(b||(b={}));const T=()=>[{id:v.AfterDataset,resolve:(e,t)=>{var n;return Boolean((null==e?void 0:e.is(s.iv.Delimiter,"."))||(null==e?void 0:e.is(s.iv.Whitespace))&&(null==e||null===(n=e.previous)||void 0===n?void 0:n.is(s.iv.Delimiter,".")))}},{id:v.AfterFrom,resolve:(e,t)=>Boolean(x(e))},{id:v.AfterSelect,resolve:(e,t)=>{var n;const r=w(e,b.Select)||function(e){return E(e,b.Select)}(e)&&(null==e||null===(n=e.previous)||void 0===n?void 0:n.is(s.iv.Delimiter,","));return Boolean(r)}}],S=(e,t,n)=>()=>[{id:g.TablesWithinDataset,applyTo:[v.AfterDataset],suggestionsResolver:async t=>{const n=t.currentToken?function(e){let t=e,n="";for(;null!==(r=t)&&void 0!==r&&r.previous&&!t.previous.isWhiteSpace();){var r;t=t.previous,n=t.value+n}return n=n.trim(),n}(t.currentToken):"";return(await e.current(n)).map((e=>{var n;return y(e.name,null!==(n=e.completion)&&void 0!==n?n:e.name,s.cm.Field,t)}))}},{id:"metaAfterSelect",applyTo:[v.AfterSelect],suggestionsResolver:async e=>{const t=A(e.currentToken,C.Next);return(await n.current(t)).map((t=>{const n=t.kind===s.cm.Class?`${t.completion}.`:t.completion;return y(t.name,n,t.kind,e)}))}},{id:"metaAfterSelectFuncArg",applyTo:[s.fC.AfterSelectFuncFirstArgument],suggestionsResolver:async e=>{const t=A(e.currentToken,C.Next);return(await n.current(t)).map((t=>{const n=t.kind===s.cm.Class?`${t.completion}.`:t.completion;return y(t.name,n,t.kind,e)}))}},{id:"metaAfterFrom",applyTo:[v.AfterFrom],suggestionsResolver:async e=>{var t;if(!x(e.currentToken))return[];const r=(null===(t=e.currentToken)||void 0===t?void 0:t.value)||"";return(await n.current(r)).map((t=>y(t.name,t.completion,t.kind,e)))}},{id:`MYSQL${s.fC.WhereKeyword}`,applyTo:[s.fC.WhereKeyword],suggestionsResolver:async e=>{const t=A(e.currentToken,C.Previous);return(await n.current(t)).map((t=>{const n=t.kind===s.cm.Class?`${t.completion}.`:t.completion;return y(t.name,n,t.kind,e)}))}},{id:s.fC.WhereComparisonOperator,applyTo:[s.fC.WhereComparisonOperator],suggestionsResolver:async e=>{if(!E(e.currentToken,b.Where))return[];const t=A(e.currentToken,C.Previous);return(await n.current(t)).map((t=>{const n=t.kind===s.cm.Class?`${t.completion}.`:t.completion;return y(t.name,n,t.kind,e)}))}}];function A(e,t){let n=(null==e?void 0:e.value)||"";const r=function(e,t,n){let r=e;for(;r;){if(r.is(s.iv.Keyword,t))return I(r);r=r[n]}return!1}(e,b.From,t);return r&&(n=r),n}function y(e,t,n,r){return{label:e,insertText:t,command:{id:"editor.action.triggerSuggest",title:""},kind:n,sortText:s.G8.High,range:Object.assign({},r.range,{startColumn:r.range.endColumn,endColumn:r.range.endColumn})}}function x(e){return w(e,b.From)}function E(e,t){if(null==e||!e.is(s.iv.Keyword)){let r=e;for(;;){var n;if(!r)return!1;if(r.is(s.iv.Keyword,t))return!0;if(r.isKeyword())return!1;r=(null===(n=r)||void 0===n?void 0:n.previous)||null}}return!1}function w(e,t){var n;return(null==e?void 0:e.is(s.iv.Whitespace))&&(null==e||null===(n=e.previous)||void 0===n?void 0:n.is(s.iv.Keyword,t))}function I(e){const t=null==e?void 0:e.next;if(null!=t&&t.isWhiteSpace()){var n;const e=t.next,r=null==e?void 0:e.next;return null!=r&&r.is(s.iv.Delimiter)?`${null==e?void 0:e.value}${null==r?void 0:r.value}${null===(n=r.next)||void 0===n?void 0:n.value}`:null==e?void 0:e.value}}function j(){return[...f.QF,...p]}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class k extends a.D{constructor(e){super(e),L(this,"responseParser",void 0),L(this,"completionProvider",void 0),this.instanceSettings=e,this.responseParser=new u,this.completionProvider=void 0}getQueryModel(e,t,n){return new l(e,t,n)}getResponseParser(){return this.responseParser}getSqlCompletionProvider(e){if(void 0!==this.completionProvider)return this.completionProvider;const t={getColumns:{current:t=>async function(e,t){const n=await e.fields(t);return n.length>0?n.map((e=>({name:e.value,type:e.value,description:e.value}))):[]}(e,t)},getTables:{current:t=>async function(e,t){return await e.lookup(t.dataset)}(e,{dataset:t})},fetchMeta:{current:e=>this.fetchMeta(e)},getFunctions:{current:()=>j()}};return this.completionProvider=(e=>{let{getColumns:t,getTables:n,fetchMeta:r,getFunctions:i}=e;return()=>({triggerCharacters:["."," ","$",",","(","'"],supportedFunctions:()=>i.current(),supportedOperators:()=>f.fP,customSuggestionKinds:S(n,t,r),customStatementPlacement:T})})(t),this.completionProvider}async fetchDatasets(){return(await this.runSql("SELECT DISTINCT TABLE_SCHEMA from information_schema.TABLES where TABLE_TYPE != 'SYSTEM VIEW' ORDER BY TABLE_SCHEMA",{refId:"datasets"})).map((e=>e[0]))}async fetchTables(e){const t=await this.runSql(function(e){return`SELECT table_name FROM information_schema.tables WHERE table_schema = ${void 0!==e?`'${e}'`:"database()"} ORDER BY table_name`}(e),{refId:"tables"});return t.map((e=>e[0]))}async fetchFields(e){if(!e.dataset||!e.table)return[];const t=h(this.getQueryModel(e),e.table);return function(e){var t;const n=[];for(const r of e){let e="text";switch(null===(t=r.type)||void 0===t?void 0:t.toUpperCase()){case"BOOLEAN":case"BOOL":e="boolean";break;case"BYTES":case"VARCHAR":case"GEOGRAPHY":e="text";break;case"FLOAT":case"FLOAT64":case"INT":case"INTEGER":case"INT64":case"NUMERIC":case"BIGNUMERIC":e="number";break;case"DATE":e="date";break;case"DATETIME":case"TIMESTAMP":e="datetime";break;case"TIME":e="time"}n.push(Object.assign({},r,{raqbFieldType:e,icon:d(r.type.toUpperCase())}))}return n}((await this.runSql(t,{refId:"fields"})).map((e=>({name:e[0],text:e[0],value:e[0],type:e[1],label:e[0]}))))}async fetchMeta(e){var t;const n=this.instanceSettings.jsonData.database;if(!(e=null===(t=e)||void 0===t?void 0:t.trim())&&n){return(await this.fetchTables(n)).map((e=>({name:e,completion:e,kind:s.cm.Class})))}if(e){const t=e.split(".").filter((e=>e));if(t.length>2)return[];if(1!==t.length||n){if(1===t.length&&n){return(await this.fetchFields({dataset:n,table:t[0]})).map((e=>({name:e.value,completion:e.value,kind:s.cm.Field})))}if(2!==t.length||n)return[];return(await this.fetchFields({dataset:t[0],table:t[1]})).map((e=>({name:e.value,completion:e.value,kind:s.cm.Field})))}return(await this.fetchTables(t[0])).map((e=>({name:e,completion:e,kind:s.cm.Class})))}return(await this.fetchDatasets()).map((e=>({name:e,completion:`${e}.`,kind:s.cm.Module})))}getDB(){return void 0!==this.db?this.db:{datasets:()=>this.fetchDatasets(),tables:e=>this.fetchTables(e),fields:e=>this.fetchFields(e),validateQuery:(e,t)=>Promise.resolve({query:e,error:"",isError:!1,isValid:!0}),dsID:()=>this.id,lookup:e=>this.fetchMeta(e),getSqlCompletionProvider:()=>this.getSqlCompletionProvider(this.db),functions:async()=>j()}}}n(68404);var R,D,N,M=n(81391),F=n(64624),_=n(24643),W=n(1652),P=n(78454),B=n(28648),O=n(72786),q=n(8771),V=n(35011),K=n(2935),G=n(63843),Y=n(45916);const $=new r.hf(k).setQueryEditor(i.M).setConfigEditor((e=>{const{options:t,onOptionsChange:n}=e,r=t.jsonData,i=e=>r=>{n(Object.assign({},t,{[e]:r.currentTarget.value}))},a=t=>n=>{(0,M.tp)(e,t,n.currentTarget.checked)},s=15;return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(F.C,{label:"MySQL Connection",width:400,children:[(0,Y.jsx)(_._,{labelWidth:s,label:"Host",children:(0,Y.jsx)(W.I,{width:40,name:"host",type:"text",value:t.url||"",placeholder:"localhost:3306",onChange:i("url")})}),(0,Y.jsx)(_._,{labelWidth:s,label:"Database",children:(0,Y.jsx)(W.I,{width:40,name:"database",value:t.database||"",placeholder:"database name",onChange:i("database")})}),(0,Y.jsxs)(P.Z,{children:[(0,Y.jsx)(_._,{labelWidth:s,label:"User",children:(0,Y.jsx)(W.I,{width:s,value:t.user||"",placeholder:"user",onChange:i("user")})}),(0,Y.jsx)(_._,{labelWidth:10,label:"Password",children:(0,Y.jsx)(B.m4,{width:s,placeholder:"Password",isConfigured:t.secureJsonFields&&t.secureJsonFields.password,onReset:()=>{(0,M.Mf)(e,"password")},onBlur:(0,M.fi)(e,"password")})})]}),(0,Y.jsx)(_._,{tooltip:R||(R=(0,Y.jsxs)("span",{children:["Specify the time zone used in the database session, e.g. ",(0,Y.jsx)("code",{children:"Europe/Berlin"})," or",(0,Y.jsx)("code",{children:"+02:00"}),". This is necessary, if the timezone of the database (or the host of the database) is set to something other than UTC. The value is set in the session with",(0,Y.jsx)("code",{children:"SET time_zone='...'"}),". If you leave this field empty, the timezone is not updated. You can find more information in the MySQL documentation."]})),label:"Session timezone",labelWidth:20,children:(0,Y.jsx)(W.I,{width:35,value:r.timezone||"",onChange:(0,M._R)(e,"timezone"),placeholder:"(default)"})}),(0,Y.jsxs)(P.Z,{children:[(0,Y.jsx)(_._,{labelWidth:20,htmlFor:"tlsAuth",label:"TLS Client Auth",children:(0,Y.jsx)(O.x,{id:"tlsAuth",onChange:a("tlsAuth"),value:r.tlsAuth||!1})}),(0,Y.jsx)(_._,{labelWidth:20,tooltip:"Needed for verifing self-signed TLS Certs",htmlFor:"tlsCaCert",label:"With CA Cert",children:(0,Y.jsx)(O.x,{id:"tlsCaCert",onChange:a("tlsAuthWithCACert"),value:r.tlsAuthWithCACert||!1})})]}),(0,Y.jsx)(_._,{labelWidth:20,htmlFor:"skipTLSVerify",label:"Skip TLS Verify",children:(0,Y.jsx)(O.x,{id:"skipTLSVerify",onChange:a("tlsSkipVerify"),value:r.tlsSkipVerify||!1})})]}),r.tlsAuth||r.tlsAuthWithCACert?(0,Y.jsx)(F.C,{label:"TLS/SSL Auth Details",children:(0,Y.jsx)(G.d,{showCACert:r.tlsAuthWithCACert,showKeyPair:r.tlsAuth,editorProps:e,labelWidth:25})}):null,(0,Y.jsx)(K.K,{labelWidth:s,jsonData:r,onPropertyChanged:(t,n)=>{(0,M.tp)(e,t,n)}}),(0,Y.jsx)(F.C,{label:"MySQL details",children:(0,Y.jsx)(_._,{tooltip:D||(D=(0,Y.jsxs)("span",{children:["A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example",(0,Y.jsx)("code",{children:"1m"})," if your data is written every minute."]})),labelWidth:20,label:"Min time interval",children:(0,Y.jsx)(W.I,{placeholder:"1m",value:r.timeInterval||"",onChange:(0,M._R)(e,"timeInterval")})})}),N||(N=(0,Y.jsxs)(q.b,{title:"User Permission",severity:"info",children:["The database user should only be granted SELECT permissions on the specified database & tables you want to query. Grafana does not validate that queries are safe so queries can contain any SQL statement. For example, statements like ",(0,Y.jsx)("code",{children:"USE otherdb;"})," and ",(0,Y.jsx)("code",{children:"DROP TABLE user;"})," would be executed. To protect against this we ",(0,Y.jsx)("strong",{children:"Highly"})," recommend you create a specific MySQL user with restricted permissions. Checkout the"," ",(0,Y.jsx)(V.r,{rel:"noreferrer",target:"_blank",href:"http://docs.grafana.org/features/datasources/mysql/",children:"MySQL Data Source Docs"}),"for more information."]}))]})}))},76345:()=>{},56834:()=>{}}]);
//# sourceMappingURL=mysqlPlugin.70c17a8ea69be486bb00.js.map