"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9671],{26227:(e,t,s)=>{s.d(t,{f:()=>l});var a=s(68404),i=s(7197),n=s(98163),r=s(47570),o=s(98638),d=s(77058),c=s(45916);const l=e=>{let{teamId:t,roleOptions:s,disabled:l,onApplyRoles:m,pendingRoles:h,apply:u=!1,maxWidth:p}=e;const[{loading:g,value:f=[]},b]=(0,i.Z)((async()=>{try{if(u&&Boolean(null==h?void 0:h.length))return h;if(n.Vt.hasPermission(r.bW.ActionTeamsRolesList))return await(0,d._C)(t)}catch(e){console.error("Error loading options",e)}return[]}),[t,h]);(0,a.useEffect)((()=>{b()}),[t,b,h]);const x=n.Vt.hasPermission(r.bW.ActionTeamsRolesAdd)&&n.Vt.hasPermission(r.bW.ActionTeamsRolesRemove);return(0,c.jsx)(o.I,{apply:u,onRolesChange:async e=>{u?m&&m(e):(await(0,d.u7)(e,t),await b())},roleOptions:s,appliedRoles:f,isLoading:g,disabled:l,basicRoleDisabled:!0,canUpdateRoles:x,maxWidth:p})}},39539:(e,t,s)=>{s.d(t,{$:()=>l});var a=s(24420),i=s.n(a),n=s(68404),r=s(1485),o=s(47570),d=s(45193),c=s(45916);const l=(e,t,s)=>a=>{const l=(0,r.connect)(e,t)(a),m=e=>{const t=(0,o.I0)();return(0,n.useEffect)((()=>function(){t((0,d.e)({cleanupAction:s}))}),[t]),(0,c.jsx)(l,Object.assign({},e))};return m.displayName=`ConnectWithCleanUp(${l.displayName})`,i()(m,a),m}},65623:(e,t,s)=>{s.d(t,{Yb:()=>i,d5:()=>n});var a=s(48147);const i=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;const n=()=>function(){var e;const t=null===(e=a.v.licenseInfo)||void 0===e?void 0:e.trialExpiry;return!!(t&&t>0)}()&&a.v.featureToggles.featureHighlights},90357:(e,t,s)=>{s.r(t),s.d(t,{TeamList:()=>I,default:()=>$});var a,i,n,r,o,d=s(68404),c=s(78146),l=s(74819),m=s(40920),h=s(25049),u=s(12396),p=s(28436),g=s(90894),f=s(26227),b=s(77058),x=s(78837),y=s(61959),v=s(47570),j=s(39539),A=s(44083),T=s(99574),C=s(71181),P=s(45916);function w(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class I extends d.PureComponent{constructor(e){super(e),w(this,"deleteTeam",(e=>{this.props.deleteTeam(e.id)})),w(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),w(this,"getPaginatedTeams",(e=>{const t=30*(this.props.searchPage-1);return e.slice(t,t+30)})),this.state={roleOptions:[]}}componentDidMount(){this.fetchTeams(),y.Vt.licensedAccessControlEnabled()&&y.Vt.hasPermission(v.bW.ActionRolesList)&&this.fetchRoleOptions()}async fetchTeams(){await this.props.loadTeams()}async fetchRoleOptions(){const e=await(0,b.ul)();this.setState({roleOptions:e})}renderTeam(e){var t,s;const{editorsCanAdmin:a,signedInUser:i}=this.props,n=e.permission,r=`org/teams/edit/${e.id}`,o=(0,C.kC)({permission:n,editorsCanAdmin:a,signedInUser:i}),d=y.Vt.hasAccessInMetadata(v.bW.ActionTeamsDelete,e,o),l=y.Vt.hasAccessInMetadata(v.bW.ActionTeamsRead,e,o),m=y.Vt.hasAccessInMetadata(v.bW.ActionTeamsRolesList,e,!1),h=y.Vt.licensedAccessControlEnabled()&&y.Vt.hasPermission(v.bW.ActionRolesList);return(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{className:"width-4 text-center link-td",children:l?(0,P.jsx)("a",{href:r,children:(0,P.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:"Team avatar"})}):(0,P.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:"Team avatar"})}),(0,P.jsx)("td",{className:"link-td",children:l?(0,P.jsx)("a",{href:r,children:e.name}):(0,P.jsx)("div",{style:{padding:"0px 8px"},children:e.name})}),(0,P.jsx)("td",{className:"link-td",children:l?(0,P.jsx)("a",{href:r,"aria-label":(null===(t=e.email)||void 0===t?void 0:t.length)>0?void 0:"Empty email cell",children:e.email}):(0,P.jsx)("div",{style:{padding:"0px 8px"},"aria-label":(null===(s=e.email)||void 0===s?void 0:s.length)>0?void 0:"Empty email cell",children:e.email})}),(0,P.jsx)("td",{className:"link-td",children:l?(0,P.jsx)("a",{href:r,children:e.memberCount}):(0,P.jsx)("div",{style:{padding:"0px 8px"},children:e.memberCount})}),h&&(0,P.jsx)("td",{children:m&&(0,P.jsx)(f.f,{teamId:e.id,roleOptions:this.state.roleOptions})}),(0,P.jsx)("td",{className:"text-right",children:(0,P.jsx)(c.m,{"aria-label":`Delete team ${e.name}`,size:"sm",disabled:!d,onConfirm:()=>this.deleteTeam(e)})})]},e.id)}renderEmptyList(){return(0,P.jsx)(p.Z,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!y.Vt.hasPermission(v.bW.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"})}renderTeamList(){const{teams:e,searchQuery:t,editorsCanAdmin:s,searchPage:d,setTeamsSearchPage:c}=this.props,p=y.Vt.hasRole("Admin")||s&&y.Vt.hasRole("Editor"),g=y.Vt.hasAccess(v.bW.ActionTeamsCreate,p),f=y.Vt.licensedAccessControlEnabled()&&y.Vt.hasPermission(v.bW.ActionTeamsRolesList)&&y.Vt.hasPermission(v.bW.ActionRolesList),b=g?"org/teams/new":"#",x=this.getPaginatedTeams(e),j=Math.ceil(e.length/30);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"page-action-bar",children:[(0,P.jsx)("div",{className:"gf-form gf-form--grow",children:(0,P.jsx)(l.H,{placeholder:"Search teams",value:t,onChange:this.onSearchQueryChange})}),(0,P.jsx)(m.Qj,{href:b,disabled:!g,children:"New Team"})]}),(0,P.jsx)("div",{className:"admin-list-table",children:(0,P.jsxs)(h.wc,{spacing:"md",children:[(0,P.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[a||(a=(0,P.jsx)("th",{})),i||(i=(0,P.jsx)("th",{children:"Name"})),n||(n=(0,P.jsx)("th",{children:"Email"})),r||(r=(0,P.jsx)("th",{children:"Members"})),f&&(o||(o=(0,P.jsx)("th",{children:"Roles"}))),(0,P.jsx)("th",{style:{width:"1%"}})]})}),(0,P.jsx)("tbody",{children:x.map((e=>this.renderTeam(e)))})]}),(0,P.jsx)(h.Lh,{justify:"flex-end",children:(0,P.jsx)(u.t,{onNavigate:c,currentPage:d,numberOfPages:j,hideWhenSinglePage:!0})})]})})]})}renderList(){const{teamsCount:e,hasFetched:t}=this.props;return t?e>0?this.renderTeamList():this.renderEmptyList():null}render(){const{hasFetched:e}=this.props;return(0,P.jsx)(g.T,{navId:"teams",children:(0,P.jsx)(g.T.Contents,{isLoading:!e,children:this.renderList()})})}}const R={loadTeams:A.jI,deleteTeam:A.fC,setSearchQuery:T.ql,setTeamsSearchPage:T.ot},$=(0,j.$)((function(e){return{teams:(0,C.LK)(e.teams),searchQuery:(0,C.uP)(e.teams),searchPage:(0,C._u)(e.teams),teamsCount:(0,C.v7)(e.teams),hasFetched:e.teams.hasFetched,editorsCanAdmin:x.vc.editorsCanAdmin,signedInUser:y.Vt.user}}),R,(e=>e.teams=T.p3))(I)},44083:(e,t,s)=>{s.d(t,{A_:()=>b,Lt:()=>u,P5:()=>x,QX:()=>m,ei:()=>h,fC:()=>y,fs:()=>g,jI:()=>l,j_:()=>f,zT:()=>p,zZ:()=>v});var a=s(6932),i=s(36537),n=s(98163),r=s(66728),o=s(47570),d=s(91574),c=s(99574);function l(){return async e=>{if(!n.Vt.hasPermission(o.bW.ActionTeamsRead))return void e((0,c.PL)([]));const t=await(0,a.i)().get("/api/teams/search",(0,r.y)({perpage:1e3,page:1}));e((0,c.PL)(t.teams))}}function m(e){return async t=>{const s=await(0,a.i)().get(`/api/teams/${e}`,(0,r.y)());t((0,c.y$)(s)),t((0,i.RL)((0,d.B)(s)))}}function h(){return async(e,t)=>{const s=t().team.team,i=await(0,a.i)().get(`/api/teams/${s.id}/members`);e((0,c.n2)(i))}}function u(e){return async(t,s)=>{const i=s().team.team;await(0,a.i)().post(`/api/teams/${i.id}/members`,{userId:e}),t(h())}}function p(e){return async(t,s)=>{const i=s().team.team;await(0,a.i)().delete(`/api/teams/${i.id}/members/${e}`),t(h())}}function g(e,t){return async(s,i)=>{const n=i().team.team;await(0,a.i)().put(`/api/teams/${n.id}`,{name:e,email:t}),s(m(n.id))}}function f(){return async(e,t)=>{const s=t().team.team,i=await(0,a.i)().get(`/api/teams/${s.id}/groups`);e((0,c.iI)(i))}}function b(e){return async(t,s)=>{const i=s().team.team;await(0,a.i)().post(`/api/teams/${i.id}/groups`,{groupId:e}),t(f())}}function x(e){return async(t,s)=>{const i=s().team.team;await(0,a.i)().delete(`/api/teams/${i.id}/groups/${encodeURIComponent(e)}`),t(f())}}function y(e){return async t=>{await(0,a.i)().delete(`/api/teams/${e}`),await n.Vt.fetchUserPermissions(),t(l())}}function v(e){return async t=>{await(0,a.i)().put(`/api/teams/${e.teamId}/members/${e.userId}`,{permission:e.permission}),t(h())}}},91574:(e,t,s)=>{s.d(t,{B:()=>l,o:()=>m});var a=s(87709),i=s(17963),n=s(78837),r=s(61959),o=s(65623),d=s(47570);const c={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:d.hw.Member};function l(e){const t={img:e.avatarUrl,id:"team-"+e.id,subTitle:"Manage members and settings",url:"",text:e.name,breadcrumbs:[{title:"Teams",url:"org/teams"}],children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${e.id}`,text:"Settings",url:`org/teams/edit/${e.id}/settings`}]};(e===c||r.Vt.hasPermissionInMetadata(d.bW.ActionTeamsPermissionsRead,e))&&t.children.unshift({active:!1,icon:"users-alt",id:`team-members-${e.id}`,text:"Members",url:`org/teams/edit/${e.id}/members`});const s={active:!1,icon:"sync",id:`team-groupsync-${e.id}`,text:"External group sync",url:`org/teams/edit/${e.id}/groupsync`},l=e===c;return(0,o.d5)()&&(s.tabSuffix=()=>(0,i.Z)({experimentId:l?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,a.v)("teamsync")?(l||r.Vt.hasPermissionInMetadata(d.bW.ActionTeamsPermissionsRead,e))&&t.children.push(s):n.ZP.featureToggles.featureHighlights&&t.children.push(Object.assign({},s,{tabSuffix:()=>(0,i.Z)({experimentId:l?"":"feature-highlights-team-sync-badge"})})),t}function m(e){const t=l(c);let s;for(const a of t.children)if(a.id.indexOf(e)>0){a.active=!0,s=a;break}return{main:t,node:s}}},71181:(e,t,s)=>{s.d(t,{JB:()=>r,LK:()=>l,VP:()=>c,YY:()=>m,_u:()=>d,kC:()=>u,uP:()=>i,v7:()=>o,vt:()=>h,xc:()=>n});var a=s(47570);const i=e=>e.searchQuery,n=e=>e.searchMemberQuery,r=e=>e.groups,o=e=>e.teams.length,d=e=>e.searchPage,c=(e,t)=>e.team.id===parseInt(t,10)?e.team:null,l=e=>{const t=RegExp(e.searchQuery,"i");return e.teams.filter((e=>t.test(e.name)))},m=e=>{const t=RegExp(e.searchMemberQuery,"i");return e.members.filter((e=>t.test(e.login)||t.test(e.email)||t.test(e.name)))},h=e=>{const{members:t,signedInUser:s,editorsCanAdmin:i}=e,n=t.find((e=>e.userId===s.id)),r=n?n.permission:a.hw.Member;return u({permission:r,signedInUser:s,editorsCanAdmin:i})},u=e=>{const{permission:t,signedInUser:s,editorsCanAdmin:i}=e,n=s.isGrafanaAdmin||s.orgRole===a.B5.Admin,r=t===a.hw.Admin;return n||r||!i}}}]);
//# sourceMappingURL=TeamList.6e4fb6015f82c29da0c5.js.map