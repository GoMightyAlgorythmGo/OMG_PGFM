{"version":3,"file":"opentsdbPlugin.8af1ac5ad4a499e0f5cc.js","mappings":"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","sources":["webpack://grafana/./public/app/angular/AngularLocationWrapper.ts","webpack://grafana/./public/app/angular/panel/metrics_panel_ctrl.ts","webpack://grafana/./public/app/angular/panel/panel_ctrl.ts","webpack://grafana/./public/app/angular/panel/query_ctrl.ts","webpack://grafana/./public/app/plugins/datasource/opentsdb/components/OpenTsdbDetails.tsx","webpack://grafana/./public/app/plugins/datasource/opentsdb/components/AnnotationEditor.tsx","webpack://grafana/./public/app/plugins/datasource/opentsdb/migrations.ts","webpack://grafana/./public/app/plugins/datasource/opentsdb/datasource.ts","webpack://grafana/./public/app/plugins/datasource/opentsdb/query_ctrl.ts","webpack://grafana/./public/app/plugins/datasource/opentsdb/module.ts","webpack://grafana/./public/app/plugins/datasource/opentsdb/components/ConfigEditor.tsx","webpack://grafana/./public/app/plugins/sdk.ts"],"sourcesContent":["import { deprecationWarning, urlUtil } from '@grafana/data';\nimport { locationSearchToObject, locationService, navigationLogger } from '@grafana/runtime';\n\n// Ref: https://github.com/angular/angular.js/blob/ae8e903edf88a83fedd116ae02c0628bf72b150c/src/ng/location.js#L5\nconst DEFAULT_PORTS: Record<string, number> = { http: 80, https: 443, ftp: 21 };\n\nexport class AngularLocationWrapper {\n  constructor() {\n    this.absUrl = this.wrapInDeprecationWarning(this.absUrl);\n    this.hash = this.wrapInDeprecationWarning(this.hash);\n    this.host = this.wrapInDeprecationWarning(this.host);\n    this.path = this.wrapInDeprecationWarning(this.path);\n    this.port = this.wrapInDeprecationWarning(this.port, 'window.location');\n    this.protocol = this.wrapInDeprecationWarning(this.protocol, 'window.location');\n    this.replace = this.wrapInDeprecationWarning(this.replace);\n    this.search = this.wrapInDeprecationWarning(this.search);\n    this.state = this.wrapInDeprecationWarning(this.state);\n    this.url = this.wrapInDeprecationWarning(this.url);\n  }\n\n  wrapInDeprecationWarning(fn: Function, replacement?: string) {\n    let self = this;\n\n    return function wrapper() {\n      deprecationWarning('$location', fn.name, replacement || 'locationService');\n      return fn.apply(self, arguments);\n    };\n  }\n\n  absUrl(): string {\n    return `${window.location.origin}${this.url()}`;\n  }\n\n  hash(newHash?: string | null) {\n    navigationLogger('AngularLocationWrapper', false, 'Angular compat layer: hash');\n\n    if (!newHash) {\n      return locationService.getLocation().hash.slice(1);\n    } else {\n      throw new Error('AngularLocationWrapper method not implemented.');\n    }\n  }\n\n  host(): string {\n    return new URL(window.location.href).hostname;\n  }\n\n  path(pathname?: any) {\n    navigationLogger('AngularLocationWrapper', false, 'Angular compat layer: path');\n\n    const location = locationService.getLocation();\n\n    if (pathname !== undefined && pathname !== null) {\n      let parsedPath = String(pathname);\n      parsedPath = parsedPath.startsWith('/') ? parsedPath : `/${parsedPath}`;\n      const url = new URL(`${window.location.origin}${parsedPath}`);\n\n      locationService.push({\n        pathname: url.pathname,\n        search: url.search.length > 0 ? url.search : location.search,\n        hash: url.hash.length > 0 ? url.hash : location.hash,\n      });\n      return this;\n    }\n\n    if (pathname === null) {\n      locationService.push('/');\n      return this;\n    }\n\n    return location.pathname;\n  }\n\n  port(): number | null {\n    const url = new URL(window.location.href);\n    return parseInt(url.port, 10) || DEFAULT_PORTS[url.protocol] || null;\n  }\n\n  protocol(): string {\n    return new URL(window.location.href).protocol.slice(0, -1);\n  }\n\n  replace() {\n    throw new Error('AngularLocationWrapper method not implemented.');\n  }\n\n  search(search?: any, paramValue?: any) {\n    navigationLogger('AngularLocationWrapper', false, 'Angular compat layer: search');\n    if (!search) {\n      return locationService.getSearchObject();\n    }\n\n    if (search && arguments.length > 1) {\n      locationService.partial({\n        [search]: paramValue,\n      });\n\n      return this;\n    }\n\n    if (search) {\n      let newQuery;\n\n      if (typeof search === 'object') {\n        newQuery = { ...search };\n      } else {\n        newQuery = locationSearchToObject(search);\n      }\n\n      for (const key of Object.keys(newQuery)) {\n        // removing params with null | undefined\n        if (newQuery[key] === null || newQuery[key] === undefined) {\n          delete newQuery[key];\n        }\n      }\n\n      const updatedUrl = urlUtil.renderUrl(locationService.getLocation().pathname, newQuery);\n      locationService.push(updatedUrl);\n    }\n\n    return this;\n  }\n\n  state(state?: any) {\n    navigationLogger('AngularLocationWrapper', false, 'Angular compat layer: state');\n    throw new Error('AngularLocationWrapper method not implemented.');\n  }\n\n  url(newUrl?: any) {\n    navigationLogger('AngularLocationWrapper', false, 'Angular compat layer: url');\n\n    if (newUrl !== undefined) {\n      if (newUrl.startsWith('#')) {\n        locationService.push({ ...locationService.getLocation(), hash: newUrl });\n      } else if (newUrl.startsWith('?')) {\n        locationService.push({ ...locationService.getLocation(), search: newUrl });\n      } else if (newUrl.trim().length === 0) {\n        locationService.push('/');\n      } else {\n        locationService.push(newUrl);\n      }\n\n      return locationService;\n    }\n\n    const location = locationService.getLocation();\n    return `${location.pathname}${location.search}${location.hash}`;\n  }\n}\n","import { isArray } from 'lodash';\nimport { Unsubscribable } from 'rxjs';\n\nimport {\n  DataFrame,\n  DataQueryResponse,\n  DataSourceApi,\n  LegacyResponseData,\n  LoadingState,\n  PanelData,\n  PanelEvents,\n  TimeRange,\n  toDataFrameDTO,\n  toLegacyResponseData,\n} from '@grafana/data';\nimport { PanelCtrl } from 'app/angular/panel/panel_ctrl';\nimport { ContextSrv } from 'app/core/services/context_srv';\nimport { PanelModel } from 'app/features/dashboard/state';\nimport { applyPanelTimeOverrides } from 'app/features/dashboard/utils/panel';\n\nimport { PanelQueryRunner } from '../../features/query/state/PanelQueryRunner';\n\nclass MetricsPanelCtrl extends PanelCtrl {\n  declare datasource: DataSourceApi;\n  declare range: TimeRange;\n\n  contextSrv: ContextSrv;\n  datasourceSrv: any;\n  timeSrv: any;\n  templateSrv: any;\n  interval: any;\n  intervalMs: any;\n  resolution: any;\n  timeInfo?: string;\n  skipDataOnInit = false;\n  dataList: LegacyResponseData[] = [];\n  querySubscription?: Unsubscribable | null;\n  useDataFrames = false;\n  panelData?: PanelData;\n\n  constructor($scope: any, $injector: any) {\n    super($scope, $injector);\n\n    this.contextSrv = $injector.get('contextSrv');\n    this.datasourceSrv = $injector.get('datasourceSrv');\n    this.timeSrv = $injector.get('timeSrv');\n    this.templateSrv = $injector.get('templateSrv');\n    this.panel.datasource = this.panel.datasource || null;\n\n    this.events.on(PanelEvents.refresh, this.onMetricsPanelRefresh.bind(this));\n    this.events.on(PanelEvents.panelTeardown, this.onPanelTearDown.bind(this));\n    this.events.on(PanelEvents.componentDidMount, this.onMetricsPanelMounted.bind(this));\n  }\n\n  private onMetricsPanelMounted() {\n    const queryRunner = this.panel.getQueryRunner() as PanelQueryRunner;\n    this.querySubscription = queryRunner\n      .getData({ withTransforms: true, withFieldConfig: true })\n      .subscribe(this.panelDataObserver);\n  }\n\n  private onPanelTearDown() {\n    if (this.querySubscription) {\n      this.querySubscription.unsubscribe();\n      this.querySubscription = null;\n    }\n  }\n\n  private onMetricsPanelRefresh() {\n    // ignore fetching data if another panel is in fullscreen\n    if (this.otherPanelInFullscreenMode()) {\n      return;\n    }\n\n    // if we have snapshot data use that\n    if (this.panel.snapshotData) {\n      this.updateTimeRange();\n      let data = this.panel.snapshotData;\n      // backward compatibility\n      if (!isArray(data)) {\n        data = data.data;\n      }\n\n      this.panelData = {\n        state: LoadingState.Done,\n        series: data,\n        timeRange: this.range,\n      };\n\n      // Defer panel rendering till the next digest cycle.\n      // For some reason snapshot panels don't init at this time, so this helps to avoid rendering issues.\n      return this.$timeout(() => {\n        this.events.emit(PanelEvents.dataSnapshotLoad, data);\n      });\n    }\n\n    // clear loading/error state\n    delete this.error;\n    this.loading = true;\n\n    // load datasource service\n    return this.datasourceSrv\n      .get(this.panel.datasource, this.panel.scopedVars)\n      .then(this.issueQueries.bind(this))\n      .catch((err: any) => {\n        this.processDataError(err);\n      });\n  }\n\n  processDataError(err: any) {\n    // if canceled  keep loading set to true\n    if (err.cancelled) {\n      console.log('Panel request cancelled', err);\n      return;\n    }\n\n    this.error = err.message || 'Request Error';\n\n    if (err.data) {\n      if (err.data.message) {\n        this.error = err.data.message;\n      } else if (err.data.error) {\n        this.error = err.data.error;\n      }\n    }\n\n    this.angularDirtyCheck();\n  }\n\n  angularDirtyCheck() {\n    if (!this.$scope.$root.$$phase) {\n      this.$scope.$digest();\n    }\n  }\n\n  // Updates the response with information from the stream\n  panelDataObserver = {\n    next: (data: PanelData) => {\n      this.panelData = data;\n\n      if (data.state === LoadingState.Error) {\n        this.loading = false;\n        this.processDataError(data.error);\n      }\n\n      // Ignore data in loading state\n      if (data.state === LoadingState.Loading) {\n        this.loading = true;\n        this.angularDirtyCheck();\n        return;\n      }\n\n      if (data.request) {\n        const { timeInfo } = data.request;\n        if (timeInfo) {\n          this.timeInfo = timeInfo;\n        }\n      }\n\n      if (data.timeRange) {\n        this.range = data.timeRange;\n      }\n\n      if (this.useDataFrames) {\n        this.handleDataFrames(data.series);\n      } else {\n        // Make the results look as if they came directly from a <6.2 datasource request\n        const legacy = data.series.map((v) => toLegacyResponseData(v));\n        this.handleQueryResult({ data: legacy });\n      }\n\n      this.angularDirtyCheck();\n    },\n  };\n\n  updateTimeRange(datasource?: DataSourceApi) {\n    this.datasource = datasource || this.datasource;\n    this.range = this.timeSrv.timeRange();\n\n    const newTimeData = applyPanelTimeOverrides(this.panel, this.range);\n    this.timeInfo = newTimeData.timeInfo;\n    this.range = newTimeData.timeRange;\n  }\n\n  issueQueries(datasource: DataSourceApi) {\n    this.updateTimeRange(datasource);\n\n    this.datasource = datasource;\n\n    const panel = this.panel as PanelModel;\n    const queryRunner = panel.getQueryRunner();\n\n    return queryRunner.run({\n      datasource: panel.datasource,\n      queries: panel.targets,\n      panelId: panel.id,\n      dashboardId: this.dashboard.id,\n      timezone: this.dashboard.getTimezone(),\n      timeInfo: this.timeInfo,\n      timeRange: this.range,\n      maxDataPoints: panel.maxDataPoints || this.width,\n      minInterval: panel.interval,\n      scopedVars: panel.scopedVars,\n      cacheTimeout: panel.cacheTimeout,\n      transformations: panel.transformations,\n    });\n  }\n\n  handleDataFrames(data: DataFrame[]) {\n    this.loading = false;\n\n    if (this.dashboard && this.dashboard.snapshot) {\n      this.panel.snapshotData = data.map((frame) => toDataFrameDTO(frame));\n    }\n\n    try {\n      this.events.emit(PanelEvents.dataFramesReceived, data);\n    } catch (err) {\n      this.processDataError(err);\n    }\n  }\n\n  handleQueryResult(result: DataQueryResponse) {\n    this.loading = false;\n\n    if (this.dashboard.snapshot) {\n      this.panel.snapshotData = result.data;\n    }\n\n    if (!result || !result.data) {\n      console.log('Data source query result invalid, missing data field:', result);\n      result = { data: [] };\n    }\n\n    try {\n      this.events.emit(PanelEvents.dataReceived, result.data);\n    } catch (err) {\n      this.processDataError(err);\n    }\n  }\n}\n\nexport { MetricsPanelCtrl };\n","import { auto } from 'angular';\nimport { isString } from 'lodash';\n\nimport {\n  AppEvent,\n  PanelEvents,\n  PanelPluginMeta,\n  AngularPanelMenuItem,\n  EventBusExtended,\n  EventBusSrv,\n} from '@grafana/data';\nimport { AngularLocationWrapper } from 'app/angular/AngularLocationWrapper';\nimport config from 'app/core/config';\nimport { profiler } from 'app/core/core';\n\nimport { DashboardModel } from '../../features/dashboard/state';\n\nexport class PanelCtrl {\n  panel: any;\n  error: any;\n  declare dashboard: DashboardModel;\n  pluginName = '';\n  pluginId = '';\n  editorTabs: any;\n  $scope: any;\n  $injector: auto.IInjectorService;\n  $timeout: any;\n  editModeInitiated = false;\n  declare height: number;\n  declare width: number;\n  containerHeight: any;\n  events: EventBusExtended;\n  loading = false;\n  timing: any;\n  $location: AngularLocationWrapper;\n\n  constructor($scope: any, $injector: auto.IInjectorService) {\n    this.panel = this.panel ?? $scope.$parent.panel;\n    this.dashboard = this.dashboard ?? $scope.$parent.dashboard;\n    this.$injector = $injector;\n    this.$scope = $scope;\n    this.$timeout = $injector.get('$timeout');\n    this.editorTabs = [];\n    this.$location = new AngularLocationWrapper();\n    this.events = new EventBusSrv();\n    this.timing = {}; // not used but here to not break plugins\n\n    const plugin = config.panels[this.panel.type];\n    if (plugin) {\n      this.pluginId = plugin.id;\n      this.pluginName = plugin.name;\n    }\n\n    $scope.$on(PanelEvents.componentDidMount.name, () => this.panelDidMount());\n  }\n\n  panelDidMount() {\n    this.events.emit(PanelEvents.componentDidMount);\n    this.events.emit(PanelEvents.initialized);\n    this.dashboard.panelInitialized(this.panel);\n  }\n\n  renderingCompleted() {\n    profiler.renderingCompleted();\n  }\n\n  refresh() {\n    this.panel.refresh();\n  }\n\n  publishAppEvent<T>(event: AppEvent<T>, payload?: T) {\n    this.$scope.$root.appEvent(event, payload);\n  }\n\n  initEditMode() {\n    if (!this.editModeInitiated) {\n      this.editModeInitiated = true;\n      this.events.emit(PanelEvents.editModeInitialized);\n    }\n  }\n\n  addEditorTab(title: string, directiveFn: any, index?: number, icon?: any) {\n    const editorTab = { title, directiveFn, icon };\n\n    if (isString(directiveFn)) {\n      editorTab.directiveFn = () => {\n        return { templateUrl: directiveFn };\n      };\n    }\n\n    if (index) {\n      this.editorTabs.splice(index, 0, editorTab);\n    } else {\n      this.editorTabs.push(editorTab);\n    }\n  }\n\n  getExtendedMenu() {\n    const menu: AngularPanelMenuItem[] = [];\n    this.events.emit(PanelEvents.initPanelActions, menu);\n    return menu;\n  }\n\n  // Override in sub-class to add items before extended menu\n  async getAdditionalMenuItems(): Promise<any[]> {\n    return [];\n  }\n\n  otherPanelInFullscreenMode() {\n    return this.dashboard.otherPanelInFullscreen(this.panel);\n  }\n\n  render(payload?: any) {\n    this.events.emit(PanelEvents.render, payload);\n  }\n\n  // overriden from react\n  onPluginTypeChange = (plugin: PanelPluginMeta) => {};\n}\n","import { auto } from 'angular';\nimport { indexOf } from 'lodash';\n\nexport class QueryCtrl<T = any> {\n  target!: T;\n  datasource!: any;\n  panelCtrl!: any;\n  panel: any;\n  hasRawMode!: boolean;\n  error?: string | null;\n  isLastQuery: boolean;\n\n  constructor(public $scope: any, public $injector: auto.IInjectorService) {\n    this.panelCtrl = this.panelCtrl ?? $scope.ctrl.panelCtrl;\n    this.target = this.target ?? $scope.ctrl.target;\n    this.datasource = this.datasource ?? $scope.ctrl.datasource;\n    this.panel = this.panelCtrl?.panel ?? $scope.ctrl.panelCtrl.panel;\n    this.isLastQuery = indexOf(this.panel.targets, this.target) === this.panel.targets.length - 1;\n  }\n\n  refresh() {\n    this.panelCtrl.refresh();\n  }\n}\n","import React, { SyntheticEvent } from 'react';\n\nimport { DataSourceSettings, SelectableValue } from '@grafana/data';\nimport { InlineFormLabel, LegacyForms } from '@grafana/ui';\n\nimport { useUniqueId } from '../../influxdb/components/useUniqueId';\nimport { OpenTsdbOptions } from '../types';\n\nconst { Select, Input } = LegacyForms;\n\nconst tsdbVersions = [\n  { label: '<=2.1', value: 1 },\n  { label: '==2.2', value: 2 },\n  { label: '==2.3', value: 3 },\n];\n\nconst tsdbResolutions = [\n  { label: 'second', value: 1 },\n  { label: 'millisecond', value: 2 },\n];\n\ninterface Props {\n  value: DataSourceSettings<OpenTsdbOptions>;\n  onChange: (value: DataSourceSettings<OpenTsdbOptions>) => void;\n}\n\nexport const OpenTsdbDetails = (props: Props) => {\n  const { onChange, value } = props;\n\n  const idSuffix = useUniqueId();\n\n  return (\n    <>\n      <h5>OpenTSDB settings</h5>\n      <div className=\"gf-form\">\n        <InlineFormLabel width={7} htmlFor={`select-version-${idSuffix}`}>\n          Version\n        </InlineFormLabel>\n        <Select\n          inputId={`select-version-${idSuffix}`}\n          options={tsdbVersions}\n          value={tsdbVersions.find((version) => version.value === value.jsonData.tsdbVersion) ?? tsdbVersions[0]}\n          onChange={onSelectChangeHandler('tsdbVersion', value, onChange)}\n        />\n      </div>\n      <div className=\"gf-form\">\n        <InlineFormLabel width={7} htmlFor={`select-resolution-${idSuffix}`}>\n          Resolution\n        </InlineFormLabel>\n        <Select\n          inputId={`select-resolution-${idSuffix}`}\n          options={tsdbResolutions}\n          value={\n            tsdbResolutions.find((resolution) => resolution.value === value.jsonData.tsdbResolution) ??\n            tsdbResolutions[0]\n          }\n          onChange={onSelectChangeHandler('tsdbResolution', value, onChange)}\n        />\n      </div>\n      <div className=\"gf-form\">\n        <InlineFormLabel width={7} htmlFor={`lookup-input-${idSuffix}`}>\n          Lookup limit\n        </InlineFormLabel>\n        <Input\n          id={`lookup-input-${idSuffix}`}\n          type=\"number\"\n          value={value.jsonData.lookupLimit ?? 1000}\n          onChange={onInputChangeHandler('lookupLimit', value, onChange)}\n        />\n      </div>\n    </>\n  );\n};\n\nconst onSelectChangeHandler =\n  (key: keyof OpenTsdbOptions, value: Props['value'], onChange: Props['onChange']) => (newValue: SelectableValue) => {\n    onChange({\n      ...value,\n      jsonData: {\n        ...value.jsonData,\n        [key]: newValue.value,\n      },\n    });\n  };\n\nconst onInputChangeHandler =\n  (key: keyof OpenTsdbOptions, value: Props['value'], onChange: Props['onChange']) =>\n  (event: SyntheticEvent<HTMLInputElement>) => {\n    onChange({\n      ...value,\n      jsonData: {\n        ...value.jsonData,\n        [key]: event.currentTarget.value,\n      },\n    });\n  };\n","import React, { useState } from 'react';\n\nimport { QueryEditorProps } from '@grafana/data';\nimport { InlineFormLabel, Input, InlineSwitch } from '@grafana/ui';\n\nimport OpenTsDatasource from '../datasource';\nimport { OpenTsdbQuery, OpenTsdbOptions } from '../types';\n\nexport const AnnotationEditor = (props: QueryEditorProps<OpenTsDatasource, OpenTsdbQuery, OpenTsdbOptions>) => {\n  const { query, onChange } = props;\n  const [target, setTarget] = useState<string>(query.target ?? '');\n  const [isGlobal, setIsGlobal] = useState<boolean>(query.isGlobal ?? false);\n\n  const updateValue = <K extends keyof OpenTsdbQuery, V extends OpenTsdbQuery[K]>(key: K, val: V) => {\n    onChange({\n      ...query,\n      [key]: val,\n      fromAnnotations: true,\n    });\n  };\n\n  const updateIsGlobal = (isGlobal: boolean) => {\n    isGlobal = !isGlobal;\n    setIsGlobal(isGlobal);\n    updateValue('isGlobal', isGlobal);\n  };\n\n  return (\n    <div className=\"gf-form-group\">\n      <div className=\"gf-form\">\n        <InlineFormLabel width={12}>OpenTSDB metrics query</InlineFormLabel>\n        <Input\n          value={target}\n          onChange={(e) => setTarget(e.currentTarget.value ?? '')}\n          onBlur={() => updateValue('target', target)}\n          placeholder=\"events.eventname\"\n        />\n      </div>\n      <div className=\"gf-form\">\n        <InlineFormLabel width={12}>Show Global Annotations?</InlineFormLabel>\n        <InlineSwitch value={isGlobal} onChange={(e) => updateIsGlobal(isGlobal)} />\n      </div>\n    </div>\n  );\n};\n","import { LegacyAnnotation } from './types';\n\n// this becomes the target in the migrated annotations\nconst migrateLegacyAnnotation = (json: LegacyAnnotation) => {\n  // return the target annotation\n  const annotation: LegacyAnnotation = {\n    fromAnnotations: true,\n    target: json.target ?? '',\n    name: json.name ?? '',\n    isGlobal: json.isGlobal ?? false,\n  };\n\n  return annotation;\n};\n\n// eslint-ignore-next-line\nexport const prepareAnnotation = (json: any) => {\n  const resultingTarget = json.target && typeof json.target !== 'string' ? json.target : migrateLegacyAnnotation(json);\n\n  json.target = resultingTarget;\n\n  return json;\n};\n","import angular from 'angular';\nimport {\n  clone,\n  compact,\n  each,\n  every,\n  filter,\n  findIndex,\n  has,\n  includes,\n  isArray,\n  isEmpty,\n  map as _map,\n  toPairs,\n} from 'lodash';\nimport { lastValueFrom, merge, Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport {\n  AnnotationEvent,\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceApi,\n  dateMath,\n  ScopedVars,\n  toDataFrame,\n} from '@grafana/data';\nimport { FetchResponse, getBackendSrv } from '@grafana/runtime';\nimport { getTemplateSrv, TemplateSrv } from 'app/features/templating/template_srv';\n\nimport { AnnotationEditor } from './components/AnnotationEditor';\nimport { prepareAnnotation } from './migrations';\nimport { OpenTsdbOptions, OpenTsdbQuery } from './types';\n\nexport default class OpenTsDatasource extends DataSourceApi<OpenTsdbQuery, OpenTsdbOptions> {\n  type: any;\n  url: any;\n  name: any;\n  withCredentials: any;\n  basicAuth: any;\n  tsdbVersion: any;\n  tsdbResolution: any;\n  lookupLimit: any;\n  tagKeys: any;\n\n  aggregatorsPromise: any;\n  filterTypesPromise: any;\n\n  constructor(instanceSettings: any, private readonly templateSrv: TemplateSrv = getTemplateSrv()) {\n    super(instanceSettings);\n    this.type = 'opentsdb';\n    this.url = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.withCredentials = instanceSettings.withCredentials;\n    this.basicAuth = instanceSettings.basicAuth;\n    instanceSettings.jsonData = instanceSettings.jsonData || {};\n    this.tsdbVersion = instanceSettings.jsonData.tsdbVersion || 1;\n    this.tsdbResolution = instanceSettings.jsonData.tsdbResolution || 1;\n    this.lookupLimit = instanceSettings.jsonData.lookupLimit || 1000;\n    this.tagKeys = {};\n\n    this.aggregatorsPromise = null;\n    this.filterTypesPromise = null;\n    this.annotations = {\n      QueryEditor: AnnotationEditor,\n      prepareAnnotation,\n    };\n  }\n\n  // Called once per panel (graph)\n  query(options: DataQueryRequest<OpenTsdbQuery>): Observable<DataQueryResponse> {\n    // migrate annotations\n    if (options.targets.some((target: OpenTsdbQuery) => target.fromAnnotations)) {\n      const streams: Array<Observable<DataQueryResponse>> = [];\n\n      for (const annotation of options.targets) {\n        if (annotation.target) {\n          streams.push(\n            new Observable((subscriber) => {\n              this.annotationEvent(options, annotation)\n                .then((events) => subscriber.next({ data: [toDataFrame(events)] }))\n                .catch((ex) => {\n                  // grafana fetch throws the error so for annotation consistency among datasources\n                  // we return an empty array which displays as 'no events found'\n                  // in the annnotation editor\n                  return subscriber.next({ data: [toDataFrame([])] });\n                })\n                .finally(() => subscriber.complete());\n            })\n          );\n        }\n      }\n\n      return merge(...streams);\n    }\n\n    const start = this.convertToTSDBTime(options.range.raw.from, false, options.timezone);\n    const end = this.convertToTSDBTime(options.range.raw.to, true, options.timezone);\n    const qs: any[] = [];\n\n    each(options.targets, (target) => {\n      if (!target.metric) {\n        return;\n      }\n      qs.push(this.convertTargetToQuery(target, options, this.tsdbVersion));\n    });\n\n    const queries = compact(qs);\n\n    // No valid targets, return the empty result to save a round trip.\n    if (isEmpty(queries)) {\n      return of({ data: [] });\n    }\n\n    const groupByTags: any = {};\n    each(queries, (query) => {\n      if (query.filters && query.filters.length > 0) {\n        each(query.filters, (val) => {\n          groupByTags[val.tagk] = true;\n        });\n      } else {\n        each(query.tags, (val, key) => {\n          groupByTags[key] = true;\n        });\n      }\n    });\n\n    options.targets = filter(options.targets, (query) => {\n      return query.hide !== true;\n    });\n\n    return this.performTimeSeriesQuery(queries, start, end).pipe(\n      catchError((err) => {\n        // Throw the error message here instead of the whole object to workaround the error parsing error.\n        throw err?.data?.error?.message || 'Error performing time series query.';\n      }),\n      map((response) => {\n        const metricToTargetMapping = this.mapMetricsToTargets(response.data, options, this.tsdbVersion);\n        const result = _map(response.data, (metricData: any, index: number) => {\n          index = metricToTargetMapping[index];\n          if (index === -1) {\n            index = 0;\n          }\n          this._saveTagKeys(metricData);\n\n          return this.transformMetricData(\n            metricData,\n            groupByTags,\n            options.targets[index],\n            options,\n            this.tsdbResolution\n          );\n        });\n        return { data: result };\n      })\n    );\n  }\n\n  annotationEvent(options: DataQueryRequest, annotation: OpenTsdbQuery): Promise<AnnotationEvent[]> {\n    const start = this.convertToTSDBTime(options.range.raw.from, false, options.timezone);\n    const end = this.convertToTSDBTime(options.range.raw.to, true, options.timezone);\n    const qs = [];\n    const eventList: any[] = [];\n\n    qs.push({ aggregator: 'sum', metric: annotation.target });\n\n    const queries = compact(qs);\n\n    return lastValueFrom(\n      this.performTimeSeriesQuery(queries, start, end).pipe(\n        map((results) => {\n          if (results.data[0]) {\n            let annotationObject = results.data[0].annotations;\n            if (annotation.isGlobal) {\n              annotationObject = results.data[0].globalAnnotations;\n            }\n            if (annotationObject) {\n              each(annotationObject, (ann) => {\n                const event = {\n                  text: ann.description,\n                  time: Math.floor(ann.startTime) * 1000,\n                  annotation: annotation,\n                };\n\n                eventList.push(event);\n              });\n            }\n          }\n          return eventList;\n        })\n      )\n    );\n  }\n\n  targetContainsTemplate(target: any) {\n    if (target.filters && target.filters.length > 0) {\n      for (let i = 0; i < target.filters.length; i++) {\n        if (this.templateSrv.containsTemplate(target.filters[i].filter)) {\n          return true;\n        }\n      }\n    }\n\n    if (target.tags && Object.keys(target.tags).length > 0) {\n      for (const tagKey in target.tags) {\n        if (this.templateSrv.containsTemplate(target.tags[tagKey])) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  performTimeSeriesQuery(queries: any[], start: any, end: any): Observable<FetchResponse> {\n    let msResolution = false;\n    if (this.tsdbResolution === 2) {\n      msResolution = true;\n    }\n    const reqBody: any = {\n      start: start,\n      queries: queries,\n      msResolution: msResolution,\n      globalAnnotations: true,\n    };\n    if (this.tsdbVersion === 3) {\n      reqBody.showQuery = true;\n    }\n\n    // Relative queries (e.g. last hour) don't include an end time\n    if (end) {\n      reqBody.end = end;\n    }\n\n    const options = {\n      method: 'POST',\n      url: this.url + '/api/query',\n      data: reqBody,\n    };\n\n    this._addCredentialOptions(options);\n    return getBackendSrv().fetch(options);\n  }\n\n  suggestTagKeys(metric: string | number) {\n    return Promise.resolve(this.tagKeys[metric] || []);\n  }\n\n  _saveTagKeys(metricData: { tags: {}; aggregateTags: any; metric: string | number }) {\n    const tagKeys = Object.keys(metricData.tags);\n    each(metricData.aggregateTags, (tag) => {\n      tagKeys.push(tag);\n    });\n\n    this.tagKeys[metricData.metric] = tagKeys;\n  }\n\n  _performSuggestQuery(query: string, type: string): Observable<any> {\n    return this._get('/api/suggest', { type, q: query, max: this.lookupLimit }).pipe(\n      map((result: any) => {\n        return result.data;\n      })\n    );\n  }\n\n  _performMetricKeyValueLookup(metric: string, keys: any): Observable<any[]> {\n    if (!metric || !keys) {\n      return of([]);\n    }\n\n    const keysArray = keys.split(',').map((key: any) => {\n      return key.trim();\n    });\n    const key = keysArray[0];\n    let keysQuery = key + '=*';\n\n    if (keysArray.length > 1) {\n      keysQuery += ',' + keysArray.splice(1).join(',');\n    }\n\n    const m = metric + '{' + keysQuery + '}';\n\n    return this._get('/api/search/lookup', { m: m, limit: this.lookupLimit }).pipe(\n      map((result: any) => {\n        result = result.data.results;\n        const tagvs: any[] = [];\n        each(result, (r) => {\n          if (tagvs.indexOf(r.tags[key]) === -1) {\n            tagvs.push(r.tags[key]);\n          }\n        });\n        return tagvs;\n      })\n    );\n  }\n\n  _performMetricKeyLookup(metric: any): Observable<any[]> {\n    if (!metric) {\n      return of([]);\n    }\n\n    return this._get('/api/search/lookup', { m: metric, limit: 1000 }).pipe(\n      map((result: any) => {\n        result = result.data.results;\n        const tagks: any[] = [];\n        each(result, (r) => {\n          each(r.tags, (tagv, tagk) => {\n            if (tagks.indexOf(tagk) === -1) {\n              tagks.push(tagk);\n            }\n          });\n        });\n        return tagks;\n      })\n    );\n  }\n\n  _get(\n    relativeUrl: string,\n    params?: { type?: string; q?: string; max?: number; m?: any; limit?: number }\n  ): Observable<FetchResponse> {\n    const options = {\n      method: 'GET',\n      url: this.url + relativeUrl,\n      params: params,\n    };\n\n    this._addCredentialOptions(options);\n\n    return getBackendSrv().fetch(options);\n  }\n\n  _addCredentialOptions(options: any) {\n    if (this.basicAuth || this.withCredentials) {\n      options.withCredentials = true;\n    }\n    if (this.basicAuth) {\n      options.headers = { Authorization: this.basicAuth };\n    }\n  }\n\n  metricFindQuery(query: string) {\n    if (!query) {\n      return Promise.resolve([]);\n    }\n\n    let interpolated;\n    try {\n      interpolated = this.templateSrv.replace(query, {}, 'distributed');\n    } catch (err) {\n      return Promise.reject(err);\n    }\n\n    const responseTransform = (result: any) => {\n      return _map(result, (value) => {\n        return { text: value };\n      });\n    };\n\n    const metricsRegex = /metrics\\((.*)\\)/;\n    const tagNamesRegex = /tag_names\\((.*)\\)/;\n    const tagValuesRegex = /tag_values\\((.*?),\\s?(.*)\\)/;\n    const tagNamesSuggestRegex = /suggest_tagk\\((.*)\\)/;\n    const tagValuesSuggestRegex = /suggest_tagv\\((.*)\\)/;\n\n    const metricsQuery = interpolated.match(metricsRegex);\n    if (metricsQuery) {\n      return lastValueFrom(this._performSuggestQuery(metricsQuery[1], 'metrics').pipe(map(responseTransform)));\n    }\n\n    const tagNamesQuery = interpolated.match(tagNamesRegex);\n    if (tagNamesQuery) {\n      return lastValueFrom(this._performMetricKeyLookup(tagNamesQuery[1]).pipe(map(responseTransform)));\n    }\n\n    const tagValuesQuery = interpolated.match(tagValuesRegex);\n    if (tagValuesQuery) {\n      return lastValueFrom(\n        this._performMetricKeyValueLookup(tagValuesQuery[1], tagValuesQuery[2]).pipe(map(responseTransform))\n      );\n    }\n\n    const tagNamesSuggestQuery = interpolated.match(tagNamesSuggestRegex);\n    if (tagNamesSuggestQuery) {\n      return lastValueFrom(this._performSuggestQuery(tagNamesSuggestQuery[1], 'tagk').pipe(map(responseTransform)));\n    }\n\n    const tagValuesSuggestQuery = interpolated.match(tagValuesSuggestRegex);\n    if (tagValuesSuggestQuery) {\n      return lastValueFrom(this._performSuggestQuery(tagValuesSuggestQuery[1], 'tagv').pipe(map(responseTransform)));\n    }\n\n    return Promise.resolve([]);\n  }\n\n  testDatasource() {\n    return lastValueFrom(\n      this._performSuggestQuery('cpu', 'metrics').pipe(\n        map(() => {\n          return { status: 'success', message: 'Data source is working' };\n        })\n      )\n    );\n  }\n\n  getAggregators() {\n    if (this.aggregatorsPromise) {\n      return this.aggregatorsPromise;\n    }\n\n    this.aggregatorsPromise = lastValueFrom(\n      this._get('/api/aggregators').pipe(\n        map((result: any) => {\n          if (result.data && isArray(result.data)) {\n            return result.data.sort();\n          }\n          return [];\n        })\n      )\n    );\n    return this.aggregatorsPromise;\n  }\n\n  getFilterTypes() {\n    if (this.filterTypesPromise) {\n      return this.filterTypesPromise;\n    }\n\n    this.filterTypesPromise = lastValueFrom(\n      this._get('/api/config/filters').pipe(\n        map((result: any) => {\n          if (result.data) {\n            return Object.keys(result.data).sort();\n          }\n          return [];\n        })\n      )\n    );\n    return this.filterTypesPromise;\n  }\n\n  transformMetricData(md: { dps: any }, groupByTags: any, target: any, options: any, tsdbResolution: number) {\n    const metricLabel = this.createMetricLabel(md, target, groupByTags, options);\n    const dps: any[] = [];\n\n    // TSDB returns datapoints has a hash of ts => value.\n    // Can't use pairs(invert()) because it stringifies keys/values\n    each(md.dps, (v: any, k: number) => {\n      if (tsdbResolution === 2) {\n        dps.push([v, k * 1]);\n      } else {\n        dps.push([v, k * 1000]);\n      }\n    });\n\n    return { target: metricLabel, datapoints: dps };\n  }\n\n  createMetricLabel(\n    md: { dps?: any; tags?: any; metric?: any },\n    target: { alias: string },\n    groupByTags: any,\n    options: { scopedVars: any }\n  ) {\n    if (target.alias) {\n      const scopedVars = clone(options.scopedVars || {});\n      each(md.tags, (value, key) => {\n        scopedVars['tag_' + key] = { value: value };\n      });\n      return this.templateSrv.replace(target.alias, scopedVars);\n    }\n\n    let label = md.metric;\n    const tagData: any[] = [];\n\n    if (!isEmpty(md.tags)) {\n      each(toPairs(md.tags), (tag) => {\n        if (has(groupByTags, tag[0])) {\n          tagData.push(tag[0] + '=' + tag[1]);\n        }\n      });\n    }\n\n    if (!isEmpty(tagData)) {\n      label += '{' + tagData.join(', ') + '}';\n    }\n\n    return label;\n  }\n\n  convertTargetToQuery(target: any, options: any, tsdbVersion: number) {\n    if (!target.metric || target.hide) {\n      return null;\n    }\n\n    const query: any = {\n      metric: this.templateSrv.replace(target.metric, options.scopedVars, 'pipe'),\n      aggregator: 'avg',\n    };\n\n    if (target.aggregator) {\n      query.aggregator = this.templateSrv.replace(target.aggregator);\n    }\n\n    if (target.shouldComputeRate) {\n      query.rate = true;\n      query.rateOptions = {\n        counter: !!target.isCounter,\n      };\n\n      if (target.counterMax && target.counterMax.length) {\n        query.rateOptions.counterMax = parseInt(target.counterMax, 10);\n      }\n\n      if (target.counterResetValue && target.counterResetValue.length) {\n        query.rateOptions.resetValue = parseInt(target.counterResetValue, 10);\n      }\n\n      if (tsdbVersion >= 2) {\n        query.rateOptions.dropResets =\n          !query.rateOptions.counterMax && (!query.rateOptions.ResetValue || query.rateOptions.ResetValue === 0);\n      }\n    }\n\n    if (!target.disableDownsampling) {\n      let interval = this.templateSrv.replace(target.downsampleInterval || options.interval);\n\n      if (interval.match(/\\.[0-9]+s/)) {\n        interval = parseFloat(interval) * 1000 + 'ms';\n      }\n\n      query.downsample = interval + '-' + target.downsampleAggregator;\n\n      if (target.downsampleFillPolicy && target.downsampleFillPolicy !== 'none') {\n        query.downsample += '-' + target.downsampleFillPolicy;\n      }\n    }\n\n    if (target.filters && target.filters.length > 0) {\n      query.filters = angular.copy(target.filters);\n      if (query.filters) {\n        for (const filterKey in query.filters) {\n          query.filters[filterKey].filter = this.templateSrv.replace(\n            query.filters[filterKey].filter,\n            options.scopedVars,\n            'pipe'\n          );\n        }\n      }\n    } else {\n      query.tags = angular.copy(target.tags);\n      if (query.tags) {\n        for (const tagKey in query.tags) {\n          query.tags[tagKey] = this.templateSrv.replace(query.tags[tagKey], options.scopedVars, 'pipe');\n        }\n      }\n    }\n\n    if (target.explicitTags) {\n      query.explicitTags = true;\n    }\n\n    return query;\n  }\n\n  mapMetricsToTargets(metrics: any, options: any, tsdbVersion: number) {\n    let interpolatedTagValue, arrTagV;\n    return _map(metrics, (metricData) => {\n      if (tsdbVersion === 3) {\n        return metricData.query.index;\n      } else {\n        return findIndex(options.targets as any[], (target) => {\n          if (target.filters && target.filters.length > 0) {\n            return target.metric === metricData.metric;\n          } else {\n            return (\n              target.metric === metricData.metric &&\n              every(target.tags, (tagV, tagK) => {\n                interpolatedTagValue = this.templateSrv.replace(tagV, options.scopedVars, 'pipe');\n                arrTagV = interpolatedTagValue.split('|');\n                return includes(arrTagV, metricData.tags[tagK]) || interpolatedTagValue === '*';\n              })\n            );\n          }\n        });\n      }\n    });\n  }\n\n  interpolateVariablesInQueries(queries: OpenTsdbQuery[], scopedVars: ScopedVars): OpenTsdbQuery[] {\n    if (!queries.length) {\n      return queries;\n    }\n\n    return queries.map((query) => ({\n      ...query,\n      metric: this.templateSrv.replace(query.metric, scopedVars),\n    }));\n  }\n\n  convertToTSDBTime(date: any, roundUp: any, timezone: any) {\n    if (date === 'now') {\n      return null;\n    }\n\n    date = dateMath.parse(date, roundUp, timezone);\n    return date.valueOf();\n  }\n}\n","import { auto } from 'angular';\nimport { map, size, has } from 'lodash';\n\nimport { textUtil, rangeUtil } from '@grafana/data';\nimport { QueryCtrl } from 'app/plugins/sdk';\n\nexport class OpenTsQueryCtrl extends QueryCtrl {\n  static templateUrl = 'partials/query.editor.html';\n  aggregators: any;\n  fillPolicies: any;\n  filterTypes: any;\n  tsdbVersion: any;\n  aggregator: any;\n  downsampleInterval: any;\n  downsampleAggregator: any;\n  downsampleFillPolicy: any;\n  errors: any;\n  suggestMetrics: any;\n  suggestTagKeys: any;\n  suggestTagValues: any;\n  addTagMode = false;\n  addFilterMode = false;\n\n  /** @ngInject */\n  constructor($scope: any, $injector: auto.IInjectorService) {\n    super($scope, $injector);\n\n    this.errors = this.validateTarget();\n    this.aggregators = ['avg', 'sum', 'min', 'max', 'dev', 'zimsum', 'mimmin', 'mimmax'];\n    this.fillPolicies = ['none', 'nan', 'null', 'zero'];\n    this.filterTypes = [\n      'wildcard',\n      'iliteral_or',\n      'not_iliteral_or',\n      'not_literal_or',\n      'iwildcard',\n      'literal_or',\n      'regexp',\n    ];\n\n    this.tsdbVersion = this.datasource.tsdbVersion;\n\n    if (!this.target.aggregator) {\n      this.target.aggregator = 'sum';\n    }\n\n    if (!this.target.downsampleAggregator) {\n      this.target.downsampleAggregator = 'avg';\n    }\n\n    if (!this.target.downsampleFillPolicy) {\n      this.target.downsampleFillPolicy = 'none';\n    }\n\n    this.datasource.getAggregators().then((aggs: { length: number }) => {\n      if (aggs.length !== 0) {\n        this.aggregators = aggs;\n      }\n    });\n\n    this.datasource.getFilterTypes().then((filterTypes: { length: number }) => {\n      if (filterTypes.length !== 0) {\n        this.filterTypes = filterTypes;\n      }\n    });\n\n    // needs to be defined here as it is called from typeahead\n    this.suggestMetrics = (query: string, callback: any) => {\n      this.datasource\n        .metricFindQuery('metrics(' + query + ')')\n        .then(this.getTextValues)\n        .then(callback);\n    };\n\n    this.suggestTagKeys = (query: any, callback: any) => {\n      this.datasource.suggestTagKeys(this.target.metric).then(callback);\n    };\n\n    this.suggestTagValues = (query: string, callback: any) => {\n      this.datasource\n        .metricFindQuery('suggest_tagv(' + query + ')')\n        .then(this.getTextValues)\n        .then(callback);\n    };\n  }\n\n  targetBlur() {\n    this.errors = this.validateTarget();\n    this.refresh();\n  }\n\n  getTextValues(metricFindResult: any) {\n    return map(metricFindResult, (value) => {\n      return textUtil.escapeHtml(value.text);\n    });\n  }\n\n  addTag() {\n    if (this.target.filters && this.target.filters.length > 0) {\n      this.errors.tags = 'Please remove filters to use tags, tags and filters are mutually exclusive.';\n    }\n\n    if (!this.addTagMode) {\n      this.addTagMode = true;\n      return;\n    }\n\n    if (!this.target.tags) {\n      this.target.tags = {};\n    }\n\n    this.errors = this.validateTarget();\n\n    if (!this.errors.tags) {\n      this.target.tags[this.target.currentTagKey] = this.target.currentTagValue;\n      this.target.currentTagKey = '';\n      this.target.currentTagValue = '';\n      this.targetBlur();\n    }\n\n    this.addTagMode = false;\n  }\n\n  removeTag(key: string | number) {\n    delete this.target.tags[key];\n    this.targetBlur();\n  }\n\n  editTag(key: string | number, value: any) {\n    this.removeTag(key);\n    this.target.currentTagKey = key;\n    this.target.currentTagValue = value;\n    this.addTag();\n  }\n\n  closeAddTagMode() {\n    this.addTagMode = false;\n    return;\n  }\n\n  addFilter() {\n    if (this.target.tags && size(this.target.tags) > 0) {\n      this.errors.filters = 'Please remove tags to use filters, tags and filters are mutually exclusive.';\n    }\n\n    if (!this.addFilterMode) {\n      this.addFilterMode = true;\n      return;\n    }\n\n    if (!this.target.filters) {\n      this.target.filters = [];\n    }\n\n    if (!this.target.currentFilterType) {\n      this.target.currentFilterType = 'iliteral_or';\n    }\n\n    if (!this.target.currentFilterGroupBy) {\n      this.target.currentFilterGroupBy = false;\n    }\n\n    this.errors = this.validateTarget();\n\n    if (!this.errors.filters) {\n      const currentFilter = {\n        type: this.target.currentFilterType,\n        tagk: this.target.currentFilterKey,\n        filter: this.target.currentFilterValue,\n        groupBy: this.target.currentFilterGroupBy,\n      };\n      this.target.filters.push(currentFilter);\n      this.target.currentFilterType = 'literal_or';\n      this.target.currentFilterKey = '';\n      this.target.currentFilterValue = '';\n      this.target.currentFilterGroupBy = false;\n      this.targetBlur();\n    }\n\n    this.addFilterMode = false;\n  }\n\n  removeFilter(index: number) {\n    this.target.filters.splice(index, 1);\n    this.targetBlur();\n  }\n\n  editFilter(fil: { tagk: any; filter: any; type: any; groupBy: any }, index: number) {\n    this.removeFilter(index);\n    this.target.currentFilterKey = fil.tagk;\n    this.target.currentFilterValue = fil.filter;\n    this.target.currentFilterType = fil.type;\n    this.target.currentFilterGroupBy = fil.groupBy;\n    this.addFilter();\n  }\n\n  closeAddFilterMode() {\n    this.addFilterMode = false;\n    return;\n  }\n\n  validateTarget() {\n    const errs: any = {};\n\n    if (this.target.shouldDownsample) {\n      try {\n        if (this.target.downsampleInterval) {\n          rangeUtil.describeInterval(this.target.downsampleInterval);\n        } else {\n          errs.downsampleInterval = \"You must supply a downsample interval (e.g. '1m' or '1h').\";\n        }\n      } catch (err) {\n        if (err instanceof Error) {\n          errs.downsampleInterval = err.message;\n        }\n      }\n    }\n\n    if (this.target.tags && has(this.target.tags, this.target.currentTagKey)) {\n      errs.tags = \"Duplicate tag key '\" + this.target.currentTagKey + \"'.\";\n    }\n\n    return errs;\n  }\n}\n","import { DataSourcePlugin } from '@grafana/data';\n\nimport { ConfigEditor } from './components/ConfigEditor';\nimport OpenTsDatasource from './datasource';\nimport { OpenTsQueryCtrl } from './query_ctrl';\n\nexport const plugin = new DataSourcePlugin(OpenTsDatasource)\n  .setQueryCtrl(OpenTsQueryCtrl)\n  .setConfigEditor(ConfigEditor);\n","import React from 'react';\n\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\nimport { DataSourceHttpSettings } from '@grafana/ui';\n\nimport { OpenTsdbOptions } from '../types';\n\nimport { OpenTsdbDetails } from './OpenTsdbDetails';\n\nexport const ConfigEditor = (props: DataSourcePluginOptionsEditorProps<OpenTsdbOptions>) => {\n  const { options, onOptionsChange } = props;\n\n  return (\n    <>\n      <DataSourceHttpSettings\n        defaultUrl=\"http://localhost:4242\"\n        dataSourceConfig={options}\n        onChange={onOptionsChange}\n      />\n      <OpenTsdbDetails value={options} onChange={onOptionsChange} />\n    </>\n  );\n};\n","import { makeClassES5Compatible } from '@grafana/data';\nimport { loadPluginCss } from '@grafana/runtime';\nimport { MetricsPanelCtrl as MetricsPanelCtrlES6 } from 'app/angular/panel/metrics_panel_ctrl';\nimport { PanelCtrl as PanelCtrlES6 } from 'app/angular/panel/panel_ctrl';\nimport { QueryCtrl as QueryCtrlES6 } from 'app/angular/panel/query_ctrl';\n\nconst PanelCtrl = makeClassES5Compatible(PanelCtrlES6);\nconst MetricsPanelCtrl = makeClassES5Compatible(MetricsPanelCtrlES6);\nconst QueryCtrl = makeClassES5Compatible(QueryCtrlES6);\n\nexport { PanelCtrl, MetricsPanelCtrl, QueryCtrl, loadPluginCss };\n"],"names":["DEFAULT_PORTS","http","https","ftp","AngularLocationWrapper","constructor","this","absUrl","wrapInDeprecationWarning","hash","host","path","port","protocol","replace","search","state","url","fn","replacement","self","deprecationWarning","name","apply","arguments","window","location","origin","newHash","navigationLogger","Error","locationService","slice","URL","href","hostname","pathname","parsedPath","String","startsWith","length","parseInt","paramValue","newQuery","locationSearchToObject","key","Object","keys","undefined","updatedUrl","urlUtil","newUrl","trim","MetricsPanelCtrl","PanelCtrl","$scope","$injector","super","next","data","panelData","LoadingState","loading","processDataError","error","angularDirtyCheck","request","timeInfo","timeRange","range","useDataFrames","handleDataFrames","series","legacy","map","v","toLegacyResponseData","handleQueryResult","contextSrv","get","datasourceSrv","timeSrv","templateSrv","panel","datasource","events","on","PanelEvents","onMetricsPanelRefresh","bind","onPanelTearDown","onMetricsPanelMounted","queryRunner","getQueryRunner","querySubscription","getData","withTransforms","withFieldConfig","subscribe","panelDataObserver","unsubscribe","otherPanelInFullscreenMode","snapshotData","updateTimeRange","isArray","$timeout","emit","scopedVars","then","issueQueries","catch","err","cancelled","console","log","message","$root","$$phase","$digest","newTimeData","applyPanelTimeOverrides","run","queries","targets","panelId","id","dashboardId","dashboard","timezone","getTimezone","maxDataPoints","width","minInterval","interval","cacheTimeout","transformations","snapshot","frame","toDataFrameDTO","result","plugin","$parent","editorTabs","$location","EventBusSrv","timing","config","type","pluginId","pluginName","$on","panelDidMount","panelInitialized","renderingCompleted","profiler","refresh","publishAppEvent","event","payload","appEvent","initEditMode","editModeInitiated","addEditorTab","title","directiveFn","index","icon","editorTab","isString","templateUrl","splice","push","getExtendedMenu","menu","otherPanelInFullscreen","render","QueryCtrl","panelCtrl","ctrl","target","isLastQuery","indexOf","Select","Input","LegacyForms","tsdbVersions","label","value","tsdbResolutions","OpenTsdbDetails","props","onChange","idSuffix","useUniqueId","className","htmlFor","inputId","options","find","version","jsonData","tsdbVersion","onSelectChangeHandler","resolution","tsdbResolution","lookupLimit","onInputChangeHandler","newValue","currentTarget","AnnotationEditor","query","setTarget","useState","isGlobal","setIsGlobal","updateValue","val","fromAnnotations","I","e","onBlur","placeholder","updateIsGlobal","prepareAnnotation","json","resultingTarget","migrateLegacyAnnotation","OpenTsDatasource","DataSourceApi","instanceSettings","getTemplateSrv","withCredentials","basicAuth","tagKeys","aggregatorsPromise","filterTypesPromise","annotations","QueryEditor","some","streams","annotation","Observable","subscriber","annotationEvent","toDataFrame","ex","finally","complete","merge","start","convertToTSDBTime","raw","from","end","to","qs","each","metric","convertTargetToQuery","compact","isEmpty","of","groupByTags","filters","tagk","tags","filter","hide","performTimeSeriesQuery","pipe","catchError","response","metricToTargetMapping","mapMetricsToTargets","_map","metricData","_saveTagKeys","transformMetricData","eventList","aggregator","lastValueFrom","results","annotationObject","globalAnnotations","ann","text","description","time","Math","floor","startTime","targetContainsTemplate","i","containsTemplate","tagKey","msResolution","reqBody","showQuery","method","_addCredentialOptions","getBackendSrv","fetch","suggestTagKeys","Promise","resolve","aggregateTags","tag","_performSuggestQuery","_get","q","max","_performMetricKeyValueLookup","keysArray","split","keysQuery","join","m","limit","tagvs","r","_performMetricKeyLookup","tagks","tagv","relativeUrl","params","headers","Authorization","metricFindQuery","interpolated","reject","responseTransform","metricsQuery","match","tagNamesQuery","tagValuesQuery","tagNamesSuggestQuery","tagValuesSuggestQuery","testDatasource","status","getAggregators","sort","getFilterTypes","md","metricLabel","createMetricLabel","dps","k","datapoints","alias","clone","tagData","toPairs","has","shouldComputeRate","rate","rateOptions","counter","isCounter","counterMax","counterResetValue","resetValue","dropResets","ResetValue","disableDownsampling","downsampleInterval","parseFloat","downsample","downsampleAggregator","downsampleFillPolicy","angular","filterKey","explicitTags","metrics","interpolatedTagValue","arrTagV","findIndex","every","tagV","tagK","includes","interpolateVariablesInQueries","date","roundUp","dateMath","valueOf","OpenTsQueryCtrl","errors","validateTarget","aggregators","fillPolicies","filterTypes","aggs","suggestMetrics","callback","getTextValues","suggestTagValues","targetBlur","metricFindResult","textUtil","addTag","addTagMode","currentTagKey","currentTagValue","removeTag","editTag","closeAddTagMode","addFilter","size","addFilterMode","currentFilterType","currentFilterGroupBy","currentFilter","currentFilterKey","currentFilterValue","groupBy","removeFilter","editFilter","fil","closeAddFilterMode","errs","shouldDownsample","rangeUtil","DataSourcePlugin","setQueryCtrl","setConfigEditor","onOptionsChange","DataSourceHttpSettings","defaultUrl","dataSourceConfig","makeClassES5Compatible","PanelCtrlES6","MetricsPanelCtrlES6","QueryCtrlES6"],"sourceRoot":""}