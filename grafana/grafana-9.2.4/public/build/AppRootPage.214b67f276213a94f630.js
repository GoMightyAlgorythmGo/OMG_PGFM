"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[295],{20469:(e,n,t)=>{t.d(n,{ZP:()=>l,hF:()=>a,rb:()=>i});var r=t(93964),o=t.n(r);const a=o().module("grafana.core",["ngRoute"]),i=[a,o().module("grafana.controllers",[]),o().module("grafana.directives",[]),o().module("grafana.factories",[]),o().module("grafana.services",[]),o().module("grafana.filters",[]),o().module("grafana.routes",[])],l=a},69435:(e,n,t)=>{t.d(n,{GO:()=>l,rR:()=>i});var r=t(20469),o=t(78837);class a{constructor(){var e,n,t;t=void 0,(n="navItems")in(e=this)?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,this.navItems=o.ZP.bootData.navTree}getCfgNode(){return this.navItems.find((e=>"cfg"===e.id))}getNav(){var e;let n=this.navItems;const t={breadcrumbs:[]};for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];for(const e of o){if("number"==typeof e){t.main=t.breadcrumbs[e];break}const r=n.find((n=>n.id===e));var i;if(r)t.breadcrumbs.push(r),t.node=r,t.main=r,n=null!==(i=r.children)&&void 0!==i?i:[]}if(null!==(e=t.main)&&void 0!==e&&e.children)for(const e of t.main.children){var l;e.active=e.url===(null===(l=t.node)||void 0===l?void 0:l.url)}return t}getNotFoundNav(){return i()}}function i(){return l("Page not found","404 Error")}function l(e,n){const t={text:e,subTitle:n,icon:"exclamation-triangle"};return{node:t,main:t}}a.$inject=[],r.ZP.service("navModelSrv",a)},25309:(e,n,t)=>{t.r(n),t.d(n,{AppRootPage:()=>M,default:()=>U,getAppPluginPageError:()=>A});var r,o,a,i=t(14066),l=t(68404),s=t(97394),u=(r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},r(e,n)},function(e,n){function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),c="html",d="svg",p=function(e,n){var t,r,o,a={};if(e===c)o=document.createElement("div");else{if(e!==d)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');o=document.createElementNS("http://www.w3.org/2000/svg","g")}if(n&&"object"==typeof n)for(var i=0,l=Object.entries(n.attributes);i<l.length;i++){var s=l[i],u=s[0],p=s[1];o.setAttribute(u,p)}var h={element:o,elementType:e,setPortalProps:function(e){a=e},getInitialPortalProps:function(){return a},mount:function(n,o){if(o!==r){if(h.unmount(),n!==t&&!function(e,n){if(n===c)return e instanceof HTMLElement;if(n===d)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+n+'" for validateElementType.')}(n,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+n.tagName+">.");n.replaceChild(h.element,o),t=n,r=o}},unmount:function(e){e&&e!==r||t&&r&&(t.replaceChild(r,h.element),t=void 0,r=void 0)}};return h},h=function(e){function n(n){var t=e.call(this,n)||this;return t.addPropsChannel=function(){Object.assign(t.props.node,{setPortalProps:function(e){t.setState({nodeProps:e})}})},t.state={nodeProps:t.props.node.getInitialPortalProps()},t}return u(n,e),n.prototype.componentDidMount=function(){this.addPropsChannel()},n.prototype.componentDidUpdate=function(){this.addPropsChannel()},n.prototype.render=function(){var e=this,n=this.props,t=n.children,r=n.node;return s.createPortal(l.Children.map(t,(function(n){return l.isValidElement(n)?l.cloneElement(n,e.state.nodeProps):n})),r.element)},n}(l.PureComponent),f=function(e){function n(n){var t=e.call(this,n)||this;return t.placeholderNode=l.createRef(),t.passPropsThroughPortal(),t}return u(n,e),n.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},n.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var n=this.placeholderNode.current,t=n.parentNode;e.mount(t,n),this.passPropsThroughPortal()},n.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode.setPortalProps({}),this.currentPortalNode=e);var n=this.placeholderNode.current,t=n.parentNode;e.mount(t,n),this.passPropsThroughPortal()},n.prototype.componentWillUnmount=function(){var e=this.props.node;e.unmount(this.placeholderNode.current),e.setPortalProps({})},n.prototype.render=function(){return l.createElement("div",{ref:this.placeholderNode})},n}(l.PureComponent),m=p.bind(null,c),v=(p.bind(null,d),t(58565)),g=t(19383),P=t(55261),b=t(48147),y=t(69435),N=t(90894),j=t(22584),w=t(98163),O=t(47570),x=t(32569),E=t(33500),T=t(43653),C=t(20777),I=t(45916);const S={loading:!0,pluginNav:null,plugin:null};function M(e){let{match:n,queryParams:t,location:r}=e;const[i,s]=(0,l.useReducer)(_.reducer,S),u=(0,l.useMemo)((()=>m()),[]),{plugin:c,loading:d,pluginNav:p}=i,P=(0,O.v9)((0,v.P1)(k,(e=>(0,T.d)(r,p,e)))),M=(0,l.useMemo)((()=>(0,C.a)(P)),[P]);(0,l.useEffect)((()=>{!async function(e,n){try{const t=await(0,x.a)(e).then((e=>{const t=A(e);return t?(w.h$.emit(g.SI.alertError,[t]),n(_.actions.setState({pluginNav:(0,y.GO)(t)})),null):(0,E.Av)(e)}));n(_.actions.setState({plugin:t,loading:!1,pluginNav:null}))}catch(e){n(_.actions.setState({plugin:null,loading:!1,pluginNav:(0,y.rR)()}))}}(n.params.pluginId,s)}),[n.params.pluginId]);const U=(0,l.useCallback)((e=>s(_.actions.changeNav(e))),[]);if(!c||n.params.pluginId!==c.meta.id)return(0,I.jsx)(N.T,Object.assign({},function(){if(b.v.featureToggles.topnav)return{navId:"apps"};const e={text:"Loading plugin"};return{navModel:{main:e,node:e}}}(),{children:d&&(o||(o=(0,I.jsx)(j.Z,{})))}));if(!c.root)return(0,I.jsxs)(N.T,{navModel:(0,y.GO)("Plugin load error"),children:[a||(a=(0,I.jsx)("div",{children:"No root app page component found"})),";"]});const V=c.root&&(0,I.jsx)(c.root,{meta:c.meta,basename:n.url,onNavChanged:U,query:t,path:r.pathname});return b.v.featureToggles.topnav&&!p?(0,I.jsx)(C.v.Provider,{value:M,children:V}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(h,{node:u,children:V}),P?(0,I.jsx)(N.T,{navModel:P,pageNav:null==p?void 0:p.node,children:(0,I.jsx)(N.T.Contents,{isLoading:d,children:(0,I.jsx)(f,{node:u})})}):(0,I.jsx)(N.T,{children:(0,I.jsx)(f,{node:u})})]})}const _=(0,i.oM)({name:"prom-builder-container",initialState:S,reducers:{setState:(e,n)=>{Object.assign(e,n.payload)},changeNav:(e,n)=>{let t=n.payload;t&&t.node.children&&(t=Object.assign({},t,{node:Object.assign({},t.main,{hideFromBreadcrumbs:!0})})),e.pluginNav=t}}});function k(e){return e.navIndex}function A(e){return e?e.type!==P.zV.app?"Plugin must be an app":e.enabled?null:"Application Not Enabled":"Unknown Plugin"}const U=M},43653:(e,n,t)=>{t.d(n,{O:()=>u,d:()=>c});var r=t(55261),o=t(48147),a=t(8674),i=t(75064),l=t(32569),s=t(33500);async function u(e){const n=await(0,l.a)(e);let t;if(n.type===r.zV.app&&(t=await(0,s.Av)(n)),n.type===r.zV.datasource&&(t=await(0,s.nL)(n)),n.type===r.zV.panel){t=await(0,i._2)(n)}if(n.type===r.zV.renderer&&(t={meta:n}),!t)throw new Error("Unknown Plugin type: "+n.type);return t}function c(e,n,t){var r,i;if(!o.v.featureToggles.topnav)return n;const l=(0,a.h)(t,"apps").main,s=Object.assign({},l),u=o.v.appSubUrl+e.pathname+e.search;let c;return s.children=(null!==(r=null==s?void 0:s.children)&&void 0!==r?r:[]).map((e=>e.children?Object.assign({},e,{children:e.children.map((e=>{var n;return u.startsWith(null!==(n=e.url)&&void 0!==n?n:"")?(c=Object.assign({},e,{active:!0}),c):e}))}):e)),{main:s,node:null!==(i=c)&&void 0!==i?i:s}}}}]);
//# sourceMappingURL=AppRootPage.214b67f276213a94f630.js.map