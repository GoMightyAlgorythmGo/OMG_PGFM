"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[207],{54531:(e,t,n)=>{n.r(t),n.d(t,{SceneListPage:()=>l,default:()=>c});n(68404);var i=n(68522),s=n(11340),a=n(90894),r=n(62889),o=n(45916);const l=e=>{let{}=e;const t=(0,r.F)();return(0,o.jsx)(a.T,{navId:"scenes",children:(0,o.jsx)(a.T.Contents,{children:(0,o.jsx)(i.Stack,{direction:"column",children:t.map((e=>(0,o.jsx)(s.Z,{href:`/scenes/${e.state.title}`,children:(0,o.jsx)(s.Z.Heading,{children:e.state.title})},e.state.title)))})})})},c=l},11471:(e,t,n)=>{n.r(t),n.d(t,{ScenePage:()=>r,default:()=>o});n(68404);var i,s=n(62889),a=n(45916);const r=e=>{const t=(0,s.H)(e.match.params.name);return t?(0,a.jsx)(t.Component,{model:t}):i||(i=(0,a.jsx)("h2",{children:"Scene not found"}))},o=r},62889:(e,t,n)=>{n.d(t,{H:()=>$e,F:()=>Pe});var i=n(75414),s=n(68404),a=n(29918),r=n(48147),o=n(27003),l=n(31510),c=n(47496),d=n(90894),u=n(72646),h=n(4203),g=n(34110),p=n(97437),f=n(64224),m=n(27549),v=n(9617),b=n(45916);function w(e){let{model:t,children:n}=e;const i=(0,v.wW)(x),s=t.getSceneEditor(),{hoverObject:a,selectedObject:r}=s.useState();let o=i.wrapper;return(null==a?void 0:a.ref)===t&&(o+=" "+i.hover),(null==r?void 0:r.ref)===t&&(o+=" "+i.selected),(0,b.jsx)("div",{style:{},className:o,onMouseEnter:()=>s.onMouseEnterObject(t),onMouseLeave:()=>s.onMouseLeaveObject(t),onClick:e=>{e.stopPropagation(),s.onSelectObject(t)},children:n})}const x=e=>({wrapper:(0,m.css)({display:"flex",flexGrow:1,padding:8,border:`1px dashed ${e.colors.primary.main}`,cursor:"pointer"}),hover:(0,m.css)({border:`1px solid ${e.colors.primary.border}`}),selected:(0,m.css)({border:`1px solid ${e.colors.error.border}`})});function j(e){var t;let{model:n,isEditing:i}=e;const a=null!==(t=n.constructor.Component)&&void 0!==t?t:y,r=(0,b.jsx)(a,{model:n,isEditing:i});return(0,s.useEffect)((()=>(n.isActive||n.activate(),()=>{n.isActive&&n.deactivate()})),[n]),i?(0,b.jsx)(w,{model:n,children:r}):r}function y(e){return null}var S,C,O,I=n(57385);class R extends I.R{}function E(e){return void 0!==e.useState}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}O="scene-object-state-change",(C="type")in(S=R)?Object.defineProperty(S,C,{value:O,enumerable:!0,configurable:!0,writable:!0}):S[C]=O;class z{constructor(e){k(this,"subject",new u.x),k(this,"state",void 0),k(this,"parent",void 0),k(this,"subs",new h.w0),k(this,"isActive",void 0),k(this,"events",new p.F),e.key||(e.key=(0,g.Z)()),this.state=e,this.subject.next(e),this.setParent()}get Component(){return j}get Editor(){var e;return null!==(e=this.constructor.Editor)&&void 0!==e?e:()=>null}setParent(){for(const e of Object.values(this.state))if(E(e)&&(e.parent=this),Array.isArray(e))for(const t of e)E(t)&&(t.parent=this)}subscribe(e){return this.subject.subscribe(e)}setState(e){const t=this.state;this.state=Object.assign({},this.state,e),this.setParent(),this.subject.next(this.state),this.getRoot().events.publish(new R({prevState:t,newState:this.state,partialUpdate:e,changedObject:this}))}getRoot(){return this.parent?this.parent.getRoot():this}activate(){this.isActive=!0;const{$data:e}=this.state;e&&!e.isActive&&e.activate()}deactivate(){this.isActive=!1;const{$data:e}=this.state;e&&e.isActive&&e.deactivate(),this.subs.unsubscribe(),this.subs=new h.w0}useState(){return function(e){const t=(0,f.N)();return(0,s.useEffect)((()=>{const n=e.subject.subscribe(t);return()=>n.unsubscribe()}),[e,t]),e.state}(this)}getTimeRange(){const{$timeRange:e}=this.state;if(e)return e;if(this.parent)return this.parent.getTimeRange();throw new Error("No time range found in scene tree")}getData(){const{$data:e}=this.state;if(e)return e;if(this.parent)return this.parent.getData();throw new Error("No data found in scene tree")}getSceneEditor(){const{$editor:e}=this.state;if(e)return e;if(this.parent)return this.parent.getSceneEditor();throw new Error("No editor found in scene tree")}clone(e){const t=Object.assign({},this.state);for(const e in t){const n=t[e];n instanceof z&&(t[e]=n.clone())}if("children"in this.state){const e=[];for(const t of this.state.children)e.push(t.clone());t.children=e}return Object.assign(t,e),new this.constructor(t)}}var P=n(98712);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ${constructor(e){T(this,"locationListenerUnsub",void 0),T(this,"stateChangeSub",void 0),T(this,"onLocationUpdate",(e=>{})),T(this,"onStateChanged",(e=>{let{payload:t}=e;const n=t.changedObject;if("getUrlState"in n){const e=n.getUrlState();P.E1.partial(e,!0)}})),this.stateChangeSub=e.events.subscribe(R,this.onStateChanged),this.locationListenerUnsub=P.E1.getHistory().listen(this.onLocationUpdate)}cleanUp(){this.stateChangeSub.unsubscribe(),this.locationListenerUnsub()}}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class M extends z{constructor(){super(...arguments),D(this,"urlSyncManager",void 0)}activate(){super.activate(),this.urlSyncManager=new $(this)}deactivate(){super.deactivate(),this.urlSyncManager.cleanUp()}}D(M,"Component",(function(e){let{model:t}=e;const{title:n,layout:i,actions:s=[],isEditing:u,$editor:h}=t.useState(),g=(null!=s?s:[]).map((e=>(0,b.jsx)(e.Component,{model:e},e.state.key)));h&&g.push((0,b.jsx)(o.h,{icon:"cog",variant:u?"primary":"default",onClick:()=>t.setState({isEditing:!t.state.isEditing})}));const p=r.v.featureToggles.topnav?(0,b.jsx)(c.A,{actions:g}):(0,b.jsx)(l.X,{title:n,children:g});return(0,b.jsx)(d.T,{navId:"scenes",pageNav:{text:n},layout:a.Qz.Canvas,toolbar:p,children:(0,b.jsxs)("div",{style:{flexGrow:1,display:"flex",gap:"8px",overflow:"auto"},children:[(0,b.jsx)(i.Component,{model:i,isEditing:u}),h&&(0,b.jsx)(h.Component,{model:h,isEditing:u})]})})}));var N=n(84719),q=n(1652);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class A extends z{}F(A,"Editor",(function(e){let{model:t}=e;const{fontSize:n}=t.useState();return(0,b.jsx)(N.g,{label:"Font size",children:(0,b.jsx)(q.I,{type:"number",defaultValue:n,onBlur:e=>t.setState({fontSize:parseInt(e.currentTarget.value,10)})})})})),F(A,"Component",(e=>{let{model:t}=e;const{text:n,fontSize:i=20,align:s="left"}=t.useState(),a={fontSize:i,display:"flex",flexGrow:1,alignItems:"center",padding:16,justifyContent:s};return(0,b.jsx)("div",{style:a,children:n})}));var _=n(96380);function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class G extends z{toggleDirection(){this.setState({direction:"row"===this.state.direction?"column":"row"})}}function L(e){let{item:t,direction:n,isEditing:i}=e;const{size:s}=t.useState();return(0,b.jsx)("div",{style:W(n,s),children:(0,b.jsx)(t.Component,{model:t,isEditing:i})})}function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{xSizing:n="fill",ySizing:i="fill"}=t,s={display:"flex",flexDirection:e,minWidth:t.minWidth,minHeight:t.minHeight};return"column"===e?(t.height?s.height=t.height:s.flexGrow="fill"===i?1:0,t.width?s.width=t.width:s.alignSelf="fill"===n?"stretch":"flex-start"):(t.height?s.height=t.height:s.alignSelf="fill"===i?"stretch":"flex-start",t.width?s.width=t.width:s.flexGrow="fill"===n?1:0),s}U(G,"Component",(function(e){let{model:t,isEditing:n}=e;const{direction:i="row",children:s}=t.useState();return(0,b.jsx)("div",{style:{flexGrow:1,flexDirection:i,display:"flex",gap:"8px"},children:s.map((e=>(0,b.jsx)(L,{item:e,direction:i,isEditing:n},e.state.key)))})})),U(G,"Editor",(function(e){let{model:t}=e;const{direction:n="row"}=t.useState();return(0,b.jsx)(N.g,{label:"Direction",children:(0,b.jsx)(_.S,{options:[{icon:"arrow-right",value:"row"},{icon:"arrow-down",value:"column"}],value:n,onChange:e=>t.setState({direction:e})})})}));var H=n(5937);class V extends z{}class Z extends z{activate(){super.activate(),this.subs.add(this.getData().subscribe({next:e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===H.Gu.Done&&this.performRepeat(e.data)}}))}performRepeat(e){const t=this.state.layout.state.children[0],n=[];for(const i of e.series){const s=t.clone({key:`${n.length}`,$data:new V({data:Object.assign({},e,{series:[i]})})});n.push(s)}this.state.layout.setState({children:n})}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Z,"Component",(e=>{let{model:t,isEditing:n}=e;const{layout:i}=t.useState();return(0,b.jsx)(i.Component,{model:i,isEditing:n})}));var J=n(17077),K=n(65014),Q=n(43961);class B extends z{}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(B,"Component",(function(e){let{model:t}=e;const{hidePicker:n}=t.useState(),i=t.getTimeRange(),s=i.useState();if(n)return null;return(0,b.jsxs)(J.R,{alignment:"right",children:[(0,b.jsx)(Q.a,{value:s,onChange:i.onTimeRangeChange,timeZone:"browser",fiscalYearStartMonth:0,onMoveBackward:()=>{},onMoveForward:()=>{},onZoom:()=>{},onChangeTimeZone:()=>{},onChangeFiscalYearStartMonth:()=>{}}),(0,b.jsx)(K.dP,{onRefresh:i.onRefresh,onIntervalChanged:i.onIntervalChanged})]})}));Y(class extends z{},"Component",(e=>{let{model:t}=e;const n=t.useState();return(0,b.jsx)(o.h,{onClick:n.onClick,icon:n.icon})}));class X extends z{}Y(X,"Component",(e=>{let{model:t}=e;const n=t.useState();return(0,b.jsx)(q.I,{defaultValue:n.value,width:8,onBlur:e=>{t.state.onChange(parseInt(e.currentTarget.value,10))}})}));var ee=n(87723),te=n(91115),ne=n(4293),ie=n(12307);function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ae extends z{constructor(){super(...arguments),se(this,"onSetTimeRange",(e=>{this.getTimeRange().setState({raw:{from:(0,te.zh)(e.from),to:(0,te.zh)(e.to)},from:(0,te.zh)(e.from),to:(0,te.zh)(e.to)})}))}}function re(e){let{model:t}=e;const{title:n,pluginId:i,options:s,fieldConfig:a}=t.useState(),{data:r}=t.getData().useState();return(0,b.jsx)(ee.Z,{children:e=>{let{width:o,height:l}=e;return o<3||l<3?null:(0,b.jsx)(ie.fm,{title:n,width:o,height:l,children:(e,n)=>(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(ne.$,{title:"Raw data",pluginId:i,width:e,height:n,data:r,options:s,fieldConfig:a,onOptionsChange:()=>{},onChangeTimeRange:t.onSetTimeRange})})})}})}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}se(ae,"Component",re),se(ae,"Editor",(function(e){let{model:t}=e;const{title:n}=t.useState();return(0,b.jsx)(N.g,{label:"Title",children:(0,b.jsx)(q.I,{defaultValue:n,onBlur:e=>t.setState({title:e.currentTarget.value})})})})),re.displayName="ScenePanelRenderer";class le extends z{constructor(){super(...arguments),oe(this,"onTimeRangeChange",(e=>{this.setState(e)})),oe(this,"onRefresh",(()=>{this.setState(Object.assign({},this.state))})),oe(this,"onIntervalChanged",(e=>{}))}getUrlState(){return{from:this.state.raw.from,to:this.state.raw.to}}updateFromUrl(e){}}var ce=n(37812);function de(e){let{model:t}=e;return(0,b.jsx)(ce.u,{id:"props",title:"Properties",forceOpen:1,children:(0,b.jsx)(t.Editor,{model:t},t.state.key)})}var ue,he=n(24085);function ge(e){let{node:t,selectedObject:n}=e;const i=(0,v.wW)(pe),s=t.useState();let a=[];for(const e of Object.keys(s)){const t=s[e];E(t)&&a.push(t)}if("children"in s)for(const e of s.children)a.push(e);const r=t.constructor.name,o=n===t;return(0,b.jsxs)("div",{className:i.node,children:[(0,b.jsxs)("div",{className:i.header,onClick:()=>t.getSceneEditor().onSelectObject(t),children:[(0,b.jsx)("div",{className:i.icon,children:a.length>0&&(ue||(ue=(0,b.jsx)(he.J,{name:"angle-down",size:"sm"})))}),(0,b.jsx)("div",{className:(0,m.cx)(i.name,o&&i.selected),children:r})]}),a.length>0&&(0,b.jsx)("div",{className:i.children,children:a.map((e=>(0,b.jsx)(ge,{node:e,selectedObject:n},e.state.key)))})]})}const pe=e=>({node:(0,m.css)({display:"flex",flexGrow:0,cursor:"pointer",flexDirection:"column",padding:"2px 4px"}),header:(0,m.css)({display:"flex",fontWeight:500}),name:(0,m.css)({}),selected:(0,m.css)({color:e.colors.error.text}),icon:(0,m.css)({width:e.spacing(3),color:e.colors.text.secondary}),children:(0,m.css)({display:"flex",flexDirection:"column",paddingLeft:8})});class fe extends z{get Component(){return me}onMouseEnterObject(e){this.setState({hoverObject:{ref:e}})}onMouseLeaveObject(e){e.parent?this.setState({hoverObject:{ref:e.parent}}):this.setState({hoverObject:void 0})}onSelectObject(e){this.setState({selectedObject:{ref:e}})}}function me(e){let{model:t,isEditing:n}=e;const{selectedObject:i}=t.useState(),s=(0,v.wW)(ve);return n?(0,b.jsxs)("div",{className:s.container,children:[(0,b.jsx)("div",{className:s.tree,children:(0,b.jsx)(ge,{node:t.parent,selectedObject:null==i?void 0:i.ref})}),i&&(0,b.jsx)(de,{model:i.ref})]}):null}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(fe,"Component",me);const ve=e=>({container:(0,m.css)({display:"flex",flexGrow:0,border:`1px solid ${e.colors.border.weak}`,background:e.colors.background.primary,width:e.spacing(40),cursor:"pointer",flexDirection:"column"}),tree:(0,m.css)({padding:e.spacing(.25,1)})});var be=n(82897),we=n(38536),xe=n(23541),je=n(67436),ye=n(78338),Se=n(392);class Ce extends z{constructor(){super(...arguments),function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"querySub",void 0)}activate(){super.activate();const e=this.getTimeRange();this.subs.add(e.subscribe({next:e=>{this.runWithTimeRange(e)}})),this.state.data||this.runQueries()}deactivate(){super.deactivate(),this.querySub&&(this.querySub.unsubscribe(),this.querySub=void 0)}runQueries(){const e=this.getTimeRange();this.runWithTimeRange(e.state)}async runWithTimeRange(e){const t=(0,be.cloneDeep)(this.state.queries),n={app:we.zj.Dashboard,requestId:(0,ye.t)(),timezone:"browser",panelId:1,dashboardId:1,range:e,interval:"1s",intervalMs:1e3,targets:(0,be.cloneDeep)(this.state.queries),maxDataPoints:500,scopedVars:{},startTime:Date.now()};try{var i;const s=await async function(e,t){if(e&&e.query)return e;return await(0,je.ak)().get(e,t)}(t[0].datasource,n.scopedVars);n.targets=n.targets.map((e=>(e.datasource||(e.datasource=s.getRef()),e)));const a=s.interval,r=xe.calculateInterval(e,null!==(i=n.maxDataPoints)&&void 0!==i?i:1e3,a);n.scopedVars=Object.assign({},n.scopedVars,{__interval:{text:r.interval,value:r.interval},__interval_ms:{text:r.intervalMs.toString(),value:r.intervalMs}}),n.interval=r.interval,n.intervalMs=r.intervalMs,this.querySub=(0,Se.v7)(s,n).subscribe({next:e=>{console.log("set data",e,e.state),this.setState({data:e})}})}catch(e){console.error("PanelQueryRunner Error",e)}}}function Oe(){const e=new Ce({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},seriesCount:2,alias:"__server_names",scenarioId:"random_walk"}]});return new M({title:"Panel repeater test",layout:new Z({layout:new G({direction:"column",children:[new G({size:{minHeight:200},children:[new ae({pluginId:"timeseries",title:"Title",options:{legend:{displayMode:"hidden"}}}),new ae({size:{width:300},pluginId:"stat",fieldConfig:{defaults:{displayName:"Last"},overrides:[]},options:{graphMode:"none"}})]})]})}),$editor:new fe({}),$timeRange:new le((0,i.JK)()),$data:e,actions:[new X({value:"2",onChange:t=>{e.setState({queries:[Object.assign({},e.state.queries[0],{seriesCount:t})]}),e.runQueries()}}),new B({})]})}var Ie=n(68522),Re=n(40920);function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ke extends z{constructor(){super(...arguments),Ee(this,"onToggle",(()=>{this.setState({isCollapsed:!this.state.isCollapsed,size:Object.assign({},this.state.size,{ySizing:this.state.isCollapsed?"fill":"content"})})})),Ee(this,"onRemove",(()=>{const e=this.parent;"children"in e.state&&e.setState({children:e.state.children.filter((e=>e!==this))})}))}}Ee(ke,"Component",(function(e){let{model:t,isEditing:n}=e;const{title:i,isCollapsed:s,canCollapse:a,canRemove:r,layout:l,actions:c}=t.useState(),d=(0,v.wW)(ze),u=(null!=c?c:[]).map((e=>(0,b.jsx)(e.Component,{model:e},e.state.key)));r&&u.push((0,b.jsx)(o.h,{icon:"times",variant:"default",onClick:t.onRemove,"aria-label":"Remove scene"},"remove-button"));return(0,b.jsxs)("div",{className:d.row,children:[(0,b.jsxs)("div",{className:d.rowHeader,children:[(0,b.jsxs)(Ie.Stack,{gap:0,children:[(0,b.jsx)("div",{className:d.title,role:"heading",children:i}),a&&(0,b.jsx)("div",{className:d.toggle,children:(0,b.jsx)(Re.zx,{size:"sm",icon:s?"angle-down":"angle-up",fill:"text",variant:"secondary","aria-label":s?"Expand scene":"Collapse scene",onClick:t.onToggle})})]}),(0,b.jsx)("div",{className:d.actions,children:u})]}),!s&&(0,b.jsx)(l.Component,{model:l,isEditing:n})]})}));const ze=e=>({row:(0,m.css)({display:"flex",flexDirection:"column",flexGrow:1,gap:e.spacing(1),cursor:"pointer"}),toggle:(0,m.css)({}),title:(0,m.css)({fontSize:e.typography.h5.fontSize}),rowHeader:(0,m.css)({display:"flex",alignItems:"center",gap:e.spacing(2)}),actions:(0,m.css)({display:"flex",alignItems:"center",gap:e.spacing(1),justifyContent:"flex-end",flexGrow:1})});function Pe(){return[new M({title:"Flex layout test",layout:new G({direction:"row",children:[new ae({pluginId:"timeseries",title:"Dynamic height and width",size:{minWidth:"70%"}}),new G({direction:"column",children:[new ae({pluginId:"timeseries",title:"Fill height"}),new ae({pluginId:"timeseries",title:"Fill height"}),new A({text:"Size to content",fontSize:20,size:{ySizing:"content"},align:"center"}),new ae({pluginId:"timeseries",title:"Fixed height",size:{height:300}})]})]}),$editor:new fe({}),$timeRange:new le((0,i.JK)()),$data:new Ce({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new B({})]}),Oe(),new M({title:"Nested Scene demo",layout:new G({direction:"column",children:[new ae({key:"3",pluginId:"timeseries",title:"Panel 3"}),(e="Inner scene",new ke({title:e,canRemove:!0,layout:new G({direction:"row",children:[new ae({key:"3",pluginId:"timeseries",title:"Data"})]}),$timeRange:new le((0,i.JK)()),$data:new Ce({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new B({})]}))]}),$timeRange:new le((0,i.JK)()),$data:new Ce({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new B({})]}),new M({title:"Scene with rows",layout:new G({direction:"column",children:[new ke({title:"Overview",canCollapse:!0,layout:new G({direction:"row",children:[new ae({pluginId:"timeseries",title:"Fill height"}),new ae({pluginId:"timeseries",title:"Fill height"})]})}),new ke({title:"More server details",canCollapse:!0,layout:new G({direction:"row",children:[new ae({pluginId:"timeseries",title:"Fill height"}),new ae({pluginId:"timeseries",title:"Fill height"})]})})]}),$editor:new fe({}),$timeRange:new le((0,i.JK)()),$data:new Ce({queries:[{refId:"A",datasource:{uid:"gdev-testdata",type:"testdata"},scenarioId:"random_walk"}]}),actions:[new B({})]})];var e}const Te={};function $e(e){if(Te[e])return Te[e];const t=Pe().find((t=>t.state.title===e));return t&&(Te[e]=t),t}}}]);
//# sourceMappingURL=scenes.d32cfb92881b6c3671d9.js.map