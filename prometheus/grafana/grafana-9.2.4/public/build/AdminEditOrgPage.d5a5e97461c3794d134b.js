"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2721],{52657:(e,s,a)=>{a.r(s),a.d(s,{default:()=>w});var i,t,r,n=a(27549),l=a(68404),o=a(7197),d=a(6932),c=a(8771),h=a(17518),u=a(61692),m=a(84719),g=a(1652),x=a(40920),j=a(90894),b=a(98163),p=a(66728),v=a(47570),f=a(50641),N=a(45916);function w(e){var s,a;let{match:w}=e;const y=parseInt(w.params.id,10),I=b.Vt.hasPermission(v.bW.OrgsWrite),O=b.Vt.hasPermission(v.bW.OrgUsersRead),[R,C]=(0,l.useState)([]),[U,V]=(0,o.Z)((()=>(async e=>await(0,d.i)().get("/api/orgs/"+e))(y)),[]),[,W]=(0,o.Z)((()=>(async e=>b.Vt.hasPermission(v.bW.OrgUsersRead)?await(0,d.i)().get(`/api/orgs/${e}/users`,(0,p.y)()):[])(y)),[]);(0,l.useEffect)((()=>{V(),W().then((e=>C(e)))}),[V,W]);const D={text:null!==(s=null==U||null===(a=U.value)||void 0===a?void 0:a.name)&&void 0!==s?s:"",icon:"shield",breadcrumbs:[{title:"Orgs",url:"admin/orgs"}],subTitle:"Manage settings and user roles for an organization."};return(0,N.jsx)(j.T,{navId:"global-orgs",pageNav:D,subTitle:"Manage settings for this specific org.",children:(0,N.jsx)(j.T.Contents,{children:(0,N.jsxs)(N.Fragment,{children:[t||(t=(0,N.jsx)(h.D,{children:"Edit organization"})),U.value&&(0,N.jsx)(u.l,{defaultValues:{orgName:U.value.name},onSubmit:async e=>await(async e=>await(0,d.i)().put("/api/orgs/"+y,Object.assign({},U.value,{name:e})))(e.orgName),children:e=>{let{register:s,errors:a}=e;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(m.g,{label:"Name",invalid:!!a.orgName,error:"Name is required",disabled:!I,children:(0,N.jsx)(g.I,Object.assign({},s("orgName",{required:!0}),{id:"org-name-input"}))}),(0,N.jsx)(x.zx,{type:"submit",disabled:!I,children:"Update"})]})}}),(0,N.jsxs)("div",{className:n.css`
              margin-top: 20px;
            `,children:[r||(r=(0,N.jsx)(h.D,{children:"Organization users"})),!O&&(i||(i=(0,N.jsx)(c.b,{severity:"info",title:"Access denied",children:"You do not have permission to see users in this organization. To update this organization, contact your server administrator."}))),O&&!!R.length&&(0,N.jsx)(f.Z,{users:R,orgId:y,onRoleChange:(e,s)=>{(async(e,s)=>{await(0,d.i)().patch("/api/orgs/"+s+"/users/"+e.userId,e)})(Object.assign({},s,{role:e}),y),C(R.map((a=>s.userId===a.userId?Object.assign({},s,{role:e}):a))),W()},onRemoveUser:e=>{(async(e,s)=>{await(0,d.i)().delete("/api/orgs/"+s+"/users/"+e.userId)})(e,y),C(R.filter((s=>e.userId!==s.userId))),W()}})]})]})})})}},50641:(e,s,a)=>{a.d(s,{Z:()=>f});var i,t,r,n,l,o,d,c,h=a(68404),u=a(40920),m=a(95378),g=a(57497),x=a(77058),j=a(98163),b=a(47570),p=a(8936),v=a(45916);const f=e=>{const{users:s,orgId:a,onRoleChange:f,onRemoveUser:N}=e,[w,y]=(0,h.useState)(null),[I,O]=(0,h.useState)([]);return(0,h.useEffect)((()=>{j.Vt.licensedAccessControlEnabled()&&async function(){try{if(j.Vt.hasPermission(b.bW.ActionRolesList)){let e=await(0,x.ul)(a);O(e)}}catch(e){console.error("Error loading options")}}()}),[a]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("table",{className:"filter-table form-inline",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[i||(i=(0,v.jsx)("th",{})),t||(t=(0,v.jsx)("th",{children:"Login"})),r||(r=(0,v.jsx)("th",{children:"Email"})),n||(n=(0,v.jsx)("th",{children:"Name"})),l||(l=(0,v.jsx)("th",{children:"Seen"})),o||(o=(0,v.jsx)("th",{children:"Role"})),(0,v.jsx)("th",{style:{width:"34px"}}),d||(d=(0,v.jsx)("th",{}))]})}),(0,v.jsx)("tbody",{children:s.map(((e,s)=>(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{className:"width-2 text-center",children:(0,v.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:"User avatar"})}),(0,v.jsx)("td",{className:"max-width-6",children:(0,v.jsx)("span",{className:"ellipsis",title:e.login,children:e.login})}),(0,v.jsx)("td",{className:"max-width-5",children:(0,v.jsx)("span",{className:"ellipsis",title:e.email,children:e.email})}),(0,v.jsx)("td",{className:"max-width-5",children:(0,v.jsx)("span",{className:"ellipsis",title:e.name,children:e.name})}),(0,v.jsx)("td",{className:"width-1",children:e.lastSeenAtAge}),(0,v.jsx)("td",{className:"width-8",children:j.Vt.licensedAccessControlEnabled()?(0,v.jsx)(g.R,{userId:e.userId,orgId:a,roleOptions:I,basicRole:e.role,onBasicRoleChange:s=>f(s,e),basicRoleDisabled:!j.Vt.hasPermissionInMetadata(b.bW.OrgUsersWrite,e)}):(0,v.jsx)(p.A,{"aria-label":"Role",value:e.role,disabled:!j.Vt.hasPermissionInMetadata(b.bW.OrgUsersWrite,e),onChange:s=>f(s,e)})}),(0,v.jsx)("td",{className:"width-1 text-center",children:e.isDisabled&&(c||(c=(0,v.jsx)("span",{className:"label label-tag label-tag--gray",children:"Disabled"})))}),j.Vt.hasPermissionInMetadata(b.bW.OrgUsersRemove,e)&&(0,v.jsx)("td",{className:"text-right",children:(0,v.jsx)(u.zx,{size:"sm",variant:"destructive",onClick:()=>{y(e)},icon:"times","aria-label":"Delete user"})})]},`${e.userId}-${s}`)))})]}),Boolean(w)&&(0,v.jsx)(m.s,{body:`Are you sure you want to delete user ${null==w?void 0:w.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{y(null)},isOpen:!0,onConfirm:()=>{w&&(N(w),y(null))}})]})}}}]);
//# sourceMappingURL=AdminEditOrgPage.d5a5e97461c3794d134b.js.map