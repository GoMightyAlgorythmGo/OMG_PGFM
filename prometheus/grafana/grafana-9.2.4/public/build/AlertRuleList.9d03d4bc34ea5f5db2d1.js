"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4286],{10029:(e,a,t)=>{t.r(a),t.d(a,{AlertRuleListUnconnected:()=>H,default:()=>Z});var n,s=t(68404),r=t(1485),i=t(98712),l=t(48147),o=t(74819),c=t(61884),u=t(40920),d=t(25049),h=t(5831),g=t(90894),p=t(8674),f=t(21169),x=t(59385),m=t(45916);function j(e){let{onDismiss:a}=e;return(0,m.jsx)(x.u,{title:"Adding an Alert",isOpen:!0,onDismiss:a,onClickBackdrop:a,children:n||(n=(0,m.jsxs)(d.wc,{spacing:"sm",children:[(0,m.jsx)("img",{src:"public/img/alert_howto_new.png",alt:"link to how to alert image"}),(0,m.jsx)("p",{children:"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."}),(0,m.jsx)("p",{children:"Remember to save the dashboard to persist your alert rule changes."})]}))})}var v=t(47846),w=t.n(v),y=t(11340),b=t(24085);const A=e=>{let{rule:a,search:t,onTogglePause:n}=e;const r=`${a.url}?editPanel=${a.panelId}&tab=alert`,i=(0,s.useCallback)((e=>(0,m.jsx)(w(),{highlightClassName:"highlight-search-match",textToHighlight:e,searchWords:[t]},e)),[t]);return(0,m.jsxs)(y.Z,{children:[(0,m.jsx)(y.Z.Heading,{children:i(a.name)}),(0,m.jsx)(y.Z.Figure,{children:(0,m.jsx)(b.J,{size:"xl",name:a.stateIcon,className:`alert-rule-item__icon ${a.stateClass}`})}),(0,m.jsxs)(y.Z.Meta,{children:[(0,m.jsxs)("span",{children:[(0,m.jsxs)("span",{className:`${a.stateClass}`,children:[i(a.stateText)," "]},"text"),"for ",a.stateAge]},"state"),a.info?i(a.info):null]}),(0,m.jsxs)(y.Z.Actions,{children:[(0,m.jsx)(u.zx,{variant:"secondary",icon:"paused"===a.state?"play":"pause",onClick:n,children:"paused"===a.state?"Resume":"Pause"},"play"),(0,m.jsx)(u.Qj,{variant:"secondary",href:r,icon:"cog",children:"Edit alert"},"edit")]})]})};var C,R=t(8771);const P=()=>C||(C=(0,m.jsxs)(R.b,{severity:"warning",title:"Grafana legacy alerting is going away soon",children:[(0,m.jsxs)("p",{children:["You are using Grafana legacy alerting, it has been deprecated and will be removed in the next major version of Grafana.",(0,m.jsx)("br",{}),"We encourage you to upgrade to the new Grafana Alerting experience."]}),(0,m.jsxs)("p",{children:["See"," ",(0,m.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/difference-old-new/",children:"What’s New with Grafana Alerting"})," ","to learn more about what‘s new or learn"," ",(0,m.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/opt-in/",children:"how to enable the new Grafana Alerting feature"}),"."]})]}));var k=t(9191),N=t(61988);const S=e=>e.searchQuery,T=e=>{const a=new RegExp(e.alertRules.searchQuery,"i");return e.alertRules.items.filter((e=>a.test(e.name)||a.test(e.stateText)||a.test(e.info)))};var $,F,O,_;function Q(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const G={getAlertRulesAsync:k.Au,setSearchQuery:N.ql,togglePauseAlertRule:k.en},E=(0,r.connect)((function(e){return{navModel:(0,p.h)(e.navIndex,"alert-list"),alertRules:T(e),search:S(e.alertRules),isLoading:e.alertRules.isLoading}}),G);class H extends s.PureComponent{constructor(){super(...arguments),Q(this,"stateFilters",[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}]),Q(this,"onStateFilterChanged",(e=>{i.E1.partial({state:e.value})})),Q(this,"onOpenHowTo",(()=>{h.Z.publish(new f.Dn({component:j}))})),Q(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),Q(this,"onTogglePause",(e=>{this.props.togglePauseAlertRule(e.id,{paused:"paused"!==e.state})})),Q(this,"alertStateFilterOption",(e=>{let{text:a,value:t}=e;return(0,m.jsx)("option",{value:t,children:a},t)}))}componentDidMount(){this.fetchRules()}componentDidUpdate(e){e.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){var e;return null!==(e=this.props.queryParams.state)&&void 0!==e?e:"all"}render(){const{navModel:e,alertRules:a,search:t,isLoading:n}=this.props;return(0,m.jsx)(g.T,{navModel:e,children:(0,m.jsxs)(g.T.Contents,{isLoading:n,children:[(0,m.jsxs)("div",{className:"page-action-bar",children:[(0,m.jsx)("div",{className:"gf-form gf-form--grow",children:(0,m.jsx)(o.H,{placeholder:"Search alerts",value:t,onChange:this.onSearchQueryChange})}),(0,m.jsxs)("div",{className:"gf-form",children:[$||($=(0,m.jsx)("label",{className:"gf-form-label",htmlFor:"alert-state-filter",children:"States"})),(0,m.jsx)("div",{className:"width-13",children:(0,m.jsx)(c.Ph,{inputId:"alert-state-filter",options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()})})]}),F||(F=(0,m.jsx)("div",{className:"page-action-bar__spacer"})),l.v.unifiedAlertingEnabled&&(O||(O=(0,m.jsx)(u.Qj,{variant:"primary",href:"alerting/ng/new",children:"Add NG Alert"}))),(0,m.jsx)(u.zx,{variant:"secondary",onClick:this.onOpenHowTo,children:"How to add an alert"})]}),_||(_=(0,m.jsx)(P,{})),(0,m.jsx)(d.wc,{spacing:"none",children:a.map((e=>(0,m.jsx)(A,{rule:e,search:t,onTogglePause:()=>this.onTogglePause(e)},e.id)))})]})})}}const Z=E(H)},9191:(e,a,t)=>{t.d(a,{Au:()=>o,C2:()=>u,c1:()=>h,en:()=>c,fA:()=>g,fg:()=>d,tk:()=>p});var n=t(6932),s=t(98712),r=t(36537),i=t(58257),l=t(61988);function o(e){return async a=>{a((0,l.gz)());const t=await(0,n.i)().get("/api/alerts",e);a((0,l.Oc)(t))}}function c(e,a){return async t=>{await(0,n.i)().post(`/api/alerts/${e}/pause`,a);t(o({state:(s.E1.getSearchObject().state||"all").toString()}))}}function u(e){return async a=>{try{await(0,n.i)().post("/api/alert-notifications",e),a((0,r.$l)((0,i.AT)("Notification created"))),s.E1.push("/alerting/notifications")}catch(e){(0,n.kW)(e)&&a((0,r.$l)((0,i.t_)(e.data.error)))}}}function d(e){return async a=>{try{await(0,n.i)().put(`/api/alert-notifications/${e.id}`,e),a((0,r.$l)((0,i.AT)("Notification updated")))}catch(e){(0,n.kW)(e)&&a((0,r.$l)((0,i.t_)(e.data.error)))}}}function h(e){return async(a,t)=>{const s=t().notificationChannel.notificationChannel;await(0,n.i)().post("/api/alert-notifications/test",Object.assign({id:s.id},e))}}function g(){return async e=>{const a=(await(0,n.i)().get("/api/alert-notifiers")).sort(((e,a)=>e.name>a.name?1:-1));e((0,l.T2)(a))}}function p(e){return async a=>{await a(g());const t=await(0,n.i)().get(`/api/alert-notifications/${e}`);a((0,l.K)(t))}}}}]);
//# sourceMappingURL=AlertRuleList.9d03d4bc34ea5f5db2d1.js.map