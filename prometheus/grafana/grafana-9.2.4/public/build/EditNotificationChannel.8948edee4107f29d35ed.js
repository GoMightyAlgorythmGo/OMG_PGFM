"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7384],{39539:(e,t,n)=>{n.d(t,{$:()=>d});var i=n(24420),s=n.n(i),r=n(68404),a=n(1485),l=n(47570),o=n(45193),c=n(45916);const d=(e,t,n)=>i=>{const d=(0,a.connect)(e,t)(i),u=e=>{const t=(0,l.I0)();return(0,r.useEffect)((()=>function(){t((0,o.e)({cleanupAction:n}))}),[t]),(0,c.jsx)(d,Object.assign({},e))};return u.displayName=`ConnectWithCleanUp(${d.displayName})`,s()(u,i),u}},13239:(e,t,n)=>{n.r(t),n.d(t,{EditNotificationChannelPage:()=>j,default:()=>b});var i,s,r=n(68404),a=n(48147),l=n(61692),o=n(98134),c=n(90894),d=n(39539),u=n(51114),g=n(9191),p=n(61988),h=n(97130),f=n(45916);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class j extends r.PureComponent{constructor(){super(...arguments),m(this,"onSubmit",(e=>{const{notificationChannel:t}=this.props;this.props.updateNotificationChannel(Object.assign({},(0,h.YV)(Object.assign({},t,e,{settings:Object.assign({},t.settings,e.settings)})),{id:t.id}))})),m(this,"onTestChannel",(e=>{const{notificationChannel:t}=this.props;this.props.testNotificationChannel((0,h.dv)(Object.assign({},t,e,{settings:Object.assign({},t.settings,e.settings)})))}))}componentDidMount(){this.props.loadNotificationChannel(parseInt(this.props.match.params.id,10))}render(){const{notificationChannel:e,notificationChannelTypes:t}=this.props;return(0,f.jsx)(c.T,{navId:"channels",children:(0,f.jsxs)(c.T.Contents,{children:[i||(i=(0,f.jsx)("h2",{className:"page-sub-heading",children:"Edit notification channel"})),e&&e.id>0?(0,f.jsx)(l.l,{maxWidth:600,onSubmit:this.onSubmit,defaultValues:Object.assign({},e,{type:t.find((t=>t.value===e.type))}),children:n=>{let{control:i,errors:s,getValues:r,register:l,watch:o}=n;const c=t.find((e=>e.value===r().type.value));return(0,f.jsx)(u.w,{selectableChannels:(0,h.t7)(t,!0),selectedChannel:c,imageRendererAvailable:a.v.rendererAvailable,onTestChannel:this.onTestChannel,register:l,watch:o,errors:s,getValues:r,control:i,resetSecureField:this.props.resetSecureField,secureFields:e.secureFields})}}):s||(s=(0,f.jsxs)("div",{children:["Loading notification channel",(0,f.jsx)(o.$,{})]}))]})})}}const v={loadNotificationChannel:g.tk,testNotificationChannel:g.c1,updateNotificationChannel:g.fg,resetSecureField:p.J0},b=(0,d.$)((e=>({notificationChannel:e.notificationChannel.notificationChannel,notificationChannelTypes:e.notificationChannel.notificationChannelTypes})),v,(e=>e.notificationChannel=p.Gr))(j)},51114:(e,t,n)=>{n.d(t,{w:()=>k});var i=n(27549),s=n(68404),r=n(9617),a=n(98134),l=n(25049),o=n(40920),c=n(40882),d=n(78837),u=n(84719),g=n(1652),p=n(65586),h=n(61884),f=n(95922),m=n(63639),j=n(45916);const v=["ref"];const b=e=>{let{control:t,option:n,register:i,invalid:s}=e;const r=n.secure?`secureSettings.${n.propertyName}`:`settings.${n.propertyName}`;switch(n.element){case"input":return(0,j.jsx)(g.I,Object.assign({},i(`${r}`,{required:!!n.required&&"Required",validate:e=>""===n.validationRule||x(e,n.validationRule)}),{invalid:s,type:n.inputType,placeholder:n.placeholder}));case"select":return(0,j.jsx)(p.g,{control:t,name:`${r}`,render:e=>{var t;let{}=e,i=function(e,t){if(null==e)return{};var n,i,s={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e.field,v);return(0,j.jsx)(h.Ph,Object.assign({},i,{options:null!==(t=n.selectOptions)&&void 0!==t?t:void 0,invalid:s}))}});case"textarea":return(0,j.jsx)(m.K,Object.assign({invalid:s},i(`${r}`,{required:!!n.required&&"Required",validate:e=>""===n.validationRule||x(e,n.validationRule)})));default:return console.error("Element not supported",n.element),null}},x=(e,t)=>!!RegExp(t).test(e)||"Invalid format",y=e=>{let{control:t,currentFormValues:n,errors:i,selectedChannelOptions:s,register:r,onResetSecureField:a,secureFields:l}=e;return(0,j.jsx)(j.Fragment,{children:s.map(((e,s)=>{var c;const d=`${e.label}-${s}`,p=n[`settings.${e.showWhen.field}`]&&n[`settings.${e.showWhen.field}`].value;return e.showWhen.field&&p!==e.showWhen.is?null:"checkbox"===e.element?(0,j.jsx)(u.g,{children:(0,j.jsx)(f.X,Object.assign({},r(e.secure?`secureSettings.${e.propertyName}`:`settings.${e.propertyName}`),{label:e.label,description:e.description}))},d):(0,j.jsx)(u.g,{label:e.label,description:e.description,invalid:i.settings&&!!i.settings[e.propertyName],error:i.settings&&(null===(c=i.settings[e.propertyName])||void 0===c?void 0:c.message),children:l&&l[e.propertyName]?(0,j.jsx)(g.I,{readOnly:!0,value:"Configured",suffix:(0,j.jsx)(o.zx,{onClick:()=>a(e.propertyName),fill:"text",type:"button",size:"sm",children:"Clear"})}):(0,j.jsx)(b,{option:e,register:r,control:t})},d)}))})},C=["ref"];const O=e=>{let{control:t,currentFormValues:n,errors:i,secureFields:s,selectedChannel:r,channels:a,register:l,resetSecureField:o}=e;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.g,{label:"Name",invalid:!!i.name,error:i.name&&i.name.message,children:(0,j.jsx)(g.I,Object.assign({},l("name",{required:"Name is required"})))}),(0,j.jsx)(u.g,{label:"Type",children:(0,j.jsx)(p.g,{name:"type",render:e=>{let{}=e,t=function(e,t){if(null==e)return{};var n,i,s={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e.field,C);return(0,j.jsx)(h.Ph,Object.assign({},t,{options:a}))},control:t,rules:{required:!0}})}),(0,j.jsx)(y,{selectedChannelOptions:r.options.filter((e=>e.required)),currentFormValues:n,secureFields:s,onResetSecureField:o,register:l,errors:i,control:t})]})};var F=n(63373),S=n(8771);const w=e=>{var t;let{control:n,currentFormValues:i,errors:s,selectedChannel:r,secureFields:a,register:l,resetSecureField:o}=e;return(0,j.jsxs)(F.s,{label:`Optional ${r.heading}`,isOpen:!1,children:[""!==r.info&&(0,j.jsx)(S.b,{severity:"info",title:null!==(t=r.info)&&void 0!==t?t:""}),(0,j.jsx)(y,{selectedChannelOptions:r.options.filter((e=>!e.required)),currentFormValues:i,register:l,errors:s,control:n,onResetSecureField:o,secureFields:a})]})};var N,$=n(2869);const R=e=>{let{currentFormValues:t,imageRendererAvailable:n,register:i}=e;return(0,j.jsxs)(F.s,{label:"Notification settings",isOpen:!1,children:[(0,j.jsx)(u.g,{children:(0,j.jsx)(f.X,Object.assign({},i("isDefault"),{label:"Default",description:"Use this notification for all alerts"}))}),(0,j.jsx)(u.g,{children:(0,j.jsx)(f.X,Object.assign({},i("settings.uploadImage"),{label:"Include image",description:"Captures an image and include it in the notification"}))}),t.uploadImage&&!n&&(N||(N=(0,j.jsx)($.v,{title:"No image renderer available/installed",children:"Grafana cannot find an image renderer to capture an image for the notification. Please make sure the Grafana Image Renderer plugin is installed. Please contact your Grafana administrator to install the plugin."}))),(0,j.jsx)(u.g,{children:(0,j.jsx)(f.X,Object.assign({},i("disableResolveMessage"),{label:"Disable Resolve Message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"}))}),(0,j.jsx)(u.g,{children:(0,j.jsx)(f.X,Object.assign({},i("sendReminder"),{label:"Send reminders",description:"Send additional notifications for triggered alerts"}))}),t.sendReminder&&(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(u.g,{label:"Send reminder every",description:"Specify how often reminders should be sent, e.g. every 30s, 1m, 10m, 30m', or 1h etc. Alert reminders are sent after rules are evaluated. A reminder can never be sent more frequently than a configured alert rule evaluation interval.",children:(0,j.jsx)(g.I,Object.assign({},i("frequency"),{width:8}))})})]})};var q,I,T;const k=e=>{let{control:t,errors:n,selectedChannel:i,selectableChannels:c,register:u,watch:g,getValues:p,imageRendererAvailable:h,onTestChannel:f,resetSecureField:m,secureFields:v}=e;const b=V((0,r.Fg)());(0,s.useEffect)((()=>{const e=new Set(null==i?void 0:i.options.filter((e=>e.showWhen.field)).map((e=>`settings.${e.showWhen.field}`)))||[];g(["type","sendReminder","uploadImage",...e])}),[null==i?void 0:i.options,g]);const x=p();return i?(0,j.jsxs)("div",{className:b.formContainer,children:[(0,j.jsx)("div",{className:b.formItem,children:(0,j.jsx)(O,{selectedChannel:i,channels:c,secureFields:v,resetSecureField:m,currentFormValues:x,register:u,errors:n,control:t})}),i.options.filter((e=>!e.required)).length>0&&(0,j.jsx)("div",{className:b.formItem,children:(0,j.jsx)(w,{selectedChannel:i,secureFields:v,resetSecureField:m,currentFormValues:x,register:u,errors:n,control:t})}),(0,j.jsx)("div",{className:b.formItem,children:(0,j.jsx)(R,{imageRendererAvailable:h,currentFormValues:x,register:u,errors:n,control:t})}),(0,j.jsx)("div",{className:b.formButtons,children:(0,j.jsxs)(l.Lh,{children:[I||(I=(0,j.jsx)(o.zx,{type:"submit",children:"Save"})),(0,j.jsx)(o.zx,{type:"button",variant:"secondary",onClick:()=>f(p()),children:"Test"}),(0,j.jsx)("a",{href:`${d.ZP.appSubUrl}/alerting/notifications`,children:T||(T=(0,j.jsx)(o.zx,{type:"button",variant:"secondary",children:"Back"}))})]})})]}):q||(q=(0,j.jsx)(a.$,{}))},V=(0,c.B)((e=>({formContainer:i.css``,formItem:i.css`
      flex-grow: 1;
      padding-top: ${e.spacing.md};
    `,formButtons:i.css`
      padding-top: ${e.spacing.xl};
    `})))},9191:(e,t,n)=>{n.d(t,{Au:()=>o,C2:()=>d,c1:()=>g,en:()=>c,fA:()=>p,fg:()=>u,tk:()=>h});var i=n(6932),s=n(98712),r=n(36537),a=n(58257),l=n(61988);function o(e){return async t=>{t((0,l.gz)());const n=await(0,i.i)().get("/api/alerts",e);t((0,l.Oc)(n))}}function c(e,t){return async n=>{await(0,i.i)().post(`/api/alerts/${e}/pause`,t);n(o({state:(s.E1.getSearchObject().state||"all").toString()}))}}function d(e){return async t=>{try{await(0,i.i)().post("/api/alert-notifications",e),t((0,r.$l)((0,a.AT)("Notification created"))),s.E1.push("/alerting/notifications")}catch(e){(0,i.kW)(e)&&t((0,r.$l)((0,a.t_)(e.data.error)))}}}function u(e){return async t=>{try{await(0,i.i)().put(`/api/alert-notifications/${e.id}`,e),t((0,r.$l)((0,a.AT)("Notification updated")))}catch(e){(0,i.kW)(e)&&t((0,r.$l)((0,a.t_)(e.data.error)))}}}function g(e){return async(t,n)=>{const s=n().notificationChannel.notificationChannel;await(0,i.i)().post("/api/alert-notifications/test",Object.assign({id:s.id},e))}}function p(){return async e=>{const t=(await(0,i.i)().get("/api/alert-notifiers")).sort(((e,t)=>e.name>t.name?1:-1));e((0,l.T2)(t))}}function h(e){return async t=>{await t(p());const n=await(0,i.i)().get(`/api/alert-notifications/${e}`);t((0,l.K)(n))}}},97130:(e,t,n)=>{n.d(t,{Pg:()=>s,YV:()=>a,dv:()=>l,t7:()=>r});var i=n(58635);const s={id:-1,name:"",type:{value:"email",label:"Email"},sendReminder:!1,disableResolveMessage:!1,frequency:"15m",settings:{uploadImage:n(48147).v.rendererAvailable,autoResolve:!0,httpMethod:"POST",severity:"critical"},secureSettings:{},secureFields:{},isDefault:!1},r=(0,i.Z)(((e,t)=>e.map((e=>t?{value:e.value,label:e.label,description:e.description}:{value:e.value,label:e.label})))),a=e=>{const t=Object.fromEntries(Object.entries(e.settings).map((e=>{let[t,n]=e;return[t,n&&n.hasOwnProperty("value")?n.value:n]})));return Object.assign({},s,e,{frequency:""===e.frequency?s.frequency:e.frequency,type:e.type.value,settings:Object.assign({},s.settings,t),secureSettings:Object.assign({},e.secureSettings)})},l=e=>{var t;return{name:e.name,type:e.type.value,frequency:null!==(t=e.frequency)&&void 0!==t?t:s.frequency,settings:Object.assign({},Object.assign(s.settings,e.settings)),secureSettings:Object.assign({},e.secureSettings)}}}}]);
//# sourceMappingURL=EditNotificationChannel.8948edee4107f29d35ed.js.map