"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5783],{91354:(e,t,a)=>{a.r(t),a.d(t,{plugin:()=>ta});var r=a(12822),s=a(82897),n=a(68404),i=a(81391),o=a(42528),l=a(97833),u=a(2869),d=a(61884),c=a(8771),m=a(6251),h=a(24643);const p="Direct browser access in the InfluxDB datasource is no longer available. Switch to server access mode.";let g;!function(e){e.InfluxQL="InfluxQL",e.Flux="Flux"}(g||(g={}));var f,v,y,x,b,j,w,S,C=a(45916);function T(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const{Input:O,SecretFormField:P}=o.vw6,E=[{label:"GET",value:"GET"},{label:"POST",value:"POST"}],N=[{label:"InfluxQL",value:g.InfluxQL,description:"The InfluxDB SQL-like query language."},{label:"Flux",value:g.Flux,description:"Advanced data scripting and query language.  Supported in InfluxDB 2.x and 1.8+"}];class I extends n.PureComponent{constructor(e){var t;super(e),T(this,"state",{maxSeries:""}),T(this,"htmlPrefix",void 0),T(this,"onResetPassword",(()=>{(0,i.Mf)(this.props,"password")})),T(this,"onResetToken",(()=>{(0,i.Mf)(this.props,"token")})),T(this,"onVersionChanged",(e=>{const{options:t,onOptionsChange:a}=this.props,r=Object.assign({},t,{jsonData:Object.assign({},t.jsonData,{version:e.value})});e.value===g.Flux&&(r.access="proxy",r.basicAuth=!0,r.jsonData.httpMode="POST",delete r.user,delete r.database),a(r)})),this.state.maxSeries=(null===(t=e.options.jsonData.maxSeries)||void 0===t?void 0:t.toString())||"",this.htmlPrefix=(0,s.uniqueId)("influxdb-config")}renderInflux2x(){const{options:e}=this.props,{secureJsonFields:t}=e,a=e.secureJsonData||{},{htmlPrefix:r}=this;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsxs)("div",{className:"gf-form",children:[(0,C.jsx)(l.c,{htmlFor:`${r}-org`,className:"width-10",children:"Organization"}),(0,C.jsx)("div",{className:"width-10",children:(0,C.jsx)(O,{id:`${r}-org`,className:"width-20",value:e.jsonData.organization||"",onChange:(0,i._R)(this.props,"organization")})})]})}),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsx)("div",{className:"gf-form",children:(0,C.jsx)(P,{isConfigured:Boolean(t&&t.token),value:a.token||"",label:"Token","aria-label":"Token",labelWidth:10,inputWidth:20,onReset:this.onResetToken,onChange:(0,i.fi)(this.props,"token")})})}),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsxs)("div",{className:"gf-form",children:[f||(f=(0,C.jsx)(l.c,{className:"width-10",children:"Default Bucket"})),(0,C.jsx)("div",{className:"width-10",children:(0,C.jsx)(O,{className:"width-20",placeholder:"default bucket",value:e.jsonData.defaultBucket||"",onChange:(0,i._R)(this.props,"defaultBucket")})})]})}),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsxs)("div",{className:"gf-form",children:[v||(v=(0,C.jsx)(l.c,{className:"width-10",tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.",children:"Min time interval"})),(0,C.jsx)("div",{className:"width-10",children:(0,C.jsx)(O,{className:"width-10",placeholder:"10s",value:e.jsonData.timeInterval||"",onChange:(0,i._R)(this.props,"timeInterval")})})]})})]})}renderInflux1x(){const{options:e}=this.props,{secureJsonFields:t}=e,a=e.secureJsonData||{},{htmlPrefix:r}=this;return(0,C.jsxs)(C.Fragment,{children:[y||(y=(0,C.jsxs)(u.v,{children:[(0,C.jsx)("h5",{children:"Database Access"}),(0,C.jsxs)("p",{children:["Setting the database for this datasource does not deny access to other databases. The InfluxDB query syntax allows switching the database in the query. For example:",(0,C.jsx)("code",{children:"SHOW MEASUREMENTS ON _internal"})," or",(0,C.jsx)("code",{children:'SELECT * FROM "_internal".."database" LIMIT 10'}),(0,C.jsx)("br",{}),(0,C.jsx)("br",{}),"To support data isolation and security, make sure appropriate permissions are configured in InfluxDB."]})]})),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsxs)("div",{className:"gf-form",children:[(0,C.jsx)(l.c,{htmlFor:`${r}-db`,className:"width-10",children:"Database"}),(0,C.jsx)("div",{className:"width-20",children:(0,C.jsx)(O,{id:`${r}-db`,className:"width-20",value:e.database||"",onChange:(0,i.z_)(this.props,"database")})})]})}),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsxs)("div",{className:"gf-form",children:[(0,C.jsx)(l.c,{htmlFor:`${r}-user`,className:"width-10",children:"User"}),(0,C.jsx)("div",{className:"width-10",children:(0,C.jsx)(O,{id:`${r}-user`,className:"width-20",value:e.user||"",onChange:(0,i.z_)(this.props,"user")})})]})}),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsx)("div",{className:"gf-form",children:(0,C.jsx)(P,{isConfigured:Boolean(t&&t.password),value:a.password||"",label:"Password","aria-label":"Password",labelWidth:10,inputWidth:20,onReset:this.onResetPassword,onChange:(0,i.fi)(this.props,"password")})})}),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsxs)("div",{className:"gf-form",children:[(0,C.jsx)(l.c,{htmlFor:`${r}-http-method`,className:"width-10",tooltip:"You can use either GET or POST HTTP method to query your InfluxDB database. The POST method allows you to perform heavy requests (with a lots of WHERE clause) while the GET method will restrict you and return an error if the query is too large.",children:"HTTP Method"}),(0,C.jsx)(d.Ph,{inputId:`${r}-http-method`,className:"width-10",value:E.find((t=>t.value===e.jsonData.httpMode)),options:E,defaultValue:e.jsonData.httpMode,onChange:(0,i.nx)(this.props,"httpMode")})]})}),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsxs)("div",{className:"gf-form",children:[x||(x=(0,C.jsx)(l.c,{className:"width-10",tooltip:"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example 1m if your data is written every minute.",children:"Min time interval"})),(0,C.jsx)("div",{className:"width-10",children:(0,C.jsx)(O,{className:"width-10",placeholder:"10s",value:e.jsonData.timeInterval||"",onChange:(0,i._R)(this.props,"timeInterval")})})]})})]})}render(){const{options:e,onOptionsChange:t}=this.props,a="direct"===e.access;return(0,C.jsxs)(C.Fragment,{children:[b||(b=(0,C.jsx)("h3",{className:"page-heading",children:"Query Language"})),(0,C.jsx)("div",{className:"gf-form-group",children:(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsx)("div",{className:"gf-form",children:(0,C.jsx)(d.Ph,{"aria-label":"Query language",className:"width-30",value:e.jsonData.version===g.Flux?N[1]:N[0],options:N,defaultValue:N[0],onChange:this.onVersionChanged})})})}),e.jsonData.version===g.Flux&&(j||(j=(0,C.jsxs)(u.v,{children:[(0,C.jsx)("h5",{children:"Support for Flux in Grafana is currently in beta"}),(0,C.jsxs)("p",{children:["Please report any issues to: ",(0,C.jsx)("br",{}),(0,C.jsx)("a",{href:"https://github.com/grafana/grafana/issues/new/choose",children:"https://github.com/grafana/grafana/issues"})]})]}))),a&&(w||(w=(0,C.jsx)(c.b,{title:"Error",severity:"error",children:p}))),(0,C.jsx)(m.E,{showAccessOptions:a,dataSourceConfig:e,defaultUrl:"http://localhost:8086",onChange:t}),(0,C.jsxs)("div",{className:"gf-form-group",children:[S||(S=(0,C.jsx)("div",{children:(0,C.jsx)("h3",{className:"page-heading",children:"InfluxDB Details"})})),e.jsonData.version===g.Flux?this.renderInflux2x():this.renderInflux1x(),(0,C.jsx)("div",{className:"gf-form-inline",children:(0,C.jsx)(h._,{labelWidth:20,label:"Max series",tooltip:"Limit the number of series/tables that Grafana will process. Lower this number to prevent abuse, and increase it if you have lots of small time series and not all are shown. Defaults to 1000.",children:(0,C.jsx)(O,{placeholder:"1000",type:"number",className:"width-10",value:this.state.maxSeries,onChange:e=>{this.setState({maxSeries:e.currentTarget.value});const t=parseInt(e.currentTarget.value,10);(0,i.tp)(this.props,"maxSeries",Number.isFinite(t)?t:void 0)}})})})]})]})}}const F=I;var k;const A=[{title:"Getting started",label:"Start by selecting a measurement and field from the dropdown above. You can then use the tag selector to further narrow your search."}],D=e=>(0,C.jsxs)("div",{children:[k||(k=(0,C.jsx)("h2",{children:"InfluxDB Cheat Sheet"})),A.map((e=>(0,C.jsxs)("div",{className:"cheat-sheet-item",children:[(0,C.jsx)("div",{className:"cheat-sheet-item__title",children:e.title}),(0,C.jsx)("div",{className:"cheat-sheet-item__label",children:e.label})]},e.title)))]});class R extends n.PureComponent{render(){return(0,C.jsx)(D,{onClickExample:this.props.onClickExample})}}var q=a(27549),B=a(39132),M=a(76355);const _=[],Q={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]};function L(e){const t=_[e.type];if(!t)throw{message:"Could not find query part "+e.type};return new M.XN(e,t)}function V(e){_[e.type]=new M.zU(e),e.category.push(_[e.type])}const $=[];function G(e,t){return"*"===e.params[0]?"*":'"'+e.params[0]+'"'}function z(e,t){for(let a=0;a<e.length;a++){const r=e[a];if(r.def.category===Q.Aggregations){if(r.def.type===t.def.type)return;if("count"===r.def.type&&"distinct"===t.def.type)break;if("distinct"===r.def.type){const r=e.length>=a+2;if("count"!==t.def.type&&r){e[a+1].def.category===Q.Aggregations&&e.splice(a+1,1)}else if("count"===t.def.type)return void(r&&"count"===e[a+1].def.type||e.splice(a+1,0,t))}return void(e[a]=t)}if(r.def.category===Q.Selectors)return void(e[a]=t)}e.splice(1,0,t)}function W(e,t){let a;for(a=0;a<e.length;a++){const t=e[a];if(t.def.category===Q.Math||t.def.category===Q.Aliasing)break}e.splice(a,0,t)}V({type:"field",addStrategy:function(e,t,a){const r=(0,s.map)(e,(e=>L({type:e.def.type,params:(0,s.clone)(e.params)})));a.selectModels.push(r)},category:Q.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:G}),V({type:"count",addStrategy:z,category:Q.Aggregations,params:[],defaultParams:[],renderer:M.D}),V({type:"distinct",addStrategy:z,category:Q.Aggregations,params:[],defaultParams:[],renderer:M.D}),V({type:"integral",addStrategy:z,category:Q.Aggregations,params:[],defaultParams:[],renderer:M.D}),V({type:"mean",addStrategy:z,category:Q.Aggregations,params:[],defaultParams:[],renderer:M.D}),V({type:"median",addStrategy:z,category:Q.Aggregations,params:[],defaultParams:[],renderer:M.D}),V({type:"mode",addStrategy:z,category:Q.Aggregations,params:[],defaultParams:[],renderer:M.D}),V({type:"sum",addStrategy:z,category:Q.Aggregations,params:[],defaultParams:[],renderer:M.D}),V({type:"derivative",addStrategy:W,category:Q.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:M.D}),V({type:"spread",addStrategy:W,category:Q.Transformations,params:[],defaultParams:[],renderer:M.D}),V({type:"non_negative_derivative",addStrategy:W,category:Q.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:M.D}),V({type:"difference",addStrategy:W,category:Q.Transformations,params:[],defaultParams:[],renderer:M.D}),V({type:"non_negative_difference",addStrategy:W,category:Q.Transformations,params:[],defaultParams:[],renderer:M.D}),V({type:"moving_average",addStrategy:W,category:Q.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:M.D}),V({type:"cumulative_sum",addStrategy:W,category:Q.Transformations,params:[],defaultParams:[],renderer:M.D}),V({type:"stddev",addStrategy:W,category:Q.Transformations,params:[],defaultParams:[],renderer:M.D}),V({type:"time",category:$,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:M.D}),V({type:"fill",category:$,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:M.D}),V({type:"elapsed",addStrategy:W,category:Q.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:M.D}),V({type:"holt_winters",addStrategy:W,category:Q.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:M.D}),V({type:"holt_winters_with_fit",addStrategy:W,category:Q.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:M.D}),V({type:"bottom",addStrategy:z,category:Q.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:M.D}),V({type:"first",addStrategy:z,category:Q.Selectors,params:[],defaultParams:[],renderer:M.D}),V({type:"last",addStrategy:z,category:Q.Selectors,params:[],defaultParams:[],renderer:M.D}),V({type:"max",addStrategy:z,category:Q.Selectors,params:[],defaultParams:[],renderer:M.D}),V({type:"min",addStrategy:z,category:Q.Selectors,params:[],defaultParams:[],renderer:M.D}),V({type:"percentile",addStrategy:z,category:Q.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:M.D}),V({type:"top",addStrategy:z,category:Q.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:M.D}),V({type:"tag",category:$,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:G}),V({type:"math",addStrategy:function(e,t){const a=e.length;if(a>0){if("math"===e[a-1].def.type)return void(e[a-1]=t);if(a>1&&"math"===e[a-2].def.type)return void(e[a-2]=t);if("alias"===e[a-1].def.type)return void e.splice(a-1,0,t)}e.push(t)},category:Q.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:M.C7}),V({type:"alias",addStrategy:function(e,t){const a=e.length;a>0&&"alias"===e[a-1].def.type?e[a-1]=t:e.push(t)},category:Q.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:function(e,t){return t+' AS "'+e.params[0]+'"'}});const U={create:L,getCategories:()=>Q,replaceAggregationAdd:z};function H(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class K{constructor(e,t,a){H(this,"target",void 0),H(this,"selectModels",[]),H(this,"queryBuilder",void 0),H(this,"groupByParts",void 0),H(this,"templateSrv",void 0),H(this,"scopedVars",void 0),H(this,"refId",void 0),this.target=e,this.templateSrv=t,this.scopedVars=a,e.policy=e.policy||"default",e.resultFormat=e.resultFormat||"time_series",e.orderByTime=e.orderByTime||"ASC",e.tags=e.tags||[],e.groupBy=e.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],e.select=e.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}updateProjection(){this.selectModels=(0,s.map)(this.target.select,(e=>(0,s.map)(e,U.create))),this.groupByParts=(0,s.map)(this.target.groupBy,U.create)}updatePersistedParts(){this.target.select=(0,s.map)(this.selectModels,(e=>(0,s.map)(e,(e=>({type:e.def.type,params:e.params})))))}hasGroupByTime(){return(0,s.find)(this.target.groupBy,(e=>"time"===e.type))}hasFill(){return(0,s.find)(this.target.groupBy,(e=>"fill"===e.type))}addGroupBy(e){let t=e.match(/^(\w+)\((.*)\)$/);if(!t||!this.target.groupBy)return;const a=t[1],r=t[2],s=U.create({type:a,params:[r]}),n=this.target.groupBy.length;0===n?this.target.groupBy.push(s.part):"time"===a?this.target.groupBy.splice(0,0,s.part):"tag"===a&&"fill"===this.target.groupBy[n-1].type?this.target.groupBy.splice(n-1,0,s.part):this.target.groupBy.push(s.part),this.updateProjection()}removeGroupByPart(e,t){const a=U.getCategories();"time"===e.def.type&&(this.target.groupBy=(0,s.filter)(this.target.groupBy,(e=>"fill"!==e.type)),this.target.select=(0,s.map)(this.target.select,(e=>(0,s.filter)(e,(e=>{const t=U.create(e);return t.def.category!==a.Aggregations&&t.def.category!==a.Selectors}))))),this.target.groupBy.splice(t,1),this.updateProjection()}removeSelect(e){this.target.select.splice(e,1),this.updateProjection()}removeSelectPart(e,t){if("field"===t.def.type){if(this.selectModels.length>1){const t=(0,s.indexOf)(this.selectModels,e);this.selectModels.splice(t,1)}}else{const a=(0,s.indexOf)(e,t);e.splice(a,1)}this.updatePersistedParts()}addSelectPart(e,t){const a=U.create({type:t});a.def.addStrategy(e,a,this),this.updatePersistedParts()}renderTagCondition(e,t,a){let r="",s=e.operator,n=e.value;return t>0&&(r=(e.condition||"AND")+" "),s||(s=/^\/.*\/$/.test(n)?"=~":"="),"=~"!==s&&"!~"!==s?(a&&(n=this.templateSrv.replace(n,this.scopedVars)),">"!==s&&"<"!==s&&(n="'"+n.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'")):a&&(n=this.templateSrv.replace(n,this.scopedVars,"regex")),r+'"'+e.key+'" '+s+" "+n}getMeasurementAndPolicy(e){let t=this.target.policy,a=this.target.measurement||"measurement";return a.match("^/.*/$")?e&&(a=this.templateSrv.replace(a,this.scopedVars,"regex")):a='"'+a+'"',t="default"!==t?'"'+this.target.policy+'".':"",t+a}interpolateQueryStr(e,t,a){if(!t.multi&&!t.includeAll)return e;if("string"==typeof e)return B.Z.regexEscape(e);return"("+(0,s.map)(e,B.Z.regexEscape).join("|")+")"}render(e){const t=this.target;if(t.rawQuery)return e?this.templateSrv.replace(t.query,this.scopedVars,this.interpolateQueryStr):t.query;let a,r,n="SELECT ";for(a=0;a<this.selectModels.length;a++){const e=this.selectModels[a];let t="";for(r=0;r<e.length;r++){t=e[r].render(t)}a>0&&(n+=", "),n+=t}n+=" FROM "+this.getMeasurementAndPolicy(e)+" WHERE ";const i=(0,s.map)(t.tags,((t,a)=>this.renderTagCondition(t,a,e)));i.length>0&&(n+="("+i.join(" ")+") AND "),n+="$timeFilter";let o="";for(a=0;a<this.groupByParts.length;a++){const e=this.groupByParts[a];a>0&&(o+="fill"===e.def.type?" ":", "),o+=e.render("")}return o.length&&(n+=" GROUP BY "+o),t.fill&&(n+=" fill("+t.fill+")"),"DESC"===t.orderByTime&&(n+=" ORDER BY time DESC"),t.limit&&(n+=" LIMIT "+t.limit),t.slimit&&(n+=" SLIMIT "+t.slimit),t.tz&&(n+=" tz('"+t.tz+"')"),n}renderAdhocFilters(e){const t=(0,s.map)(e,((e,t)=>this.renderTagCondition(e,t,!0)));return t.join(" ")}}function Y(e){const t=(0,s.cloneDeep)(e);return new K(t).render(!1)}K.$inject=["target","templateSrv","scopedVars"];var Z,J,X,ee=a(93921),te=a(9644),ae=a(38465),re=a(40920),se=a(32302);function ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const ie=[{label:"Show buckets",description:"List the available buckets (table)",value:"buckets()"},{label:"Simple query",description:"filter by measurement and field",value:'from(bucket: "db/rp")\n  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)\n  |> filter(fn: (r) =>\n    r._measurement == "example-measurement" and\n    r._field == "example-field"\n  )'},{label:"Grouped Query",description:"Group by (min/max/sum/median)",value:'// v.windowPeriod is a variable referring to the current optimized window period (currently: $interval)\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r["_measurement"] == "measurement1" or r["_measurement"] =~ /^.*?regex.*$/)\n  |> filter(fn: (r) => r["_field"] == "field2" or r["_field"] =~ /^.*?regex.*$/)\n  |> aggregateWindow(every: v.windowPeriod, fn: mean|median|max|count|derivative|sum)\n  |> yield(name: "some-name")'},{label:"Filter by value",description:"Results between a min/max",value:'// v.bucket, v.timeRangeStart, and v.timeRange stop are all variables supported by the flux plugin and influxdb\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r["_value"] >= 10 and r["_value"] <= 20)'},{label:"Schema Exploration: (measurements)",description:"Get a list of measurement using flux",value:'import "influxdata/influxdb/v1"\nv1.measurements(bucket: v.bucket)'},{label:"Schema Exploration: (fields)",description:"Return every possible key in a single table",value:'from(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop:v.timeRangeStop)\n  |> keys()\n  |> keep(columns: ["_value"])\n  |> group()\n  |> distinct()'},{label:"Schema Exploration: (tag keys)",description:"Get a list of tag keys using flux",value:'import "influxdata/influxdb/v1"\nv1.tagKeys(bucket: v.bucket)'},{label:"Schema Exploration: (tag values)",description:"Get a list of tag values using flux",value:'import "influxdata/influxdb/v1"\nv1.tagValues(\n    bucket: v.bucket,\n    tag: "host",\n    predicate: (r) => true,\n    start: -1d\n)'}];class oe extends n.PureComponent{constructor(){super(...arguments),ne(this,"onFluxQueryChange",(e=>{this.props.onChange(Object.assign({},this.props.query,{query:e})),this.props.onRunQuery()})),ne(this,"onSampleChange",(e=>{this.props.onChange(Object.assign({},this.props.query,{query:e.value})),this.forceUpdate(),this.props.onRunQuery()})),ne(this,"getSuggestions",(()=>{const e=[{label:"v.timeRangeStart",kind:te.k.Property,detail:"The start time"},{label:"v.timeRangeStop",kind:te.k.Property,detail:"The stop time"},{label:"v.windowPeriod",kind:te.k.Property,detail:"based on max data points"},{label:"v.defaultBucket",kind:te.k.Property,detail:"bucket configured in the datsource"},{label:"v.organization",kind:te.k.Property,detail:"org configured for the datsource"}],t=(0,ee.J)();return t.getVariables().forEach((a=>{const r="${"+a.name+"}";let s=t.replace(r);s===r&&(s=""),e.push({label:r,kind:te.k.Text,detail:`(Template Variable) ${s}`})})),e})),ne(this,"editorDidMountCallbackHack",(e=>{setTimeout((()=>e.layout()),100)}))}render(){const{query:e}=this.props,t=Z||(Z=(0,C.jsxs)("div",{children:["Type: ",(0,C.jsx)("i",{children:"ctrl+space"})," to show template variable suggestions ",(0,C.jsx)("br",{}),"Many queries can be copied from Chronograf"]}));return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(ae.p,{height:"200px",language:"sql",value:e.query||"",onBlur:this.onFluxQueryChange,onSave:this.onFluxQueryChange,showMiniMap:!1,showLineNumbers:!0,getSuggestions:this.getSuggestions,onEditorDidMount:this.editorDidMountCallbackHack}),(0,C.jsxs)("div",{className:(0,q.cx)("gf-form-inline",q.css`
              margin-top: 6px;
            `),children:[J||(J=(0,C.jsx)(re.Qj,{icon:"external-link-alt",variant:"secondary",target:"blank",href:"https://docs.influxdata.com/influxdb/latest/query-data/get-started/",children:"Flux language syntax"})),(0,C.jsx)(se.X,{options:ie,value:"Sample Query",onChange:this.onSampleChange}),X||(X=(0,C.jsx)("div",{className:"gf-form gf-form--grow",children:(0,C.jsx)("div",{className:"gf-form-label gf-form-label--grow"})})),(0,C.jsx)(l.c,{width:5,tooltip:t,children:"Help"})]})]})}}var le=a(95378);const ue=e=>{let{isRaw:t,onChange:a}=e;const[r,s]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{s(!1)}),[t]),t?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(re.zx,{"aria-label":"Switch to visual editor",icon:"pen",variant:"secondary",type:"button",onClick:()=>{s(!0)}}),(0,C.jsx)(le.s,{isOpen:r,title:"Switch to visual editor mode",body:"Are you sure to switch to visual editor mode? You will lose the changes done in raw query mode.",confirmText:"Yes, switch to editor mode",dismissText:"No, stay in raw query mode",onConfirm:()=>{a(!1)},onDismiss:()=>{s(!1)}})]}):(0,C.jsx)(re.zx,{"aria-label":"Switch to text editor",icon:"pen",variant:"secondary",type:"button",onClick:()=>{a(!0)}})};var de=a(63639),ce=a(25049),me=a(1652);const he=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"},{label:"Logs",value:"logs"}],pe="time_series";var ge=a(36345);function fe(e){const[t,a]=(0,n.useState)(e),r=(0,ge.Z)(e);return(0,n.useEffect)((()=>{r!==e&&t!==e&&a(e)}),[e,t,r]),[t,a]}var ve=a(68366);const ye=e=>{var t;let{query:a,onChange:r,onRunQuery:s}=e;const[n,i]=fe(a.query),[o,u]=fe(a.alias),c=(0,ve.L)(),m=(0,ve.L)(),h=null!==(t=a.resultFormat)&&void 0!==t?t:pe,p=()=>{r(Object.assign({},a,{query:n,alias:o,resultFormat:h})),s()};return(0,C.jsxs)("div",{children:[(0,C.jsx)(de.K,{"aria-label":"query",rows:3,spellCheck:!1,placeholder:"InfluxDB Query",onBlur:p,onChange:e=>{i(e.currentTarget.value)},value:null!=n?n:""}),(0,C.jsxs)(ce.Lh,{children:[(0,C.jsx)(l.c,{htmlFor:m,children:"Format as"}),(0,C.jsx)(d.Ph,{inputId:m,onChange:e=>{r(Object.assign({},a,{resultFormat:e.value})),s()},value:h,options:he}),(0,C.jsx)(l.c,{htmlFor:c,children:"Alias by"}),(0,C.jsx)(me.I,{id:c,type:"text",spellCheck:!1,placeholder:"Naming pattern",onBlur:p,onChange:e=>{u(e.currentTarget.value)},value:null!=o?o:""})]})]})};var xe=a(9617),be=a(79550),je=a(8397);class we{constructor(e,t){this.target=e,this.database=t}buildExploreQuery(e,t,a){let r,n,i="";if("TAG_KEYS"===e)i="SHOW TAG KEYS",r=this.target.measurement,n=this.target.policy;else if("TAG_VALUES"===e)i="SHOW TAG VALUES",r=this.target.measurement,n=this.target.policy;else if("MEASUREMENTS"===e)i="SHOW MEASUREMENTS",a&&(i+=" WITH MEASUREMENT =~ /(?i)"+B.Z.regexEscape(a)+"/");else{if("FIELDS"===e)return r=this.target.measurement,n=this.target.policy,r.match("^/.*/")||(r='"'+r+'"',n&&"default"!==n&&(n='"'+n+'"',r=n+"."+r)),"SHOW FIELD KEYS FROM "+r;if("RETENTION POLICIES"===e)return i='SHOW RETENTION POLICIES on "'+this.database+'"',i}if(r&&(r.match("^/.*/")||r.match(/^merge\(.*\)/)||(r='"'+r+'"'),n&&"default"!==n&&(n='"'+n+'"',r=n+"."+r),i+=" FROM "+r),t&&(i+=' WITH KEY = "'+t+'"'),this.target.tags&&this.target.tags.length>0){const e=(0,s.reduce)(this.target.tags,((e,a)=>(a.key===t||">"===a.operator||"<"===a.operator||e.push(function(e,t){let a="",r=e.operator,s=e.value;return t>0&&(a=(e.condition||"AND")+" "),r||(r=/^\/.*\/$/.test(e.value)?"=~":"="),(""===s||"=~"!==r&&"!~"!==r)&&(s="'"+s.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")+"'"),a+'"'+e.key+'" '+r+" "+s}(a,e.length)),e)),[]);e.length>0&&(i+=" WHERE "+e.join(" "))}return"MEASUREMENTS"===e&&(i+=" LIMIT 100"),i}}const Se=(e,t,a,r,s)=>{const n=new we(r,s.database).buildExploreQuery(e,t,a);return s.metricFindQuery(n)};async function Ce(e,t,a,r){const s={tags:a,measurement:e,policy:t};return(await Se("TAG_KEYS",void 0,void 0,s,r)).map((e=>e.text))}const Te=(0,q.css)({paddingRight:"4px"});function Oe(e){if(null==e)throw new Error("value must not be nullish");return e}const Pe=(0,q.cx)("width-8",Te),Ee=e=>{let{format:t,inputId:a,onChange:r}=e;return(0,C.jsx)(d.Ph,{inputId:a,className:Pe,onChange:e=>{r(Oe(e.value))},value:t,options:he})};var Ne=a(99151),Ie=a.n(Ne),Fe=a(7197);const ke=(0,q.css)({minWidth:"160px"}),Ae=e=>e,De=e=>{let{loadOptions:t,allowCustomValue:a,onChange:r,onClose:s}=e;const n=Ie()(t,1e3,{leading:!0});return(0,C.jsx)("div",{className:ke,children:(0,C.jsx)(d.qb,{formatCreateLabel:Ae,defaultOptions:!0,autoFocus:!0,isOpen:!0,onCloseMenu:s,allowCustomValue:a,loadOptions:n,onChange:r})})},Re=e=>{var t;let{loadOptions:a,allowCustomValue:r,onChange:s,onClose:i}=e;const[o,l]=(0,Fe.Z)(a,[a]);return(0,n.useEffect)((()=>{l("")}),[l,a]),(0,C.jsx)("div",{className:ke,children:(0,C.jsx)(d.Ph,{isLoading:o.loading,formatCreateLabel:Ae,autoFocus:!0,isOpen:!0,onCloseMenu:i,allowCustomValue:r,options:null!==(t=o.value)&&void 0!==t?t:[],onChange:s})})},qe=e=>{let{loadOptions:t,filterByLoadOptions:a,allowCustomValue:r,onChange:s,onClose:n}=e;return a?(0,C.jsx)(De,{loadOptions:t,allowCustomValue:r,onChange:s,onClose:n}):(0,C.jsx)(Re,{loadOptions:t,allowCustomValue:r,onChange:s,onClose:n})},Be=e=>{let{initialValue:t,onChange:a,onClose:r}=e;const[s,n]=fe(t);return(0,C.jsx)(me.I,{autoFocus:!0,type:"text",spellCheck:!1,onBlur:r,onKeyDown:e=>{"Enter"===e.key&&a(s)},onChange:e=>{n(e.currentTarget.value)},value:s})},Me=(0,q.css)({width:"auto",cursor:"pointer"}),_e=e=>{let{value:t,buttonClassName:a,loadOptions:r,filterByLoadOptions:s,allowCustomValue:i,onChange:o}=e;const[l,u]=(0,n.useState)(!1);if(l)return void 0!==r?(0,C.jsx)(qe,{loadOptions:r,filterByLoadOptions:null!=s&&s,allowCustomValue:i,onChange:e=>{u(!1),o(e)},onClose:()=>{u(!1)}}):(0,C.jsx)(Be,{initialValue:t,onClose:()=>{u(!1)},onChange:e=>{u(!1),o({value:e,label:e})}});{const e=(0,q.cx)(Me,a);return(0,C.jsx)(je.W,{as:"button",className:e,onClick:()=>{u(!0)},children:t})}};function Qe(e){return{label:e,value:e}}const Le=e=>{let{policy:t,measurement:a,onChange:r,getPolicyOptions:s,getMeasurementOptions:n}=e;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(_e,{allowCustomValue:!0,value:null!=t?t:"using default policy",loadOptions:async()=>{const e=await s();return(e.some((e=>"default"===e))?e:["default",...e]).map(Qe)},onChange:e=>{r(e.value,a)}}),(0,C.jsx)(_e,{allowCustomValue:!0,value:null!=a?a:"select measurement",loadOptions:async e=>(await n(e)).map(Qe),filterByLoadOptions:!0,onChange:e=>{r(t,e.value)}})]})},Ve=e=>{let{value:t,onChange:a,isWide:r,placeholder:s}=e;const[n,i]=fe(t);return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(me.I,{placeholder:s,className:(0,q.cx)(null!=r&&r?"width-14":"width-8",Te),type:"text",spellCheck:!1,onBlur:()=>{a(""===n?void 0:n)},onChange:e=>{i(e.currentTarget.value)},value:null!=n?n:""})})},$e=[{label:"ascending",value:"ASC"},{label:"descending",value:"DESC"}],Ge=(0,q.cx)("width-9",Te),ze=e=>{let{value:t,onChange:a,inputId:r}=e;return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(d.Ph,{inputId:r,className:Ge,onChange:e=>{a(Oe(e.value))},value:t,options:$e})})};var We=a(63547),Ue=a(77779),He=a(75646);const Ke=e=>{let{loadOptions:t,allowCustomValue:a,onAdd:r}=e;return(0,C.jsx)(_e,{value:"+",loadOptions:t,allowCustomValue:a,onChange:e=>{r(Oe(e.value))}})},Ye=(0,q.css)({paddingRight:"0",marginRight:"0"}),Ze=e=>{let{name:t,onRemove:a}=e;return(0,C.jsx)(He.z,{renderMenuItems:()=>{return e=a,(0,C.jsx)(We.k,{label:"",children:(0,C.jsx)(Ue.s,{label:"remove",onClick:e})});var e},children:e=>{let{openMenu:a}=e;return(0,C.jsx)("button",{className:(0,q.cx)("gf-form-label",Ye),onClick:a,children:t})}})},Je=(0,q.css)({paddingLeft:"0",paddingRight:"0",marginLeft:"0",marginRight:"0"}),Xe=e=>{let{name:t,params:a,onChange:r,onRemove:s}=e;const i=(0,xe.l4)(),o=(0,n.useMemo)((()=>(e=>(0,q.cx)("gf-form-label",(0,q.css)({paddingLeft:"0",lineHeight:e.typography.body.lineHeight,fontSize:e.typography.body.fontSize})))(i)),[i]);return(0,C.jsxs)("div",{className:o,children:[(0,C.jsx)(Ze,{name:t,onRemove:s}),"(",a.map(((e,t)=>{const{value:s,options:i}=e,o=t===a.length-1,l=null!==i?()=>i().then((e=>e.map(Qe))):void 0;return(0,C.jsxs)(n.Fragment,{children:[(0,C.jsx)(_e,{allowCustomValue:!0,value:s,buttonClassName:Je,loadOptions:l,onChange:e=>{((e,t)=>{const s=a.map((e=>e.value));s[t]=e,r(s)})(Oe(e.value),t)}}),!o&&","]},t)})),")"]})},et=e=>{let{parts:t,getNewPartOptions:a,onAddNewPart:r,onRemovePart:s,onChange:n}=e;return(0,C.jsxs)(C.Fragment,{children:[t.map(((e,t)=>(0,C.jsx)(Xe,{name:e.name,params:e.params,onRemove:()=>{s(t)},onChange:e=>{n(t,e)}},t))),(0,C.jsx)(Ke,{loadOptions:a,onAdd:r})]})};function tt(e){return/^\/.*\/$/.test(e)}function at(e){var t;return null!==(t=e.operator)&&void 0!==t?t:tt(e.value)?"=~":"="}function rt(e,t){var a;return t?void 0:null!==(a=e.condition)&&void 0!==a?a:"AND"}function st(e,t){const a="=~"===e||"!~"===e;return tt(t)?a?e:"=~":a?"=":e}const nt=["=","!=","<>","<",">","=~","!~"].map(Qe),it=["AND","OR"].map(Qe),ot=()=>Promise.resolve(it),lt=()=>Promise.resolve(nt),ut=e=>{let{tag:t,isFirst:a,onRemove:r,onChange:s,getTagKeyOptions:n,getTagValueOptions:i}=e;const o=at(t),l=rt(t,a);return(0,C.jsxs)("div",{className:"gf-form",children:[null!=l&&(0,C.jsx)(_e,{value:l,loadOptions:ot,onChange:e=>{s(Object.assign({},t,{condition:e.value}))}}),(0,C.jsx)(_e,{allowCustomValue:!0,value:t.key,loadOptions:()=>n().catch((e=>(console.error(e),[]))).then((e=>[{label:"-- remove filter --",value:void 0},...e.map(Qe)])),onChange:e=>{const{value:a}=e;void 0===a?r():s(Object.assign({},t,{key:null!=a?a:""}))}}),(0,C.jsx)(_e,{value:o,loadOptions:lt,onChange:e=>{s(Object.assign({},t,{operator:e.value}))}}),(0,C.jsx)(_e,{allowCustomValue:!0,value:t.value,loadOptions:()=>i(t.key).then((e=>e.map(Qe))),onChange:e=>{var a;const r=null!==(a=e.value)&&void 0!==a?a:"";s(Object.assign({},t,{value:r,operator:st(o,r)}))}})]})},dt=e=>{let{tags:t,onChange:a,getTagKeyOptions:r,getTagValueOptions:s}=e;return(0,C.jsxs)(C.Fragment,{children:[t.map(((e,n)=>(0,C.jsx)(ut,{tag:e,isFirst:0===n,onChange:e=>{((e,r)=>{const s=t.map(((t,a)=>r===a?e:t));a(s)})(e,n)},onRemove:()=>{(e=>{const r=t.filter(((t,a)=>a!==e));a(r)})(n)},getTagKeyOptions:r,getTagValueOptions:s},n))),(0,C.jsx)(Ke,{allowCustomValue:!0,loadOptions:()=>r().then((e=>e.map(Qe))),onAdd:e=>{((e,r)=>{const s={key:e,value:"select tag value"},n={key:s.key,value:s.value,operator:at(s),condition:rt(s,r)};a([...t,n])})(e,0===t.length)}})]})};function ct(e,t){var a;const r=U.create(e).def,s=(null!==(a=e.params)&&void 0!==a?a:[]).map((e=>e.toString()));if(s.length!==r.params.length)throw new Error("Invalid query-segment");return s.map(((e,a)=>{const s=r.params[a];return s.dynamicLookup?{value:e,options:Oe(t.get(`${r.type}_${a}`))}:null!=s.options?{value:e,options:()=>Promise.resolve(s.options)}:{value:e,options:null}}))}function mt(e,t){return e.map((e=>({name:e.type,params:ct(e,t)})))}function ht(e){return e.then((e=>[...(0,ee.J)().getVariables().map((e=>`/^$${e.name}$/`)),...e]))}function pt(e,t){return e.filter((e=>t.has(e.key)))}const gt=e=>{var t,a,r,i;const o=(0,ve.L)(),l=`influxdb-qe-format-as-${o}`,u=`influxdb-qe-order-by${o}`,d=(0,xe.wW)(ft),c=function(e){if(void 0!==e.policy&&void 0!==e.resultFormat&&void 0!==e.orderByTime&&void 0!==e.tags&&void 0!==e.groupBy&&void 0!==e.select)return e;const t=(0,s.cloneDeep)(e);return new K(t).target}(e.query),{datasource:m}=e,{measurement:h,policy:p}=c,g=(0,n.useMemo)((()=>Ce(h,p,[],m).then((e=>new Set(e)))),[h,p,m]),f=(0,n.useMemo)((()=>{var e;const t=new Map([["field_0",()=>void 0!==h?async function(e,t,a){const r={tags:[],measurement:e,policy:t};return(await Se("FIELDS",void 0,void 0,r,a)).map((e=>e.text))}(h,p,m):Promise.resolve([])]]);return(null!==(e=c.select)&&void 0!==e?e:[]).map((e=>mt(e,t)))}),[h,p,c.select,m]),v=(0,n.useMemo)((()=>()=>g.then((e=>{var t;return Ce(h,p,pt(null!==(t=c.tags)&&void 0!==t?t:[],e),m)}))),[h,p,c.tags,m,g]),y=(0,n.useMemo)((()=>{var e;const t=new Map([["tag_0",v]]);return mt(null!==(e=c.groupBy)&&void 0!==e?e:[],t)}),[v,c.groupBy]),x=t=>{e.onChange(t),e.onRunQuery()};return(0,C.jsxs)("div",{children:[(0,C.jsxs)(be.f,{label:"FROM",fill:!0,children:[(0,C.jsx)(Le,{policy:p,measurement:h,getPolicyOptions:()=>async function(e){const t={tags:[],measurement:void 0,policy:void 0};return(await Se("RETENTION POLICIES",void 0,void 0,t,e)).map((e=>e.text))}(m),getMeasurementOptions:e=>ht(g.then((t=>{var a;return async function(e,t,a){const r={tags:t,measurement:void 0,policy:void 0};return(await Se("MEASUREMENTS",void 0,e,r,a)).map((e=>e.text))}(""===e?void 0:e,pt(null!==(a=c.tags)&&void 0!==a?a:[],t),m)}))),onChange:(e,t)=>{x(Object.assign({},c,{policy:e,measurement:t}))}}),(0,C.jsx)(je.W,{width:"auto",className:d.inlineLabel,children:"WHERE"}),(0,C.jsx)(dt,{tags:null!==(t=c.tags)&&void 0!==t?t:[],onChange:e=>{x(Object.assign({},c,{tags:0===e.length?void 0:e}))},getTagKeyOptions:v,getTagValueOptions:e=>ht(g.then((t=>{var a;return async function(e,t,a,r,s){const n={tags:r,measurement:t,policy:a};return(await Se("TAG_VALUES",e,void 0,n,s)).map((e=>e.text))}(e,h,p,pt(null!==(a=c.tags)&&void 0!==a?a:[],t),m)})))})]}),f.map(((e,t)=>(0,C.jsx)(be.f,{label:0===t?"SELECT":"",fill:!0,children:(0,C.jsx)(et,{parts:e,getNewPartOptions:()=>Promise.resolve(function(){const e=U.getCategories(),t=[];return Object.keys(e).forEach((a=>{const r=e[a].map((e=>Qe(e.type)));t.push({label:a,options:r})})),t}()),onChange:(e,a)=>{const r=function(e,t,a,r){var s;const n=[...null!==(s=e.select)&&void 0!==s?s:[]];return n[t]=[...n[t]],n[t][a]=Object.assign({},n[t][a],{params:r}),Object.assign({},e,{select:n})}(c,t,e,a);x(r)},onAddNewPart:e=>{x(function(e,t,a){const r=(0,s.cloneDeep)(e),n=new K(r);return n.addSelectPart(n.selectModels[a],t),n.target}(c,e,t))},onRemovePart:e=>{x(function(e,t,a){const r=(0,s.cloneDeep)(e),n=new K(r),i=n.selectModels[a];return n.removeSelectPart(i,i[t]),n.target}(c,e,t))}})},t))),(0,C.jsx)(be.f,{label:"GROUP BY",fill:!0,children:(0,C.jsx)(et,{parts:y,getNewPartOptions:()=>async function(e,t){const a=await t(),r=Object.assign({},e),s=new K(r),n=[];return s.hasFill()||n.push(Qe("fill(null)")),s.hasGroupByTime()||n.push(Qe("time($interval)")),a.forEach((e=>{n.push(Qe(`tag(${e})`))})),n}(c,v),onChange:(e,t)=>{const a=function(e,t,a){var r;const s=[...null!==(r=e.groupBy)&&void 0!==r?r:[]];return s[t]=Object.assign({},s[t],{params:a}),Object.assign({},e,{groupBy:s})}(c,e,t);x(a)},onAddNewPart:e=>{x(function(e,t){const a=(0,s.cloneDeep)(e),r=new K(a);return r.addGroupBy(t),r.target}(c,e))},onRemovePart:e=>{x(function(e,t){const a=(0,s.cloneDeep)(e),r=new K(a);return r.removeGroupByPart(r.groupByParts[t],t),r.target}(c,e))}})}),(0,C.jsxs)(be.f,{label:"TIMEZONE",fill:!0,children:[(0,C.jsx)(Ve,{placeholder:"(optional)",value:c.tz,onChange:e=>{x(Object.assign({},c,{tz:e}))}}),(0,C.jsx)(je.W,{htmlFor:u,width:"auto",className:d.inlineLabel,children:"ORDER BY TIME"}),(0,C.jsx)(ze,{inputId:u,value:"DESC"===c.orderByTime?"DESC":"ASC",onChange:e=>{x(Object.assign({},c,{orderByTime:e}))}})]}),(0,C.jsxs)(be.f,{label:"LIMIT",fill:!0,children:[(0,C.jsx)(Ve,{placeholder:"(optional)",value:null===(a=c.limit)||void 0===a?void 0:a.toString(),onChange:e=>{x(Object.assign({},c,{limit:e}))}}),(0,C.jsx)(je.W,{width:"auto",className:d.inlineLabel,children:"SLIMIT"}),(0,C.jsx)(Ve,{placeholder:"(optional)",value:null===(r=c.slimit)||void 0===r?void 0:r.toString(),onChange:e=>{x(Object.assign({},c,{slimit:e}))}})]}),(0,C.jsxs)(be.f,{htmlFor:l,label:"FORMAT AS",fill:!0,children:[(0,C.jsx)(Ee,{inputId:l,format:null!==(i=c.resultFormat)&&void 0!==i?i:pe,onChange:e=>{x(Object.assign({},c,{resultFormat:e}))}}),"table"!==c.resultFormat&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(je.W,{width:"auto",className:d.inlineLabel,children:"ALIAS"}),(0,C.jsx)(Ve,{isWide:!0,placeholder:"Naming pattern",value:c.alias,onChange:e=>{x(Object.assign({},c,{alias:e}))}})]})]})]})};function ft(e){return{inlineLabel:q.css`
      color: ${e.colors.primary.text};
    `}}var vt;class yt extends n.PureComponent{constructor(){var e,t,a;super(...arguments),a=()=>{},(t="onRefresh")in(e=this)?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}render(){let{query:e,datasource:t,onChange:a}=this.props;return t.isFlux?(0,C.jsx)(oe,{datasource:t,query:{refId:"A",query:e},onRunQuery:this.onRefresh,onChange:e=>a(e.query)}):(0,C.jsxs)("div",{className:"gf-form-inline",children:[vt||(vt=(0,C.jsx)(l.c,{width:10,children:"Query"})),(0,C.jsx)("div",{className:"gf-form-inline gf-form--grow",children:(0,C.jsx)(de.K,{defaultValue:e||"",placeholder:"metric name or tags query",rows:1,className:"gf-form-input",onBlur:e=>a(e.currentTarget.value)})})]})}}var xt,bt,jt,wt,St,Ct,Tt=a(86558),Ot=a(16976),Pt=a(3321),Et=a(71808),Nt=a(58799),It=a(35778),Ft=a(14444),kt=a(32025),At=a(75560),Dt=a(81351),Rt=a(35089),qt=a(13924),Bt=a(6932),Mt=a(45753),_t=a(78837),Qt=a(7166);const Lt=e=>{var t,a,r,s,i;const{query:o,onChange:u}=e,[d,c]=(0,n.useState)(null!==(t=o.query)&&void 0!==t?t:""),[m,h]=(0,n.useState)(null!==(a=o.textColumn)&&void 0!==a?a:""),[p,g]=(0,n.useState)(null!==(r=o.tagsColumn)&&void 0!==r?r:""),[f,v]=(0,n.useState)(null!==(s=null==o?void 0:o.timeEndColumn)&&void 0!==s?s:""),[y]=(0,n.useState)(null!==(i=null==o?void 0:o.titleColumn)&&void 0!==i?i:""),x=(e,t)=>{u(Object.assign({},o,{[e]:t,fromAnnotations:!0,textEditor:!0}))};return(0,C.jsxs)("div",{className:"gf-form-group",children:[(0,C.jsxs)("div",{className:"gf-form",children:[xt||(xt=(0,C.jsx)(l.c,{width:12,children:"InfluxQL Query"})),(0,C.jsx)(me.I,{value:d,onChange:e=>{var t;return c(null!==(t=e.currentTarget.value)&&void 0!==t?t:"")},onBlur:()=>x("query",d),placeholder:"select text from events where $timeFilter limit 1000"})]}),bt||(bt=(0,C.jsx)(l.c,{width:12,tooltip:(0,C.jsx)("div",{children:"If your influxdb query returns more than one field you need to specify the column names below. An annotation event is composed of a title, tags, and an additional text field. Optionally you can map the timeEnd column for region annotation usage."}),children:"Field mappings"})),(0,C.jsx)("div",{className:"gf-form-group",children:(0,C.jsxs)("div",{className:"gf-form-inline",children:[(0,C.jsxs)("div",{className:"gf-form",children:[jt||(jt=(0,C.jsx)(l.c,{width:12,children:"Text"})),(0,C.jsx)(me.I,{value:m,onChange:e=>{var t;return h(null!==(t=e.currentTarget.value)&&void 0!==t?t:"")},onBlur:()=>x("textColumn",m)})]}),(0,C.jsxs)("div",{className:"gf-form",children:[wt||(wt=(0,C.jsx)(l.c,{width:12,children:"Tags"})),(0,C.jsx)(me.I,{value:p,onChange:e=>{var t;return g(null!==(t=e.currentTarget.value)&&void 0!==t?t:"")},onBlur:()=>x("tagsColumn",p)})]}),(0,C.jsxs)("div",{className:"gf-form",children:[St||(St=(0,C.jsx)(l.c,{width:12,children:"TimeEnd"})),(0,C.jsx)(me.I,{value:f,onChange:e=>{var t;return v(null!==(t=e.currentTarget.value)&&void 0!==t?t:"")},onBlur:()=>x("timeEndColumn",f)})]}),(0,C.jsxs)("div",{className:"gf-form ng-hide",children:[Ct||(Ct=(0,C.jsx)(l.c,{width:12,children:"Title"})),(0,C.jsx)(me.I,{defaultValue:y})]})]})})]})};var Vt=a(39302);function $t(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Gt{constructor(e){$t(this,"refId",void 0),$t(this,"series",void 0),$t(this,"alias",void 0),$t(this,"annotation",void 0),$t(this,"meta",void 0),this.series=e.series,this.alias=e.alias,this.annotation=e.annotation,this.meta=e.meta,this.refId=e.refId}getTimeSeries(){const e=[];let t,a;return 0===this.series.length||(0,s.each)(this.series,(r=>{const n=r.columns.length,i=(0,s.map)(r.tags,((e,t)=>t+": "+e));for(a=1;a<n;a++){let s=r.name;const n=r.columns[a];"value"!==n&&(s=s+"."+n),this.alias?s=this._getSeriesName(r,a):r.tags&&(s=s+" {"+i.join(", ")+"}");const o=[];if(r.values)for(t=0;t<r.values.length;t++)o[t]=[r.values[t][a],r.values[t][0]];e.push({title:s,target:s,datapoints:o,tags:r.tags,meta:this.meta,refId:this.refId})}})),e}_getSeriesName(e,t){const a=e.name.split(".");return this.alias.replace(/\$(\w+)|\[\[([\s\S]+?)\]\]/g,((r,s,n)=>{const i=s||n,o=parseInt(i,10);if("m"===i||"measurement"===i)return e.name;if("col"===i)return e.columns[t];var l;if(!isNaN(o))return null!==(l=a[o])&&void 0!==l?l:r;if(0!==i.indexOf("tag_"))return r;const u=i.replace("tag_","");return e.tags?e.tags[u]:r}))}getAnnotations(){const e=[];return(0,s.each)(this.series,(t=>{let a=null,r=null,n=null;const i=[];let o=null;(0,s.each)(t.columns,((e,t)=>{"time"!==e?"sequence_number"!==e&&(e!==this.annotation.titleColumn?(0,s.includes)((this.annotation.tagsColumn||"").replace(" ","").split(","),e)?i.push(t):e!==this.annotation.textColumn?e!==this.annotation.timeEndColumn?a||o===t||(a=t):n=t:o=t:a=t):r=t})),(0,s.each)(t.values,(t=>{const l={annotation:this.annotation,time:+new Date(t[r]),title:t[a],timeEnd:t[n],tags:(0,s.flatten)(i.filter((e=>t[e])).map((e=>t[e].split(",")))),text:t[o]};e.push(l)}))})),e}getTable(){const e=new Vt.Z;let t,a;return e.refId=this.refId,e.meta=this.meta,0===this.series.length||(0,s.each)(this.series,((r,n)=>{if(0===n){const t=r.columns[0],n="time"===t?{text:"Time",type:kt.fS.time}:{text:t};for(e.columns.push(n),(0,s.each)((0,s.keys)(r.tags),(t=>{e.columns.push({text:t})})),a=1;a<r.columns.length;a++)e.columns.push({text:r.columns[a]})}if(r.values)for(t=0;t<r.values.length;t++){const s=r.values[t],n=[s[0]];if(r.tags)for(const e in r.tags)r.tags.hasOwnProperty(e)&&n.push(r.tags[e]);for(a=1;a<s.length;a++)n.push(s[a]);e.rows.push(n)}})),e}}const zt=e=>{var t;return e.target=null!==(t=e.target)&&void 0!==t?t:(e=>{var t,a,r,s,n,i;return{query:null!==(t=e.query)&&void 0!==t?t:"",queryType:"tags",fromAnnotations:!0,tagsColumn:null!==(a=e.tagsColumn)&&void 0!==a?a:"",textColumn:null!==(r=e.textColumn)&&void 0!==r?r:"",timeEndColumn:null!==(s=e.timeEndColumn)&&void 0!==s?s:"",titleColumn:null!==(n=e.titleColumn)&&void 0!==n?n:"",name:null!==(i=e.name)&&void 0!==i?i:""}})(e),e};class Wt{parse(e,t){if(null==t||!t.results||0===t.results.length)return[];const a=t.results[0];if(!a.series)return[];const r=e.toLowerCase(),n=r.indexOf("show field keys")>=0||r.indexOf("show retention policies")>=0,i=new Set;return(0,s.each)(a.series,(e=>{(0,s.each)(e.values,(e=>{(0,s.isArray)(e)?n?Kt(i,e[0]):void 0!==e[1]?Kt(i,e[1]):Kt(i,e[0]):Kt(i,e)}))})),Array.from(i).map((e=>({text:e})))}getTable(e,t,a){let r=new Vt.Z;var n;if(e.length>0)if(r.meta=Object.assign({},a,{executedQueryString:null===(n=e[0].meta)||void 0===n?void 0:n.executedQueryString}),r.refId=t.refId,r=function(e,t,a){const r=function(e){var t;let a=[];null===(t=e.select)||void 0===t||t.forEach((e=>{const t=e.filter((e=>"field"!==e.type));t.length>0?a.push(t[0].type):e[0]&&e[0].params&&e[0].params[0]&&a.push(e[0].params[0].toString())}));let r=[];return a.forEach((e=>{r.push(Ht(e,e,r,0))})),r}(a);e[0].fields.forEach((e=>{"time"===e.name?t.columns.push({text:"Time",type:kt.fS.time}):"value"===e.name&&e.labels&&Object.keys(e.labels).forEach((e=>{t.columns.push({text:e})}))})),"metricFindQuery"===e[0].refId&&e.forEach((e=>{e.name&&t.columns.push({text:e.name})}));for(let e=0;e<r.length;e++)t.columns.push({text:r[e]});return t}(e,r,t),e[0].fields[1]&&e[0].fields[1].labels){let t=(0,s.groupBy)(e,(e=>e.fields[1].labels?Object.values(e.fields[1].labels):null));const a=Object.keys(t);t=Object.values(t);for(let e=0;e<t.length;e++)r=Ut(t[e],r,[...a[e].split(",")])}else r=Ut(e,r,[]);return r}async transformAnnotationResponse(e,t,a){const r=(0,Mt.z1)(t,[a]);if(r){const t=this.getTable(r.data,a,{}),n=[];let i=null,o=null,l=null;const u=[];let d=null;return(0,s.each)(t.columns,((t,a)=>{"time"!==t.text.toLowerCase()?t.text!==e.titleColumn?!function(e,t){const a=(t||"").replace(" ","").split(",");for(const t of a)if(e.includes(t))return!0;return!1}(t.text,e.tagsColumn)?t.text.includes(e.textColumn)?d=a:t.text!==e.timeEndColumn?i||d===a||(i=a):l=a:u.push(a):i=a:o=a})),(0,s.each)(t.rows,(t=>{const a={annotation:e,time:+new Date(t[o]),title:t[i],timeEnd:t[l],tags:(0,s.flatten)(u.filter((e=>t[e])).map((e=>t[e].split(",")))),text:t[d]};n.push(a)})),n}return[]}}function Ut(e,t,a){const r=e[0].fields[0].values.toArray();for(let s=0;s<r.length;s++){const n=r[s],i=e.map((e=>e.fields[1]?e.fields[1].values.toArray()[s]:null));i.indexOf(null)<0&&t.rows.push([n,...a,...i])}return t}function Ht(e,t,a,r){return a.indexOf(t)>-1?Ht(e,e+"_"+ ++r,a,r):t}function Kt(e,t){e.add(t.toString())}const Yt=["__interval","__interval_ms"];function Zt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Jt(e){const t=e.find((e=>null!==e));if(void 0===t)return kt.fS.number;const a=typeof t;switch(a){case"string":return kt.fS.string;case"boolean":return kt.fS.boolean;case"number":return kt.fS.number;default:throw new Error(`InfluxQL: invalid value type ${a}`)}}function Xt(e){const t=[],a=[],r=e.datapoints;for(const e of r)a.push(e[0]),t.push(e[1]);const s=[{name:kt.Ls,type:kt.fS.time,config:{},values:new At.G(t)},{name:kt.M5,type:Jt(a),config:{displayNameFromDS:e.title},values:new At.G(a),labels:e.tags}];return{name:e.target,refId:e.refId,meta:e.meta,fields:s,length:a.length}}class ea extends qt.CK{constructor(e){var t,a,r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,Qt.J)();super(e),Zt(this,"type",void 0),Zt(this,"urls",void 0),Zt(this,"username",void 0),Zt(this,"password",void 0),Zt(this,"name",void 0),Zt(this,"database",void 0),Zt(this,"basicAuth",void 0),Zt(this,"withCredentials",void 0),Zt(this,"access",void 0),Zt(this,"interval",void 0),Zt(this,"responseParser",void 0),Zt(this,"httpMode",void 0),Zt(this,"isFlux",void 0),Zt(this,"isProxyAccess",void 0),this.templateSrv=s,this.type="influxdb",this.urls=(null!==(t=e.url)&&void 0!==t?t:"").split(",").map((e=>e.trim())),this.username=null!==(a=e.username)&&void 0!==a?a:"",this.password=null!==(r=e.password)&&void 0!==r?r:"",this.name=e.name,this.database=e.database,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.access=e.access;const n=e.jsonData||{};this.interval=n.timeInterval,this.httpMode=n.httpMode||"GET",this.responseParser=new Wt,this.isFlux=n.version===g.Flux,this.isProxyAccess="proxy"===e.access,this.isFlux?this.annotations={QueryEditor:oe}:this.annotations={QueryEditor:Lt,prepareAnnotation:zt}}query(e){if(!this.isProxyAccess){const e=new Error(p);return(0,Tt._)((()=>e))}const t=Object.assign({},e,{targets:e.targets.filter((e=>!0!==e.hide))});return this.isFlux?super.query(t):this.isMigrationToggleOnAndIsAccessProxy()?super.query(t).pipe((0,It.U)((e=>{if(e.error)throw{message:"InfluxDB Error: "+e.error.message,res:e};const a=[],r=(0,s.groupBy)(e.data,(e=>e.refId));return Object.keys(r).length>0&&t.targets.forEach((e=>{var t;const s=null!==(t=r[e.refId])&&void 0!==t?t:[];switch(e.resultFormat){case"logs":case"table":a.push(this.responseParser.getTable(s,e,{preferredVisualisationType:e.resultFormat}));break;default:for(let e=0;e<s.length;e++)a.push(s[e])}})),{data:a}}))):this.classicQuery(e)}getQueryDisplayText(e){return this.isFlux?e.query:new K(e).render(!1)}filterQuery(e){return!this.isFlux||!!e.query}applyTemplateVariables(e,t){const a=function(e,t){if(null==e)return{};var a,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(s[a]=e[a]);return s}(t,Yt);var r;return this.isFlux?Object.assign({},e,{query:this.templateSrv.replace(null!==(r=e.query)&&void 0!==r?r:"",a)}):(_t.ZP.featureToggles.influxdbBackendMigration&&"proxy"===this.access&&(e=this.applyVariables(e,t,a)),e)}classicQuery(e){if(e.targets.some((e=>e.fromAnnotations))){const t=[];for(const a of e.targets)a.query&&t.push(new Ot.y((t=>{this.annotationEvents(e,a).then((e=>t.next({data:[(0,Dt.g0)(e)]}))).catch((e=>t.error(new Error(e)))).finally((()=>t.complete()))})));return(0,Pt.T)(...t)}let t=this.getTimeFilter(e);const a=e.scopedVars,r=(0,s.cloneDeep)(e.targets),n=[];let i,o,l=(0,s.map)(r,(e=>e.hide?"":(n.push(e),a.interval=a.__interval,new K(e,this.templateSrv,a).render(!0)))).reduce(((e,t)=>(""!==t&&(e+=";"+t),e)));if(""===l)return(0,Et.of)({data:[]});const u=this.templateSrv.getAdhocFilters(this.name);if(u.length>0){t+=" AND "+new K({refId:"A"},this.templateSrv,a).renderAdhocFilters(u)}return a.timeFilter={value:t},l=this.templateSrv.replace(l,a),this._seriesQuery(l,e).pipe((0,It.U)((t=>{if(!t||!t.results)return{data:[]};const a=[];for(i=0;i<t.results.length;i++){const r=t.results[i];if(!r||!r.series)continue;const s=n[i];let l=s.alias;l&&(l=this.templateSrv.replace(s.alias,e.scopedVars));const u={executedQueryString:t.executedQueryString},d=new Gt({refId:s.refId,series:t.results[i].series,alias:l,meta:u});switch(s.resultFormat){case"logs":u.preferredVisualisationType="logs";case"table":a.push(d.getTable());break;default:{const e=d.getTimeSeries();for(o=0;o<e.length;o++)a.push(Xt(e[o]));break}}}return{data:a}})))}async annotationEvents(e,t){if(this.isFlux)return Promise.reject({message:"Flux requires the standard annotation query"});if(!t.query)return Promise.reject({message:"Query missing in annotation definition"});if(_t.ZP.featureToggles.influxdbBackendMigration&&"proxy"===this.access){const a={refId:"metricFindQuery",datasource:this.getRef(),query:this.templateSrv.replace(t.query,void 0,"regex"),rawQuery:!0};return(0,Nt.n)((0,Bt.i)().fetch({url:"/api/ds/query",method:"POST",data:{from:e.range.from.valueOf().toString(),to:e.range.to.valueOf().toString(),queries:[a]},requestId:t.name}).pipe((0,It.U)((async e=>await this.responseParser.transformAnnotationResponse(t,e,a)))))}const a=this.getTimeFilter({rangeRaw:e.range.raw,timezone:e.timezone});let r=t.query.replace("$timeFilter",a);return r=this.templateSrv.replace(r,void 0,"regex"),(0,Nt.n)(this._seriesQuery(r,e)).then((e=>{if(!e||!e.results||!e.results[0])throw{message:"No results in response from InfluxDB"};return new Gt({series:e.results[0].series,annotation:t}).getAnnotations()}))}targetContainsTemplate(e){const t=this.isFlux?e.query:Y(e);return this.templateSrv.containsTemplate(t)}interpolateVariablesInQueries(e,t){return e&&0!==e.length?e.map((e=>{var a;return this.isFlux?Object.assign({},e,{datasource:this.getRef(),query:this.templateSrv.replace(null!==(a=e.query)&&void 0!==a?a:"",t,"regex")}):Object.assign({},e,{datasource:this.getRef()},this.applyVariables(e,t,t))})):[]}applyVariables(e,t,a){var r,s,n,i,o,l,u,d,c;const m=Object.assign({},e);return e.groupBy&&(m.groupBy=e.groupBy.map((e=>{var t;return Object.assign({},e,{params:null===(t=e.params)||void 0===t?void 0:t.map((e=>this.templateSrv.replace(e.toString(),void 0,"regex")))})}))),e.select&&(m.select=e.select.map((e=>e.map((e=>{var t;return Object.assign({},e,{params:null===(t=e.params)||void 0===t?void 0:t.map((e=>this.templateSrv.replace(e.toString(),void 0,"regex")))})}))))),e.tags&&(m.tags=e.tags.map((e=>Object.assign({},e,{value:this.templateSrv.replace(e.value,t,"regex")})))),Object.assign({},m,{query:this.templateSrv.replace(null!==(r=e.query)&&void 0!==r?r:"",a,"regex"),alias:this.templateSrv.replace(null!==(s=e.alias)&&void 0!==s?s:"",t),limit:this.templateSrv.replace(null!==(n=null===(i=e.limit)||void 0===i?void 0:i.toString())&&void 0!==n?n:"",t,"regex"),measurement:this.templateSrv.replace(null!==(o=e.measurement)&&void 0!==o?o:"",t,"regex"),policy:this.templateSrv.replace(null!==(l=e.policy)&&void 0!==l?l:"",t,"regex"),slimit:this.templateSrv.replace(null!==(u=null===(d=e.slimit)||void 0===d?void 0:d.toString())&&void 0!==u?u:"",t,"regex"),tz:this.templateSrv.replace(null!==(c=e.tz)&&void 0!==c?c:"",t)})}async metricFindQuery(e,t){if(this.isFlux||this.isMigrationToggleOnAndIsAccessProxy()){const a={refId:"metricFindQuery",query:e,rawQuery:!0};return(0,Nt.n)(super.query(Object.assign({},t,{targets:[a]}))).then((e=>{var t;return null!==(t=e.data)&&void 0!==t&&t.length?(0,Mt.S9)(e.data[0]):[]}))}const a=this.templateSrv.replace(e,void 0,"regex");return(0,Nt.n)(this._seriesQuery(a,t)).then((t=>this.responseParser.parse(e,t)))}getTagKeys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new we({measurement:e.measurement||"",tags:[]},this.database).buildExploreQuery("TAG_KEYS");return this.metricFindQuery(t,e)}getTagValues(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new we({measurement:e.measurement||"",tags:[]},this.database).buildExploreQuery("TAG_VALUES",e.key);return this.metricFindQuery(t,e)}_seriesQuery(e,t){if(!e)return(0,Et.of)({results:[]});if(t&&t.range){const a=this.getTimeFilter({rangeRaw:t.range,timezone:t.timezone});e=e.replace("$timeFilter",a)}return this._influxRequest(this.httpMode,"/query",{q:e,epoch:"ms"},t)}serializeParams(e){return e?(0,s.reduce)(e,((e,t,a)=>(null==t||e.push(encodeURIComponent(a)+"="+encodeURIComponent(t)),e)),[]).join("&"):""}_influxRequest(e,t,a,r){const n=this.urls.shift();this.urls.push(n);const i={};this.username&&(i.u=this.username,i.p=this.password),r&&r.database?i.db=r.database:this.database&&(i.db=this.database);const{q:o}=a;"POST"===e&&(0,s.has)(a,"q")?((0,s.extend)(i,(0,s.omit)(a,["q"])),a=this.serializeParams((0,s.pick)(a,["q"]))):"GET"!==e&&"POST"!==e||((0,s.extend)(i,a),a=null);const l={method:e,url:n+t,params:i,data:a,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return l.headers=l.headers||{},(this.basicAuth||this.withCredentials)&&(l.withCredentials=!0),this.basicAuth&&(l.headers.Authorization=this.basicAuth),"POST"===e&&(l.headers["Content-type"]="application/x-www-form-urlencoded"),(0,Bt.i)().fetch(l).pipe((0,It.U)((e=>{const{data:t}=e;if(t&&(t.executedQueryString=o,t.results)){const a=e.data.results.filter((e=>e.error));if(a.length>0)throw{message:"InfluxDB Error: "+a[0].error,data:t}}return t})),(0,Ft.K)((e=>e.cancelled?(0,Et.of)(e):(0,Tt._)(this.handleErrors(e)))))}handleErrors(e){const t={message:e&&e.status||e&&e.message||"Unknown error during query transaction. Please check JS console logs."};return(Number.isInteger(e.status)&&0!==e.status||e.status>=300)&&(e.data&&e.data.error?(t.message="InfluxDB Error: "+e.data.error,t.data=e.data,t.config=e.config):(t.message="Network Error: "+e.statusText+"("+e.status+")",t.data=e.data,t.config=e.config)),t}getTimeFilter(e){return"time >= "+this.getInfluxTime(e.rangeRaw.from,!1,e.timezone)+" and time <= "+this.getInfluxTime(e.rangeRaw.to,!0,e.timezone)}getInfluxTime(e,t,a){if((0,s.isString)(e)){if("now"===e)return"now()";const r=/^now-(\d+)([dhms])$/.exec(e);if(r){return"now() - "+parseInt(r[1],10)+r[2]}e=Rt.parse(e,t,a)}return e.valueOf()+"ms"}isMigrationToggleOnAndIsAccessProxy(){return _t.ZP.featureToggles.influxdbBackendMigration&&"proxy"===this.access}}const ta=new r.hf(ea).setConfigEditor(F).setQueryEditor((e=>{var t;let{query:a,onChange:r,onRunQuery:s,datasource:n,range:i,data:o}=e;return n.isFlux?(0,C.jsx)("div",{className:"gf-form-query-content",children:(0,C.jsx)(oe,{query:a,onChange:r,onRunQuery:s,datasource:n})}):(0,C.jsxs)("div",{className:(0,q.css)({display:"flex"}),children:[(0,C.jsx)("div",{className:(0,q.css)({flexGrow:1}),children:a.rawQuery?(0,C.jsx)(ye,{query:a,onChange:r,onRunQuery:s}):(0,C.jsx)(gt,{query:a,onChange:r,onRunQuery:s,datasource:n})}),(0,C.jsx)(ue,{isRaw:null!==(t=a.rawQuery)&&void 0!==t&&t,onChange:e=>{r(Object.assign({},a,{query:Y(a),rawQuery:e})),s()}})]})})).setVariableQueryEditor(yt).setQueryEditorHelp(R)}}]);
//# sourceMappingURL=influxdbPlugin.362f1e279dadc0ef6768.js.map