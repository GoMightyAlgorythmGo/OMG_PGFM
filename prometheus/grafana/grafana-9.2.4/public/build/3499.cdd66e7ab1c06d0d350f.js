"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3499],{53499:(e,r,s)=>{s.r(r),s.d(r,{plugin:()=>Ps});var t=s(12822),o=s(23485),i=s(3965),a=s(68404),n=s(81391),c=s(93921),u=s(6932),l=s(8771),p=s(82897),m=s.n(p),d=s(23541);class f{static createISO8601Duration(e,r){return(0,p.includes)(["hour","minute","h","m"],r)?`PT${e}${r[0].toUpperCase()}`:`P${e}${r[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const r=+e.slice(0,e.length-1),s=e[e.length-1];if(e.indexOf("ms")>-1)return f.createISO8601Duration(1,"m");if("s"===e[e.length-1]){let e=60*r%60;return e<1&&(e=1),f.createISO8601Duration(e,"m")}return f.createISO8601Duration(r,s)}static findClosestTimeGrain(e,r){const s=(0,p.filter)(r,(e=>"auto"!==e));let t=s[0];const o=d.intervalToMs(e);for(let e=0;e<s.length;e++)o>d.intervalToMs(s[e])&&(t=e+1<s.length?s[e+1]:s[e]);return t}static createTimeGrainFromISO8601Duration(e){let r=1;"PT"===e.substring(0,2)&&(r=2);const s=e.substring(r,e.length-1),t=e.substring(e.length-1);return s+" "+f.timeUnitToText(+s,t)}static timeUnitToText(e,r){let s="";return"S"===r&&(s="second"),"M"===r&&(s="minute"),"H"===r&&(s="hour"),"D"===r&&(s="day"),e>1?s+"s":s}static createKbnUnitFromISO8601Duration(e){if("auto"===e)return"auto";let r=1;"PT"===e.substring(0,2)&&(r=2);const s=e.substring(r,e.length-1),t=e.substring(e.length-1);return s+f.timeUnitToKbn(+s,t)}static timeUnitToKbn(e,r){return"S"===r?"s":"M"===r?"m":"H"===r?"h":"D"===r?"d":""}}class g{static parseResponseValues(e,r,s){const t=[];if(!e)return t;for(let o=0;o<e.value.length;o++)if(!(0,p.find)(t,["value",(0,p.get)(e.value[o],s)])){const i=(0,p.get)(e.value[o],s),a=(0,p.get)(e.value[o],r,i);t.push({text:a,value:i})}return t}static parseResourceNames(e,r){const s=[];if(!e)return s;for(let t=0;t<e.value.length;t++)"string"!=typeof e.value[t].type||r&&e.value[t].type.toLocaleLowerCase()!==r.toLocaleLowerCase()||s.push({text:e.value[t].name,value:e.value[t].name});return s}static parseMetadata(e,r){var s,t;const o=["None","Average","Minimum","Maximum","Total","Count"],i=null==e?void 0:e.value.find((e=>e.name.value===r));return i?{primaryAggType:i.primaryAggregationType,supportedAggTypes:i.supportedAggregationTypes||o,supportedTimeGrains:[{label:"Auto",value:"auto"},...g.parseTimeGrains(null!==(s=i.metricAvailabilities)&&void 0!==s?s:[])],dimensions:g.parseDimensions(null!==(t=i.dimensions)&&void 0!==t?t:[])}:{primaryAggType:"",supportedAggTypes:o,supportedTimeGrains:[],dimensions:[]}}static parseTimeGrains(e){const r=[];return e?(e.forEach((e=>{e.timeGrain&&r.push({label:f.createTimeGrainFromISO8601Duration(e.timeGrain),value:e.timeGrain})})),r):r}static parseDimensions(e){return e.map((e=>({label:e.localizedValue||e.value,value:e.value})))}static parseSubscriptions(e){const r=[];if(!e)return r;const s="subscriptionId";for(let t=0;t<e.value.length;t++)(0,p.find)(r,["value",(0,p.get)(e.value[t],s)])||r.push({text:`${(0,p.get)(e.value[t],"displayName")}`,value:(0,p.get)(e.value[t],s)});return r}static parseSubscriptionsForSelect(e){const r=[];if(!e)return r;const s="subscriptionId";for(let t=0;t<e.data.value.length;t++)(0,p.find)(r,["value",(0,p.get)(e.data.value[t],s)])||r.push({label:`${(0,p.get)(e.data.value[t],"displayName")} - ${(0,p.get)(e.data.value[t],s)}`,value:(0,p.get)(e.data.value[t],s)});return r}static parseWorkspacesForSelect(e){const r=[];if(!e)return r;const s="customerId";for(let t=0;t<e.data.value.length;t++)(0,p.find)(r,["value",(0,p.get)(e.data.value[t].properties,s)])||r.push({label:(0,p.get)(e.data.value[t],"name"),value:(0,p.get)(e.data.value[t].properties,s)});return r}}const h=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===r.length)return[];const s=r.reduce(((e,r)=>(e.add(r),e)),new Set);return e.filter((e=>s.has(e.value)))},v=e=>({value:e.value,label:e.text});const b="azuremonitor",y="loganalytics",w="resourcegraph";function k(e,r){if("string"==typeof e)return r.multi||r.includeAll&&!r.allValue?"'"+e+"'":e;if("number"==typeof e)return e;return(0,p.map)(e,(r=>"number"==typeof e?e:"'"+r+"'")).join(",")}var S=s(48147);let N,j;!function(e){e.AzureMonitor="Azure Monitor",e.LogAnalytics="Azure Log Analytics",e.AzureResourceGraph="Azure Resource Graph",e.SubscriptionsQuery="Azure Subscriptions",e.ResourceGroupsQuery="Azure Resource Groups",e.NamespacesQuery="Azure Namespaces",e.ResourceNamesQuery="Azure Resource Names",e.MetricNamesQuery="Azure Metric Names",e.WorkspacesQuery="Azure Workspaces",e.GrafanaTemplateVariableFn="Grafana Template Variable Function"}(N||(N={})),function(e){e.Public="AzureCloud",e.China="AzureChinaCloud",e.USGovernment="AzureUSGovernment",e.Germany="AzureGermanCloud",e.None=""}(j||(j={}));const z=Symbol("Concealed client secret");function x(e){return e.jsonData.azureAuthType?e.jsonData.azureAuthType:e.jsonData.tenantId&&e.jsonData.clientId?"clientsecret":S.v.azure.managedIdentityEnabled?"msi":"clientsecret"}function A(){switch(S.v.azure.cloud){case j.Public:case j.None:case void 0:return"azuremonitor";case j.China:return"chinaazuremonitor";case j.USGovernment:return"govazuremonitor";case j.Germany:return"germanyazuremonitor";default:throw new Error(`The cloud '${S.v.azure.cloud}' not supported.`)}}function C(e){switch(e){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";case"germanyazuremonitor":return"https://portal.microsoftazure.de";default:throw new Error("The cloud not supported.")}}function G(e){switch(x(e)){case"msi":return A();case"clientsecret":return e.jsonData.cloudName||A()}}function M(e){if(e.secureJsonFields.clientSecret)return z;{var r;const s=null===(r=e.secureJsonData)||void 0===r?void 0:r.clientSecret;return"string"==typeof s&&s.length>0?s:void 0}}var I,R,T,L,O,q,D,P=s(42528),F=s(97833),E=s(61884),Q=s(40920),V=s(45916);const{Input:$}=P.vw6,W=[{value:"msi",label:"Managed Identity"},{value:"clientsecret",label:"App Registration"}],U=e=>{const{credentials:r,azureCloudOptions:s,onCredentialsChange:t,getSubscriptions:o,disabled:i}=e,n=function(e){switch(e.authType){case"msi":return!0;case"clientsecret":return!!(e.azureCloud&&e.tenantId&&e.clientId&&e.clientSecret)}}(r),[c,u]=(0,a.useState)([]),[l,p]=(0,a.useReducer)((e=>e+1),0);(0,a.useEffect)((()=>{if(!o||!n)return void m([]);let e=!1;return o().then((r=>{e||m(r,l)})),()=>{e=!0}}),[l]);const m=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(u(e),o)if(s&&!r.defaultSubscriptionId&&e.length>0)d(e[0]);else if(r.defaultSubscriptionId){e.find((e=>e.value===r.defaultSubscriptionId))||d(void 0)}},d=e=>{if(t){const s=Object.assign({},r,{defaultSubscriptionId:null==e?void 0:e.value});t(s)}};return(0,V.jsxs)("div",{className:"gf-form-group",children:[e.managedIdentityEnabled&&(0,V.jsx)("div",{className:"gf-form-inline",children:(0,V.jsxs)("div",{className:"gf-form",children:[I||(I=(0,V.jsx)(F.c,{className:"width-12",tooltip:"Choose the type of authentication to Azure services",children:"Authentication"})),(0,V.jsx)(E.Ph,{className:"width-15",value:W.find((e=>e.value===r.authType)),options:W,onChange:e=>{if(t){u([]);const s=Object.assign({},r,{authType:e.value||"msi",defaultSubscriptionId:void 0});t(s)}},disabled:i})]})}),"clientsecret"===r.authType&&(0,V.jsxs)(V.Fragment,{children:[s&&(0,V.jsx)("div",{className:"gf-form-inline",children:(0,V.jsxs)("div",{className:"gf-form",children:[R||(R=(0,V.jsx)(F.c,{className:"width-12",tooltip:"Choose an Azure Cloud",children:"Azure Cloud"})),(0,V.jsx)(E.Ph,{"aria-label":"Azure Cloud",className:"width-15",value:s.find((e=>e.value===r.azureCloud)),options:s,onChange:e=>{if(t&&"clientsecret"===r.authType){u([]);const s=Object.assign({},r,{azureCloud:e.value,defaultSubscriptionId:void 0});t(s)}},disabled:i})]})}),(0,V.jsx)("div",{className:"gf-form-inline",children:(0,V.jsxs)("div",{className:"gf-form",children:[T||(T=(0,V.jsx)(F.c,{className:"width-12",children:"Directory (tenant) ID"})),(0,V.jsx)("div",{className:"width-15",children:(0,V.jsx)($,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.tenantId||"",onChange:e=>{if(t&&"clientsecret"===r.authType){u([]);const s=Object.assign({},r,{tenantId:e.target.value,defaultSubscriptionId:void 0});t(s)}},disabled:i})})]})}),(0,V.jsx)("div",{className:"gf-form-inline",children:(0,V.jsxs)("div",{className:"gf-form",children:[L||(L=(0,V.jsx)(F.c,{className:"width-12",children:"Application (client) ID"})),(0,V.jsx)("div",{className:"width-15",children:(0,V.jsx)($,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientId||"",onChange:e=>{if(t&&"clientsecret"===r.authType){u([]);const s=Object.assign({},r,{clientId:e.target.value,defaultSubscriptionId:void 0});t(s)}},disabled:i})})]})}),!i&&("symbol"==typeof r.clientSecret?(0,V.jsxs)("div",{className:"gf-form-inline",children:[O||(O=(0,V.jsxs)("div",{className:"gf-form",children:[(0,V.jsx)(F.c,{className:"width-12",children:"Client Secret"}),(0,V.jsx)($,{"data-testid":"client-secret",className:"width-25",placeholder:"configured",disabled:!0})]})),(0,V.jsx)("div",{className:"gf-form",children:(0,V.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,V.jsx)(Q.zx,{variant:"secondary",type:"button",onClick:()=>{if(t&&"clientsecret"===r.authType){u([]);const e=Object.assign({},r,{clientSecret:"",defaultSubscriptionId:void 0});t(e)}},disabled:i,children:"reset"})})})]}):(0,V.jsx)("div",{className:"gf-form-inline",children:(0,V.jsxs)("div",{className:"gf-form",children:[q||(q=(0,V.jsx)(F.c,{className:"width-12",children:"Client Secret"})),(0,V.jsx)("div",{className:"width-15",children:(0,V.jsx)($,{className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientSecret||"",onChange:e=>{if(t&&"clientsecret"===r.authType){u([]);const s=Object.assign({},r,{clientSecret:e.target.value,defaultSubscriptionId:void 0});t(s)}},disabled:i})})]})}))]}),o&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{className:"gf-form-inline",children:(0,V.jsxs)("div",{className:"gf-form",children:[D||(D=(0,V.jsx)(F.c,{className:"width-12",children:"Default Subscription"})),(0,V.jsx)("div",{className:"width-30",children:(0,V.jsx)(E.Ph,{"aria-label":"Default Subscription",value:r.defaultSubscriptionId?c.find((e=>e.value===r.defaultSubscriptionId)):void 0,options:c,onChange:d,disabled:i})})]})}),!i&&(0,V.jsx)("div",{className:"gf-form-inline",children:(0,V.jsx)("div",{className:"gf-form",children:(0,V.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,V.jsx)(Q.zx,{variant:"secondary",size:"sm",type:"button",onClick:p,disabled:!n,children:"Load Subscriptions"})})})})]}),e.children]})};var X;const _=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"germanyazuremonitor",label:"Azure Germany"},{value:"chinaazuremonitor",label:"Azure China"}],B=e=>{const{updateOptions:r,getSubscriptions:s}=e,t=(0,a.useMemo)((()=>function(e){switch(x(e)){case"msi":return S.v.azure.managedIdentityEnabled?{authType:"msi",defaultSubscriptionId:e.jsonData.subscriptionId}:{authType:"clientsecret",azureCloud:A()};case"clientsecret":return{authType:"clientsecret",azureCloud:e.jsonData.cloudName||A(),tenantId:e.jsonData.tenantId,clientId:e.jsonData.clientId,clientSecret:M(e),defaultSubscriptionId:e.jsonData.subscriptionId}}}(e.options)),[e.options]);return(0,V.jsxs)(V.Fragment,{children:[X||(X=(0,V.jsx)("h3",{className:"page-heading",children:"Authentication"})),(0,V.jsx)(U,{managedIdentityEnabled:S.v.azure.managedIdentityEnabled,credentials:t,azureCloudOptions:_,onCredentialsChange:e=>{r((r=>function(e,r){switch(r.authType){case"msi":if(!S.v.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"msi",subscriptionId:r.defaultSubscriptionId})});case"clientsecret":return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"clientsecret",cloudName:r.azureCloud||A(),tenantId:r.tenantId,clientId:r.clientId,subscriptionId:r.defaultSubscriptionId}),secureJsonData:Object.assign({},e.secureJsonData,{clientSecret:"string"==typeof r.clientSecret?r.clientSecret:void 0}),secureJsonFields:Object.assign({},e.secureJsonFields,{clientSecret:"symbol"==typeof r.clientSecret})})}}(r,e)))},getSubscriptions:s,disabled:e.options.readOnly})]})};function J(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}class H extends a.PureComponent{constructor(e){super(e),J(this,"templateSrv",(0,c.J)()),J(this,"baseURL",void 0),J(this,"updateOptions",(e=>{const r=e(this.props.options);this.props.onOptionsChange(r),this.setState({unsaved:!0})})),J(this,"saveOptions",(async()=>{this.state.unsaved&&(await(0,u.i)().put(`/api/datasources/${this.props.options.id}`,this.props.options).then((e=>{(0,n.fd)(this.props,"version",e.datasource.version)})),this.setState({unsaved:!1}))})),J(this,"getSubscriptions",(async()=>{await this.saveOptions();try{const e=await(0,u.i)().fetch({url:this.baseURL+"?api-version=2019-03-01",method:"GET"}).toPromise();return this.setState({error:void 0}),g.parseSubscriptionsForSelect(e)}catch(r){var e;if((0,u.kW)(r))this.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:null==r||null===(e=r.data)||void 0===e?void 0:e.message}});return Promise.resolve([])}})),this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${b}/subscriptions`}render(){const{options:e}=this.props,{error:r}=this.state;return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(B,{options:e,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),r&&(0,V.jsxs)(l.b,{severity:"error",title:r.title,children:[(0,V.jsx)("p",{children:r.description}),r.details&&(0,V.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:r.details})]})]})}}var K=s(38465);function Z(e){var r,s,t,o,i,a,n,c,u,l,p,m,d,f,g,h,v;if(!e||"object"!=typeof e)return;if("string"==typeof e.message)return e.message;if("string"==typeof(null===(r=e.data)||void 0===r||null===(s=r.error)||void 0===s?void 0:s.message))return e.data.error.message;const b=(null===(t=e.error)||void 0===t||null===(o=t.data)||void 0===o||null===(i=o.error)||void 0===i||null===(a=i.innererror)||void 0===a||null===(n=a.innererror)||void 0===n?void 0:n.message)||(null===(c=e.error)||void 0===c||null===(u=c.data)||void 0===u||null===(l=u.error)||void 0===l||null===(p=l.innererror)||void 0===p?void 0:p.message)||(null===(m=e.error)||void 0===m||null===(d=m.data)||void 0===d||null===(f=d.error)||void 0===f?void 0:f.message)||(null===(g=e.error)||void 0===g||null===(h=g.data)||void 0===h?void 0:h.message)||(null===(v=e.data)||void 0===v?void 0:v.message)||e;return"string"==typeof b?b:b&&b.toString?b.toString():void 0}function Y(){const[e,r]=(0,a.useState)([]),s=(0,a.useCallback)(((e,s)=>{r((r=>{const t=[...r],o=r.findIndex((r=>{let[s]=r;return s===e}));return o>-1&&t.splice(o,1),s&&t.unshift([e,s]),t}))}),[]);return[(0,a.useMemo)((()=>{const r=e[0];return r&&(s=r[1],(0,a.isValidElement)(s)?s:Z(s));var s}),[e]),s]}var ee=s(68522),re=s(24643);const se=["labelWidth","inlineField"];const te=e=>{const{labelWidth:r,inlineField:s}=e,t=function(e,r){if(null==e)return{};var s,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)s=i[t],r.indexOf(s)>=0||(o[s]=e[s]);return o}(e,se);return s?(0,V.jsx)(re._,Object.assign({labelWidth:r||18},t)):(0,V.jsx)(ee.EditorField,Object.assign({width:r||18},t))},oe=e=>{let{query:r,subscriptions:s,variableOptionGroup:t,onQueryChange:o,multiSelect:i=!1}=e;const n=(0,a.useCallback)((e=>{if(!e.value)return;let s=Object.assign({},r,{subscription:e.value});r.queryType===N.AzureMonitor&&(s.azureMonitor=Object.assign({},s.azureMonitor,{resourceGroup:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})),o(s)}),[r,o]),c=(0,a.useCallback)((e=>{e&&o(Object.assign({},r,{subscriptions:e.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""}))}))}),[r,o]),u=(0,a.useMemo)((()=>[...s,t]),[s,t]);return i?(0,V.jsx)(te,{label:"Subscriptions",children:(0,V.jsx)(E.NU,{isClearable:!0,value:h([...s,...t.options],r.subscriptions),inputId:"azure-monitor-subscriptions-field",onChange:c,options:u,width:38})}):(0,V.jsx)(te,{label:"Subscription",children:(0,V.jsx)(E.Ph,{value:r.subscription,inputId:"azure-monitor-subscriptions-field",onChange:n,options:u,width:38,allowCustomValue:!0})})},ie=e=>{var r,s;let{query:t,onQueryChange:o}=e;const i=(0,a.useCallback)((e=>{o(Object.assign({},t,{azureResourceGraph:Object.assign({},t.azureResourceGraph,{query:e})}))}),[o,t]);return(0,V.jsx)(K.p,{value:null!==(r=null===(s=t.azureResourceGraph)||void 0===s?void 0:s.query)&&void 0!==r?r:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:i,onSave:i})},ae="arg-subscriptions";function ne(e,r,s){let t=r||[];0===t.length&&s&&(t=[s]),0===t.length&&e.length&&(t=[e[0]]);const o=(0,p.intersection)(t,e);return e.length&&t.length>o.length&&(t=o.length>0?o:[e[0]]),t}const ce=e=>{let{query:r,datasource:s,subscriptionId:t,variableOptionGroup:o,onChange:i,setError:n}=e;const[c,u]=(0,a.useState)([]);return(0,a.useMemo)((()=>{s.getSubscriptions().then((e=>{const s=e.map((e=>({label:e.text,value:e.value,description:e.value})));u(s),n(ae,void 0),i(Object.assign({},r,{subscriptions:ne(s.map((e=>e.value)),r.subscriptions,r.subscription)}))})).catch((e=>n(ae,e)))}),[s]),(0,V.jsxs)("span",{"data-testid":"azure-monitor-arg-query-editor-with-experimental-ui",children:[(0,V.jsx)(ee.EditorRows,{children:(0,V.jsx)(ee.EditorRow,{children:(0,V.jsx)(ee.EditorFieldGroup,{children:(0,V.jsx)(oe,{multiSelect:!0,subscriptions:c,query:r,datasource:s,subscriptionId:t,variableOptionGroup:o,onQueryChange:i,setError:n})})})}),(0,V.jsx)(ie,{query:r,datasource:s,subscriptionId:t,variableOptionGroup:o,onQueryChange:i,setError:n})]})};var ue=s(27549),le=s(9617),pe=s(59385),me=s(24085),de=s(31423),fe=s(95967),ge=s(40882);const he=e=>{const r=(0,le.l4)(),s=ve(r,e);return(0,V.jsx)("span",{className:(0,ue.cx)(s.wrapper)})};he.defaultProps={v:0,h:0,layout:"block"};const ve=(0,ge.B)(((e,r)=>{var s,t;return{wrapper:(0,ue.css)([{paddingRight:e.spacing(null!==(s=r.h)&&void 0!==s?s:0),paddingBottom:e.spacing(null!==(t=r.v)&&void 0!==t?t:0)},"inline"===r.layout&&{display:"inline-block"},"block"===r.layout&&{display:"block"}])}}));var be,ye,we=s(11436),ke=s(4546),Se=s(9442),Ne=s(1652);const je=e=>{var r,s,t,o;let{resource:i,onChange:n}=e;const[c,u]=(0,a.useState)(!!i&&JSON.stringify(i).includes("$"));return(0,V.jsx)("div",{children:(0,V.jsxs)(we.U,{collapsible:!0,label:"Advanced",isOpen:c,onToggle:()=>u(!c),children:["string"==typeof i?(0,V.jsxs)(V.Fragment,{children:[" ",be||(be=(0,V.jsx)(ke._,{htmlFor:"input-advanced-resource-picker",children:(0,V.jsxs)("h6",{children:["Resource URI"," ",(0,V.jsx)(Se.u,{content:(0,V.jsxs)(V.Fragment,{children:["Manually edit the"," ",(0,V.jsxs)("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank",children:["resource uri."," "]}),"Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"]}),placement:"right",interactive:!0,children:(0,V.jsx)(me.J,{name:"info-circle"})})]})})),(0,V.jsx)(Ne.I,{id:"input-advanced-resource-picker",value:i,onChange:e=>n(e.currentTarget.value),placeholder:"ex: /subscriptions/$subId"})]}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(re._,{label:"Subscription",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-subscription",labelWidth:15,children:(0,V.jsx)(Ne.I,{id:"input-advanced-resource-picker-subscription",value:null!==(r=null==i?void 0:i.subscription)&&void 0!==r?r:"",onChange:e=>n(Object.assign({},i,{subscription:e.currentTarget.value})),placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeee"})}),(0,V.jsx)(re._,{label:"Resource Group",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-resourceGroup",labelWidth:15,children:(0,V.jsx)(Ne.I,{id:"input-advanced-resource-picker-resourceGroup",value:null!==(s=null==i?void 0:i.resourceGroup)&&void 0!==s?s:"",onChange:e=>n(Object.assign({},i,{resourceGroup:e.currentTarget.value})),placeholder:"resource-group"})}),(0,V.jsx)(re._,{label:"Namespace",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-metricNamespace",labelWidth:15,children:(0,V.jsx)(Ne.I,{id:"input-advanced-resource-picker-metricNamespace",value:null!==(t=null==i?void 0:i.metricNamespace)&&void 0!==t?t:"",onChange:e=>n(Object.assign({},i,{metricNamespace:e.currentTarget.value})),placeholder:"Microsoft.Insights/metricNamespaces"})}),(0,V.jsx)(re._,{label:"Resource Name",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-resourceName",labelWidth:15,children:(0,V.jsx)(Ne.I,{id:"input-advanced-resource-picker-resourceName",value:null!==(o=null==i?void 0:i.resourceName)&&void 0!==o?o:"",onChange:e=>n(Object.assign({},i,{resourceName:e.currentTarget.value})),placeholder:"name"})})]}),ye||(ye=(0,V.jsx)(he,{v:2}))]})})};var ze=s(46900),xe=s(85965),Ae=s(95922);let Ce;var Ge,Me,Ie,Re;!function(e){e.Subscription="Subscription",e.ResourceGroup="ResourceGroup",e.Resource="Resource",e.VariableGroup="TemplateVariableGroup",e.Variable="TemplateVariable"}(Ce||(Ce={}));const Te=e=>{let{isOpen:r,entry:{type:s}}=e;switch(s){case Ce.Subscription:return Ge||(Ge=(0,V.jsx)(me.J,{name:"layer-group"}));case Ce.ResourceGroup:return(0,V.jsx)(me.J,{name:r?"folder-open":"folder"});case Ce.Resource:return Me||(Me=(0,V.jsx)(me.J,{name:"cube"}));case Ce.VariableGroup:return Ie||(Ie=(0,V.jsx)(me.J,{name:"x"}));case Ce.Variable:return Re||(Re=(0,V.jsx)(me.J,{name:"x"}));default:return null}},Le=e=>({table:(0,ue.css)({width:"100%",tableLayout:"fixed"}),tableScroller:(0,ue.css)({maxHeight:"50vh",overflow:"auto"}),header:(0,ue.css)({background:e.colors.background.secondary}),row:(0,ue.css)({borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-of-type":{borderBottomColor:e.colors.border.medium}}),disabledRow:(0,ue.css)({opacity:.5}),cell:(0,ue.css)({padding:e.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:e.spacing(1,1,1,2)}}),collapseButton:(0,ue.css)({margin:0}),loadingCell:(0,ue.css)({textAlign:"center"}),spinner:(0,ue.css)({marginBottom:0}),nestedEntry:(0,ue.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,ue.css)({margin:e.spacing(0,1,0,0)}),truncated:(0,ue.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),resourceField:(0,ue.css)({maxWidth:e.spacing(36),overflow:"hidden"}),resourceFieldButton:(0,ue.css)({padding:"7px",textAlign:"left"}),nestedRowCheckbox:(0,ue.css)({zIndex:0}),selectionFooter:(0,ue.css)({position:"sticky",bottom:0,background:e.colors.background.primary,paddingTop:e.spacing(2)}),loadingWrapper:(0,ue.css)({textAlign:"center",paddingTop:e.spacing(2),paddingBottom:e.spacing(2),color:e.colors.text.secondary}),resultLimit:(0,ue.css)({margin:"4px 0",fontStyle:"italic"}),modal:(0,ue.css)({width:e.breakpoints.values.lg})});var Oe,qe,De,Pe;const Fe=e=>{let{entry:r,isSelected:s,isDisabled:t,isOpen:o,isSelectable:i,level:n,scrollIntoView:c,onToggleCollapse:u,onSelectedChange:l}=e;const p=(0,le.l4)(),m=(0,le.wW)(Le),d=!!r.children,f=(0,a.useCallback)((()=>{u(r)}),[u,r]),g=(0,a.useCallback)((e=>{const s=e.target.checked;l(r,s)}),[r,l]),h=`${c?"table":"summary"}_checkbox_${r.uri}`;return(0,a.useEffect)((()=>{var e;s&&c&&(null===(e=document.getElementById(h))||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}))}),[]),(0,V.jsxs)("div",{className:m.nestedEntry,style:{marginLeft:n*(3*p.spacing.gridSize)},children:[d?(0,V.jsx)(xe.h,{className:m.collapseButton,name:o?"angle-down":"angle-right","aria-label":o?`Collapse ${r.name}`:`Expand ${r.name}`,onClick:f,id:r.id}):Oe||(Oe=(0,V.jsx)(he,{layout:"inline",h:2})),qe||(qe=(0,V.jsx)(he,{layout:"inline",h:2})),i&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Ae.X,{id:h,onChange:g,disabled:t,value:s,className:m.nestedRowCheckbox}),De||(De=(0,V.jsx)(he,{layout:"inline",h:2}))]}),(0,V.jsx)(Te,{entry:r,isOpen:o}),Pe||(Pe=(0,V.jsx)(he,{layout:"inline",h:1})),(0,V.jsx)("label",{htmlFor:h,className:(0,ue.cx)(m.entryContentItem,m.truncated),children:r.name})]})};var Ee=s(28953);class Qe{static buildResourceUri(e,r){const s=[],{subscription:t,resourceGroup:o,metricNamespace:i,resourceName:a}=r;if(t&&(s.push("/subscriptions",t),o&&(s.push("resourceGroups",o),i&&a))){const r=e.replace(i),t=i.split("/"),o=e.replace(a),n=a.split("/"),c=t.shift();if(c&&s.push("providers",c),r.toLowerCase().startsWith("microsoft.storage/storageaccounts/")&&!o.endsWith("default")&&n.push("default"),n.length>t.length){const e=n.shift();e&&s.push(e)}for(const e in t)s.push(t[e]),s.push(n[e])}return s.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(e,r,s,t,o){let i;if("resourceUri"in s)i=s.resourceUri;else{const{subscription:e,resourceGroup:r,metricNamespace:t,resourceName:a}=s;i=Qe.buildResourceUri(o,{subscription:e,resourceGroup:r,metricNamespace:t,resourceName:a})}return`${e}${i}/providers/microsoft.insights/metricNamespaces?api-version=${r}${t?"&region=global":""}`}static buildAzureMonitorGetMetricNamesUrl(e,r,s,t){let o;const{customNamespace:i}=s;if("resourceUri"in s)o=s.resourceUri;else{const{subscription:e,resourceGroup:r,metricNamespace:i,resourceName:a}=s;o=Qe.buildResourceUri(t,{subscription:e,resourceGroup:r,metricNamespace:i,resourceName:a})}let a=`${e}${o}/providers/microsoft.insights/metricdefinitions?api-version=${r}`;return i&&(a+=`&metricnamespace=${encodeURIComponent(i)}`),a}}const Ve=/\/subscriptions\/(?<subscription>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers\/(?<metricNamespaceAndResource>.+))?)?/;function $e(e){var r;const s=Ve.exec(e),t=null!==(r=null==s?void 0:s.groups)&&void 0!==r?r:{},{subscription:o,resourceGroup:i,metricNamespaceAndResource:a}=t,{metricNamespace:n,resourceName:c}=function(e){if(!e)return{};const r=e.split("/"),s=r.splice(0,2),t=r.splice(0,1);for(;r.length;){const e=r.shift();r.length%2==0?t.push(e):s.push(e)}return{metricNamespace:s.join("/"),resourceName:t.join("/")}}(a);return{subscription:o,resourceGroup:i,metricNamespace:n,resourceName:c}}function We(e){return"string"==typeof e?$e(e):e}function Ue(e){return!!e.match(/^[A-Z0-9]+/i)}function Xe(e,r){var s,t,o,i,a,n;const c=We(r),u=We(e);return(null==u?void 0:u.subscription)===(null==c?void 0:c.subscription)&&(null==u||null===(s=u.resourceGroup)||void 0===s?void 0:s.toLowerCase())===(null==c||null===(t=c.resourceGroup)||void 0===t?void 0:t.toLowerCase())&&(null==u||null===(o=u.metricNamespace)||void 0===o?void 0:o.toLowerCase().split("/")[0])===(null==c||null===(i=c.metricNamespace)||void 0===i?void 0:i.toLowerCase().split("/")[0])&&(null==u||null===(a=u.resourceName)||void 0===a?void 0:a.split("/")[0])===(null==c||null===(n=c.resourceName)||void 0===n?void 0:n.split("/")[0])}function _e(e,r){for(const s of e){if(Xe(s.uri,r))return s;if(s.children){const e=_e(s.children,r);if(e)return e}}}function Be(e,r,s){return(0,Ee.ZP)(e,(e=>{const t=_e(e,r);t&&(t.children=s)}))}const Je=e=>{var r;let{row:s,selectedRows:t,level:o,requestNestedRows:i,onRowSelectedChange:n,selectableEntryTypes:c,scrollIntoView:u}=e;const l=(0,le.wW)(Le),[p,m]=(0,a.useState)("closed"),d=!!t.find((e=>e.uri===s.uri)),f=t.length>0&&!d,g="open"===p;return(0,a.useEffect)((()=>{var e;const r=t[0];r&&!!_e(null!==(e=s.children)&&void 0!==e?e:[],r.uri)&&m("open")}),[t,s]),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("tr",{className:(0,ue.cx)(l.row,f&&l.disabledRow),children:[(0,V.jsx)("td",{className:l.cell,children:(0,V.jsx)(Fe,{level:o,isSelected:d,isDisabled:f,isOpen:g,entry:s,onToggleCollapse:async()=>{"open"!==p?(m("loading"),i(s).then((()=>m("open"))).catch((()=>m("closed")))):m("closed")},onSelectedChange:n,isSelectable:c.some((e=>e===s.type)),scrollIntoView:u})}),(0,V.jsx)("td",{className:l.cell,children:s.typeLabel}),(0,V.jsx)("td",{className:l.cell,children:null!==(r=s.location)&&void 0!==r?r:"-"})]},s.id),g&&s.children&&Object.keys(s.children).length>0&&s.children.map((e=>(0,V.jsx)(Je,{row:e,selectedRows:t,level:o+1,requestNestedRows:i,onRowSelectedChange:n,selectableEntryTypes:c,scrollIntoView:u},e.uri))),(0,V.jsx)(ze.n,{visible:"loading"===p,children:(0,V.jsx)("tr",{children:(0,V.jsx)("td",{className:(0,ue.cx)(l.cell,l.loadingCell),colSpan:3,children:(0,V.jsx)(fe.u,{text:"Loading...",className:l.spinner})})})})]})},He=Je;var Ke;const Ze=e=>{let{searchFn:r}=e;const[s,t]=(0,a.useState)(""),o=(0,a.useMemo)((()=>(0,p.debounce)(r,600)),[r]);return(0,a.useEffect)((()=>()=>{o.cancel()}),[o]),(0,V.jsx)(Ne.I,{"aria-label":"resource search",prefix:Ke||(Ke=(0,V.jsx)(me.J,{name:"search"})),value:s,onChange:e=>{const r=e.currentTarget.value;t(r),o(r)},placeholder:"search for a resource"})};var Ye,er,rr,sr,tr,or,ir;const ar=e=>{let{resourcePickerData:r,resource:s,onApply:t,onCancel:o,selectableEntryTypes:i,queryType:n}=e;const u=(0,le.wW)(Le),[p,m]=(0,a.useState)(!1),[d,f]=(0,a.useState)([]),[g,h]=(0,a.useState)([]),[v,b]=(0,a.useState)(s),[y,w]=(0,a.useState)(void 0),[k,S]=(0,a.useState)(!1);(0,a.useEffect)((()=>{b(s)}),[s]);const N=(0,a.useCallback)((async()=>{if(!p){try{m(!0);const e=await r.fetchInitialRows(n,We(null!=v?v:{}));f(e)}catch(e){w(Z(e))}m(!1)}}),[v,p,r,n]);(0,de.Z)((()=>{N()})),(0,a.useEffect)((()=>{v||h([]);const e=v&&_e(d,function(e){return e?"string"==typeof e?e:Qe.buildResourceUri((0,c.J)(),e):""}(v));return h(e?[Object.assign({},e,{children:void 0})]:[])}),[v,d]);const j=(0,a.useCallback)((async e=>{var s;if(w(void 0),null===(s=e.children)||void 0===s||!s.length)try{const s=await r.fetchAndAppendNestedRow(d,e,n);f(s)}catch(e){throw w(Z(e)),e}}),[r,d,n]),z="string"==typeof s,x=(0,a.useCallback)(((e,r)=>{b(r?z?e.uri:We(e.uri):z?"":{})}),[z]),A=(0,a.useCallback)((()=>{v&&t(z?v:We(v))}),[z,v,t]),C=(0,a.useCallback)((async e=>{if(w(void 0),S(!1),e){try{m(!0);const s=await r.search(e,n);f(s),s.length>=r.resultLimit&&S(!0)}catch(e){w(Z(e))}m(!1)}else N()}),[N,r,n]);return(0,V.jsxs)("div",{children:[(0,V.jsx)(Ze,{searchFn:C}),k?(0,V.jsxs)("p",{className:u.resultLimit,children:["Showing first ",r.resultLimit," results"]}):Ye||(Ye=(0,V.jsx)(he,{v:2})),(0,V.jsx)("table",{className:u.table,children:(0,V.jsx)("thead",{children:(0,V.jsxs)("tr",{className:(0,ue.cx)(u.row,u.header),children:[(0,V.jsx)("td",{className:u.cell,children:"Scope"}),(0,V.jsx)("td",{className:u.cell,children:"Type"}),(0,V.jsx)("td",{className:u.cell,children:"Location"})]})})}),(0,V.jsx)("div",{className:u.tableScroller,children:(0,V.jsx)("table",{className:u.table,children:(0,V.jsxs)("tbody",{children:[p&&(0,V.jsx)("tr",{className:(0,ue.cx)(u.row),children:(0,V.jsx)("td",{className:u.cell,children:er||(er=(0,V.jsx)(fe.u,{text:"Loading..."}))})}),!p&&0===d.length&&(0,V.jsx)("tr",{className:(0,ue.cx)(u.row),children:(0,V.jsx)("td",{className:u.cell,"aria-live":"polite",children:"No resources found"})}),!p&&d.map((e=>(0,V.jsx)(He,{row:e,selectedRows:g,level:0,requestNestedRows:j,onRowSelectedChange:x,selectableEntryTypes:i,scrollIntoView:!0},e.uri)))]})})}),(0,V.jsxs)("div",{className:u.selectionFooter,children:[g.length>0&&(0,V.jsxs)(V.Fragment,{children:[rr||(rr=(0,V.jsx)("h5",{children:"Selection"})),(0,V.jsx)("div",{className:u.tableScroller,children:(0,V.jsx)("table",{className:u.table,children:(0,V.jsx)("tbody",{children:g.map((e=>(0,V.jsx)(He,{row:e,selectedRows:g,level:0,requestNestedRows:j,onRowSelectedChange:x,selectableEntryTypes:i},e.uri)))})})}),sr||(sr=(0,V.jsx)(he,{v:2}))]}),(0,V.jsx)(je,{resource:v,onChange:e=>b(e)}),tr||(tr=(0,V.jsx)(he,{v:2})),(0,V.jsx)(Q.zx,{disabled:!!y,onClick:A,children:"Apply"}),or||(or=(0,V.jsx)(he,{layout:"inline",h:1})),(0,V.jsx)(Q.zx,{onClick:o,variant:"secondary",children:"Cancel"})]}),y&&(0,V.jsxs)(V.Fragment,{children:[ir||(ir=(0,V.jsx)(he,{v:2})),(0,V.jsx)(l.b,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor",children:y})]})]})};var nr,cr,ur;const lr=e=>{let{resource:r,datasource:s}=e;const[t,o]=(0,a.useState)(We(null!=r?r:""));return(0,a.useEffect)((()=>{r&&We(r)?"string"==typeof r?s.resourcePickerData.getResourceURIDisplayProperties(r).then(o):o(r):o({})}),[s.resourcePickerData,r]),!r||"object"==typeof r&&!r.subscription?(0,V.jsx)(V.Fragment,{children:"Select a resource"}):t?(0,V.jsx)(pr,{resource:t}):(0,V.jsx)(V.Fragment,{children:r})},pr=e=>{let{resource:r}=e;const s=(0,le.wW)(Le);return r.resourceName?(0,V.jsxs)("span",{className:(0,ue.cx)(s.truncated,s.resourceField),children:[nr||(nr=(0,V.jsx)(me.J,{name:"cube"}))," ",r.resourceName.split("/")[0]]}):r.resourceGroup?(0,V.jsxs)("span",{children:[cr||(cr=(0,V.jsx)(me.J,{name:"folder"}))," ",r.resourceGroup]}):(0,V.jsxs)("span",{children:[ur||(ur=(0,V.jsx)(me.J,{name:"layer-group"}))," ",r.subscription]})},mr=e=>{let{query:r,datasource:s,onQueryChange:t,selectableEntryTypes:o,queryType:i,resource:n,inlineField:c,labelWidth:u}=e;const l=(0,le.wW)(Le),[p,m]=(0,a.useState)(!1),d=(0,a.useCallback)((()=>{m(!0)}),[]),f=(0,a.useCallback)((()=>{m(!1)}),[]),g=(0,a.useCallback)((e=>{t(function(e,r){var s;return"string"==typeof r?Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resource:r})}):Object.assign({},e,{subscription:null==r?void 0:r.subscription,azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:null==r?void 0:r.resourceGroup,metricNamespace:null==r||null===(s=r.metricNamespace)||void 0===s?void 0:s.toLocaleLowerCase(),resourceName:null==r?void 0:r.resourceName,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(r,e)),f()}),[f,t,r]);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(pe.u,{className:l.modal,title:"Select a resource",isOpen:p,onDismiss:f,trapFocus:!1,children:(0,V.jsx)(ar,{resourcePickerData:s.resourcePickerData,resource:n,onApply:g,onCancel:f,selectableEntryTypes:o,queryType:i})}),(0,V.jsx)(te,{label:"Resource",inlineField:c,labelWidth:u,children:(0,V.jsx)(Q.zx,{className:l.resourceFieldButton,variant:"secondary",onClick:d,type:"button",children:(0,V.jsx)(lr,{resource:n,datasource:s})})})]})};function dr(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{query:r})})}const fr=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],gr=e=>{var r;let{query:s,variableOptionGroup:t,onQueryChange:o}=e;const i=(0,a.useMemo)((()=>[...fr,t]),[t]),n=(0,a.useCallback)((e=>{const{value:r}=e;if(!r)return;const t=function(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resultFormat:r})})}(s,r);o(t)}),[o,s]);return(0,V.jsx)(te,{label:"Format as",children:(0,V.jsx)(E.Ph,{inputId:"azure-monitor-logs-workspaces-field",value:null===(r=s.azureLogAnalytics)||void 0===r?void 0:r.resultFormat,onChange:n,options:i,width:38})})};function hr(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}class vr{constructor(){hr(this,"resolve",void 0),hr(this,"reject",void 0),hr(this,"promise",void 0),this.resolve=void 0,this.reject=void 0,this.promise=new Promise(((e,r)=>{this.resolve=e,this.reject=r})),Object.freeze(this)}}const br=e=>{var r,s,t;let{query:o,datasource:i,onQueryChange:n}=e;const c=(0,a.useRef)();(0,a.useEffect)((()=>{var e;if(null===(e=o.azureLogAnalytics)||void 0===e||!e.resource)return;const r=[i.azureLogAnalyticsDatasource.getKustoSchema(o.azureLogAnalytics.resource),(c.current||(c.current=new vr),c.current.promise)];Promise.all(r).then((e=>{let[r,{monaco:s,editor:t}]=e;s.languages.kusto.getKustoWorker().then((e=>{const r=t.getModel();return r&&e(r.uri)})).then((e=>{null==e||e.setSchema(r,"https://help.kusto.windows.net","Samples")}))}))}),[i.azureLogAnalyticsDatasource,null===(r=o.azureLogAnalytics)||void 0===r?void 0:r.resource]);const u=(0,a.useCallback)(((e,r)=>{var s,t;null===(s=c.current)||void 0===s||null===(t=s.resolve)||void 0===t||t.call(s,{editor:e,monaco:r})}),[]),l=(0,a.useCallback)((e=>{n(dr(o,e))}),[n,o]);return(0,V.jsx)(K.p,{value:null!==(s=null===(t=o.azureLogAnalytics)||void 0===t?void 0:t.query)&&void 0!==s?s:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:l,onSave:l,onEditorDidMount:u})};function yr(e,r,s){const[t,o]=(0,a.useState)();return(0,a.useEffect)((()=>{(async function(e,r,s){var t;if(void 0!==(null===(t=r.azureLogAnalytics)||void 0===t?void 0:t.workspace)&&!r.azureLogAnalytics.resource){let t;t=Ue(r.azureLogAnalytics.workspace)?await e.resourcePickerData.getResourceURIFromWorkspace(r.azureLogAnalytics.workspace):r.azureLogAnalytics.workspace;const o=Object.assign({},r,{azureLogAnalytics:Object.assign({},r.azureLogAnalytics,{resource:t,workspace:void 0})});delete o.azureLogAnalytics.workspace,s(o)}})(e,r,s).catch((e=>o({title:"Unable to migrate workspace as a resource",message:e.message})))}),[e,r,s]),t}const wr=e=>{var r,s;let{query:t,datasource:o,subscriptionId:i,variableOptionGroup:a,onChange:n,setError:c,hideFormatAs:u}=e;const p=yr(o,t,n);return(0,V.jsx)("span",{"data-testid":"azure-monitor-logs-query-editor-with-experimental-ui",children:(0,V.jsxs)(ee.EditorRows,{children:[(0,V.jsx)(ee.EditorRow,{children:(0,V.jsx)(ee.EditorFieldGroup,{children:(0,V.jsx)(mr,{query:t,datasource:o,inlineField:!0,labelWidth:10,subscriptionId:i,variableOptionGroup:a,onQueryChange:n,setError:c,selectableEntryTypes:[Ce.Subscription,Ce.ResourceGroup,Ce.Resource,Ce.Variable],resource:null!==(r=null===(s=t.azureLogAnalytics)||void 0===s?void 0:s.resource)&&void 0!==r?r:"",queryType:"logs"})})}),(0,V.jsx)(br,{query:t,datasource:o,subscriptionId:i,variableOptionGroup:a,onQueryChange:n,setError:c}),(0,V.jsx)(ee.EditorRow,{children:(0,V.jsxs)(ee.EditorFieldGroup,{children:[!u&&(0,V.jsx)(gr,{query:t,datasource:o,subscriptionId:i,variableOptionGroup:a,onQueryChange:n,setError:c}),p&&(0,V.jsx)(l.b,{title:p.title,children:p.message})]})})]})})};function kr(e,r){var s;if((null===(s=e.azureMonitor)||void 0===s?void 0:s.customNamespace)===r)return e;const t=null!=r&&r.toLowerCase().startsWith("microsoft.storage/storageaccounts/")?"":r;return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{customNamespace:t,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function Sr(e,r){var s;return(null===(s=e.azureMonitor)||void 0===s?void 0:s.timeGrain)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{timeGrain:r})})}function Nr(e,r){var s;return(null===(s=e.azureMonitor)||void 0===s?void 0:s.dimensionFilters)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{dimensionFilters:r})})}const jr=e=>{var r;let{query:s,variableOptionGroup:t,onQueryChange:o,aggregationOptions:i,isLoading:n}=e;const c=(0,a.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var s;return(null===(s=e.azureMonitor)||void 0===s?void 0:s.aggregation)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r})})}(s,e.value);o(r)}),[o,s]),u=(0,a.useMemo)((()=>[...i,t]),[i,t]);return(0,V.jsx)(te,{label:"Aggregation",children:(0,V.jsx)(E.Ph,{inputId:"azure-monitor-metrics-aggregation-field",value:(null===(r=s.azureMonitor)||void 0===r?void 0:r.aggregation)||null,onChange:c,options:u,isLoading:n})})};var zr=s(25049);const xr=e=>{var r;let{data:s,query:t,dimensionOptions:o,onQueryChange:i}=e;const n=(0,a.useMemo)((()=>{var e,r;return null!==(e=null===(r=t.azureMonitor)||void 0===r?void 0:r.dimensionFilters)&&void 0!==e?e:[]}),[null===(r=t.azureMonitor)||void 0===r?void 0:r.dimensionFilters]),c=((e,r)=>{const[s,t]=(0,a.useState)({});return(0,a.useEffect)((()=>{var s;let o={};if(null!=e&&null!==(s=e.series)&&void 0!==s&&s.length){const s=e.series.flat().filter((e=>e.refId===r.refId)).flatMap((e=>e.fields)).map((e=>e.labels)).flat().filter((e=>null!=e));for(const e of s)for(const[r,s]of Object.entries(e))o[r]?o[r].add(s):o[r]=new Set([s])}t((e=>{const r={},s=Object.keys(o);if(0===s.length)return e;for(const t of s)e[t]&&o[t].size<e[t].size?r[t]=e[t]:r[t]=o[t];return r}))}),[null==e?void 0:e.series,r.refId]),s})(s,t),u=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],l=(0,a.useMemo)((()=>{let e=o;return n.length&&(e=o.filter((e=>!n.some((r=>r.dimension===e.value))))),e}),[n,o]),p=(e,r,s,t)=>{r[e]=s,t(r)},m=(e,r)=>{var s;const t=Array.from(null!==(s=c[r.toLowerCase()])&&void 0!==s?s:[]);return t.find((r=>r===e))?t.map((e=>({value:e,label:e}))):[...t,...e&&"*"!==e?[e]:[]].map((e=>({value:e,label:e})))},d=(e,r)=>{const s=m(void 0,r);if(e)for(const r of e)s.find((e=>e.value===r))||s.push({value:r,label:r});return s};return(0,V.jsx)(te,{label:"Dimensions",children:(0,V.jsx)(ee.EditorList,{items:n,onChange:e=>{const r=e.map((e=>{var r,s,t;return{dimension:null!==(r=e.dimension)&&void 0!==r?r:"",operator:null!==(s=e.operator)&&void 0!==s?s:"eq",filters:null!==(t=e.filters)&&void 0!==t?t:[]}}));i(Nr(t,r))},renderItem:(e,r,s)=>{var t,i,a,n;return(0,V.jsxs)(zr.Lh,{spacing:"none",children:[(0,V.jsx)(E.Ph,{menuShouldPortal:!0,placeholder:"Field",value:e.dimension,options:(n=e.dimension||"",l.concat(o.filter((e=>e.value===n)))),onChange:s=>{var t;return p("dimension",e,null!==(t=s.value)&&void 0!==t?t:"",r)}}),(0,V.jsx)(E.Ph,{menuShouldPortal:!0,placeholder:"Operation",value:e.operator,options:(a=e.operator||"eq",u.find((e=>e.value===a))?u:[...u,...a?[{label:a,value:a}]:[]]),onChange:s=>{var t;return p("operator",e,null!==(t=s.value)&&void 0!==t?t:"",r)},allowCustomValue:!0}),"eq"===e.operator||"ne"===e.operator?(0,V.jsx)(E.NU,{menuShouldPortal:!0,placeholder:"Select value(s)",value:e.filters,options:d(e.filters,null!==(t=e.dimension)&&void 0!==t?t:""),onChange:s=>p("filters",e,s.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""})),r),"aria-label":"dimension-labels-select",allowCustomValue:!0}):(0,V.jsx)(E.Ph,{menuShouldPortal:!0,placeholder:"Select value",value:e.filters?e.filters[0]:"",allowCustomValue:!0,options:m(e.filters?e.filters[0]:"",null!==(i=e.dimension)&&void 0!==i?i:""),onChange:s=>{var t;return p("filters",e,[null!==(t=null==s?void 0:s.value)&&void 0!==t?t:""],r)},isClearable:!0}),(0,V.jsx)(ee.AccessoryButton,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:s,type:"button"})]})}})})},Ar=e=>{var r,s;let{onQueryChange:t,query:o}=e;const[i,n]=(0,a.useState)(null!==(r=null===(s=o.azureMonitor)||void 0===s?void 0:s.alias)&&void 0!==r?r:""),c=(0,a.useCallback)((e=>{e.target instanceof HTMLInputElement&&n(e.target.value)}),[]),u=(0,a.useCallback)((()=>{const e=function(e,r){var s;return(null===(s=e.azureMonitor)||void 0===s?void 0:s.alias)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{alias:r})})}(o,i);t(e)}),[t,o,i]);return(0,V.jsx)(te,{label:"Legend format",children:(0,V.jsx)(Ne.I,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:i,onChange:c,onBlur:u,width:38})})},Cr=e=>{var r,s;let{metricNames:t,query:o,variableOptionGroup:i,onQueryChange:n}=e;const c=(0,a.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var s;return(null===(s=e.azureMonitor)||void 0===s?void 0:s.metricName)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricName:r,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(o,e.value);n(r)}),[n,o]),u=(0,a.useMemo)((()=>[...t,i]),[t,i]);return(0,V.jsx)(te,{label:"Metric",children:(0,V.jsx)(E.Ph,{inputId:"azure-monitor-metrics-metric-field",value:null!==(r=null===(s=o.azureMonitor)||void 0===s?void 0:s.metricName)&&void 0!==r?r:null,onChange:c,options:u,allowCustomValue:!0})})},Gr=e=>{var r,s;let{metricNamespaces:t,query:o,variableOptionGroup:i,onQueryChange:n}=e;const c=(0,a.useCallback)((e=>{if(!e.value)return;const r=kr(o,e.value);n(r)}),[n,o]),u=(0,a.useMemo)((()=>[...t,i]),[t,i]),l=t.map((e=>e.value.toLowerCase())).concat(i.options.map((e=>e.value))),p=(null===(r=o.azureMonitor)||void 0===r?void 0:r.customNamespace)||(null===(s=o.azureMonitor)||void 0===s?void 0:s.metricNamespace);return p&&!l.includes(p.toLowerCase())&&u.push({label:p,value:p}),(0,V.jsx)(te,{label:"Metric namespace",children:(0,V.jsx)(E.Ph,{inputId:"azure-monitor-metrics-metric-namespace-field",value:p||null,onChange:c,options:u,allowCustomValue:!0})})},Mr=e=>{var r;let{query:s,timeGrainOptions:t,variableOptionGroup:o,onQueryChange:i}=e;const n=(0,a.useCallback)((e=>{if(!e.value)return;const r=Sr(s,e.value);i(r)}),[i,s]),c=(0,a.useMemo)((()=>{const e=f.findClosestTimeGrain("1m",t.map((e=>f.createKbnUnitFromISO8601Duration(e.value)))||["1m","5m","15m","30m","1h","6h","12h","1d"]);return[...t.map((r=>"auto"===r.value?Object.assign({},r,{description:e}):r)),o]}),[t,o]);return(0,V.jsx)(te,{label:"Time grain",children:(0,V.jsx)(E.Ph,{inputId:"azure-monitor-metrics-time-grain-field",value:null===(r=s.azureMonitor)||void 0===r?void 0:r.timeGrain,onChange:n,options:c})})},Ir=e=>{var r,s;let{onQueryChange:t,query:o}=e;const[i,n]=(0,a.useState)(null!==(r=null===(s=o.azureMonitor)||void 0===s?void 0:s.top)&&void 0!==r?r:""),c=(0,a.useCallback)((e=>{e.target instanceof HTMLInputElement&&n(e.target.value)}),[]),u=(0,a.useCallback)((()=>{const e=function(e,r){var s;return(null===(s=e.azureMonitor)||void 0===s?void 0:s.top)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{top:r})})}(o,i);t(e)}),[t,o,i]);return(0,V.jsx)(te,{label:"Top",children:(0,V.jsx)(Ne.I,{id:"azure-monitor-metrics-top-field",value:i,onChange:c,onBlur:u,width:16})})};function Rr(e,r,s){const[t]=(0,a.useState)((()=>Math.random())),[o,i]=(0,a.useState)(),n=(0,a.useMemo)((()=>null!=o?o:[]),[o]);return(0,a.useEffect)((()=>{e().then((e=>{i(e),r(t,void 0)})).catch((e=>{r(t,e)}))}),s),n}const Tr={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0};function Lr(e,r){const s=e.map(v);return r&&!s.find((e=>e.value===r.toLowerCase()))&&s.push({label:r,value:r}),s}const Or=e=>{var r,s,t,o,i,n;let{data:c,query:u,datasource:l,variableOptionGroup:p,onChange:m,setError:g}=e;const h=((e,r,s)=>{var t;const[o,i]=(0,a.useState)(Tr),{subscription:n}=e,{resourceGroup:c,resourceName:u,metricNamespace:l,metricName:p,aggregation:m,timeGrain:g,customNamespace:h}=null!==(t=e.azureMonitor)&&void 0!==t?t:{};return(0,a.useEffect)((()=>{n&&c&&u&&l&&p?r.azureMonitorDatasource.getMetricMetadata({subscription:n,resourceGroup:c,resourceName:u,metricNamespace:l,metricName:p,customNamespace:h}).then((e=>{var r;const s=(e.supportedAggTypes||[e.primaryAggType]).map((e=>({label:e,value:e})));i({aggOptions:s,timeGrains:e.supportedTimeGrains,dimensions:e.dimensions,isLoading:!1,supportedAggTypes:null!==(r=e.supportedAggTypes)&&void 0!==r?r:[],primaryAggType:e.primaryAggType})})):i(Tr)}),[r,n,c,u,l,p,h]),(0,a.useEffect)((()=>{const r=m||o.primaryAggType,t=g||"auto";r===m&&t===g||s(Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r,timeGrain:t,allowedTimeGrainsMs:o.timeGrains.filter((e=>"auto"!==e.value)).map((e=>d.intervalToMs(f.createKbnUnitFromISO8601Duration(e.value))))})}))}),[s,o,m,g,e]),o})(u,l,m),v=((e,r,s,t)=>{var o;const{subscription:i}=e,{metricNamespace:a,resourceGroup:n,resourceName:c}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return Rr((async()=>{if(!i||!n||!c)return;const t=Lr(await r.azureMonitorDatasource.getMetricNamespaces({subscription:i,metricNamespace:a,resourceGroup:n,resourceName:c},!1),a);return!a&&t.length&&s(kr(e,t[0].value)),t}),t,[i,a,n,c])})(u,l,m,g),b=((e,r,s,t)=>{var o;const{subscription:i}=e,{metricNamespace:a,metricName:n,resourceGroup:c,resourceName:u,customNamespace:l}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return Rr((async()=>{if(i&&a&&c&&u)return Lr(await r.azureMonitorDatasource.getMetricNames({subscription:i,resourceGroup:c,resourceName:u,metricNamespace:a,customNamespace:l}),n)}),t,[i,c,u,a,l])})(u,l,0,g),y={subscription:u.subscription,resourceGroup:null===(r=u.azureMonitor)||void 0===r?void 0:r.resourceGroup,metricNamespace:null===(s=u.azureMonitor)||void 0===s?void 0:s.metricNamespace,resourceName:null===(t=u.azureMonitor)||void 0===t?void 0:t.resourceName};return(0,V.jsx)("span",{"data-testid":"azure-monitor-metrics-query-editor-with-experimental-ui",children:(0,V.jsxs)(ee.EditorRows,{children:[(0,V.jsx)(ee.EditorRow,{children:(0,V.jsxs)(ee.EditorFieldGroup,{children:[(0,V.jsx)(mr,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g,selectableEntryTypes:[Ce.Resource],resource:y,queryType:"metrics"}),(0,V.jsx)(Gr,{metricNamespaces:v,query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g}),(0,V.jsx)(Cr,{metricNames:b,query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g}),(0,V.jsx)(jr,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g,aggregationOptions:null!==(o=null==h?void 0:h.aggOptions)&&void 0!==o?o:[],isLoading:h.isLoading}),(0,V.jsx)(Mr,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g,timeGrainOptions:null!==(i=null==h?void 0:h.timeGrains)&&void 0!==i?i:[]})]})}),(0,V.jsx)(ee.EditorRow,{children:(0,V.jsx)(ee.EditorFieldGroup,{children:(0,V.jsx)(xr,{data:c,query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g,dimensionOptions:null!==(n=null==h?void 0:h.dimensions)&&void 0!==n?n:[]})})}),(0,V.jsx)(ee.EditorRow,{children:(0,V.jsxs)(ee.EditorFieldGroup,{children:[(0,V.jsx)(Ir,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g}),(0,V.jsx)(Ar,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:m,setError:g})]})})]})})},qr=e=>{let{query:r,onQueryChange:s}=e;const t=[{value:N.AzureMonitor,label:"Metrics"},{value:N.LogAnalytics,label:"Logs"},{value:N.AzureResourceGraph,label:"Azure Resource Graph"}],o=(0,a.useCallback)((e=>{e.value&&s(Object.assign({},r,{queryType:e.value}))}),[s,r]);return(0,V.jsx)("span",{"data-testid":"azure-monitor-experimental-header",children:(0,V.jsx)(ee.EditorHeader,{children:(0,V.jsx)(ee.InlineSelect,{label:"Service",value:r.queryType,placeholder:"Service...",allowCustomValue:!0,options:t,onChange:o})})})};var Dr=s(10322),Pr=s.n(Dr);const Fr="select";function Er(e){let r=e;return r.queryType||(r=Object.assign({},r,{queryType:N.AzureMonitor})),r=function(e){var r,s,t,o;let i=e;null!==(r=i.azureLogAnalytics)&&void 0!==r&&null!==(s=r.query)&&void 0!==s&&s.match(/\$__from\s/gi)&&(i=dr(i,i.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() ")));null!==(t=i.azureLogAnalytics)&&void 0!==t&&null!==(o=t.query)&&void 0!==o&&o.match(/\$__to\s/gi)&&(i=dr(i,i.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() ")));return i}(r),r.queryType===N.AzureMonitor&&r.azureMonitor&&(r=function(e){var r;let s=e;if(null!==(r=s.azureMonitor)&&void 0!==r&&r.timeGrainUnit&&"auto"!==s.azureMonitor.timeGrain){var t,o;s=Sr(s,f.createISO8601Duration(null!==(t=s.azureMonitor.timeGrain)&&void 0!==t?t:"auto",s.azureMonitor.timeGrainUnit)),null===(o=s.azureMonitor)||void 0===o||delete o.timeGrainUnit}return s}(r),r=function(e){var r,s;if((!(null===(r=e.azureMonitor)||void 0===r?void 0:r.metricNamespace)||e.azureMonitor.metricNamespace===Fr)&&null!==(s=e.azureMonitor)&&void 0!==s&&s.metricDefinition)return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:e.azureMonitor.metricDefinition,metricDefinition:void 0})});return e}(r),r=function(e){var r;let s=e;const t=null===(r=s.azureMonitor)||void 0===r?void 0:r.dimension;var o;t&&"None"!==t&&(s=function(e){var r,s;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"eq",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=null!==(r=null===(s=e.azureMonitor)||void 0===s?void 0:s.dimensionFilters)&&void 0!==r?r:[];return Nr(e,[...a,{dimension:t,operator:o,filters:i}])}(s,t,"eq",[(null===(o=s.azureMonitor)||void 0===o?void 0:o.dimensionFilter)||""]));return s}(r),r=function(e){const r=e.azureMonitor;if(!r)return e;const s=[],t=r.dimensionFilters;if(t&&t.length>0&&(t.forEach((e=>{const r={dimension:e.dimension,operator:e.operator};if(!e.filters&&e.filter)s.push(Object.assign({},r,{filters:[e.filter]}));else{let t=!1;if(e.filters&&e.filter){for(const r of e.filters)if(e.filter===r){t=!0;break}t||"*"===e.filter||e.filters.push(e.filter),s.push(Object.assign({},r,{filters:e.filters}))}}})),s.length>0))return Object.assign({},e,{azureMonitor:Object.assign({},r,{dimensionFilters:s})});return e}(r),r=function(e){var r;if(null!==(r=e.azureMonitor)&&void 0!==r&&r.resourceUri&&!e.azureMonitor.resourceUri.startsWith("$")){const r=We(e.azureMonitor.resourceUri),s=(null==r?void 0:r.subscription)&&(null==r?void 0:r.resourceGroup)&&(null==r?void 0:r.resourceName);return Object.assign({},e,{subscription:null==r?void 0:r.subscription,azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:null==r?void 0:r.resourceGroup,metricNamespace:null==r?void 0:r.metricNamespace,resourceName:null==r?void 0:r.resourceName,resourceUri:s?void 0:e.azureMonitor.resourceUri})})}return e}(r)),r}const Qr={queryType:N.AzureMonitor},Vr=(e,r)=>{const s=(0,a.useMemo)((()=>(e=>{const r=Er((0,p.defaults)({},e,Qr));return Pr()(r,e)?e:r})(e)),[e]);return(0,a.useEffect)((()=>{s!==e&&r(s)}),[s,e,r]),s};var $r,Wr;const Ur=e=>{let{data:r,subscriptionId:s,query:t,datasource:o,variableOptionGroup:i,onChange:a,setError:n}=e;switch(t.queryType){case N.AzureMonitor:return(0,V.jsx)(Or,{data:r,query:t,datasource:o,onChange:a,variableOptionGroup:i,setError:n});case N.LogAnalytics:return(0,V.jsx)(wr,{subscriptionId:s,query:t,datasource:o,onChange:a,variableOptionGroup:i,setError:n});case N.AzureResourceGraph:return(0,V.jsx)(ce,{subscriptionId:s,query:t,datasource:o,onChange:a,variableOptionGroup:i,setError:n});default:const e=t.queryType;return(0,V.jsx)(l.b,{title:"Unknown query type",children:("Application Insights"===e||"Insights Analytics"===e)&&(0,V.jsxs)(V.Fragment,{children:[e," was deprecated in Grafana 9. See the"," ",Wr||(Wr=(0,V.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer",children:"deprecation notice"}))," ","to get more information about how to migrate your queries. This is the current query definition:",(0,V.jsx)(K.p,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(t,null,4)})]})})}},Xr=e=>{let{query:r,datasource:s,onChange:t,onRunQuery:o,data:i}=e;const[n,c]=Y(),u=(0,a.useMemo)((()=>(0,p.debounce)(o,500)),[o]),m=(0,a.useCallback)((e=>{t(e),u()}),[t,u]),d=Vr(r,m),f=d.subscription||s.azureMonitorDatasource.defaultSubscriptionId,g={label:"Template Variables",options:s.getVariables().map((e=>({label:e,value:e})))};return(0,V.jsxs)("div",{"data-testid":"azure-monitor-query-editor",children:[(0,V.jsx)(qr,{query:d,onQueryChange:m}),(0,V.jsx)(Ur,{data:i,subscriptionId:f,query:d,datasource:s,onChange:m,variableOptionGroup:g,setError:c}),n&&(0,V.jsxs)(V.Fragment,{children:[$r||($r=(0,V.jsx)(he,{v:2})),(0,V.jsx)(l.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:n})]})]})};var _r=s(13146),Br=s(71808),Jr=s(35778),Hr=s(5937),Kr=s(13924),Zr=s(7166),Yr=s(94396),es=s(71114),rs=s(91115);class ss{constructor(e,r,s){this.rawQueryString=e,this.options=r,this.defaultTimeField=s}generate(){let e=this.rawQueryString;const r=/\$__([_a-zA-Z0-9]+)\(([^()]*)\)/gi;e=e.replace(r,((e,r,s)=>"contains"===r?this.getMultiContains(s):e)),e=e.replace(/\$__escapeMulti\(('[^]*')\)/gi,((e,r)=>this.escape(r))),this.options&&(e=e.replace(r,((e,r,s)=>"timeFilter"===r?this.getTimeFilter(s,this.options):"timeFrom"===r?this.getFrom(this.options):"timeTo"===r?this.getUntil(this.options):e)),e=e.replace(/\$__interval/gi,this.options.interval));const s=e;e=encodeURIComponent(e);return{uriString:`query=${e}`,rawQuery:s}}getFrom(e){const r=e.range.from;return`datetime(${(0,rs.CQ)(r).startOf("minute").toISOString()})`}getUntil(e){var r;if("now"===(null===(r=e.rangeRaw)||void 0===r?void 0:r.to)){const e=Date.now();return`datetime(${(0,rs.CQ)(e).startOf("minute").toISOString()})`}{const r=e.range.to;return`datetime(${(0,rs.CQ)(r).startOf("minute").toISOString()})`}}getTimeFilter(e,r){var s;const t=e||this.defaultTimeField;return"now"===(null===(s=r.rangeRaw)||void 0===s?void 0:s.to)?`${t} >= ${this.getFrom(r)}`:`${t}  >= ${this.getFrom(r)} and ${t} <= ${this.getUntil(r)}`}getMultiContains(e){const r=e.indexOf(","),s=e.substring(0,r),t=e.substring(e.indexOf(",")+1);return t&&"all"===t.toLowerCase().trim()?"1 == 1":`${s.trim()} in (${t.trim()})`}escape(e){return e.substring(1,e.length-1).split("','").map((e=>`@'${e}'`)).join(", ")}}class ts{constructor(e){this.results=e}parseQueryResult(){let e=[],r=[];for(let s=0;s<this.results.length;s++){if(0===this.results[s].result.tables.length)continue;r=this.results[s].result.tables[0].columns;const t=this.results[s].result.tables[0].rows;e="time_series"===this.results[s].query.resultFormat?(0,p.concat)(e,this.parseTimeSeriesResult(this.results[s].query,r,t)):(0,p.concat)(e,this.parseTableResult(this.results[s].query,r,t))}return e}parseTimeSeriesResult(e,r,s){const t=[];let o=-1,i=-1,a=-1;for(let e=0;e<r.length;e++)-1===o&&"datetime"===r[e].type&&(o=e),-1===i&&"string"===r[e].type&&(i=e),-1===a&&["int","long","real","double"].indexOf(r[e].type)>-1&&(a=e);if(-1===o)throw new Error("No datetime column found in the result. The Time Series format requires a time column.");return(0,p.forEach)(s,(s=>{const n=ts.dateTimeToEpoch(s[o]),c=i>-1?s[i]:r[a].name,u=ts.findOrCreateBucket(t,c);u.datapoints.push([s[a],n]),u.refId=e.refId,u.meta={executedQueryString:e.query}})),t}parseTableResult(e,r,s){return{type:"table",columns:(0,p.map)(r,(e=>({text:e.name,type:e.type}))),rows:s,refId:e.refId,meta:{executedQueryString:e.query}}}parseToVariables(){const e=this.parseQueryResult(),r=[];return(0,p.forEach)(e,(e=>{(0,p.forEach)((0,p.flattenDeep)(e.rows),(e=>{r.push({text:e,value:e})}))})),r}transformToAnnotations(e){const r=this.parseQueryResult(),s=[];return(0,p.forEach)(r,(r=>{let t=-1,o=-1,i=-1;for(let e=0;e<r.columns.length;e++)-1===t&&"datetime"===r.columns[e].type&&(t=e),-1===o&&"text"===r.columns[e].text.toLowerCase()&&(o=e),-1===i&&"tags"===r.columns[e].text.toLowerCase()&&(i=e);(0,p.forEach)(r.rows,(r=>{s.push({annotation:e.annotation,time:Math.floor(ts.dateTimeToEpoch(r[t])),text:r[o]?r[o].toString():"",tags:r[i]?r[i].trim().split(/\s*,\s*/):[]})}))})),s}static findOrCreateBucket(e,r){let s=(0,p.find)(e,["target",r]);return s||(s={target:r,datapoints:[],refId:"",query:""},e.push(s)),s}static dateTimeToEpoch(e){return(0,rs.CQ)(e).valueOf()}static parseSubscriptions(e){const r=[];if(!e)return r;const s="subscriptionId";for(let t=0;t<e.value.length;t++)(0,p.find)(r,["value",(0,p.get)(e.value[t],s)])||r.push({text:`${(0,p.get)(e.value[t],"displayName")}`,value:(0,p.get)(e.value[t],s)});return r}}const os=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function is(e){return e.functions?e.functions.map((e=>{const r=e.parameters&&e.parameters.split(", ").map((e=>{const r=e.match(os);if(!r)return;const[,s,t,o]=r;return{name:s,type:t,defaultValue:o,cslDefaultValue:o}})).filter((e=>!!e));return{name:e.name,body:e.body,inputParameters:r||[]}})):[]}function as(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}class ns extends Kr.CK{constructor(e){super(e),as(this,"resourcePath",void 0),as(this,"azurePortalUrl",void 0),as(this,"defaultSubscriptionId",void 0),as(this,"azureMonitorPath",void 0),as(this,"firstWorkspace",void 0),as(this,"cache",void 0),this.instanceSettings=e,this.cache=new Map,this.resourcePath=`${y}`,this.azureMonitorPath=`${b}/subscriptions`;const r=G(e);this.azurePortalUrl=C(r),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r;return!(!0===e.hide||null===(r=e.azureLogAnalytics)||void 0===r||!r.query||!e.azureLogAnalytics.resource&&!e.azureLogAnalytics.workspace)}async getSubscriptions(){if(!this.isConfigured())return[];const e=`${this.azureMonitorPath}?api-version=2019-03-01`;return await this.getResource(e).then((e=>ts.parseSubscriptions(e)))}async getWorkspaces(e){const r=await this.getWorkspaceList(e);return(0,p.map)(r.value,(e=>({text:e.name,value:e.id})))||[]}getWorkspaceList(e){const r=(0,c.J)().replace(e||this.defaultSubscriptionId),s=this.azureMonitorPath+`/${r}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(s)}async getMetadata(e){const r=`${this.resourcePath}/v1${e}/metadata`;return await this.getResource(r)}async getKustoSchema(e){const r=(0,c.J)(),s=r.replace(e,{},k);return function(e,r,s){const t={name:r,tables:e.tables,functions:is(e),majorVersion:0,minorVersion:0};return t.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]}),{clusterType:"Engine",cluster:{connectionString:r,databases:[t]},database:t,globalParameters:s.map((e=>({name:`$${e.name}`,type:"dynamic"})))}}(await this.getMetadata(s),s,r.getVariables())}applyTemplateVariables(e,r){const s=e.azureLogAnalytics;if(!s)return e;const t=(0,c.J)(),o=t.replace(s.resource,r);let i=t.replace(s.workspace,r);i||o||!this.firstWorkspace||(i=this.firstWorkspace);const a=t.replace(s.query,r,k);return Object.assign({},e,{queryType:N.LogAnalytics,azureLogAnalytics:{resultFormat:s.resultFormat,query:a,resource:o,workspace:i}})}query(e){return super.query(e).pipe((0,es.z)((e=>(0,Yr.D)(this.processResponse(e)))))}async processResponse(e){if(e.data)for(const t of e.data){var r,s;const e=null===(r=t.meta)||void 0===r||null===(s=r.custom)||void 0===s?void 0:s.encodedQuery;if(e&&e.length>0){const e=await this.buildDeepLink(t.meta.custom);if(null!=e&&e.length)for(const r of t.fields)r.config.links=[{url:e,title:"View in Azure Portal",targetBlank:!0}]}}return e}async buildDeepLink(e){const r=encodeURIComponent(e.encodedQuery),s=e.workspace,t=e.subscription,o=await this.getWorkspaceDetails(s);if(!o.workspace||!o.resourceGroup)return"";return`${this.azurePortalUrl}/#blade/Microsoft_OperationsManagementSuite_Workspace/AnalyticsBlade/initiator/AnalyticsShareLinkToQuery/isQueryEditorVisible/true/scope/%7B%22resources%22%3A%5B%7B%22resourceId%22%3A%22%2Fsubscriptions%2F${t}%2Fresourcegroups%2F${o.resourceGroup}%2Fproviders%2Fmicrosoft.operationalinsights%2Fworkspaces%2F${o.workspace}%22%7D%5D%7D/query/${r}/isQueryBase64Compressed/true/timespanInIsoFormat/P1D`}async getWorkspaceDetails(e){if(!this.defaultSubscriptionId)return{};const r=(await this.getWorkspaceList(this.defaultSubscriptionId)).value.find((r=>r.properties.customerId===e));if(!r)return{};const s=/.*resourcegroups\/(.*)\/providers.*/.exec(r.id);return!s||s.length<2?{}:{workspace:r.name,resourceGroup:s[1]}}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}buildQuery(e,r,s){const t=new ss((0,c.J)().replace(e,{},k),r,"TimeGenerated").generate().uriString,o=Ue(s)?`${this.resourcePath}/v1/workspaces/${s}/query?${t}`:`${this.resourcePath}/v1${s}/query?${t}`;return[{datasource:this.getRef(),path:o,resultFormat:"table"}]}async getDefaultOrFirstSubscription(){var e;if(this.defaultSubscriptionId)return this.defaultSubscriptionId;return null===(e=(await this.getSubscriptions())[0])||void 0===e?void 0:e.value}async getFirstWorkspace(){var e;if(this.firstWorkspace)return this.firstWorkspace;const r=await this.getDefaultOrFirstSubscription();if(!r)return;const s=null===(e=(await this.getWorkspaces(r))[0])||void 0===e?void 0:e.value;return s&&(this.firstWorkspace=s),s}annotationQuery(e){if(!e.annotation.rawQuery)return Promise.reject({message:"Query missing in annotation definition"});const r=this.buildQuery(e.annotation.rawQuery,e,e.annotation.workspace),s=this.doQueries(r);return Promise.all(s).then((r=>new ts(r).transformToAnnotations(e)))}doQueries(e){return(0,p.map)(e,(e=>this.getResource(e.path).then((r=>({result:r,query:e}))).catch((r=>{throw{error:r,query:e}}))))}validateDatasource(){if("clientsecret"===x(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}}var cs=s(75478);function us(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function ls(e){return!(!e||"select"===e)}class ps extends Kr.CK{constructor(e){super(e),us(this,"apiVersion","2018-01-01"),us(this,"apiPreviewVersion","2017-12-01-preview"),us(this,"listByResourceGroupApiVersion","2021-04-01"),us(this,"defaultSubscriptionId",void 0),us(this,"resourcePath",void 0),us(this,"azurePortalUrl",void 0),us(this,"timeSrv",void 0),us(this,"templateSrv",void 0),this.instanceSettings=e,this.timeSrv=(0,cs.$t)(),this.templateSrv=(0,c.J)(),this.defaultSubscriptionId=e.jsonData.subscriptionId;const r=G(e);this.resourcePath=b,this.azurePortalUrl=C(r)}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r,s,t,o,i,a,n;const c=ls(null==e||null===(r=e.azureMonitor)||void 0===r?void 0:r.resourceGroup)&&ls(null==e||null===(s=e.azureMonitor)||void 0===s?void 0:s.resourceName)&&ls((null==e||null===(t=e.azureMonitor)||void 0===t?void 0:t.metricDefinition)||(null==e||null===(o=e.azureMonitor)||void 0===o?void 0:o.metricNamespace)),u=ls(null===(i=e.azureMonitor)||void 0===i?void 0:i.resourceUri);return!(!0===e.hide||!c&&!u||!ls(null==e||null===(a=e.azureMonitor)||void 0===a?void 0:a.metricName)||!ls(null==e||null===(n=e.azureMonitor)||void 0===n?void 0:n.aggregation))}applyTemplateVariables(e,r){var s;const t=e.azureMonitor;if(!t)throw new Error("Query is not a valid Azure Monitor Metrics query");t.timeGrain&&t.timeGrainUnit&&"auto"!==t.timeGrain&&(t.timeGrain=f.createISO8601Duration(t.timeGrain,t.timeGrainUnit));const o=(0,c.J)(),i=o.replace(e.subscription||this.defaultSubscriptionId,r),a=o.replace(t.resourceGroup,r),n=o.replace(t.resourceName,r),u=o.replace(t.metricNamespace,r),l=o.replace(t.customNamespace,r),p=o.replace((t.timeGrain||"").toString(),r),m=o.replace(t.aggregation,r),d=o.replace(t.top||"",r),g=(null!==(s=t.dimensionFilters)&&void 0!==s?s:[]).filter((e=>e.dimension&&"None"!==e.dimension)).map((e=>{var s;const t=null===(s=e.filters)||void 0===s?void 0:s.map((e=>o.replace(null!=e?e:"",r)));return{dimension:o.replace(e.dimension,r),operator:e.operator||"eq",filters:t||[]}})),h={resourceGroup:a,metricNamespace:u,customNamespace:l,resourceName:n,timeGrain:p,allowedTimeGrainsMs:t.allowedTimeGrainsMs,metricName:o.replace(t.metricName,r),aggregation:m,dimensionFilters:g,top:d||"10",alias:t.alias};return t.metricDefinition&&(h.metricDefinition=o.replace(t.metricDefinition,r)),t.resourceUri&&(h.resourceUri=o.replace(t.resourceUri,r)),Er(Object.assign({},e,{subscription:i,queryType:N.AzureMonitor,azureMonitor:h}))}async getSubscriptions(){return this.isConfigured()?this.getResource(`${this.resourcePath}/subscriptions?api-version=2019-03-01`).then((e=>g.parseSubscriptions(e))):[]}getResourceGroups(e){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then((e=>g.parseResponseValues(e,"name","name")))}getResourceNames(e,r,s,t){const o=(0,p.startsWith)(null==s?void 0:s.toLowerCase(),"microsoft.storage/storageaccounts/")?"microsoft.storage/storageaccounts":s;let i=`${this.resourcePath}/subscriptions/${e}`;return r&&(i+=`/resourceGroups/${r}`),i+=`/resources?api-version=${this.listByResourceGroupApiVersion}`,o&&(i+=`&$filter=resourceType eq '${o}'`),t&&(i+=`&$skiptoken=${t}`),this.getResource(i).then((async t=>{let o=[];if((0,p.startsWith)(null==s?void 0:s.toLowerCase(),"microsoft.storage/storageaccounts/")){o=g.parseResourceNames(t,"microsoft.storage/storageaccounts");for(let e=0;e<o.length;e++)o[e].text+="/default",o[e].value+="/default"}else o=g.parseResourceNames(t,s);if(t.nextLink){const i=new URL(t.nextLink).searchParams.get("$skiptoken");if(!i)throw Error("unable to request the next page of resources");const a=await this.getResourceNames(e,r,s,i);o=o.concat(a)}return o}))}getMetricNamespaces(e,r){const s=Qe.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceTemplateVariables(e),r,this.templateSrv);return this.getResource(s).then((e=>g.parseResponseValues(e,"properties.metricNamespaceName","properties.metricNamespaceName"))).then((e=>{if(s.toLowerCase().includes("microsoft.storage/storageaccounts")){const r=["microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storageaccounts/queueservices"];for(const s of r)(0,p.find)(e,["value",s.toLowerCase()])||e.push({value:s,text:s})}return e}))}getMetricNames(e){const r=Qe.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e),this.templateSrv);return this.getResource(r).then((e=>g.parseResponseValues(e,"name.localizedValue","name.value")))}getMetricMetadata(e){const{metricName:r}=e,s=Qe.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e),this.templateSrv);return this.getResource(s).then((e=>g.parseMetadata(e,r)))}validateDatasource(){if("clientsecret"===x(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}replaceTemplateVariables(e){const r=(0,c.J)(),s=Object.assign({},e);return Object.keys(e).forEach((e=>{s[e]=r.replace(s[e])})),s}}class ms extends Kr.CK{filterQuery(e){var r;return!(null===(r=e.azureResourceGraph)||void 0===r||!r.query)}applyTemplateVariables(e,r){const s=e.azureResourceGraph;if(!s)return e;const t=(0,c.J)(),o=t.getVariables().map((e=>`$${e.name}`)),i=m().find(e.subscriptions,(e=>m().includes(o,e))),a=[...t.replace(i,r,(e=>e)).split(",").filter((e=>e.length>0)),...m().filter(e.subscriptions,(e=>!m().includes(o,e)))],n=t.replace(s.query,r,k);return Object.assign({},e,{queryType:N.AzureResourceGraph,subscriptions:a,azureResourceGraph:{resultFormat:"table",query:n}})}}const ds=[{location:"eastus",displayName:"East US",supportsLogs:!0},{location:"eastus2",displayName:"East US 2",supportsLogs:!0},{location:"southcentralus",displayName:"South Central US",supportsLogs:!0},{location:"westus2",displayName:"West US 2",supportsLogs:!0},{location:"westus3",displayName:"West US 3",supportsLogs:!0},{location:"australiaeast",displayName:"Australia East",supportsLogs:!0},{location:"southeastasia",displayName:"Southeast Asia",supportsLogs:!0},{location:"northeurope",displayName:"North Europe",supportsLogs:!0},{location:"uksouth",displayName:"UK South",supportsLogs:!0},{location:"westeurope",displayName:"West Europe",supportsLogs:!0},{location:"centralus",displayName:"Central US",supportsLogs:!0},{location:"northcentralus",displayName:"North Central US",supportsLogs:!0},{location:"westus",displayName:"West US",supportsLogs:!0},{location:"southafricanorth",displayName:"South Africa North",supportsLogs:!0},{location:"centralindia",displayName:"Central India",supportsLogs:!0},{location:"eastasia",displayName:"East Asia",supportsLogs:!0},{location:"japaneast",displayName:"Japan East",supportsLogs:!0},{location:"jioindiawest",displayName:"Jio India West",supportsLogs:!0},{location:"koreacentral",displayName:"Korea Central",supportsLogs:!0},{location:"canadacentral",displayName:"Canada Central",supportsLogs:!0},{location:"francecentral",displayName:"France Central",supportsLogs:!0},{location:"germanywestcentral",displayName:"Germany West Central",supportsLogs:!0},{location:"norwayeast",displayName:"Norway East",supportsLogs:!0},{location:"switzerlandnorth",displayName:"Switzerland North",supportsLogs:!0},{location:"uaenorth",displayName:"UAE North",supportsLogs:!0},{location:"brazilsouth",displayName:"Brazil South",supportsLogs:!0},{location:"centralusstage",displayName:"Central US (Stage)",supportsLogs:!0},{location:"eastusstage",displayName:"East US (Stage)",supportsLogs:!0},{location:"eastus2stage",displayName:"East US 2 (Stage)",supportsLogs:!0},{location:"northcentralusstage",displayName:"North Central US (Stage)",supportsLogs:!0},{location:"southcentralusstage",displayName:"South Central US (Stage)",supportsLogs:!0},{location:"westusstage",displayName:"West US (Stage)",supportsLogs:!0},{location:"westus2stage",displayName:"West US 2 (Stage)",supportsLogs:!0},{location:"asia",displayName:"Asia",supportsLogs:!0},{location:"asiapacific",displayName:"Asia Pacific",supportsLogs:!0},{location:"australia",displayName:"Australia",supportsLogs:!0},{location:"brazil",displayName:"Brazil",supportsLogs:!0},{location:"canada",displayName:"Canada",supportsLogs:!0},{location:"europe",displayName:"Europe",supportsLogs:!0},{location:"global",displayName:"Global",supportsLogs:!0},{location:"india",displayName:"India",supportsLogs:!0},{location:"japan",displayName:"Japan",supportsLogs:!0},{location:"uk",displayName:"United Kingdom",supportsLogs:!0},{location:"unitedstates",displayName:"United States",supportsLogs:!0},{location:"eastasiastage",displayName:"East Asia (Stage)",supportsLogs:!0},{location:"southeastasiastage",displayName:"Southeast Asia (Stage)",supportsLogs:!0},{location:"westcentralus",displayName:"West Central US",supportsLogs:!0},{location:"southafricawest",displayName:"South Africa West",supportsLogs:!0},{location:"australiacentral",displayName:"Australia Central",supportsLogs:!0},{location:"australiacentral2",displayName:"Australia Central 2",supportsLogs:!0},{location:"australiasoutheast",displayName:"Australia Southeast",supportsLogs:!0},{location:"japanwest",displayName:"Japan West",supportsLogs:!0},{location:"koreasouth",displayName:"Korea South",supportsLogs:!0},{location:"southindia",displayName:"South India",supportsLogs:!0},{location:"westindia",displayName:"West India",supportsLogs:!0},{location:"canadaeast",displayName:"Canada East",supportsLogs:!0},{location:"francesouth",displayName:"France South",supportsLogs:!0},{location:"germanynorth",displayName:"Germany North",supportsLogs:!0},{location:"norwaywest",displayName:"Norway West",supportsLogs:!0},{location:"switzerlandwest",displayName:"Switzerland West",supportsLogs:!0},{location:"ukwest",displayName:"UK West",supportsLogs:!0},{location:"uaecentral",displayName:"UAE Central",supportsLogs:!0},{location:"brazilsoutheast",displayName:"Brazil Southeast",supportsLogs:!0},{location:"chinaeast",displayName:"China Eest",supportsLogs:!0},{location:"chinaeast2",displayName:"China Eest 2",supportsLogs:!0},{location:"chinanorth",displayName:"China North",supportsLogs:!0},{location:"chinanorth2",displayName:"China North 2",supportsLogs:!0},{location:"chinanorth3",displayName:"China North 3",supportsLogs:!0}],fs=ds.filter((e=>e.supportsLogs)).map((e=>`"${e.location}"`)).join(","),gs=ds.reduce(((e,r)=>Object.assign({},e,{[r.location]:r.displayName})),{}),hs={"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems":"Backup Items","microsoft.resources/subscriptions":"Subscriptions","microsoft.resources/subscriptions/resourcegroups":"Resource groups","citrix.services/xenappessentials":"Citrix Virtual Apps Essentials","citrix.services/xendesktopessentials":"Citrix Virtual Desktops Essentials","dynatrace.observability/monitors":"Dynatrace","github.enterprise/accounts":"GitHub AE","microsoft.aad/domainservices":"Azure AD Domain Services","microsoft.aadiam/privatelinkforazuread":"Private Link for Azure AD","microsoft.agfoodplatform/farmbeats":"Azure FarmBeats","microsoft.analysisservices/servers":"Analysis Services","microsoft.anybuild/clusters":"AnyBuild clusters","microsoft.apimanagement/service":"API Management services","microsoft.appconfiguration/configurationstores":"App Configuration","microsoft.appplatform/spring":"Azure Spring Cloud","microsoft.attestation/attestationproviders":"Attestation providers","microsoft.authorization/resourcemanagementprivatelinks":"Resource management private links","microsoft.automation/automationaccounts":"Automation Accounts","microsoft.automation/automationaccounts/runbooks":"Runbook","microsoft.autonomoussystems/workspaces":"Bonsai","microsoft.avs/privateclouds":"AVS Private clouds","microsoft.azureactivedirectory/b2cdirectories":"B2C Tenants","microsoft.azureactivedirectory/guestusages":"Guest Usages","microsoft.azurearcdata/datacontrollers":"Azure Arc data controllers","microsoft.azurearcdata/postgresinstances":"Azure Arc-enabled PostgreSQL Hyperscale server groups","microsoft.azurearcdata/sqlmanagedinstances":"SQL managed instances - Azure Arc","microsoft.azurearcdata/sqlserverinstances":"SQL Server - Azure Arc","microsoft.azuredata/sqlserverregistrations":"SQL Server registries","microsoft.azurepercept/accounts":"Azure Percept accounts","microsoft.azurestackhci/clusters":"Azure Stack HCI","microsoft.azurestackhci/virtualmachines":"Azure Stack HCI virtual machine - Azure Arc","microsoft.baremetal/crayservers":"Cray Servers","microsoft.baremetal/monitoringservers":"Monitoring Servers","microsoft.baremetalinfrastructure/baremetalinstances":"BareMetal Instances","microsoft.batch/batchaccounts":"Batch accounts","microsoft.bing/accounts":"Bing Resources","microsoft.botservice/botservices":"Bot Services","microsoft.cache/redis":"Azure Cache for Redis","microsoft.cache/redisenterprise":"Redis Enterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies":"Content Delivery Network WAF policies","microsoft.cdn/profiles (front doors standard/premium":"Preview)","microsoft.cdn/profiles/afdendpoints":"Endpoints","microsoft.cdn/profiles/endpoints":"Endpoints","microsoft.certificateregistration/certificateorders":"App Service Certificates","microsoft.chaos/chaosexperiments":"Chaos Experiments (Classic)","microsoft.chaos/experiments":"Chaos Experiments","microsoft.classiccompute/domainnames":"Cloud services (classic)","microsoft.classiccompute/virtualmachines":"Virtual machines (classic)","microsoft.classicnetwork/networksecuritygroups":"Network security groups (classic)","microsoft.classicnetwork/reservedips":"Reserved IP addresses (classic)","microsoft.classicnetwork/virtualnetworks":"Virtual networks (classic)","microsoft.classicstorage/storageaccounts":"Storage accounts (classic)","microsoft.cloudtest/accounts":"CloudTest Accounts","microsoft.cloudtest/hostedpools":"1ES Hosted Pools","microsoft.cloudtest/images":"CloudTest Images","microsoft.cloudtest/pools":"CloudTest Pools","microsoft.clusterstor/nodes":"ClusterStors","microsoft.cognitiveservices/accounts":"Cognitive Services","microsoft.compute/availabilitysets":"Availability sets","microsoft.compute/capacityreservationgroups":"Capacity Reservation Groups","microsoft.compute/cloudservices":"Cloud services (extended support)","microsoft.compute/diskaccesses":"Disk Accesses","microsoft.compute/diskencryptionsets":"Disk Encryption Sets","microsoft.compute/disks":"Disks","microsoft.compute/galleries":"Azure compute galleries","microsoft.compute/galleries/applications":"VM application definitions","microsoft.compute/galleries/applications/versions":"VM application versions","microsoft.compute/galleries/images":"VM image definitions","microsoft.compute/galleries/images/versions":"VM image versions","microsoft.compute/hostgroups":"Host groups","microsoft.compute/hostgroups/hosts":"Hosts","microsoft.compute/images":"Images","microsoft.compute/proximityplacementgroups":"Proximity placement groups","microsoft.compute/restorepointcollections":"Restore Point Collections","microsoft.compute/snapshots":"Snapshots","microsoft.compute/sshpublickeys":"SSH keys","microsoft.compute/virtualmachines":"Virtual machines","microsoft.compute/virtualmachinescalesets":"Virtual machine scale sets","microsoft.confidentialledger/ledgers":"Confidential Ledgers","microsoft.confluent/organizations":"Confluent organizations","microsoft.connectedcache/cachenodes":"Connected Cache Resources","microsoft.connectedcache/enterprisecustomers":"Connected Cache Resources","microsoft.connectedvehicle/platformaccounts":"Connected Vehicle Platforms","microsoft.connectedvmwarevsphere/vcenters":"VMware vCenters","microsoft.connectedvmwarevsphere/virtualmachines":"VMware + AVS virtual machines","microsoft.containerinstance/containergroups":"Container instances","microsoft.containerregistry/registries":"Container registries","microsoft.containerregistry/registries/replications":"Container registry replications","microsoft.containerregistry/registries/webhooks":"Container registry webhooks","microsoft.containerservice/managedclusters":"Kubernetes services","microsoft.dashboard/grafana":"Grafana Workspaces","microsoft.databox/jobs":"Azure Data Box","microsoft.databoxedge/databoxedgedevices":"Azure Stack Edge / Data Box Gateway","microsoft.databricks/workspaces":"Azure Databricks Services","microsoft.datacatalog/catalogs":"Data Catalog","microsoft.datacollaboration/workspaces":"Project CI","microsoft.datadog/monitors":"Datadog","microsoft.datafactory/datafactories":"Data factories","microsoft.datafactory/factories":"Data factories (V2)","microsoft.datalakeanalytics/accounts":"Data Lake Analytics","microsoft.datalakestore/accounts":"Data Lake Storage Gen1","microsoft.datamigration/services":"Azure Database Migration Services","microsoft.datamigration/services/projects":"Azure Database Migration Projects","microsoft.datamigration/sqlmigrationservices":"Azure Database Migration Services","microsoft.dataprotection/backupvaults":"Backup vaults","microsoft.dataprotection/resourceguards":"Resource Guards (Preview)","microsoft.datareplication/replicationvaults":"Site Recovery Vaults","microsoft.datashare/accounts":"Data Shares","microsoft.dbformariadb/servers":"Azure Database for MariaDB servers","microsoft.dbformysql/flexibleservers":"Azure Database for MySQL flexible servers","microsoft.dbformysql/servers":"Azure Database for MySQL servers","microsoft.dbforpostgresql/flexibleservers":"Azure Database for PostgreSQL flexible servers","microsoft.dbforpostgresql/servergroups":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servergroupsv2":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servers":"Azure Database for PostgreSQL servers","microsoft.dbforpostgresql/serversv2":"Azure Database for PostgreSQL servers v2","microsoft.deploymentmanager/rollouts":"Rollouts","microsoft.desktopvirtualization/applicationgroups":"Application groups","microsoft.desktopvirtualization/hostpools":"Host pools","microsoft.desktopvirtualization/scalingplans":"Scaling plans","microsoft.desktopvirtualization/workspaces":"Workspaces","microsoft.devices/iothubs":"IoT Hub","microsoft.devices/provisioningservices":"Device Provisioning Services","microsoft.deviceupdate/accounts":"Device Update for IoT Hubs","microsoft.devops/pipelines":"DevOps Starter","microsoft.devtestlab/labs":"DevTest Labs","microsoft.devtestlab/labs/virtualmachines":"Virtual machines","microsoft.digitaltwins/digitaltwinsinstances":"Azure Digital Twins","microsoft.documentdb/cassandraclusters":"Azure Managed Instance for Apache Cassandra","microsoft.documentdb/databaseaccounts":"Azure Cosmos DB accounts","microsoft.domainregistration/domains":"App Service Domains","microsoft.edgeorder/addresses":"Azure Edge Hardware Center Address","microsoft.edgeorder/orderitems":"Azure Edge Hardware Center","microsoft.elastic/monitors":"Elasticsearch (Elastic Cloud)","microsoft.eventgrid/domains":"Event Grid Domains","microsoft.eventgrid/partnernamespaces":"Event Grid Partner Namespaces","microsoft.eventgrid/partnerregistrations":"Event Grid Partner Registrations","microsoft.eventgrid/partnertopics":"Event Grid Partner Topics","microsoft.eventgrid/systemtopics":"Event Grid System Topics","microsoft.eventgrid/topics":"Event Grid Topics","microsoft.eventhub/clusters":"Event Hubs Clusters","microsoft.eventhub/namespaces":"Event Hubs Namespaces","microsoft.experimentation/experimentworkspaces":"Experiment Workspaces","microsoft.extendedlocation/customlocations":"Custom locations","microsoft.fidalgo/devcenters":"Fidalgo DevCenters","microsoft.fidalgo/networksettings":"Network Configurations","microsoft.fidalgo/projects":"Fidalgo Projects","microsoft.fidalgo/projects/environments":"Fidalgo Environments","microsoft.fluidrelay/fluidrelayservers":"Fluid Relay","microsoft.genomics/accounts":"Genomics accounts","microsoft.hanaonazure/hanainstances":"SAP HANA on Azure","microsoft.hanaonazure/sapmonitors":"Azure Monitors for SAP Solutions","microsoft.hdinsight/clusterpools":"HDInsight cluster pools","microsoft.hdinsight/clusterpools/clusters":"HDInsight gen2 clusters","microsoft.hdinsight/clusterpools/clusters/sessionclusters":"HDInsight session clusters","microsoft.hdinsight/clusters":"HDInsight clusters","microsoft.healthbot/healthbots":"Azure Health Bot","microsoft.healthcareapis/services":"Azure API for FHIR","microsoft.healthcareapis/workspaces":"Healthcare APIs Workspaces","microsoft.healthcareapis/workspaces/dicomservices":"DICOM services","microsoft.healthcareapis/workspaces/fhirservices":"FHIR services","microsoft.healthcareapis/workspaces/iotconnectors":"IoT connectors","microsoft.hpcworkbench/instances":"HPC Workbenches (preview)","microsoft.hpcworkbench/instances/chambers":"Chambers (preview)","microsoft.hpcworkbench/instances/chambers/accessprofiles":"Chamber Profiles (preview)","microsoft.hpcworkbench/instances/chambers/workloads":"Chamber VMs (preview)","microsoft.hpcworkbench/instances/consortiums":"Consortiums (preview)","microsoft.hybridcompute/machines":"Servers - Azure Arc","microsoft.hybridcompute/privatelinkscopes":"Azure Arc Private Link Scopes","microsoft.hybriddata/datamanagers":"StorSimple Data Managers","microsoft.hybridnetwork/devices":"Azure Network Function Manager  Devices","microsoft.hybridnetwork/networkfunctions":"Azure Network Function Manager  Network Functions","microsoft.importexport/jobs":"Import/export jobs","microsoft.insights/components":"Application Insights","microsoft.insights/datacollectionendpoints":"Data collection endpoints","microsoft.insights/datacollectionrules":"Data collection rules","microsoft.insights/privatelinkscopes":"Azure Monitor Private Link Scopes","microsoft.insights/webtests":"Availability tests","microsoft.insights/workbooks":"Azure Workbooks","microsoft.insights/workbooktemplates":"Azure Workbook Templates","microsoft.iotcentral/iotapps":"IoT Central Applications","microsoft.keyvault/vaults":"Key vaults","microsoft.kubernetes/connectedclusters":"Kubernetes - Azure Arc","microsoft.kusto/clusters":"Azure Data Explorer Clusters","microsoft.kusto/clusters/databases":"Azure Data Explorer Databases","microsoft.labservices/labaccounts":"Lab accounts","microsoft.labservices/labplans":"Lab plans","microsoft.labservices/labs":"Labs","microsoft.loadtestservice/loadtests":"Azure Load Testing","microsoft.logic/integrationaccounts":"Integration accounts","microsoft.logic/integrationserviceenvironments":"Integration Service Environments","microsoft.logic/integrationserviceenvironments/managedapis":"Managed Connector","microsoft.logic/workflows":"Logic apps","microsoft.logz/monitors":"Logz main account","microsoft.logz/monitors/accounts":"Logz sub account","microsoft.logz/monitors/metricssource":"Logz metrics data source","microsoft.machinelearning/commitmentplans":"Machine Learning Studio (classic) web service plans","microsoft.machinelearning/webservices":"Machine Learning Studio (classic) web services","microsoft.machinelearning/workspaces":"Machine Learning Studio (classic) workspaces","microsoft.machinelearningservices/workspaces":"Machine learning","microsoft.machinelearningservices/workspaces/onlineendpoints":"Machine learning online endpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments":"Machine learning online deployments","microsoft.maintenance/maintenanceconfigurations":"Maintenance Configurations","microsoft.managedidentity/userassignedidentities":"Managed Identities","microsoft.maps/accounts":"Azure Maps Accounts","microsoft.maps/accounts/creators":"Azure Maps Creator Resources","microsoft.media/mediaservices":"Media Services","microsoft.media/mediaservices/liveevents":"Live events","microsoft.media/mediaservices/streamingendpoints":"Streaming Endpoints","microsoft.media/videoanalyzers":"Video Analyzers","microsoft.migrate/projects":"Migration projects","microsoft.mixedreality/objectanchorsaccounts":"Object Anchors Accounts","microsoft.mixedreality/objectunderstandingaccounts":"Object Understanding Accounts","microsoft.mixedreality/remoterenderingaccounts":"Remote Rendering Accounts","microsoft.mixedreality/spatialanchorsaccounts":"Spatial Anchors Accounts","microsoft.mobilenetwork/mobilenetworks":"Mobile Networks","microsoft.mobilenetwork/mobilenetworks/datanetworks":"Data Networks","microsoft.mobilenetwork/mobilenetworks/services":"Services","microsoft.mobilenetwork/mobilenetworks/simpolicies":"Sim Policies","microsoft.mobilenetwork/mobilenetworks/sites":"Mobile Network Sites","microsoft.mobilenetwork/mobilenetworks/slices":"Slices","microsoft.mobilenetwork/packetcorecontrolplanes":"Packet Core Control Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes":"Packet Core Data Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks":"Attached Data Networks","microsoft.mobilenetwork/sims":"Sims","microsoft.netapp/netappaccounts":"NetApp accounts","microsoft.netapp/netappaccounts/capacitypools":"Capacity pools","microsoft.netapp/netappaccounts/capacitypools/volumes":"Volumes","microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots":"Snapshots","microsoft.netapp/netappaccounts/snapshotpolicies":"Snapshot policies","microsoft.network/applicationgateways":"Application gateways","microsoft.network/applicationgatewaywebapplicationfirewallpolicies":"Application Gateway WAF policies","microsoft.network/applicationsecuritygroups":"Application security groups","microsoft.network/azurefirewalls":"Firewalls","microsoft.network/bastionhosts":"Bastions","microsoft.network/connections":"Connections","microsoft.network/customipprefixes":"Custom IP Prefixes","microsoft.network/ddosprotectionplans":"DDoS protection plans","microsoft.network/dnsforwardingrulesets":"Dns Forwarding Rulesets","microsoft.network/dnsresolvers":"DNS Private Resolvers","microsoft.network/dnszones":"DNS zones","microsoft.network/expressroutecircuits":"ExpressRoute circuits","microsoft.network/expressrouteports":"ExpressRoute Direct","microsoft.network/firewallpolicies":"Firewall Policies","microsoft.network/frontdoors":"Front Doors","microsoft.network/frontdoorwebapplicationfirewallpolicies":"Web Application Firewall policies (WAF)","microsoft.network/ipgroups":"IP Groups","microsoft.network/loadbalancers":"Load balancers","microsoft.network/localnetworkgateways":"Local network gateways","microsoft.network/natgateways":"NAT gateways","microsoft.network/networkexperimentprofiles":"Internet Analyzer profiles","microsoft.network/networkinterfaces":"Network interfaces","microsoft.network/networkmanagers":"Network Managers","microsoft.network/networksecuritygroups":"Network security groups","microsoft.network/networkwatchers":"Network Watchers","microsoft.network/networkwatchers/flowlogs":"NSG Flow Logs","microsoft.network/privatednszones":"Private DNS zones","microsoft.network/privateendpoints":"Private endpoints","microsoft.network/privatelinkservices":"Private link services","microsoft.network/publicipaddresses":"Public IP addresses","microsoft.network/publicipprefixes":"Public IP Prefixes","microsoft.network/routefilters":"Route filters","microsoft.network/routetables":"Route tables","microsoft.network/serviceendpointpolicies":"Service endpoint policies","microsoft.network/trafficmanagerprofiles":"Traffic Manager profiles","microsoft.network/virtualnetworkgateways":"Virtual network gateways","microsoft.network/virtualnetworks":"Virtual networks","microsoft.network/virtualwans":"Virtual WANs","microsoft.notificationhubs/namespaces":"Notification Hub Namespaces","microsoft.notificationhubs/namespaces/notificationhubs":"Notification Hubs","microsoft.openenergyplatform/energyservices":"Project Oak Forest","microsoft.openlogisticsplatform/workspaces":"Open Supply Chain Platform","microsoft.operationalinsights/querypacks":"Log Analytics query packs","microsoft.operationalinsights/workspaces":"Log Analytics workspaces","microsoft.operationsmanagement/solutions":"Solutions","microsoft.orbital/contactprofiles":"Contact Profiles","microsoft.orbital/edgesites":"Edge Sites","microsoft.orbital/groundstations":"Ground Stations","microsoft.orbital/l2connections":"L2 Connections","microsoft.orbital/spacecrafts":"Spacecrafts","microsoft.peering/peerings":"Peerings","microsoft.peering/peeringservices":"Peering Services","microsoft.playfab/playeraccountpools":"PlayFab player account pools","microsoft.playfab/titles":"PlayFab titles","microsoft.portal/dashboards":"Shared dashboards","microsoft.powerbidedicated/capacities":"Power BI Embedded","microsoft.purview/accounts":"Microsoft Purview accounts","microsoft.quantum/workspaces":"Quantum Workspaces","microsoft.recommendationsservice/accounts":"Intelligent Recommendations Accounts","microsoft.recommendationsservice/accounts/modeling":"Modeling","microsoft.recommendationsservice/accounts/serviceendpoints":"Service Endpoints","microsoft.recoveryservices/vaults":"Recovery Services vaults","microsoft.redhatopenshift/openshiftclusters":"Azure Red Hat OpenShift","microsoft.relay/namespaces":"Relays","microsoft.resourceconnector/appliances":"Resource bridges","microsoft.resourcegraph/queries":"Resource Graph queries","microsoft.resources/deploymentscripts":"Deployment Scripts","microsoft.resources/templatespecs":"Template specs","microsoft.saas/applications":"Software as a Service (classic)","microsoft.saas/resources":"SaaS","microsoft.scom/managedinstances":"Aquila Instances","microsoft.scvmm/virtualmachines":"SCVMM virtual machine - Azure Arc","microsoft.scvmm/vmmservers":"SCVMM management servers","microsoft.search/searchservices":"Search services","microsoft.securitydetonation/chambers":"Security Detonation Chambers","microsoft.servicebus/namespaces":"Service Bus Namespaces","microsoft.servicefabric/clusters":"Service Fabric clusters","microsoft.servicefabric/managedclusters":"Service Fabric managed clusters","microsoft.serviceshub/connectors":"Services Hub Connectors","microsoft.signalrservice/signalr":"SignalR","microsoft.signalrservice/webpubsub":"Web PubSub Service","microsoft.solutions/applicationdefinitions":"Service catalog managed application definitions","microsoft.solutions/applications":"Managed applications","microsoft.sql/instancepools":"Instance pools","microsoft.sql/managedinstances":"SQL managed instances","microsoft.sql/managedinstances/databases":"Managed databases","microsoft.sql/servers":"SQL servers","microsoft.sql/servers/databases":"SQL databases","microsoft.sql/servers/elasticpools":"SQL elastic pools","microsoft.sql/servers/jobagents":"Elastic Job agents","microsoft.sql/virtualclusters":"Virtual clusters","microsoft.sqlvirtualmachine/sqlvirtualmachines":"SQL virtual machines","microsoft.storage/storageaccounts":"Storage accounts","microsoft.storagecache/amlfilesystems":"Lustre File Systems","microsoft.storagecache/caches":"HPC caches","microsoft.storagepool/diskpools":"Disk Pools","microsoft.storagesync/storagesyncservices":"Storage Sync Services","microsoft.storagesyncdev/storagesyncservices":"Storage Sync Services","microsoft.storagesyncint/storagesyncservices":"Storage Sync Services","microsoft.storsimple/managers":"StorSimple Device Managers","microsoft.streamanalytics/clusters":"Stream Analytics clusters","microsoft.streamanalytics/streamingjobs":"Stream Analytics jobs","microsoft.synapse/privatelinkhubs":"Azure Synapse Analytics (private link hubs)","microsoft.synapse/workspaces":"Azure Synapse Analytics","microsoft.synapse/workspaces/bigdatapools":"Apache Spark pools","microsoft.synapse/workspaces/kustopools":"Data Explorer pools (preview)","microsoft.synapse/workspaces/sqlpools":"Dedicated SQL pools","microsoft.testbase/testbaseaccounts":"Test Base Accounts","microsoft.testbase/testbaseaccounts/packages":"Test Base Packages","microsoft.timeseriesinsights/environments":"Time Series Insights environments","microsoft.timeseriesinsights/environments/eventsources":"Time Series Insights event sources","microsoft.timeseriesinsights/environments/referencedatasets":"Time Series Insights reference data sets","microsoft.videoindexer/accounts":"Video Analyzer for Media","microsoft.virtualmachineimages/imagetemplates":"Image Templates","microsoft.visualstudio/account":"Azure DevOps organizations","microsoft.visualstudio/account/project":"DevOps Starter","microsoft.vmwarecloudsimple/dedicatedcloudnodes":"CloudSimple Nodes","microsoft.vmwarecloudsimple/dedicatedcloudservices":"CloudSimple Services","microsoft.vmwarecloudsimple/virtualmachines":"CloudSimple Virtual Machines","microsoft.vsonline/plans":"Visual Studio Online Plans","microsoft.web/connectiongateways":"On-premises data gateways","microsoft.web/connections":"API Connections","microsoft.web/containerapps":"Container Apps","microsoft.web/customapis":"Logic Apps Custom Connector","microsoft.web/hostingenvironments":"App Service Environments","microsoft.web/kubeenvironments":"App Service Kubernetes Environments","microsoft.web/serverfarms":"App Service plans","microsoft.web/sites":"App Services","microsoft.web/sites/slots":"App Service (Slots)","microsoft.web/staticsites":"Static Web Apps","microsoft.windowsesu/multipleactivationkeys":"Windows Multiple Activation Keys","microsoft.windowsiot/deviceservices":"Windows 10 IoT Core Services","microsoft.workloads/monitors":"Azure Monitors for SAP Solutions (v2)","microsoft.workloads/phpworkloads":"Scalable WordPress on Linux","microsoft.workloads/sapvirtualinstances":"SAP Virtual Instances","microsoft.workloads/sapvirtualinstances/applicationinstances":"SAP app server instances","microsoft.workloads/sapvirtualinstances/centralinstances":"SAP central server instances","microsoft.workloads/sapvirtualinstances/databaseinstances":"SAP database server instances","nginx.nginxplus/nginxdeployments":"NGINX Deployment","providers.test/statefulibizaengines":"VLCentral Help","wandisco.fusion/fusiongroups":"LiveData Planes","wandisco.fusion/fusiongroups/azurezones":"Azure Zones","wandisco.fusion/fusiongroups/azurezones/plugins":"Plugins","wandisco.fusion/fusiongroups/hivereplicationrules":"Hive Replication Rules","wandisco.fusion/fusiongroups/managedonpremzones":"On-premises Zones","wandisco.fusion/fusiongroups/replicationrules":"Replication Rules","wandisco.fusion/migrators":"LiveData Migrators","wandisco.fusion/migrators/exclusiontemplates":"Exclusions","wandisco.fusion/migrators/livedatamigrations":"Migrations","wandisco.fusion/migrators/metadatamigrations":"Metadata Migrations","wandisco.fusion/migrators/metadatatargets":"Metadata Targets","wandisco.fusion/migrators/pathmappings":"Path Mappings","wandisco.fusion/migrators/targets":"Targets","microsoft.security/insights/classification":"Data Sensitivity Security Insights (Preview)","microsoft.security/locations/alerts":"Security Alerts"};function vs(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}const bs=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.aadiam/tenants","microsoft.agfoodplatform/farmbeats","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.attestation/attestationproviders","microsoft.automation/automationaccounts","microsoft.autonomousdevelopmentplatform/accounts","microsoft.autonomousdevelopmentplatform/datapools","microsoft.autonomousdevelopmentplatform/workspaces","microsoft.avs/privateclouds","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.blockchain/blockchainmembers","microsoft.blockchain/cordamembers","microsoft.botservice/botservices","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.cdn/profiles/endpoints","microsoft.classiccompute/domainnames","microsoft.classiccompute/virtualmachines","microsoft.classicnetwork/networksecuritygroups","microsoft.classicstorage/storageaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.connectedcache/cachenodes","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.d365customerinsights/instances","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.databricks/workspaces","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.desktopvirtualization/applicationgroups","microsoft.desktopvirtualization/hostpools","microsoft.desktopvirtualization/scalingplans","microsoft.desktopvirtualization/workspaces","microsoft.devices/elasticpools/iothubtenants","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.eventgrid/domains","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.experimentation/experimentworkspaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.insights/qos","microsoft.iotcentral/iotapps","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kusto/clusters","microsoft.loadtestservice/loadtests","microsoft.logic/integrationaccounts","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networksecuritygroups","microsoft.network/networksecurityperimeters","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/vpngateways","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.openlogisticsplatform/workspaces","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.peering/peeringservices","microsoft.powerbi/tenants","microsoft.powerbi/tenants/workspaces","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.resources/subscriptions/resourcegroups","microsoft.search/searchservices","microsoft.security/antimalwaresettings","microsoft.securityinsights/settings","microsoft.servicebus/namespaces","microsoft.signalrservice/signalr","microsoft.signalrservice/webpubsub","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/managedinstances/databases","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/tableservices","microsoft.storagecache/caches","microsoft.storagesync/storagesyncservices","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.videoindexer/accounts","microsoft.vmwarecloudsimple/virtualmachines","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots"].map((e=>`"${e}"`)).join(",");class ys extends Kr.CK{constructor(e,r){super(e),vs(this,"resourcePath",void 0),vs(this,"resultLimit",200),vs(this,"azureMonitorDatasource",void 0),vs(this,"supportedMetricNamespaces",""),vs(this,"search",(async(e,r)=>{let s="resources";"logs"===r&&(s+="\n      | union resourcecontainers"),s+=`\n        | where id contains "${e}"\n        ${await this.filterByType(r)}\n        | order by tolower(name) asc\n        | limit ${this.resultLimit}\n      `;const{data:t}=await this.makeResourceGraphRequest(s);return t.map((e=>{var r;const s=$e(e.id);if(!s||!(s.resourceName||s.resourceGroup||s.subscription))throw new Error("unable to fetch resource details");let t=null!==(r=s.subscription)&&void 0!==r?r:"",o=Ce.Subscription;return s.resourceName?(t=s.resourceName,o=Ce.Resource):s.resourceGroup&&(t=s.resourceGroup,o=Ce.ResourceGroup),{name:e.name,id:t,uri:e.id,resourceGroupName:e.resourceGroup,type:o,typeLabel:hs[e.type]||e.type,location:gs[e.location]||e.location}}))})),vs(this,"filterByType",(async e=>(""===this.supportedMetricNamespaces&&"logs"!==e&&await this.fetchAllNamespaces(),"logs"===e?`| where type in (${bs})`:`| where type in (${this.supportedMetricNamespaces})`))),this.resourcePath=`${w}`,this.azureMonitorDatasource=r}async fetchInitialRows(e,r){const s=await this.getSubscriptions();if(!r)return s;let t=s;if(r.subscription){const s=`/subscriptions/${r.subscription}/resourceGroups/${r.resourceGroup}`;if(r.resourceGroup){const s=await this.getResourceGroupsBySubscriptionId(r.subscription,e);t=Be(t,`/subscriptions/${r.subscription}`,s)}if(r.resourceName){t=Be(t,s,await this.getResourcesForResourceGroup(s,e))}}return t}async fetchAndAppendNestedRow(e,r,s){const t=r.type===Ce.Subscription?await this.getResourceGroupsBySubscriptionId(r.id,s):await this.getResourcesForResourceGroup(r.id,s);return Be(e,r.uri,t)}async getSubscriptions(){let e,r=[],s=!1;for(;!s;){let t={};e&&(t={$skipToken:e});const o=await this.makeResourceGraphRequest("\n    resources\n    | join kind=inner (\n              ResourceContainers\n                | where type == 'microsoft.resources/subscriptions'\n                | project subscriptionName=name, subscriptionURI=id, subscriptionId\n              ) on subscriptionId\n    | summarize count() by subscriptionName, subscriptionURI, subscriptionId\n    | order by subscriptionName desc\n  ",1,t);if(!o.data.length)throw new Error("No subscriptions were found");r=r.concat(o.data),e=o.$skipToken,s=!e}return r.map((e=>({name:e.subscriptionName,id:e.subscriptionId,uri:`/subscriptions/${e.subscriptionId}`,typeLabel:"Subscription",type:Ce.Subscription,children:[]})))}async getResourceGroupsBySubscriptionId(e,r){const s=`\n    resources\n     | join kind=inner (\n       ResourceContainers\n       | where type == 'microsoft.resources/subscriptions/resourcegroups'\n       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId\n     ) on resourceGroup, subscriptionId\n\n     ${await this.filterByType(r)}\n     | where subscriptionId == '${e}'\n     | summarize count() by resourceGroupName, resourceGroupURI\n     | order by resourceGroupURI asc`;let t,o=[],i=!1;for(;!i;){let e={};t&&(e={$skipToken:t});const r=await this.makeResourceGraphRequest(s,1,e);o=o.concat(r.data),t=r.$skipToken,i=!t}return o.map((e=>{const r=$e(e.resourceGroupURI);if(!r||!r.resourceGroup)throw new Error("unable to fetch resource groups");return{name:e.resourceGroupName,uri:e.resourceGroupURI,id:r.resourceGroup,type:Ce.ResourceGroup,typeLabel:"Resource Group",children:[]}}))}async getResourcesForResourceGroup(e,r){const{data:s}=await this.makeResourceGraphRequest(`\n      resources\n      | where id hasprefix "${e}"\n      ${await this.filterByType(r)} and location in (${fs})\n    `);return s.map((e=>{const r=$e(e.id);if(!r||!r.resourceName)throw new Error("unable to fetch resource details");return{name:e.name,id:r.resourceName,uri:e.id,resourceGroupName:e.resourceGroup,type:Ce.Resource,typeLabel:hs[e.type]||e.type,location:gs[e.location]||e.location}}))}async getResourceURIDisplayProperties(e){var r;const{subscription:s,resourceGroup:t,resourceName:o}=null!==(r=We(e))&&void 0!==r?r:{};if(!s)throw new Error("Invalid resource URI passed");const i=`/subscriptions/${s}`,a=`\n    resourcecontainers\n    | where type == "microsoft.resources/subscriptions"\n    | where id =~ "${i}"\n    | project subscriptionName=name, subscriptionId\n\n    | join kind=leftouter (\n      resourcecontainers            \n            | where type == "microsoft.resources/subscriptions/resourcegroups"\n            | where id =~ "${`${i}/resourceGroups/${t}`}"\n            | project resourceGroupName=name, resourceGroup, subscriptionId\n        ) on subscriptionId\n\n        | join kind=leftouter (\n          resources\n            | where id =~ "${e}"\n            | project resourceName=name, subscriptionId\n        ) on subscriptionId\n\n        | project subscriptionName, resourceGroupName, resourceName\n    `,{data:n}=await this.makeResourceGraphRequest(a);if(!n.length)throw new Error("unable to fetch resource details");const{subscriptionName:c,resourceGroupName:u,resourceName:l}=n[0];return{subscription:c||s,resourceGroup:u||t,resourceName:l||o}}async getResourceURIFromWorkspace(e){const{data:r}=await this.makeResourceGraphRequest(`\n      resources\n      | where properties['customerId'] == "${e}"\n      | project id\n    `);if(!r.length)throw new Error("unable to find resource for workspace "+e);return r[0].id}async makeResourceGraphRequest(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;try{return await this.postResource(this.resourcePath+"/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",{query:e,options:Object.assign({resultFormat:"objectArray"},s)})}catch(s){if(r>0)return this.makeResourceGraphRequest(e,r-1);throw s}}async fetchAllNamespaces(){const e=await this.getSubscriptions();let r=[];for await(const s of e){const e=await this.azureMonitorDatasource.getMetricNamespaces({resourceUri:`/subscriptions/${s.id}`},!0);if(e){const s=e.map((e=>`"${e.value.toLocaleLowerCase()}"`));r=r.concat(s)}}this.supportedMetricNamespaces=(0,p.uniq)(r).join(",")}}function ws(e){var r,s,t,o,i;const a="string"==typeof e.rawQuery?e.rawQuery:null,n="string"==typeof e.workspace?e.workspace:null;if(!a||!n||null!==(r=e.target)&&void 0!==r&&null!==(s=r.azureLogAnalytics)&&void 0!==s&&s.query)return e;const c=Object.assign({},null!==(t=e.target)&&void 0!==t?t:{},{refId:null!==(o=null===(i=e.target)||void 0===i?void 0:i.refId)&&void 0!==o?o:"Anno",queryType:N.LogAnalytics,azureLogAnalytics:{query:a,resource:n}});return Object.assign({},e,{rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:c})}var ks=s(58799),Ss=s(74184),Ns=s(81351);const js=e=>({subscriptions:e.match(/^Subscriptions\(\)/i),resourceGroups:e.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:e.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespaces:e.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespacesWithSub:e.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:e.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:e.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:e.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:e.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:e.match(/^workspaces\(\)/i),workspacesQueryWithSub:e.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),zs=async(e,r)=>"string"!=typeof e?e:(e=>{const r=js(e);return Object.keys(r).some((e=>!!r[e]))})(e)?((e,r)=>{const s=js(e),t=r.azureMonitorDatasource.defaultSubscriptionId;return{refId:"A",queryType:N.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:s.appInsightsMetricNameQuery?{rawQuery:e,kind:"AppInsightsMetricNameQuery"}:s.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:e,metricName:s.appInsightsGroupByQuery[1]}:s.subscriptions?{kind:"SubscriptionsQuery",rawQuery:e}:s.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:s.resourceGroupsWithSub[1]}:s.resourceGroups&&t?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:t}:s.namespacesWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s.namespacesWithSub[1],resourceGroup:s.namespacesWithSub[2]}:s.namespaces&&t?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:t,resourceGroup:s.namespaces[1]}:s.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:e,subscription:s.resourceNamesWithSub[1],resourceGroup:s.resourceNamesWithSub[2],metricNamespace:s.resourceNamesWithSub[3]}:s.resourceNames&&t?{kind:"ResourceNamesQuery",rawQuery:e,subscription:t,resourceGroup:s.resourceNames[1],metricNamespace:s.resourceNames[2]}:s.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s.metricNamespaceWithSub[1],resourceGroup:s.metricNamespaceWithSub[2],metricNamespace:s.metricNamespaceWithSub[3],resourceName:s.metricNamespaceWithSub[4]}:s.metricNamespace&&t?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:t,resourceGroup:s.metricNamespace[1],metricNamespace:s.metricNamespace[2],resourceName:s.metricNamespace[3]}:s.metricNames&&t&&-1===s.metricNames[3].indexOf(",")?{kind:"MetricNamesQuery",rawQuery:e,subscription:t,resourceGroup:s.metricNames[1],metricNamespace:s.metricNames[2],resourceName:s.metricNames[3]}:s.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:e,subscription:s.metricNamesWithSub[1],resourceGroup:s.metricNamesWithSub[2],metricNamespace:s.metricNamesWithSub[3],resourceName:s.metricNamesWithSub[4]}:s.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:e,subscription:(s.workspacesQueryWithSub[1]||"").trim()}:s.workspacesQuery&&t?{kind:"WorkspacesQuery",rawQuery:e,subscription:t}:{kind:"SubscriptionsQuery",rawQuery:e},subscription:t}})(e,r.datasource):(async(e,r)=>{const s=r.azureMonitorDatasource.defaultSubscriptionId;let t="";if(e){const e=r.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();t=e?Ue(e)?await r.resourcePickerData.getResourceURIFromWorkspace(e):e:await r.azureLogAnalyticsDatasource.getFirstWorkspace()||""}return{refId:"A",queryType:N.LogAnalytics,azureLogAnalytics:{query:e,resource:t},subscription:s}})(e,r.datasource),xs=async(e,r)=>{let s=await zs(e,r);return S.v.featureToggles.azLegacyTemplateVariables||s.queryType!==N.GrafanaTemplateVariableFn||(s=(e=>{const{queryType:r,grafanaTemplateVariableFn:s}=e;if(r!==N.GrafanaTemplateVariableFn||!s)return e;const t=Object.assign({},e);switch("subscription"in s&&(t.subscription=s.subscription),"resourceGroup"in s&&(t.resourceGroup=s.resourceGroup),"metricNamespace"in s&&(t.namespace=s.metricNamespace),"resourceName"in s&&(t.resource=s.resourceName),s.kind){case"SubscriptionsQuery":t.queryType=N.SubscriptionsQuery;break;case"ResourceGroupsQuery":t.queryType=N.ResourceGroupsQuery;break;case"ResourceNamesQuery":t.queryType=N.ResourceNamesQuery;break;case"MetricNamespaceQuery":case"MetricDefinitionsQuery":t.queryType=N.NamespacesQuery;break;case"MetricNamesQuery":t.queryType=N.MetricNamesQuery;break;case"WorkspacesQuery":t.queryType=N.WorkspacesQuery}return t})(s)),s},As=e=>{var r;let{query:s,updateQuery:t,datasource:o}=e;const[i,n]=(0,a.useState)("");(0,a.useEffect)((()=>{var e;n((null===(e=s.grafanaTemplateVariableFn)||void 0===e?void 0:e.rawQuery)||"")}),[null===(r=s.grafanaTemplateVariableFn)||void 0===r?void 0:r.rawQuery]);const c=(0,a.useCallback)((e=>{zs(e,{datasource:o}).then((r=>{r.queryType===N.GrafanaTemplateVariableFn?t(r):t(Object.assign({},s,{grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:e}}))}))}),[o,s,t]);return(0,V.jsx)(re._,{label:"Grafana template variable function",children:(0,V.jsx)(Ne.I,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:i,onChange:e=>{n(e.target.value)},onBlur:()=>c(i)})})};var Cs,Gs;const Ms={label:"-",value:""},Is=e=>{const{query:r,onChange:s,datasource:t}=e,o=[{label:"Subscriptions",value:N.SubscriptionsQuery},{label:"Resource Groups",value:N.ResourceGroupsQuery},{label:"Namespaces",value:N.NamespacesQuery},{label:"Resource Names",value:N.ResourceNamesQuery},{label:"Metric Names",value:N.MetricNamesQuery},{label:"Workspaces",value:N.WorkspacesQuery},{label:"Resource Graph",value:N.AzureResourceGraph},{label:"Logs",value:N.LogAnalytics}];"object"==typeof e.query&&e.query.queryType===N.GrafanaTemplateVariableFn&&o.push({label:"Grafana Query Function",value:N.GrafanaTemplateVariableFn});const[i,n]=(0,a.useState)({label:"Template Variables",options:[]}),[c,u]=(0,a.useState)(!1),[m,d]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1),[h,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[S,j]=(0,a.useState)([]),[z,x]=(0,a.useState)([]),[A,C]=(0,a.useState)([]),[G,M]=(0,a.useState)([]),[I,R]=Y(),T="string"==typeof r?"":r.queryType;(0,a.useEffect)((()=>{xs(r,{datasource:t}).then((e=>{s(e)}))}),[r,t,s]),(0,a.useEffect)((()=>{switch(u(!1),d(!1),g(!1),v(!1),y(!1),k(!1),T){case N.ResourceGroupsQuery:case N.WorkspacesQuery:u(!0);break;case N.NamespacesQuery:u(!0),d(!0);break;case N.ResourceNamesQuery:u(!0),d(!0),g(!0);break;case N.MetricNamesQuery:u(!0),v(!0),y(!0),k(!0)}}),[T]),(0,a.useEffect)((()=>{const e=[];t.getVariablesRaw().forEach((r=>{(0,p.get)(r,"query.queryType")!==T&&e.push({label:r.label||r.name,value:`$${r.name}`})})),n({label:"Template Variables",options:e})}),[t,T]),(0,de.Z)((()=>{t.getSubscriptions().then((e=>{j(e.map((e=>({label:e.text,value:e.value}))))}))}));const L="object"==typeof r&&r.subscription;(0,a.useEffect)((()=>{L&&t.getResourceGroups(L).then((e=>{x(e.map((e=>({label:e.text,value:e.value}))))}))}),[t,L]);const O="object"==typeof r&&r.resourceGroup||"";(0,a.useEffect)((()=>{L&&t.getMetricNamespaces(L,O).then((e=>{C(e.map((e=>({label:e.text,value:e.value}))))}))}),[t,L,O]);const q="object"==typeof r&&r.namespace||"";if((0,a.useEffect)((()=>{L&&t.getResourceNames(L,O,q).then((e=>{M(e.map((e=>({label:e.text,value:e.value}))))}))}),[t,L,O,q]),"string"==typeof r)return null;const D=e=>{s(e)};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(re._,{label:"Select query type",labelWidth:20,children:(0,V.jsx)(E.Ph,{"aria-label":"select query type",onChange:e=>{e.value&&s(Object.assign({},r,{queryType:e.value,subscription:void 0,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:o,width:25,value:T})}),r.queryType===N.LogAnalytics&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(wr,{subscriptionId:r.subscription,query:r,datasource:t,onChange:D,variableOptionGroup:i,setError:R,hideFormatAs:!0}),I&&(0,V.jsxs)(V.Fragment,{children:[Cs||(Cs=(0,V.jsx)(he,{v:2})),(0,V.jsx)(l.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:I})]})]}),r.queryType===N.GrafanaTemplateVariableFn&&(0,V.jsx)(As,{query:r,updateQuery:e.onChange,datasource:t}),c&&(0,V.jsx)(re._,{label:"Select subscription",labelWidth:20,children:(0,V.jsx)(E.Ph,{"aria-label":"select subscription",onChange:e=>{e.value&&s(Object.assign({},r,{subscription:e.value,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:S.concat(i),width:25,value:r.subscription||null})}),(h||m)&&(0,V.jsx)(re._,{label:"Select resource group",labelWidth:20,children:(0,V.jsx)(E.Ph,{"aria-label":"select resource group",onChange:e=>{s(Object.assign({},r,{resourceGroup:e.value,namespace:void 0,resource:void 0}))},options:h?z.concat(i):z.concat(i,Ms),width:25,value:r.resourceGroup||null,placeholder:h?void 0:"Optional"})}),(b||f)&&(0,V.jsx)(re._,{label:"Select namespace",labelWidth:20,children:(0,V.jsx)(E.Ph,{"aria-label":"select namespace",onChange:e=>{s(Object.assign({},r,{namespace:e.value,resource:void 0}))},options:b?A.concat(i):A.concat(i,Ms),width:25,value:r.namespace||null,placeholder:b?void 0:"Optional"})}),w&&(0,V.jsx)(re._,{label:"Select resource",labelWidth:20,children:(0,V.jsx)(E.Ph,{"aria-label":"select resource",onChange:e=>{s(Object.assign({},r,{resource:e.value}))},options:G.concat(i),width:25,value:r.resource||null})}),r.queryType===N.AzureResourceGraph&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(ce,{subscriptionId:t.azureLogAnalyticsDatasource.defaultSubscriptionId,query:r,datasource:t,onChange:D,variableOptionGroup:i,setError:R}),I&&(0,V.jsxs)(V.Fragment,{children:[Gs||(Gs=(0,V.jsx)(he,{v:2})),(0,V.jsx)(l.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:I})]})]})]})};class Rs extends Ss.Mg{constructor(e){var r,s,t;super(),t=Is,(s="editor")in(r=this)?Object.defineProperty(r,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[s]=t,this.datasource=e,this.datasource=e,this.query=this.query.bind(this)}query(e){return(0,Yr.D)((async()=>{const r=await xs(e.targets[0],{datasource:this.datasource});try{switch(r.queryType){case N.SubscriptionsQuery:const s=await this.datasource.getSubscriptions();return{data:null!=s&&s.length?[(0,Ns.g0)(s)]:[]};case N.ResourceGroupsQuery:if(r.subscription){const e=await this.datasource.getResourceGroups(r.subscription);return{data:null!=e&&e.length?[(0,Ns.g0)(e)]:[]}}case N.NamespacesQuery:if(r.subscription){const e=await this.datasource.getMetricNamespaces(r.subscription,r.resourceGroup);return{data:null!=e&&e.length?[(0,Ns.g0)(e)]:[]}}case N.ResourceNamesQuery:if(r.subscription){const e=await this.datasource.getResourceNames(r.subscription,r.resourceGroup,r.namespace);return{data:null!=e&&e.length?[(0,Ns.g0)(e)]:[]}}case N.MetricNamesQuery:if(r.subscription&&r.resourceGroup&&r.namespace&&r.resource){const e=await this.datasource.getMetricNames(r.subscription,r.resourceGroup,r.namespace,r.resource);return{data:null!=e&&e.length?[(0,Ns.g0)(e)]:[]}}case N.WorkspacesQuery:if(r.subscription){const e=await this.datasource.getAzureLogAnalyticsWorkspaces(r.subscription);return{data:null!=e&&e.length?[(0,Ns.g0)(e)]:[]}}case N.GrafanaTemplateVariableFn:if(r.grafanaTemplateVariableFn){const e=await this.callGrafanaTemplateVariableFn(r.grafanaTemplateVariableFn);return{data:null!=e&&e.length?[(0,Ns.g0)(e)]:[]}}default:e.targets[0]=r;return{data:(await(0,ks.n)(this.datasource.query(e))).data}}}catch(e){return{data:[],error:new Error(Z(e))}}})())}callGrafanaTemplateVariableFn(e){return"SubscriptionsQuery"===e.kind?this.datasource.getSubscriptions():"ResourceGroupsQuery"===e.kind?this.datasource.getResourceGroups(this.replaceVariable(e.subscription)):"ResourceNamesQuery"===e.kind?this.datasource.getResourceNames(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup),this.replaceVariable(e.metricNamespace)):"MetricNamespaceQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNamespaces(e,!0):"MetricNamesQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNames(e):"WorkspacesQuery"===e.kind?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(e.subscription)):null}replaceVariable(e){return(0,c.J)().replace((e||"").trim())}}function Ts(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}class Ls extends Kr.CK{constructor(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,Zr.J)();super(e),Ts(this,"annotations",{prepareAnnotation:ws}),Ts(this,"azureMonitorDatasource",void 0),Ts(this,"azureLogAnalyticsDatasource",void 0),Ts(this,"resourcePickerData",void 0),Ts(this,"azureResourceGraphDatasource",void 0),Ts(this,"pseudoDatasource",{}),this.templateSrv=r,this.azureMonitorDatasource=new ps(e),this.azureLogAnalyticsDatasource=new ns(e),this.azureResourceGraphDatasource=new ms(e),this.resourcePickerData=new ys(e,this.azureMonitorDatasource),this.pseudoDatasource={[N.AzureMonitor]:this.azureMonitorDatasource,[N.LogAnalytics]:this.azureLogAnalyticsDatasource,[N.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new Rs(this)}filterQuery(e){var r,s;if(!e.queryType)return!0;const t=this.pseudoDatasource[e.queryType];return null===(r=null==t||null===(s=t.filterQuery)||void 0===s?void 0:s.call(t,e))||void 0===r||r}query(e){const r=new Map;for(const s of e.targets){const t=Er(s);if(!t.queryType||t.hide||!Os(t))continue;if(!r.has(t.queryType)){const s=(0,p.cloneDeep)(e);s.requestId=`${s.requestId}-${t.refId}`,s.targets=[],r.set(t.queryType,s)}const o=r.get(t.queryType);null==o||o.targets.push(t)}const s=Array.from(r.entries()).map((e=>{let[r,s]=e;const t=this.pseudoDatasource[r];if(!t)throw new Error("Data source not created for query type "+r);return t.query(s)}));return 1===s.length?s[0]:s.length>1?(0,_r.D)(s).pipe((0,Jr.U)((e=>{const r=[];for(const s of e)for(const e of s.data)r.push(e);return{state:Hr.Gu.Done,data:r}}))):(0,Br.of)({state:Hr.Gu.Done,data:[]})}targetContainsTemplate(e){if(e.subscription&&this.templateSrv.containsTemplate(e.subscription))return!0;let r;return e.queryType===N.AzureMonitor?r=JSON.stringify(e.azureMonitor):e.queryType===N.LogAnalytics?r=JSON.stringify(e.azureLogAnalytics):e.queryType===N.AzureResourceGraph&&(r=JSON.stringify([e.azureResourceGraph,e.subscriptions])),!!r&&this.templateSrv.containsTemplate(r)}async annotationQuery(e){return this.azureLogAnalyticsDatasource.annotationQuery(e)}getResourceGroups(e){return this.azureMonitorDatasource.getResourceGroups(this.templateSrv.replace(e))}getMetricNamespaces(e,r){let s=`/subscriptions/${e}`;return r&&(s+=`/resourceGroups/${r};`),this.azureMonitorDatasource.getMetricNamespaces({resourceUri:s},!0)}getResourceNames(e,r,s){return this.azureMonitorDatasource.getResourceNames(this.templateSrv.replace(e),this.templateSrv.replace(r),this.templateSrv.replace(s))}getMetricNames(e,r,s,t){return this.azureMonitorDatasource.getMetricNames({subscription:e,resourceGroup:r,metricNamespace:s,resourceName:t})}getAzureLogAnalyticsWorkspaces(e){return this.azureLogAnalyticsDatasource.getWorkspaces(e)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(e,r){return e.map((e=>{var s;if(!e.queryType)return e;const t=this.pseudoDatasource[e.queryType];return Object.assign({datasource:null==t?void 0:t.getRef()},null!==(s=null==t?void 0:t.applyTemplateVariables(e,r))&&void 0!==s?s:e)}))}getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}getVariablesRaw(){return this.templateSrv.getVariables()}}function Os(e){switch(e.queryType){case N.AzureMonitor:return!!e.azureMonitor;case N.LogAnalytics:return!!e.azureLogAnalytics;case N.AzureResourceGraph:return!!e.azureResourceGraph;case N.GrafanaTemplateVariableFn:return!!e.grafanaTemplateVariableFn;default:return!1}}var qs=s(14285),Ds=s(21295);const Ps=new t.hf(Ls).setConfigEditor(H).setQueryEditor(Xr);(0,i.N$)().subscribe(o.Pl,(e=>{let{payload:{dashboardId:r,orgId:s,userId:t,grafanaVersion:o,queries:i}}=e;const a=i[qs.id];let n={[N.AzureMonitor]:{hidden:0,visible:0},[N.LogAnalytics]:{hidden:0,visible:0},[N.AzureResourceGraph]:{hidden:0,visible:0}};var c;a.forEach((e=>{e.queryType!==N.AzureMonitor&&e.queryType!==N.LogAnalytics&&e.queryType!==N.AzureResourceGraph||n[e.queryType][e.hide?"hidden":"visible"]++})),a&&a.length>0&&(c={grafana_version:o,dashboard_id:r,org_id:s,azure_monitor_queries:n[N.AzureMonitor].visible,azure_log_analytics_queries:n[N.LogAnalytics].visible,azure_resource_graph_queries:n[N.AzureResourceGraph].visible,azure_monitor_queries_hidden:n[N.AzureMonitor].hidden,azure_log_analytics_queries_hidden:n[N.LogAnalytics].hidden,azure_resource_graph_queries_hidden:n[N.AzureResourceGraph].hidden},(0,Ds.ff)("grafana_ds_azuremonitor_dashboard_loaded",c))}))},28953:(e,r,s)=>{function t(e){for(var r=arguments.length,s=Array(r>1?r-1:0),t=1;t<r;t++)s[t-1]=arguments[t];throw Error("[Immer] minified error nr: "+e+(s.length?" "+s.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function o(e){return!!e&&!!e[U]}function i(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var r=Object.getPrototypeOf(e);if(null===r)return!0;var s=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return s===Object||"function"==typeof s&&Function.toString.call(s)===X}(e)||Array.isArray(e)||!!e[W]||!!e.constructor[W]||m(e)||d(e))}function a(e,r,s){void 0===s&&(s=!1),0===n(e)?(s?Object.keys:_)(e).forEach((function(t){s&&"symbol"==typeof t||r(t,e[t],e)})):e.forEach((function(s,t){return r(t,s,e)}))}function n(e){var r=e[U];return r?r.i>3?r.i-4:r.i:Array.isArray(e)?1:m(e)?2:d(e)?3:0}function c(e,r){return 2===n(e)?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function u(e,r){return 2===n(e)?e.get(r):e[r]}function l(e,r,s){var t=n(e);2===t?e.set(r,s):3===t?(e.delete(r),e.add(s)):e[r]=s}function p(e,r){return e===r?0!==e||1/e==1/r:e!=e&&r!=r}function m(e){return E&&e instanceof Map}function d(e){return Q&&e instanceof Set}function f(e){return e.o||e.t}function g(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var r=B(e);delete r[U];for(var s=_(r),t=0;t<s.length;t++){var o=s[t],i=r[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(r[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),r)}function h(e,r){return void 0===r&&(r=!1),b(e)||o(e)||!i(e)||(n(e)>1&&(e.set=e.add=e.clear=e.delete=v),Object.freeze(e),r&&a(e,(function(e,r){return h(r,!0)}),!0)),e}function v(){t(2)}function b(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function y(e){var r=J[e];return r||t(18,e),r}function w(){return P}function k(e,r){r&&(y("Patches"),e.u=[],e.s=[],e.v=r)}function S(e){N(e),e.p.forEach(z),e.p=null}function N(e){e===P&&(P=e.l)}function j(e){return P={p:[],l:P,h:e,m:!0,_:0}}function z(e){var r=e[U];0===r.i||1===r.i?r.j():r.O=!0}function x(e,r){r._=r.p.length;var s=r.p[0],o=void 0!==e&&e!==s;return r.h.g||y("ES5").S(r,e,o),o?(s[U].P&&(S(r),t(4)),i(e)&&(e=A(r,e),r.l||G(r,e)),r.u&&y("Patches").M(s[U].t,e,r.u,r.s)):e=A(r,s,[]),S(r),r.u&&r.v(r.u,r.s),e!==$?e:void 0}function A(e,r,s){if(b(r))return r;var t=r[U];if(!t)return a(r,(function(o,i){return C(e,t,r,o,i,s)}),!0),r;if(t.A!==e)return r;if(!t.P)return G(e,t.t,!0),t.t;if(!t.I){t.I=!0,t.A._--;var o=4===t.i||5===t.i?t.o=g(t.k):t.o;a(3===t.i?new Set(o):o,(function(r,i){return C(e,t,o,r,i,s)})),G(e,o,!1),s&&e.u&&y("Patches").R(t,s,e.u,e.s)}return t.o}function C(e,r,s,t,a,n){if(o(a)){var u=A(e,a,n&&r&&3!==r.i&&!c(r.D,t)?n.concat(t):void 0);if(l(s,t,u),!o(u))return;e.m=!1}if(i(a)&&!b(a)){if(!e.h.F&&e._<1)return;A(e,a),r&&r.A.l||G(e,a)}}function G(e,r,s){void 0===s&&(s=!1),e.h.F&&e.m&&h(r,s)}function M(e,r){var s=e[U];return(s?f(s):e)[r]}function I(e,r){if(r in e)for(var s=Object.getPrototypeOf(e);s;){var t=Object.getOwnPropertyDescriptor(s,r);if(t)return t;s=Object.getPrototypeOf(s)}}function R(e){e.P||(e.P=!0,e.l&&R(e.l))}function T(e){e.o||(e.o=g(e.t))}function L(e,r,s){var t=m(r)?y("MapSet").N(r,s):d(r)?y("MapSet").T(r,s):e.g?function(e,r){var s=Array.isArray(e),t={i:s?1:0,A:r?r.A:w(),P:!1,I:!1,D:{},l:r,t:e,k:null,o:null,j:null,C:!1},o=t,i=H;s&&(o=[t],i=K);var a=Proxy.revocable(o,i),n=a.revoke,c=a.proxy;return t.k=c,t.j=n,c}(r,s):y("ES5").J(r,s);return(s?s.A:w()).p.push(t),t}function O(e){return o(e)||t(22,e),function e(r){if(!i(r))return r;var s,t=r[U],o=n(r);if(t){if(!t.P&&(t.i<4||!y("ES5").K(t)))return t.t;t.I=!0,s=q(r,o),t.I=!1}else s=q(r,o);return a(s,(function(r,o){t&&u(t.t,r)===o||l(s,r,e(o))})),3===o?new Set(s):s}(e)}function q(e,r){switch(r){case 2:return new Map(e);case 3:return Array.from(e)}return g(e)}s.d(r,{ZP:()=>re});var D,P,F="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),E="undefined"!=typeof Map,Q="undefined"!=typeof Set,V="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,$=F?Symbol.for("immer-nothing"):((D={})["immer-nothing"]=!0,D),W=F?Symbol.for("immer-draftable"):"__$immer_draftable",U=F?Symbol.for("immer-state"):"__$immer_state",X=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),_="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,B=Object.getOwnPropertyDescriptors||function(e){var r={};return _(e).forEach((function(s){r[s]=Object.getOwnPropertyDescriptor(e,s)})),r},J={},H={get:function(e,r){if(r===U)return e;var s=f(e);if(!c(s,r))return function(e,r,s){var t,o=I(r,s);return o?"value"in o?o.value:null===(t=o.get)||void 0===t?void 0:t.call(e.k):void 0}(e,s,r);var t=s[r];return e.I||!i(t)?t:t===M(e.t,r)?(T(e),e.o[r]=L(e.A.h,t,e)):t},has:function(e,r){return r in f(e)},ownKeys:function(e){return Reflect.ownKeys(f(e))},set:function(e,r,s){var t=I(f(e),r);if(null==t?void 0:t.set)return t.set.call(e.k,s),!0;if(!e.P){var o=M(f(e),r),i=null==o?void 0:o[U];if(i&&i.t===s)return e.o[r]=s,e.D[r]=!1,!0;if(p(s,o)&&(void 0!==s||c(e.t,r)))return!0;T(e),R(e)}return e.o[r]===s&&"number"!=typeof s&&(void 0!==s||r in e.o)||(e.o[r]=s,e.D[r]=!0,!0)},deleteProperty:function(e,r){return void 0!==M(e.t,r)||r in e.t?(e.D[r]=!1,T(e),R(e)):delete e.D[r],e.o&&delete e.o[r],!0},getOwnPropertyDescriptor:function(e,r){var s=f(e),t=Reflect.getOwnPropertyDescriptor(s,r);return t?{writable:!0,configurable:1!==e.i||"length"!==r,enumerable:t.enumerable,value:s[r]}:t},defineProperty:function(){t(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){t(12)}},K={};a(H,(function(e,r){K[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),K.deleteProperty=function(e,r){return K.set.call(this,e,r,void 0)},K.set=function(e,r,s){return H.set.call(this,e[0],r,s,e[0])};var Z=function(){function e(e){var r=this;this.g=V,this.F=!0,this.produce=function(e,s,o){if("function"==typeof e&&"function"!=typeof s){var a=s;s=e;var n=r;return function(e){var r=this;void 0===e&&(e=a);for(var t=arguments.length,o=Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return n.produce(e,(function(e){var t;return(t=s).call.apply(t,[r,e].concat(o))}))}}var c;if("function"!=typeof s&&t(6),void 0!==o&&"function"!=typeof o&&t(7),i(e)){var u=j(r),l=L(r,e,void 0),p=!0;try{c=s(l),p=!1}finally{p?S(u):N(u)}return"undefined"!=typeof Promise&&c instanceof Promise?c.then((function(e){return k(u,o),x(e,u)}),(function(e){throw S(u),e})):(k(u,o),x(c,u))}if(!e||"object"!=typeof e){if(void 0===(c=s(e))&&(c=e),c===$&&(c=void 0),r.F&&h(c,!0),o){var m=[],d=[];y("Patches").M(e,c,m,d),o(m,d)}return c}t(21,e)},this.produceWithPatches=function(e,s){if("function"==typeof e)return function(s){for(var t=arguments.length,o=Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return r.produceWithPatches(s,(function(r){return e.apply(void 0,[r].concat(o))}))};var t,o,i=r.produce(e,s,(function(e,r){t=e,o=r}));return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return[e,t,o]})):[i,t,o]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var r=e.prototype;return r.createDraft=function(e){i(e)||t(8),o(e)&&(e=O(e));var r=j(this),s=L(this,e,void 0);return s[U].C=!0,N(r),s},r.finishDraft=function(e,r){var s=(e&&e[U]).A;return k(s,r),x(void 0,s)},r.setAutoFreeze=function(e){this.F=e},r.setUseProxies=function(e){e&&!V&&t(20),this.g=e},r.applyPatches=function(e,r){var s;for(s=r.length-1;s>=0;s--){var t=r[s];if(0===t.path.length&&"replace"===t.op){e=t.value;break}}s>-1&&(r=r.slice(s+1));var i=y("Patches").$;return o(e)?i(e,r):this.produce(e,(function(e){return i(e,r)}))},e}(),Y=new Z,ee=Y.produce;Y.produceWithPatches.bind(Y),Y.setAutoFreeze.bind(Y),Y.setUseProxies.bind(Y),Y.applyPatches.bind(Y),Y.createDraft.bind(Y),Y.finishDraft.bind(Y);const re=ee}}]);
//# sourceMappingURL=3499.cdd66e7ab1c06d0d350f.js.map