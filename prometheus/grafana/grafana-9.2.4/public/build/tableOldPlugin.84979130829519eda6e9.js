"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6784],{63773:(t,e,s)=>{s.d(e,{O:()=>l});var a=s(49198),n=s(87982),i=s(98712);const r={http:80,https:443,ftp:21};class l{constructor(){this.absUrl=this.wrapInDeprecationWarning(this.absUrl),this.hash=this.wrapInDeprecationWarning(this.hash),this.host=this.wrapInDeprecationWarning(this.host),this.path=this.wrapInDeprecationWarning(this.path),this.port=this.wrapInDeprecationWarning(this.port,"window.location"),this.protocol=this.wrapInDeprecationWarning(this.protocol,"window.location"),this.replace=this.wrapInDeprecationWarning(this.replace),this.search=this.wrapInDeprecationWarning(this.search),this.state=this.wrapInDeprecationWarning(this.state),this.url=this.wrapInDeprecationWarning(this.url)}wrapInDeprecationWarning(t,e){let s=this;return function(){return(0,a.d)("$location",t.name,e||"locationService"),t.apply(s,arguments)}}absUrl(){return`${window.location.origin}${this.url()}`}hash(t){if((0,i.GQ)("AngularLocationWrapper",!1,"Angular compat layer: hash"),t)throw new Error("AngularLocationWrapper method not implemented.");return i.E1.getLocation().hash.slice(1)}host(){return new URL(window.location.href).hostname}path(t){(0,i.GQ)("AngularLocationWrapper",!1,"Angular compat layer: path");const e=i.E1.getLocation();if(null!=t){let s=String(t);s=s.startsWith("/")?s:`/${s}`;const a=new URL(`${window.location.origin}${s}`);return i.E1.push({pathname:a.pathname,search:a.search.length>0?a.search:e.search,hash:a.hash.length>0?a.hash:e.hash}),this}return null===t?(i.E1.push("/"),this):e.pathname}port(){const t=new URL(window.location.href);return parseInt(t.port,10)||r[t.protocol]||null}protocol(){return new URL(window.location.href).protocol.slice(0,-1)}replace(){throw new Error("AngularLocationWrapper method not implemented.")}search(t,e){if((0,i.GQ)("AngularLocationWrapper",!1,"Angular compat layer: search"),!t)return i.E1.getSearchObject();if(t&&arguments.length>1)return i.E1.partial({[t]:e}),this;if(t){let e;e="object"==typeof t?Object.assign({},t):(0,i.Ox)(t);for(const t of Object.keys(e))null!==e[t]&&void 0!==e[t]||delete e[t];const s=n.Cj.renderUrl(i.E1.getLocation().pathname,e);i.E1.push(s)}return this}state(t){throw(0,i.GQ)("AngularLocationWrapper",!1,"Angular compat layer: state"),new Error("AngularLocationWrapper method not implemented.")}url(t){if((0,i.GQ)("AngularLocationWrapper",!1,"Angular compat layer: url"),void 0!==t)return t.startsWith("#")?i.E1.push(Object.assign({},i.E1.getLocation(),{hash:t})):t.startsWith("?")?i.E1.push(Object.assign({},i.E1.getLocation(),{search:t})):0===t.trim().length?i.E1.push("/"):i.E1.push(t),i.E1;const e=i.E1.getLocation();return`${e.pathname}${e.search}${e.hash}`}}},15866:(t,e,s)=>{s.d(e,{k:()=>u});var a=s(82897),n=s(5937),i=s(81351),r=s(19383),l=s(91082),o=s(60301);function h(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class u extends l.q{constructor(t,e){super(t,e),h(this,"contextSrv",void 0),h(this,"datasourceSrv",void 0),h(this,"timeSrv",void 0),h(this,"templateSrv",void 0),h(this,"interval",void 0),h(this,"intervalMs",void 0),h(this,"resolution",void 0),h(this,"timeInfo",void 0),h(this,"skipDataOnInit",!1),h(this,"dataList",[]),h(this,"querySubscription",void 0),h(this,"useDataFrames",!1),h(this,"panelData",void 0),h(this,"panelDataObserver",{next:t=>{if(this.panelData=t,t.state===n.Gu.Error&&(this.loading=!1,this.processDataError(t.error)),t.state===n.Gu.Loading)return this.loading=!0,void this.angularDirtyCheck();if(t.request){const{timeInfo:e}=t.request;e&&(this.timeInfo=e)}if(t.timeRange&&(this.range=t.timeRange),this.useDataFrames)this.handleDataFrames(t.series);else{const e=t.series.map((t=>(0,i.Zr)(t)));this.handleQueryResult({data:e})}this.angularDirtyCheck()}}),this.contextSrv=e.get("contextSrv"),this.datasourceSrv=e.get("datasourceSrv"),this.timeSrv=e.get("timeSrv"),this.templateSrv=e.get("templateSrv"),this.panel.datasource=this.panel.datasource||null,this.events.on(r.Kh.refresh,this.onMetricsPanelRefresh.bind(this)),this.events.on(r.Kh.panelTeardown,this.onPanelTearDown.bind(this)),this.events.on(r.Kh.componentDidMount,this.onMetricsPanelMounted.bind(this))}onMetricsPanelMounted(){const t=this.panel.getQueryRunner();this.querySubscription=t.getData({withTransforms:!0,withFieldConfig:!0}).subscribe(this.panelDataObserver)}onPanelTearDown(){this.querySubscription&&(this.querySubscription.unsubscribe(),this.querySubscription=null)}onMetricsPanelRefresh(){if(!this.otherPanelInFullscreenMode()){if(this.panel.snapshotData){this.updateTimeRange();let t=this.panel.snapshotData;return(0,a.isArray)(t)||(t=t.data),this.panelData={state:n.Gu.Done,series:t,timeRange:this.range},this.$timeout((()=>{this.events.emit(r.Kh.dataSnapshotLoad,t)}))}return delete this.error,this.loading=!0,this.datasourceSrv.get(this.panel.datasource,this.panel.scopedVars).then(this.issueQueries.bind(this)).catch((t=>{this.processDataError(t)}))}}processDataError(t){t.cancelled?console.log("Panel request cancelled",t):(this.error=t.message||"Request Error",t.data&&(t.data.message?this.error=t.data.message:t.data.error&&(this.error=t.data.error)),this.angularDirtyCheck())}angularDirtyCheck(){this.$scope.$root.$$phase||this.$scope.$digest()}updateTimeRange(t){this.datasource=t||this.datasource,this.range=this.timeSrv.timeRange();const e=(0,o.W1)(this.panel,this.range);this.timeInfo=e.timeInfo,this.range=e.timeRange}issueQueries(t){this.updateTimeRange(t),this.datasource=t;const e=this.panel;return e.getQueryRunner().run({datasource:e.datasource,queries:e.targets,panelId:e.id,dashboardId:this.dashboard.id,timezone:this.dashboard.getTimezone(),timeInfo:this.timeInfo,timeRange:this.range,maxDataPoints:e.maxDataPoints||this.width,minInterval:e.interval,scopedVars:e.scopedVars,cacheTimeout:e.cacheTimeout,transformations:e.transformations})}handleDataFrames(t){this.loading=!1,this.dashboard&&this.dashboard.snapshot&&(this.panel.snapshotData=t.map((t=>(0,i.og)(t))));try{this.events.emit(r.Kh.dataFramesReceived,t)}catch(t){this.processDataError(t)}}handleQueryResult(t){this.loading=!1,this.dashboard.snapshot&&(this.panel.snapshotData=t.data),t&&t.data||(console.log("Data source query result invalid, missing data field:",t),t={data:[]});try{this.events.emit(r.Kh.dataReceived,t.data)}catch(t){this.processDataError(t)}}}},91082:(t,e,s)=>{s.d(e,{q:()=>u});var a=s(82897),n=s(97437),i=s(19383),r=s(63773),l=s(78837),o=s(98163);function h(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class u{constructor(t,e){var s,a;h(this,"panel",void 0),h(this,"error",void 0),h(this,"pluginName",""),h(this,"pluginId",""),h(this,"editorTabs",void 0),h(this,"$scope",void 0),h(this,"$injector",void 0),h(this,"$timeout",void 0),h(this,"editModeInitiated",!1),h(this,"containerHeight",void 0),h(this,"events",void 0),h(this,"loading",!1),h(this,"timing",void 0),h(this,"$location",void 0),h(this,"onPluginTypeChange",(t=>{})),this.panel=null!==(s=this.panel)&&void 0!==s?s:t.$parent.panel,this.dashboard=null!==(a=this.dashboard)&&void 0!==a?a:t.$parent.dashboard,this.$injector=e,this.$scope=t,this.$timeout=e.get("$timeout"),this.editorTabs=[],this.$location=new r.O,this.events=new n.F,this.timing={};const o=l.ZP.panels[this.panel.type];o&&(this.pluginId=o.id,this.pluginName=o.name),t.$on(i.Kh.componentDidMount.name,(()=>this.panelDidMount()))}panelDidMount(){this.events.emit(i.Kh.componentDidMount),this.events.emit(i.Kh.initialized),this.dashboard.panelInitialized(this.panel)}renderingCompleted(){o.rv.renderingCompleted()}refresh(){this.panel.refresh()}publishAppEvent(t,e){this.$scope.$root.appEvent(t,e)}initEditMode(){this.editModeInitiated||(this.editModeInitiated=!0,this.events.emit(i.Kh.editModeInitialized))}addEditorTab(t,e,s,n){const i={title:t,directiveFn:e,icon:n};(0,a.isString)(e)&&(i.directiveFn=()=>({templateUrl:e})),s?this.editorTabs.splice(s,0,i):this.editorTabs.push(i)}getExtendedMenu(){const t=[];return this.events.emit(i.Kh.initPanelActions,t),t}async getAdditionalMenuItems(){return[]}otherPanelInFullscreenMode(){return this.dashboard.otherPanelInFullscreen(this.panel)}render(t){this.events.emit(i.Kh.render,t)}}},88643:(t,e,s)=>{s.d(e,{G:()=>i});var a=s(82897);function n(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class i{constructor(t,e){var s,i,r,l,o;n(this,"target",void 0),n(this,"datasource",void 0),n(this,"panelCtrl",void 0),n(this,"panel",void 0),n(this,"hasRawMode",void 0),n(this,"error",void 0),n(this,"isLastQuery",void 0),this.$scope=t,this.$injector=e,this.panelCtrl=null!==(s=this.panelCtrl)&&void 0!==s?s:t.ctrl.panelCtrl,this.target=null!==(i=this.target)&&void 0!==i?i:t.ctrl.target,this.datasource=null!==(r=this.datasource)&&void 0!==r?r:t.ctrl.datasource,this.panel=null!==(l=null===(o=this.panelCtrl)||void 0===o?void 0:o.panel)&&void 0!==l?l:t.ctrl.panelCtrl.panel,this.isLastQuery=(0,a.indexOf)(this.panel.targets,this.target)===this.panel.targets.length-1}refresh(){this.panelCtrl.refresh()}}},75983:(t,e,s)=>{s.r(e),s.d(e,{TablePanelCtrl:()=>P,plugin:()=>F});var a=s(98572),n=s.n(a),i=s(82897),r=s(19383),l=s(81351),o=s(55925),h=s(78837),u=s(28380),c=s(60974),d=s(56340),p=s(49085);function m(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class g{constructor(t){m(this,"panel",void 0),m(this,"panelCtrl",void 0),m(this,"colorModes",void 0),m(this,"columnStyles",void 0),m(this,"columnTypes",void 0),m(this,"fontSizes",void 0),m(this,"dateFormats",void 0),m(this,"addColumnSegment",void 0),m(this,"unitFormats",void 0),m(this,"getColumnNames",void 0),m(this,"activeStyleIndex",void 0),m(this,"mappingTypes",void 0),m(this,"alignTypes",void 0),t.editor=this,this.activeStyleIndex=0,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.unitFormats=(0,p.QW)(),this.colorModes=[{text:"Disabled",value:null},{text:"Cell",value:"cell"},{text:"Value",value:"value"},{text:"Row",value:"row"}],this.columnTypes=[{text:"Number",value:"number"},{text:"String",value:"string"},{text:"Date",value:"date"},{text:"Hidden",value:"hidden"}],this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.dateFormats=[{text:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{text:"YYYY-MM-DD HH:mm:ss.SSS",value:"YYYY-MM-DD HH:mm:ss.SSS"},{text:"MM/DD/YY h:mm:ss a",value:"MM/DD/YY h:mm:ss a"},{text:"MMMM D, YYYY LT",value:"MMMM D, YYYY LT"},{text:"YYYY-MM-DD",value:"YYYY-MM-DD"}],this.mappingTypes=[{text:"Value to text",value:1},{text:"Range to text",value:2}],this.alignTypes=g.alignTypesEnum,this.getColumnNames=()=>this.panelCtrl.table?(0,i.map)(this.panelCtrl.table.columns,(t=>t.text)):[],this.onColorChange=this.onColorChange.bind(this)}render(){this.panelCtrl.render()}setUnitFormat(t){return e=>{t.unit=e,this.panelCtrl.render()}}addColumnStyle(){const t=this.panel.styles,e=t.length;let s=e;if(e>0){"/.*/"===t[e-1].pattern&&(s=e-1)}t.splice(s,0,{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"",dateFormat:"YYYY-MM-DD HH:mm:ss",thresholds:[],mappingType:1,align:"auto"}),this.activeStyleIndex=s}removeColumnStyle(t){this.panel.styles=(0,i.without)(this.panel.styles,t)}invertColorOrder(t){const e=this.panel.styles[t].colors,s=e[0];e[0]=e[2],e[2]=s,this.panelCtrl.render()}onColorChange(t,e){return s=>{t.colors[e]=s,this.render()}}addValueMap(t){t.valueMaps||(t.valueMaps=[]),t.valueMaps.push({value:"",text:""}),this.panelCtrl.render()}removeValueMap(t,e){t.valueMaps.splice(e,1),this.panelCtrl.render()}addRangeMap(t){t.rangeMaps||(t.rangeMaps=[]),t.rangeMaps.push({from:"",to:"",text:""}),this.panelCtrl.render()}removeRangeMap(t,e){t.rangeMaps.splice(e,1),this.panelCtrl.render()}}function f(){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/column_options.html",controller:g}}g.$inject=["$scope"],m(g,"alignTypesEnum",[{text:"auto",value:""},{text:"left",value:"left"},{text:"center",value:"center"},{text:"right",value:"right"}]);var v=s(39302),b=s(9166),y=s(90845);const C={},w=t=>Array.isArray(t)?t.reduce(((t,e)=>e.datapoints?t.concat(e):t),[]):t.datapoints?[t]:[],S=t=>Array.isArray(t)?t.reduce(((t,e)=>e.columns?t.concat(e):t),[]):t.columns?[t]:[];function x(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}C.timeseries_to_rows={description:"Time series to rows",getColumns:()=>[],transform:(t,e,s)=>{s.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];const a=w(t);for(let t=0;t<a.length;t++){const e=a[t];for(let t=0;t<e.datapoints.length;t++){const a=e.datapoints[t];s.rows.push([a[1],e.target,a[0]])}}}},C.timeseries_to_columns={description:"Time series to columns",getColumns:()=>[],transform:(t,e,s)=>{s.columns.push({text:"Time",type:"date"});const a={},n=w(t);for(let t=0;t<n.length;t++){const e=n[t];s.columns.push({text:e.target});for(let s=0;s<e.datapoints.length;s++){const n=e.datapoints[s],i=n[1].toString();a[i]||(a[i]={time:n[1]}),a[i][t]=n[0]}}for(const t in a){const e=a[t],i=[e.time];for(let t=0;t<n.length;t++){const s=e[t];i.push(s)}s.rows.push(i)}}},C.timeseries_aggregations={description:"Time series aggregations",getColumns:()=>[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}],transform:(t,e,s)=>{let a,n;for(s.columns.push({text:"Metric"}),a=0;a<e.columns.length;a++)s.columns.push({text:e.columns[a].text});const i=w(t);for(a=0;a<i.length;a++){const t=new b.Z({datapoints:i[a].datapoints,alias:i[a].target});t.getFlotPairs("connected");const r=[t.alias];for(n=0;n<e.columns.length;n++)r.push(t.stats[e.columns[n].value]);s.rows.push(r)}}},C.annotations={description:"Annotations",getColumns:()=>[],transform:(t,e,s)=>{if(s.columns.push({text:"Time",type:"date"}),s.columns.push({text:"Title"}),s.columns.push({text:"Text"}),s.columns.push({text:"Tags"}),t&&t.annotations&&0!==t.annotations.length)for(let e=0;e<t.annotations.length;e++){const a=t.annotations[e];s.rows.push([a.time,a.title,a.text,a.tags])}}},C.table={description:"Table",getColumns:t=>{if(!t||0===t.length)return[];if(1===t.length)return[...t[0].columns];const e=S(t),s={};return e.reduce(((t,e)=>(e.columns.forEach((e=>{const{text:a}=e;void 0===s[a]&&(s[a]=t.length,t.push(e))})),t)),[])},transform:(t,e,s)=>{if(!t||0===t.length)return;const a=S(t),n=(0,i.findIndex)(a,(t=>"columns"in t&&"rows"in t));if(n<0)throw{message:`Result of query #${String.fromCharCode(65+n)} is not in table format, try using another transform.`};(0,v.M)(s,...a)}},C.json={description:"JSON Data",getColumns:t=>{if(!t||0===t.length)return[];const e={};for(let s=0;s<t.length;s++){const a=t[s];if("docs"!==a.type)continue;const n=Math.min(a.datapoints.length,100);for(let t=0;t<n;t++){const s=a.datapoints[t],n=(0,y.default)(s,{});for(const t in n)e[t]=!0}}return(0,i.map)(e,((t,e)=>({text:e,value:e})))},transform:(t,e,s)=>{let a,n,r;for(const a of e.columns){const e={text:a.text};t.length>0&&t[0].filterable&&(e.filterable=!0),s.columns.push(e)}for(0===s.columns.length&&s.columns.push({text:"JSON"}),a=0;a<t.length;a++){const l=t[a];for(n=0;n<l.datapoints.length;n++){const t=l.datapoints[n],a=[];if((0,i.isObject)(t)&&e.columns.length>0){const s=(0,y.default)(t);for(r=0;r<e.columns.length;r++)a.push(s[e.columns[r].value])}else a.push(JSON.stringify(t));s.rows.push(a)}}}};class M{constructor(t,e){x(this,"panel",void 0),x(this,"panelCtrl",void 0),x(this,"transformers",void 0),x(this,"fontSizes",void 0),x(this,"addColumnSegment",void 0),x(this,"getColumnNames",void 0),x(this,"canSetColumns",!1),x(this,"columnsHelpMessage",""),this.uiSegmentSrv=e,t.editor=this,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.transformers=C,this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.addColumnSegment=e.newPlusButton(),this.updateTransformHints()}updateTransformHints(){switch(this.canSetColumns=!1,this.columnsHelpMessage="",this.panel.transform){case"timeseries_aggregations":case"json":this.canSetColumns=!0;break;case"table":this.columnsHelpMessage="Columns and their order are determined by the data query"}}getColumnOptions(){if(!this.panelCtrl.dataRaw)return Promise.resolve([]);const t=this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),e=(0,i.map)(t,(t=>this.uiSegmentSrv.newSegment({value:t.text})));return Promise.resolve(e)}addColumn(){const t=C[this.panel.transform].getColumns(this.panelCtrl.dataRaw),e=(0,i.find)(t,{text:this.addColumnSegment.value});e&&(this.panel.columns.push(e),this.render());const s=this.uiSegmentSrv.newPlusButton();this.addColumnSegment.html=s.html,this.addColumnSegment.value=s.value}transformChanged(){this.panel.columns=[],"annotations"===this.panel.transform?this.panelCtrl.refresh():("timeseries_aggregations"===this.panel.transform&&this.panel.columns.push({text:"Avg",value:"avg"}),this.updateTransformHints(),this.render())}render(){this.panelCtrl.render()}removeColumn(t){this.panel.columns=(0,i.without)(this.panel.columns,t),this.panelCtrl.render()}}function D(t){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table-old/editor.html",controller:M}}M.$inject=["$scope","uiSegmentSrv"];var T=s(43381),$=s(79638),I=s(27494),R=s(93921);function Y(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class k{constructor(t,e,s,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,R.J)(),i=arguments.length>5?arguments[5]:void 0;Y(this,"formatters",[]),Y(this,"colorState",void 0),this.panel=t,this.table=e,this.timeZone=s,this.sanitize=a,this.templateSrv=n,this.theme=i,this.initColumns()}setTable(t){this.table=t,this.initColumns()}initColumns(){this.formatters=[],this.colorState={};for(let t=0;t<this.table.columns.length;t++){const e=this.table.columns[t];e.title=e.text;for(let t=0;t<this.panel.styles.length;t++){const s=this.panel.styles[t],a=(0,T.oH)(s.pattern)?s.pattern:(0,T.GE)((0,T.x6)(s.pattern)),n=(0,T.jO)(a);if(e.text.match(n)){e.style=s,s.alias&&(e.title=$.QX.escapeHtml(e.text.replace(n,s.alias)));break}}this.formatters[t]=this.createColumnFormatter(e)}}getColorForValue(t,e){if(!e.thresholds||!e.colors)return null;for(let s=e.thresholds.length;s>0;s--)if(t>=e.thresholds[s-1])return this.theme.visualization.getColorByName(e.colors[s]);return this.theme.visualization.getColorByName((0,i.first)(e.colors))}defaultCellFormatter(t,e){return null==t||void 0===t?"":((0,i.isArray)(t)&&(t=t.join(", ")),e&&e.sanitize?this.sanitize(t):(0,i.escape)(t))}createColumnFormatter(t){if(!t.style)return this.defaultCellFormatter;if("hidden"===t.style.type)return t=>{};if("date"===t.style.type)return e=>null==e?"-":((0,i.isArray)(e)&&(e=e[0]),(0,i.isString)(e)&&!isNaN(e)&&e.length>12&&(e=parseInt(e,10)),t.style.dateFormat?(0,I.dq)(e,{format:t.style.dateFormat,timeZone:this.timeZone}):(0,I.lf)(e,{timeZone:this.timeZone}));if("string"===t.style.type)return e=>{(0,i.isArray)(e)&&(e=e.join(", "));const s=t.style.mappingType||0;if(1===s&&t.style.valueMaps)for(let s=0;s<t.style.valueMaps.length;s++){const a=t.style.valueMaps[s];if(null!==e){if(!(0,i.isString)(e)&&Number(a.value)===Number(e)||a.value===e)return this.setColorState(e,t.style),this.defaultCellFormatter(a.text,t.style)}else if("null"===a.value)return a.text}if(2===s&&t.style.rangeMaps)for(let s=0;s<t.style.rangeMaps.length;s++){const a=t.style.rangeMaps[s];if(null!==e){if(Number(a.from)<=Number(e)&&Number(a.to)>=Number(e))return this.setColorState(e,t.style),this.defaultCellFormatter(a.text,t.style)}else if("null"===a.from&&"null"===a.to)return a.text}return null==e?"-":(this.setColorState(e,t.style),this.defaultCellFormatter(e,t.style))};if("number"===t.style.type){const e=(0,p.Cf)(t.unit||t.style.unit);return s=>null==s?"-":isNaN(s)||(0,i.isArray)(s)?this.defaultCellFormatter(s,t.style):(this.setColorState(s,t.style),(0,p.zc)(e(s,t.style.decimals,null)))}return e=>this.defaultCellFormatter(e,t.style)}setColorState(t,e){if(!e.colorMode)return;if(null==t||(0,i.isArray)(t))return;const s=Number(t);isNaN(s)||(this.colorState[e.colorMode]=this.getColorForValue(s,e))}renderRowVariables(t){const e={};let s;const a=this.table.rows[t];for(let t=0;t<a.length;t++)s=`__cell_${t}`,e[s]={value:a[t],text:a[t]?a[t].toString():""};return e}formatColumnValue(t,e){const s=this.formatters[t];return s?s(e):e}renderCell(t,e,s){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];s=this.formatColumnValue(t,s);const n=this.table.columns[t],r=[];let l="";const o=[];let h="";this.colorState.cell?(r.push("background-color:"+this.colorState.cell),o.push("table-panel-color-cell"),this.colorState.cell=null):this.colorState.value&&(r.push("color:"+this.colorState.value),this.colorState.value=null);let u="";if(a&&(u='<div class="table-panel-width-hack">'+this.table.columns[t].title+"</div>"),void 0===s?(r.push("display:none"),n.hidden=!0):n.hidden=!1,!0===n.hidden)return"";if(n.style&&n.style.preserveFormat&&o.push("table-panel-cell-pre"),n.style&&n.style.align){const t=(0,i.find)(g.alignTypesEnum,["text",n.style.align]);t&&t.value&&r.push(`text-align:${t.value}`)}if(r.length&&(l=' style="'+r.join(";")+'"'),n.style&&n.style.link){const t=this.renderRowVariables(e);t.__cell={value:s,text:s?s.toString():""};const a=this.templateSrv.replace(n.style.linkUrl,t,encodeURIComponent),i=$.QX.sanitizeUrl(a),r=$.QX.escapeHtml(this.templateSrv.replace(n.style.linkTooltip,t)),h=n.style.linkTargetBlank?"_blank":"";o.push("table-panel-cell-link"),u+=`<a href="${i}" target="${h}" data-link-tooltip data-original-title="${r}" data-placement="right"${l}>`,u+=`${s}`,u+="</a>"}else u+=s;return n.filterable&&(o.push("table-panel-cell-filterable"),u+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter out value" data-placement="bottom"\n           data-row="${e}" data-column="${t}" data-operator="!=">`,u+='<i class="fa fa-search-minus"></i>',u+="</a>",u+=`<a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter for value" data-placement="bottom"\n           data-row="${e}" data-column="${t}" data-operator="=">`,u+='<i class="fa fa-search-plus"></i>',u+="</a>"),o.length&&(h=' class="'+o.join(" ")+'"'),u="<td"+h+l+">"+u+"</td>",u}render(t){const e=this.panel.pageSize||100,s=t*e,a=Math.min(s+e,this.table.rows.length);let n="";for(let t=s;t<a;t++){const e=this.table.rows[t];let a="",i="";const r=[];let l="";for(let n=0;n<this.table.columns.length;n++)a+=this.renderCell(n,t,e[n],t===s);this.colorState.row&&(i=' style="background-color:'+this.colorState.row+'"',r.push("table-panel-color-row"),this.colorState.row=null),r.length&&(l=' class="'+r.join(" ")+'"'),n+="<tr "+l+i+">"+a+"</tr>"}return n}render_values(){const t=[],e=this.table.columns.filter((t=>!t.hidden));for(let e=0;e<this.table.rows.length;e++){const s=this.table.rows[e],a=[];for(let t=0;t<this.table.columns.length;t++)this.table.columns[t].hidden||a.push(this.formatColumnValue(t,s[t]));t.push(a)}return{columns:e,rows:t}}}function E(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class P extends c.MetricsPanelCtrl{constructor(t,e,s,a){super(t,e),E(this,"pageIndex",void 0),E(this,"dataRaw",void 0),E(this,"table",void 0),E(this,"renderer",void 0),E(this,"panelHasRowColorMode",void 0),E(this,"panelHasLinks",void 0),E(this,"panelDefaults",{targets:[{}],transform:"timeseries_to_columns",pageSize:null,showHeader:!0,styles:[{type:"date",pattern:"Time",alias:"Time",dateFormat:"YYYY-MM-DD HH:mm:ss",align:"auto"},{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"/.*/",thresholds:[],align:"right"}],columns:[],fontSize:"100%",sort:{col:0,desc:!0}}),this.annotationsSrv=s,this.$sanitize=a,this.pageIndex=0,void 0===this.panel.styles&&(this.panel.styles=this.panel.columns,this.panel.columns=this.panel.fields,delete this.panel.columns,delete this.panel.fields),(0,i.defaults)(this.panel,this.panelDefaults),this.panelHasRowColorMode=Boolean(this.panel.styles.find((t=>"row"===t.colorMode))),this.panelHasLinks=Boolean(this.panel.styles.find((t=>t.link))),this.events.on(r.Kh.dataReceived,this.onDataReceived.bind(this)),this.events.on(r.Kh.dataSnapshotLoad,this.onDataReceived.bind(this)),this.events.on(r.Kh.editModeInitialized,this.onInitEditMode.bind(this))}onInitEditMode(){this.addEditorTab("Options",D,2),this.addEditorTab("Column Styles",f,3)}migrateToPanel(t){this.onPluginTypeChange(h.ZP.panels[t])}issueQueries(t){return this.pageIndex=0,"annotations"===this.panel.transform?this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}).then((t=>(this.loading=!1,this.dataRaw=t,this.pageIndex=0,this.render(),{data:this.dataRaw}))):super.issueQueries(t)}onDataReceived(t){this.dataRaw=t,this.pageIndex=0,this.dataRaw&&this.dataRaw.length&&((0,l.Ji)(this.dataRaw[0])?this.panel.transform="table":"docs"===this.dataRaw[0].type?this.panel.transform="json":"table"!==this.panel.transform&&"json"!==this.panel.transform||(this.panel.transform="timeseries_to_rows")),this.render()}render(){return this.table=function(t,e){const s=new v.Z;if(!t||0===t.length)return s;const a=C[e.transform];if(!a)throw{message:"Transformer "+e.transform+" not found"};return a.transform(t,e,s),s}(this.dataRaw,this.panel),this.table.sort(this.panel.sort),this.renderer=new k(this.panel,this.table,this.dashboard.getTimezone(),this.$sanitize,this.templateSrv,h.ZP.theme2),super.render(this.table)}toggleColumnSort(t,e){this.table.columns[this.panel.sort.col]&&(this.table.columns[this.panel.sort.col].sort=!1),this.panel.sort.col===e?this.panel.sort.desc?this.panel.sort.desc=!1:this.panel.sort.col=null:(this.panel.sort.col=e,this.panel.sort.desc=!0),this.render()}link(t,e,s,a){let i;const l=a.panel;let o=0;function h(){let t=a.height;return o>1&&(t-=26),t-31+"px"}function c(){const t=e.parents(".panel-content"),s=e.find(".table-panel-scroll"),r=e.find("tbody"),u=e.find(".table-panel-footer");e.css({"font-size":l.fontSize}),t.addClass("table-panel-content"),function(t){a.renderer.setTable(i),t.empty(),t.html(a.renderer.render(a.pageIndex))}(r),function(t){t.empty();const e=l.pageSize||100;if(o=Math.ceil(i.rows.length/e),1===o)return;const s=Math.max(a.pageIndex-3,0),r=Math.min(o,s+9),h=n()("<ul></ul>");for(let t=s;t<r;t++){const e=t===a.pageIndex?"active":"",s=n()('<li><a class="table-panel-page-link pointer '+e+'">'+(t+1)+"</a></li>");h.append(s)}t.append(h)}(u),s.css({"max-height":h()})}e.tooltip({selector:"[data-link-tooltip]"}),e.on("click",".table-panel-page-link",(function(t){const e=n()(t.currentTarget);a.pageIndex=parseInt(e.text(),10)-1,c()})),e.on("click",".table-panel-filter-link",(function(t){const e=n()(t.currentTarget).data(),s={datasource:l.datasource,key:i.columns[e.column].text,value:i.rows[e.row][e.column],operator:e.operator};(0,d.WI)((0,u.m2)(s))}));const p=t.$on("$destroy",(()=>{e.off("click",".table-panel-page-link"),e.off("click",".table-panel-filter-link"),p()}));a.events.on(r.Kh.render,(t=>{i=t||i,i&&c(),a.renderingCompleted()}))}}P.$inject=["$scope","$injector","annotationsSrv","$sanitize"],E(P,"templateUrl","module.html");const F=new o.c(null);F.angularPanelCtrl=P,F.setNoPadding()},60974:(t,e,s)=>{s.r(e),s.d(e,{MetricsPanelCtrl:()=>h,PanelCtrl:()=>o,QueryCtrl:()=>u,loadPluginCss:()=>n.Y});var a=s(86623),n=s(15895),i=s(15866),r=s(91082),l=s(88643);const o=(0,a.s)(r.q),h=(0,a.s)(i.k),u=(0,a.s)(l.G)}}]);
//# sourceMappingURL=tableOldPlugin.84979130829519eda6e9.js.map